/* twilio-chat.js 2.2.0
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2018, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes javascript-state-machine under the following license.

    Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

This software includes durational under the following license.

    Copyright (c) 2014 Micheil Smith

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes q under the following license.

    Copyright 2009â€“2014 Kristopher Michael Kowal. All rights reserved.
    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to
    deal in the Software without restriction, including without limitation the
    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
    sell copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in
    all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
    IN THE SOFTWARE.

This software includes platform.js under the following license.

    Copyright 2014 Benjamin Tan <https://d10.github.io/>
    Copyright 2011-2015 John-David Dalton <http://allyoucanleet.com/>

    Permission is hereby granted, free of charge, to any person obtaining
    a copy of this software and associated documentation files (the
    "Software"), to deal in the Software without restriction, including
    without limitation the rights to use, copy, modify, merge, publish,
    distribute, sublicense, and/or sell copies of the Software, and to
    permit persons to whom the Software is furnished to do so, subject to
    the following conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
    LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
    OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
    WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;((t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Twilio||(t.Twilio={})).Chat=e()}}(function(){var d,e,t;return function s(o,a,u){function c(r,e){if(!a[r]){if(!o[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(l)return l(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=a[r]={exports:{}};o[r][0].call(i.exports,function(e){var t=o[r][1][e];return c(t||e)},i,i.exports,s,o,a,u)}return a[r].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,t,r){"use strict";var a=o(e("babel-runtime/core-js/get-iterator")),s=o(e("babel-runtime/regenerator")),h=o(e("babel-runtime/core-js/map")),d=o(e("babel-runtime/core-js/json/stringify")),p=o(e("babel-runtime/core-js/number/is-integer")),m=o(e("babel-runtime/core-js/object/get-prototype-of")),v=o(e("babel-runtime/helpers/classCallCheck")),n=o(e("babel-runtime/helpers/createClass")),b=o(e("babel-runtime/helpers/possibleConstructorReturn")),i=o(e("babel-runtime/helpers/inherits")),c=o(e("babel-runtime/core-js/promise"));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(s,o,a,u){return new(a||(a=c.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var l=e("events"),f=e("./logger"),y=e("./data/members"),_=e("./member"),g=e("./data/messages"),k=e("./util"),w=f.Logger.scope(""),x={lastMessage:"lastMessage",attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",name:"friendlyName",sid:"sid",status:"status",type:"type",uniqueName:"uniqueName"};function C(e){try{return new Date(e)}catch(e){return null}}function j(e){switch(e){case"notParticipating":return"known";default:return e}}r.filterStatus=j;var S=function(e){function f(e,t,r){(0,v.default)(this,f);var n=(0,b.default)(this,(f.__proto__||(0,m.default)(f)).call(this)),i=t.attributes||{},s=t.createdBy,o=C(t.dateCreated),a=C(t.dateUpdated),u=t.name||t.friendlyName||null,c=(0,p.default)(t.lastConsumedMessageIndex)?t.lastConsumedMessageIndex:null,l=t.uniqueName||null;try{(0,d.default)(i)}catch(e){throw new Error("Attributes must be a valid JSON object.")}return n.services=e,n.sid=r,n.entityName=t.channel,n.state={uniqueName:l,status:"known",type:t.type,attributes:i,createdBy:s,dateCreated:o,dateUpdated:a,friendlyName:u,lastConsumedMessageIndex:c},n.members=new h.default,n.membersEntity=new y.Members(n,n.services,n.members),n.membersEntity.on("memberJoined",n.emit.bind(n,"memberJoined")),n.membersEntity.on("memberLeft",n.emit.bind(n,"memberLeft")),n.membersEntity.on("memberUpdated",n.emit.bind(n,"memberUpdated")),n.messagesEntity=new g.Messages(n,e),n.messagesEntity.on("messageAdded",function(e){return n._onMessageAdded(e)}),n.messagesEntity.on("messageUpdated",n.emit.bind(n,"messageUpdated")),n.messagesEntity.on("messageRemoved",n.emit.bind(n,"messageRemoved")),n}return(0,i.default)(f,e),(0,n.default)(f,[{key:"_subscribe",value:function(){var t=this;return this.entityPromise?this.entityPromise:this.entityPromise=this.entityPromise||this.services.syncClient.document({id:this.entityName,mode:"open_existing"}).then(function(e){return t.entity=e,t.entity.on("updated",function(e){t._update(e.value)}),t.entity.on("removed",function(){return t.emit("removed",t)}),t._update(t.entity.value),e}).catch(function(e){throw t.entity=null,t.entityPromise=null,w.error("Failed to get channel object",e),e})}},{key:"_subscribeStreams",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){var t,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._subscribe();case 3:return w.trace("_subscribeStreams, this.entity.value=",this.entity.value),t=this.entity.value.messages,r=this.entity.value.roster,e.next=8,c.default.all([this.messagesEntity.subscribe(t),this.membersEntity.subscribe(r)]);case 8:e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),w.error("Failed to subscribe on channel objects",this.sid,e.t0),e.t0;case 14:case"end":return e.stop()}},e,this,[[0,10]])}))}},{key:"_unsubscribe",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrivate||!this.entity){e.next=5;break}return e.next=3,this.entity.close();case 3:this.entity=null,this.entityPromise=null;case 5:return e.abrupt("return",c.default.all([this.membersEntity.unsubscribe(),this.messagesEntity.unsubscribe()]));case 6:case"end":return e.stop()}},e,this)}))}},{key:"_setStatus",value:function(e,t){this.statusSource=t,this.state.status!==e&&("joined"===(this.state.status=e)?this._subscribeStreams():"invited"===e?this._subscribe():this.entityPromise&&this._unsubscribe())}},{key:"_statusSource",value:function(){return this.statusSource}},{key:"_update",value:function(e){w.trace("_update",e),f.preprocessUpdate(e,this.sid);var t=!1;for(var r in e){var n=x[r];n&&(n===x.status?e.status&&"unknown"!=e.status&&(this.state.status=j(e.status)):n===x.attributes?k.isDeepEqual(this.state.attributes,e.attributes)||(this.state.attributes=e.attributes,t=!0):n===x.lastMessage?this.state.lastMessage&&!e.lastMessage?(delete this.state.lastMessage,t=!0):(this.state.lastMessage||(this.state.lastMessage={}),e.lastMessage&&e.lastMessage.sid&&e.lastMessage.sid!==this.state.lastMessage.sid&&(this.state.lastMessage.sid=e.lastMessage.sid,t=!0),e.lastMessage&&e.lastMessage.author&&e.lastMessage.author!==this.state.lastMessage.author&&(this.state.lastMessage.author=e.lastMessage.author,t=!0),!e.lastMessage||!e.lastMessage.timestamp||this.state.lastMessage.timestamp&&this.state.lastMessage.timestamp.getTime()===e.lastMessage.timestamp.getTime()||(this.state.lastMessage.timestamp=e.lastMessage.timestamp,t=!0),k.isDeepEqual(this.state.lastMessage,{})&&delete this.state.lastMessage):e[r]instanceof Date?this.state[n]&&this.state[n].getTime()===e[r].getTime()||(this.state[n]=e[r],t=!0):this[n]!==e[r]&&(this.state[n]=e[r],t=!0))}t&&this.emit("updated",this)}},{key:"_onMessageAdded",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,s=(0,a.default)(this.members.values());!(t=(i=s.next()).done);t=!0){var o=i.value;if(o.identity===e.author){o._endTyping();break}}}catch(e){r=!0,n=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw n}}this.emit("messageAdded",e)}},{key:"add",value:function(t){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&"string"==typeof t){e.next=2;break}throw new Error("Channel.add requires an <String>identity parameter");case 2:return e.abrupt("return",this.membersEntity.add(t));case 3:case"end":return e.stop()}},e,this)}))}},{key:"advanceLastConsumedMessageIndex",value:function(t){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,p.default)(t)){e.next=2;break}throw new Error("Channel.advanceLastConsumedMessageIndex requires an integral <Number>index parameter");case 2:return e.next=4,this._subscribeStreams();case 4:return e.abrupt("return",this.services.consumptionHorizon.advanceLastConsumedMessageIndexForChannel(this.sid,t,this.lastConsumedMessageIndex));case 5:case"end":return e.stop()}},e,this)}))}},{key:"decline",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("declineInvitation",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}))}},{key:"delete",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("destroyChannel",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}))}},{key:"getAttributes",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe();case 2:return e.abrupt("return",this.attributes);case 3:case"end":return e.stop()}},e,this)}))}},{key:"getMessages",value:function(t,r,n){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r||(0,p.default)(r)){e.next=2;break}throw new Error("Anchor should be a valid message index");case 2:return e.next=4,this._subscribeStreams();case 4:return e.abrupt("return",this.messagesEntity.getMessages(t,r,n));case 5:case"end":return e.stop()}},e,this)}))}},{key:"getMembers",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.membersEntity.getMembers());case 3:case"end":return e.stop()}},e,this)}))}},{key:"getMembersCount",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){var t,r,n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,r=new k.UriBuilder(t.publicChannelsUrl).path(this.sid).build(),e.next=6,this.services.network.get(r);case 6:return n=e.sent,e.abrupt("return",n.body.members_count);case 8:case"end":return e.stop()}},e,this)}))}},{key:"getMessagesCount",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){var t,r,n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,r=new k.UriBuilder(t.publicChannelsUrl).path(this.sid).build(),e.next=6,this.services.network.get(r);case 6:return n=e.sent,e.abrupt("return",n.body.messages_count);case 8:case"end":return e.stop()}},e,this)}))}},{key:"getUnconsumedMessagesCount",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){var t,r,n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,r=new k.UriBuilder(t.myChannelsUrl).arg("ChannelSid",this.sid).build(),e.next=6,this.services.network.get(r);case 6:if(!(n=e.sent).body.channels.length){e.next=13;break}if(void 0===n.body.channels[0].unread_messages_count||null==n.body.channels[0].unread_messages_count){e.next=12;break}return e.abrupt("return",n.body.channels[0].unread_messages_count);case 12:return e.abrupt("return",null);case 13:throw new Error("Channel is not in user channels list");case 14:case"end":return e.stop()}},e,this)}))}},{key:"invite",value:function(t){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t&&t.length){e.next=2;break}throw new Error("Channel.invite requires an <String>identity parameter");case 2:return e.abrupt("return",this.membersEntity.invite(t));case 3:case"end":return e.stop()}},e,this)}))}},{key:"join",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("joinChannelV2",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}))}},{key:"leave",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"!==this.state.status){e.next=3;break}return e.next=3,this.services.session.addCommand("leaveChannel",{channelSid:this.sid});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}},e,this)}))}},{key:"removeMember",value:function(t){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&("string"==typeof t||t instanceof _.Member)){e.next=2;break}throw new Error("Channel.removeMember requires a <String|Member>member parameter.");case 2:return e.abrupt("return",this.membersEntity.remove("string"==typeof t?t:t.identity));case 3:case"end":return e.stop()}},e,this)}))}},{key:"sendMessage",value:function(n,i){return u(this,void 0,void 0,s.default.mark(function e(){var t,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof n){e.next=7;break}return e.next=3,this.messagesEntity.send(n,i);case 3:return t=e.sent,e.abrupt("return",t.messageId);case 7:return e.next=9,this.messagesEntity.sendMedia(n,i);case 9:return r=e.sent,e.abrupt("return",r.messageId);case 11:case"end":return e.stop()}},e,this)}))}},{key:"setAllMessagesConsumed",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){var t;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this.getMessages(1);case 4:if(!(0<(t=e.sent).items.length)){e.next=7;break}return e.abrupt("return",this.advanceLastConsumedMessageIndex(t.items[0].index));case 7:return e.abrupt("return",c.default.resolve(0));case 8:case"end":return e.stop()}},e,this)}))}},{key:"setNoMessagesConsumed",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,null));case 3:case"end":return e.stop()}},e,this)}))}},{key:"typing",value:function(){return this.services.typingIndicator.send(this.sid)}},{key:"updateAttributes",value:function(t){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}throw new Error("Attributes can't be null");case 4:if(t.constructor===Object){e.next=6;break}throw new Error("Attributes must be a valid JSON object.");case 6:return e.next=8,this.services.session.addCommand("editAttributes",{channelSid:this.sid,attributes:(0,d.default)(t)});case 8:return e.abrupt("return",this);case 9:case"end":return e.stop()}},e,this)}))}},{key:"updateFriendlyName",value:function(t){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.friendlyName===t){e.next=3;break}return e.next=3,this.services.session.addCommand("editFriendlyName",{channelSid:this.sid,friendlyName:t});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}},e,this)}))}},{key:"updateLastConsumedMessageIndex",value:function(t){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,p.default)(t)||null===t){e.next=2;break}throw new Error('Incorrect argument "index": integer number or null expected');case 2:return e.next=4,this._subscribeStreams();case 4:return e.abrupt("return",this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,t));case 5:case"end":return e.stop()}},e,this)}))}},{key:"updateUniqueName",value:function(t){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.uniqueName===t){e.next=3;break}return e.next=3,this.services.session.addCommand("editUniqueName",{channelSid:this.sid,uniqueName:t});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}},e,this)}))}},{key:"getUserDescriptors",value:function(){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getChannelUserDescriptors(this.sid));case 1:case"end":return e.stop()}},e,this)}))}},{key:"status",get:function(){return this.state.status}},{key:"type",get:function(){return this.state.type}},{key:"uniqueName",get:function(){return this.state.uniqueName}},{key:"isPrivate",get:function(){return"private"===this.state.type}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"createdBy",get:function(){return this.state.createdBy}},{key:"attributes",get:function(){return this.state.attributes}},{key:"lastConsumedMessageIndex",get:function(){return this.state.lastConsumedMessageIndex}},{key:"lastMessage",get:function(){return this.state.lastMessage}}],[{key:"preprocessUpdate",value:function(t,r){try{"string"==typeof t.attributes?t.attributes=JSON.parse(t.attributes):t.attributes&&(0,d.default)(t.attributes)}catch(e){w.warn("Retrieved malformed attributes from the server for channel: "+r),t.attributes={}}try{t.dateCreated&&(t.dateCreated=new Date(t.dateCreated))}catch(e){w.warn("Retrieved malformed dateCreated from the server for channel: "+r),delete t.dateCreated}try{t.dateUpdated&&(t.dateUpdated=new Date(t.dateUpdated))}catch(e){w.warn("Retrieved malformed dateUpdated from the server for channel: "+r),delete t.dateUpdated}try{t.lastMessage&&t.lastMessage.timestamp&&(t.lastMessage.timestamp=new Date(t.lastMessage.timestamp))}catch(e){w.warn("Retrieved malformed lastMessage.timestamp from the server for channel: "+r),delete t.lastMessage.timestamp}}}]),f}(l.EventEmitter);r.Channel=S},{"./data/members":6,"./data/messages":7,"./logger":14,"./member":16,"./util":30,"babel-runtime/core-js/get-iterator":32,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/map":35,"babel-runtime/core-js/number/is-integer":36,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57,events:214}],2:[function(e,t,r){"use strict";var n=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./logger"),a=e("./channel"),u=new o.Logger;function c(e){try{return new Date(e)}catch(e){return null}}var l=function(){function r(e,t){(0,n.default)(this,r),this.client=e,(this.descriptor=t).sid?(this.sid=t.sid,this.channel=t.sid+".channel"):(this.sid=t.channel_sid,this.channel=t.channel_sid+".channel"),this.uniqueName=t.unique_name,this.friendlyName=t.friendly_name,this.attributes=function(e){try{return JSON.parse(e)}catch(e){u.warn("Failed to parse channel attributes",e)}return{}}(t.attributes),this.createdBy=t.created_by,this.dateCreated=c(t.date_created),this.dateUpdated=c(t.date_updated),this.messagesCount=t.messages_count,this.membersCount=t.members_count,this.type=t.type,this.isPrivate="private"==t.type,this.lastConsumedMessageIndex=t.last_consumed_message_index,t.status?this.status=a.filterStatus(t.status):this.status="unknown"}return(0,i.default)(r,[{key:"getChannel",value:function(){return this.client.getChannelBySid(this.sid)}}]),r}();r.ChannelDescriptor=l},{"./channel":1,"./logger":14,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],3:[function(e,t,r){"use strict";var s=l(e("babel-runtime/regenerator")),o=l(e("babel-runtime/helpers/extends")),n=l(e("babel-runtime/core-js/object/get-prototype-of")),i=l(e("babel-runtime/helpers/createClass")),a=l(e("babel-runtime/helpers/possibleConstructorReturn")),u=l(e("babel-runtime/helpers/inherits")),c=l(e("babel-runtime/helpers/classCallCheck")),f=l(e("babel-runtime/core-js/promise"));function l(e){return e&&e.__esModule?e:{default:e}}var h=function(s,o,a,u){return new(a||(a=f.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var d=e("events"),p=e("./logger"),m=e("./configuration"),v=e("./user");r.User=v.User;var b=e("./data/publicchannels"),y=e("./services/network"),_=e("./interfaces/notificationtypes"),g=e("./synclist"),k=e("twilsock"),w=e("twilio-notifications"),x=e("twilio-transport"),C=e("twilio-sync"),j=e("twilio-ems-client"),S=e("twilio-mcs-client"),E=e("./session"),T=e("./data/channels"),I=e("./data/users"),R=e("./services/typingindicator"),M=e("./services/consumptionhorizon"),P=e("./data/userchannels"),A=e("./pushnotification");r.PushNotification=A.PushNotification;var O=e("./util"),N=p.Logger.scope(""),D=e("./../package.json").version,U="A valid Twilio token should be provided",L=function e(){(0,c.default)(this,e)},F=function(e){function l(e,t){(0,c.default)(this,l);var r=(0,a.default)(this,(l.__proto__||(0,n.default)(l)).call(this));if(r.connectionState="connecting",r.sessionPromise=null,r.channelsPromise=null,r.version=D,r.parsePushNotification=l.parsePushNotification,r.options=t||{},r.options.disableDeepClone||(r.options=O.deepClone(r.options)),r.options.logLevel=r.options.logLevel||"error",r.options.productId="ip_messaging",r.options.Sync=r.options.Sync||{},r.options.Sync.enableSessionStorage||(r.options.Sync.enableSessionStorage=!1),!e)throw new Error(U);return N.setLevel(r.options.logLevel),r.services=new L,r.config=new m.Configuration(null,r.options),r.options.twilsockClient=r.options.twilsockClient||new k(e,r.options),r.options.transport=r.options.transport||new x.Transport(r.options.twilsockClient,r.options),r.options.emsClient=r.options.emsClient||new j.EmsClient(r.options),r.options.notificationsClient=r.options.notificationsClient||new w(e,r.options),r.options.syncClient=r.options.syncClient||new C.SyncClient(e,r.options),r.services.emsClient=r.options.emsClient,r.services.syncClient=r.options.syncClient,r.services.transport=r.options.transport,r.services.twilsockClient=r.options.twilsockClient,r.services.notificationClient=r.options.notificationsClient,r.services.session=new E.Session(r.services,r.config),r.sessionPromise=r.services.session.initialize(),r.services.network=new y.Network(r.config,r.services),r.services.users=new I.Users({session:r.services.session,network:r.services.network,syncClient:r.services.syncClient}),r.services.users.on("userSubscribed",r.emit.bind(r,"userSubscribed")),r.services.users.on("userUpdated",r.emit.bind(r,"userUpdated")),r.services.users.on("userUnsubscribed",r.emit.bind(r,"userUnsubscribed")),r.services.consumptionHorizon=new M.ConsumptionHorizon(r.services),r.services.typingIndicator=new R.TypingIndicator(r.config,{transport:r.services.transport,notificationClient:r.services.notificationClient},r.getChannelBySid.bind(r)),r.services.syncList=new g.SyncList(r.services),r.channels=new T.Channels(r.services),r.channelsPromise=r.sessionPromise.then(function(){return r.channels.on("channelAdded",r.emit.bind(r,"channelAdded")),r.channels.on("channelRemoved",r.emit.bind(r,"channelRemoved")),r.channels.on("channelInvited",r.emit.bind(r,"channelInvited")),r.channels.on("channelJoined",r.emit.bind(r,"channelJoined")),r.channels.on("channelLeft",r.emit.bind(r,"channelLeft")),r.channels.on("channelUpdated",r.emit.bind(r,"channelUpdated")),r.channels.on("memberJoined",r.emit.bind(r,"memberJoined")),r.channels.on("memberLeft",r.emit.bind(r,"memberLeft")),r.channels.on("memberUpdated",r.emit.bind(r,"memberUpdated")),r.channels.on("messageAdded",r.emit.bind(r,"messageAdded")),r.channels.on("messageUpdated",r.emit.bind(r,"messageUpdated")),r.channels.on("messageRemoved",r.emit.bind(r,"messageRemoved")),r.channels.on("typingStarted",r.emit.bind(r,"typingStarted")),r.channels.on("typingEnded",r.emit.bind(r,"typingEnded")),r.channels.fetchChannels()}).then(function(){return r.channels}),r.services.notificationClient.on("connectionStateChanged",function(e){var t=null;switch(e){case"connected":t="connected";break;case"rejected":case"denied":t="denied";break;case"disconnecting":t="disconnecting";break;case"disconnected":t="disconnected";break;default:t="connecting"}t!==r.connectionState&&(r.connectionState=t,r.emit("connectionStateChanged",r.connectionState))}),r.fpaToken=e,r}return(0,u.default)(l,e),(0,i.default)(l,[{key:"subscribeToPushNotifications",value:function(t){var r=this,n=[];return[_.NotificationTypes.NEW_MESSAGE,_.NotificationTypes.ADDED_TO_CHANNEL,_.NotificationTypes.INVITED_TO_CHANNEL,_.NotificationTypes.REMOVED_FROM_CHANNEL,_.NotificationTypes.TYPING_INDICATOR,_.NotificationTypes.CONSUMPTION_UPDATE].forEach(function(e){n.push(r.services.notificationClient.subscribe(e,t))}),f.default.all(n)}},{key:"unsubscribeFromPushNotifications",value:function(t){var r=this,n=[];return[_.NotificationTypes.NEW_MESSAGE,_.NotificationTypes.ADDED_TO_CHANNEL,_.NotificationTypes.INVITED_TO_CHANNEL,_.NotificationTypes.REMOVED_FROM_CHANNEL,_.NotificationTypes.TYPING_INDICATOR,_.NotificationTypes.CONSUMPTION_UPDATE].forEach(function(e){n.push(r.services.notificationClient.unsubscribe(e,t))}),f.default.all(n)}},{key:"initialize",value:function(){return h(this,void 0,void 0,s.default.mark(function e(){var t,r,n,i=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.emsClient.setToken(this.fpaToken);case 2:return t=e.sent,this.config.updateToken(t.token),e.next=6,this.sessionPromise;case 6:return l.supportedPushChannels.forEach(function(e){return i.subscribeToPushNotifications(e)}),e.next=9,this.services.session.getSessionLinks();case 9:return r=e.sent,this.services.publicChannels=new b.PublicChannels(this,this.services,r.publicChannelsUrl),this.services.userChannels=new P.UserChannels(this,this.services,r.myChannelsUrl),(n=(0,o.default)(this.options)).transport=null,this.services.mcsClient=new S.McsClient(this.config.token,r.mediaServiceUrl,n),e.next=17,this.services.typingIndicator.initialize();case 17:case"end":return e.stop()}},e,this)}))}},{key:"shutdown",value:function(){return h(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.twilsockClient.disconnect();case 2:case"end":return e.stop()}},e,this)}))}},{key:"updateToken",value:function(r){return h(this,void 0,void 0,s.default.mark(function e(){var t=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(N.info("updateToken"),r){e.next=3;break}throw new Error(U);case 3:if(r!==this.fpaToken){e.next=5;break}return e.abrupt("return",this);case 5:return e.abrupt("return",this.services.emsClient.setToken(r).then(function(e){if("NEW"===e.status)throw N.error("Can't extend token:",e.reason),new Error("Can't extend token:"+e.reason);return e.token}).then(function(e){return t.services.twilsockClient.updateToken(r).then(function(){return t.services.syncClient.updateToken(r)}).then(function(){return t.services.notificationClient.updateToken(r)}).then(function(){return t.services.mcsClient.updateToken(r)}).then(function(){return t.sessionPromise}).then(function(){return e})}).then(function(e){return t.config.updateToken(e),t.fpaToken=r,t}));case 6:case"end":return e.stop()}},e,this)}))}},{key:"getChannelBySid",value:function(r){return h(this,void 0,void 0,s.default.mark(function e(){var t=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&"string"==typeof r){e.next=2;break}throw new Error("Client.getChannelBySid requires a <String>channelSid parameter");case 2:return e.abrupt("return",this.channels.syncListRead.promise.then(function(){return t.channels.getChannel(r).then(function(e){return e||t.services.publicChannels.getChannelBySid(r).then(function(e){return t.channels.pushChannel(e)})})}));case 3:case"end":return e.stop()}},e,this)}))}},{key:"getChannelByUniqueName",value:function(r){return h(this,void 0,void 0,s.default.mark(function e(){var t=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&"string"==typeof r){e.next=2;break}throw new Error("Client.getChannelByUniqueName requires a <String>uniqueName parameter");case 2:return e.abrupt("return",this.channels.syncListRead.promise.then(function(){return t.services.publicChannels.getChannelByUniqueName(r).then(function(e){return t.channels.pushChannel(e)})}));case 3:case"end":return e.stop()}},e,this)}))}},{key:"getSubscribedChannels",value:function(t){return this.channelsPromise.then(function(e){return e.getChannels(t)})}},{key:"getLocalChannels",value:function(n){return this.channelsPromise.then(function(e){var t=[];e.channels.forEach(function(e){t.push(e)});var r="ascending";if(n&&n.order)if("descending"===n.order)r="descending";else if("ascending"!==n.order)throw new Error("Sorting order should be `ascending` or `descending`");if(n&&n.criteria)if("lastMessage"===n.criteria)t.sort(function(e,t){return l.compareChannelsByLastMessage(e,t,r)});else if("uniqueName"===n.criteria)t.sort(function(e,t){return l.compareChannelsByStringProperty(e.uniqueName,t.uniqueName,r)});else{if("friendlyName"!==n.criteria)throw new Error("Sorting criteria should be one of `lastMessage`, `uniqueName` or `friendlyName`");t.sort(function(e,t){return l.compareChannelsByStringProperty(e.friendlyName,t.friendlyName,r)})}return t})}},{key:"getPublicChannelDescriptors",value:function(){return this.services.publicChannels.getChannels()}},{key:"getUserChannelDescriptors",value:function(){return this.services.userChannels.getChannels()}},{key:"createChannel",value:function(t){return t=t||{},this.channelsPromise.then(function(e){return e.addChannel(t)})}},{key:"setPushRegistrationId",value:function(r,n){return h(this,void 0,void 0,s.default.mark(function e(){var t=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==l.supportedPushChannels.indexOf(r)){e.next=2;break}throw new Error("Invalid or unsupported channelType: "+r);case 2:return e.next=4,this.subscribeToPushNotifications(r).then(function(){return t.services.notificationClient.setPushRegistrationId(n,r)});case 4:case"end":return e.stop()}},e,this)}))}},{key:"unsetPushRegistrationId",value:function(t){return h(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==l.supportedPushChannels.indexOf(t)){e.next=2;break}throw new Error("Invalid or unsupported channelType: "+t);case 2:return e.next=4,this.unsubscribeFromPushNotifications(t);case 4:case"end":return e.stop()}},e,this)}))}},{key:"handlePushNotification",value:function(t){return h(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:N.debug("handlePushNotification, notificationPayload=",t),this.emit("pushNotification",l.parsePushNotification(t));case 2:case"end":return e.stop()}},e,this)}))}},{key:"getUser",value:function(e){return this.services.users.getUser(e)}},{key:"getUserDescriptor",value:function(t){return h(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getUserDescriptor(t));case 1:case"end":return e.stop()}},e,this)}))}},{key:"getSubscribedUsers",value:function(){return h(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getSubscribedUsers());case 1:case"end":return e.stop()}},e,this)}))}},{key:"user",get:function(){return this.services.users.myself}},{key:"reachabilityEnabled",get:function(){return this.services.session.reachabilityEnabled}},{key:"token",get:function(){return this.config.token}}],[{key:"create",value:function(r,n){return h(this,void 0,void 0,s.default.mark(function e(){var t;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new l(r,n),e.next=3,t.initialize();case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}))}},{key:"compareChannelsByLastMessage",value:function(e,t,r){if(e.lastMessage&&t.lastMessage){if(e.lastMessage.timestamp&&t.lastMessage.timestamp)return e.lastMessage.timestamp.getTime()<t.lastMessage.timestamp.getTime()?"ascending"===r?-1:1:"ascending"===r?1:-1;if(e.lastMessage.timestamp)return-1;if(t.lastMessage.timestamp)return 1}return e.lastMessage?-1:t.lastMessage?1:0}},{key:"compareChannelsByStringProperty",value:function(e,t,r){return e&&t?"ascending"===r?e.localeCompare(t):-1*e.localeCompare(t):e?-1:t?1:0}},{key:"parsePushNotificationChatData",value:function(e){var t={};for(var r in l.supportedPushDataFields)void 0!==e[r]&&null!==e[r]&&("message_index"===r?null!==O.parseToNumber(e[r])&&(t[l.supportedPushDataFields[r]]=Number(e[r])):t[l.supportedPushDataFields[r]]=e[r]);return t}},{key:"parsePushNotification",value:function(e){if(N.debug("parsePushNotification, notificationPayload=",e),null==e)throw new Error("Push notification payload should be provided");if(void 0!==e.aps){var t=null,r=null,n={};if(void 0!==e.data&&(n=l.parsePushNotificationChatData(e.data)),!e.type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var i=e.aps;"string"==typeof i.alert?t=i.alert||null:(t=i.alert.body||null,r=i.alert.title||null);var s=i.badge||null,o=i.sound||null,a=i.category||null;return new A.PushNotification({title:r,body:t,sound:o,badge:s,action:a,type:e.type,data:n})}if(void 0!==e.data){var u=e.data;if(u.twi_message_type){var c=l.parsePushNotificationChatData(e.data);return new A.PushNotification({title:u.twi_title||null,body:u.twi_body||null,sound:u.twi_sound||null,badge:null,action:u.twi_action||null,type:u.twi_message_type,data:c})}throw new Error("Provided push notification payload does not contain Programmable Chat push notification type")}throw new Error("Provided push notification payload is not Programmable Chat notification")}}]),l}(d.EventEmitter);F.version=D,F.supportedPushChannels=["fcm","apn","gcm"],F.supportedPushDataFields={channel_sid:"channelSid",message_sid:"messageSid",message_index:"messageIndex"},r.Client=F,r.default=F},{"./../package.json":291,"./configuration":4,"./data/channels":5,"./data/publicchannels":8,"./data/userchannels":9,"./data/users":11,"./interfaces/notificationtypes":12,"./logger":14,"./pushnotification":18,"./services/consumptionhorizon":20,"./services/network":21,"./services/typingindicator":22,"./session":23,"./synclist":25,"./user":27,"./util":30,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/extends":52,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57,events:214,"twilio-ems-client":229,"twilio-mcs-client":235,"twilio-notifications":242,"twilio-sync":253,"twilio-transport":273,twilsock:276}],4:[function(e,t,r){"use strict";var i=n(e("babel-runtime/helpers/classCallCheck")),s=n(e("babel-runtime/helpers/createClass"));function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o="https://aim.twilio.com",a=function(){function n(e,t){(0,i.default)(this,n),t=t||{},this.options=t.Chat||t.IPMessaging||t||{};var r=this.options.apiUri||this.options.typingUri||o;this.token=e,this.baseUrl=r}return(0,s.default)(n,[{key:"updateToken",value:function(e){this.token=e}},{key:"typingIndicatorUri",get:function(){return this.baseUrl+"/v1/typing"}},{key:"typingIndicatorTimeoutDefault",get:function(){return 5e3}},{key:"httpCacheIntervalDefault",get:function(){return"PT5S"}},{key:"consumptionReportIntervalDefault",get:function(){return"PT5S"}},{key:"userInfosToSubscribeDefault",get:function(){return 100}},{key:"backoffConfigDefault",get:function(){return{min:1e3,max:4e3,maxAttemptsCount:3}}},{key:"backoffConfigOverride",get:function(){return this.options.backoffConfigOverride}},{key:"retryWhenThrottledDefault",get:function(){return!0}},{key:"retryWhenThrottledOverride",get:function(){return this.options.retryWhenThrottledOverride}},{key:"typingIndicatorTimeoutOverride",get:function(){return this.options.typingIndicatorTimeoutOverride}},{key:"httpCacheIntervalOverride",get:function(){return this.options.httpCacheIntervalOverride}},{key:"consumptionReportIntervalOverride",get:function(){return this.options.consumptionReportIntervalOverride}},{key:"userInfosToSubscribeOverride",get:function(){return this.options.userInfosToSubscribeOverride}}]),n}();r.Configuration=a},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],5:[function(e,t,r){"use strict";var a=d(e("babel-runtime/regenerator")),u=d(e("babel-runtime/core-js/json/stringify")),n=d(e("babel-runtime/core-js/set")),i=d(e("babel-runtime/core-js/map")),s=d(e("babel-runtime/core-js/object/get-prototype-of")),o=d(e("babel-runtime/helpers/classCallCheck")),c=d(e("babel-runtime/helpers/createClass")),l=d(e("babel-runtime/helpers/possibleConstructorReturn")),f=d(e("babel-runtime/helpers/inherits")),h=d(e("babel-runtime/core-js/promise"));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(s,o,a,u){return new(a||(a=h.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var m=e("events"),v=e("../logger"),b=e("../channel");r.Channel=b.Channel;var y=e("../util/deferred"),_=v.Logger.scope(""),g=function(e){function r(e){(0,o.default)(this,r);var t=(0,l.default)(this,(r.__proto__||(0,s.default)(r)).call(this));return t.services=e,t.channels=new i.default,t.thumbstones=new n.default,t.syncListFetched=!1,t.syncListRead=new y.Deferred,t}return(0,f.default)(r,e),(0,c.default)(r,[{key:"getMap",value:function(){var t=this;return this.services.session.getMyChannelsId().then(function(e){return t.services.syncClient.map({id:e,mode:"open_existing"})})}},{key:"addChannel",value:function(o){return p(this,void 0,void 0,a.default.mark(function e(){var t,r,n,i,s;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("createChannel",{friendlyName:o.friendlyName,uniqueName:o.uniqueName,type:o.isPrivate?"private":"public",attributes:(0,u.default)(o.attributes)});case 2:if(t=e.sent,r="channelSid"in t?t.channelSid:null,n="channel"in t?t.channel:null,!(i=this.channels.get(r))){e.next=10;break}return e.next=9,i._subscribe();case 9:return e.abrupt("return",i);case 10:return s=new b.Channel(this.services,{channel:n,name:null,entityName:null,uniqueName:null,attributes:null,createdBy:null,friendlyName:null,lastConsumedMessageIndex:null,type:o.isPrivate?"private":"public",dateCreated:null,dateUpdated:null},r),this.channels.set(s.sid,s),this.registerForEvents(s),e.next=15,s._subscribe();case 15:return this.emit("channelAdded",s),e.abrupt("return",s);case 17:case"end":return e.stop()}},e,this)}))}},{key:"fetchChannels",value:function(){var e=this;this.getMap().then(function(i){return p(e,void 0,void 0,a.default.mark(function e(){var t,r,n=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.on("itemAdded",function(e){n.upsertChannel("sync",e.item.key,e.item.value)}),i.on("itemRemoved",function(e){var t=e.key;n.syncListFetched||n.thumbstones.add(t);var r=n.channels.get(t);r&&("joined"!==r.status&&"invited"!==r.status||(r._setStatus("known","sync"),n.emit("channelLeft",r)),r.isPrivate&&(n.channels.delete(t),n.emit("channelRemoved",r)))}),i.on("itemUpdated",function(e){n.upsertChannel("sync",e.item.key,e.item.value)}),t=[],e.next=6,this.services.syncList.getPage();case 6:r=e.sent,r.items.forEach(function(e){t.push(n.upsertChannel("synclist",e.channel_sid,e.descriptor))});case 9:if(!r.hasNextPage){e.next=16;break}return e.next=12,r.nextPage();case 12:(r=e.sent).items.forEach(function(e){t.push(n.upsertChannel("synclist",e.channel_sid,e.descriptor))}),e.next=9;break;case 16:return this.syncListRead.set(!0),e.abrupt("return",h.default.all(t));case 18:case"end":return e.stop()}},e,this)}))}).then(function(){e.syncListFetched=!0,e.thumbstones.clear(),_.debug("Channels list fetched")}).then(function(){return e}).catch(function(e){throw _.error("Failed to get channels list",e),e})}},{key:"_wrapPaginator",value:function(t,r){var n=this;return r(t.items).then(function(e){return{items:e,hasNextPage:t.hasNextPage,hasPrevPage:t.hasPrevPage,nextPage:function(){return t.nextPage().then(function(e){return n._wrapPaginator(e,r)})},prevPage:function(){return t.prevPage().then(function(e){return n._wrapPaginator(e,r)})}}})}},{key:"getChannels",value:function(t){var r=this;return this.getMap().then(function(e){return e.getItems(t)}).then(function(e){return r._wrapPaginator(e,function(e){return h.default.all(e.map(function(e){return r.upsertChannel("sync",e.key,e.value)}))})})}},{key:"getChannel",value:function(t){var r=this;return this.getMap().then(function(e){return e.getItems({key:t})}).then(function(e){return e.items.map(function(e){return r.upsertChannel("sync",e.key,e.value)})}).then(function(e){return 0<e.length?e[0]:null})}},{key:"pushChannel",value:function(e){var t=e.sid,r={name:null,entityName:null,lastConsumedMessageIndex:e.lastConsumedMessageIndex,type:e.type,status:e.status,friendlyName:e.friendlyName,dateUpdated:e.dateUpdated,dateCreated:e.dateCreated,uniqueName:e.uniqueName,createdBy:e.createdBy,attributes:e.attributes,channel:e.channel,sid:t};return this.upsertChannel("chat",t,r)}},{key:"upsertChannel",value:function(e,t,r){var n=this;_.trace("upsertChannel(sid="+t+", data=",r);var i=this.channels.get(t);return i?(_.trace("upsertChannel: channel "+t+" is known and it's status is known from source "+i._statusSource()+" and update came from source "+e,i),void 0===i._statusSource()||e===i._statusSource()||"synclist"===e&&"sync"!==i._statusSource()||"sync"===e?"joined"===r.status&&"joined"!==i.status?(i._setStatus("joined",e),void 0!==r.lastConsumedMessageIndex&&i._update({lastConsumedMessageIndex:r.lastConsumedMessageIndex}),i._subscribe().then(function(){n.emit("channelJoined",i)})):"invited"===r.status&&"invited"!==i.status?(i._setStatus("invited",e),i._subscribe().then(function(){n.emit("channelInvited",i)})):"known"!==r.status||"invited"!==i.status&&"joined"!==i.status?"notParticipating"!==r.status&&"known"!==r.status||"private"!==r.type?i._update(r):i._subscribe():(i._setStatus("known",e),i._update(r),i._subscribe().then(function(){n.emit("channelLeft",i)})):_.trace("upsertChannel: channel is known from sync and came from chat, ignoring",{sid:t,data:r.status,channel:i.status}),i._subscribe().then(function(){return i})):"chat"!==e&&"synclist"!==e||!this.thumbstones.has(t)?(_.trace("upsertChannel: creating local channel object with sid "+t,r),i=new b.Channel(this.services,r,t),this.registerForEvents(i),this.channels.set(t,i),i._subscribe().then(function(){return n.emit("channelAdded",i),"joined"===r.status?(i._setStatus("joined",e),n.emit("channelJoined",i)):"invited"===r.status&&(i._setStatus("invited",e),n.emit("channelInvited",i)),i})):void _.trace("upsertChannel: channel is deleted and came again from chat, ignoring",t)}},{key:"onChannelRemoved",value:function(e){var t=this.channels.get(e);t&&(this.channels.delete(e),this.emit("channelRemoved",t))}},{key:"registerForEvents",value:function(e){var t=this;e.on("removed",function(){return t.onChannelRemoved(e.sid)}),e.on("updated",function(){return t.emit("channelUpdated",e)}),e.on("memberJoined",this.emit.bind(this,"memberJoined")),e.on("memberLeft",this.emit.bind(this,"memberLeft")),e.on("memberUpdated",this.emit.bind(this,"memberUpdated")),e.on("messageAdded",this.emit.bind(this,"messageAdded")),e.on("messageUpdated",this.emit.bind(this,"messageUpdated")),e.on("messageRemoved",this.emit.bind(this,"messageRemoved")),e.on("typingStarted",this.emit.bind(this,"typingStarted")),e.on("typingEnded",this.emit.bind(this,"typingEnded"))}}]),r}(m.EventEmitter);r.Channels=g},{"../channel":1,"../logger":14,"../util/deferred":29,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/core-js/set":47,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57,events:214}],6:[function(e,t,r){"use strict";var s=i(e("babel-runtime/regenerator")),o=i(e("babel-runtime/core-js/object/get-prototype-of")),a=i(e("babel-runtime/helpers/classCallCheck")),n=i(e("babel-runtime/helpers/createClass")),u=i(e("babel-runtime/helpers/possibleConstructorReturn")),c=i(e("babel-runtime/helpers/inherits")),l=i(e("babel-runtime/core-js/promise"));function i(e){return e&&e.__esModule?e:{default:e}}var f=function(s,o,a,u){return new(a||(a=l.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var h=e("events"),d=e("../member"),p=e("../logger").Logger.scope("Members"),m=function(e){function i(e,t,r){(0,a.default)(this,i);var n=(0,u.default)(this,(i.__proto__||(0,o.default)(i)).call(this));return n.services=t,n.channel=e,n.members=r,n}return(0,c.default)(i,e),(0,n.default)(i,[{key:"unsubscribe",value:function(){return f(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rosterEntityPromise){e.next=6;break}return e.next=3,this.rosterEntityPromise;case 3:e.sent.close(),this.rosterEntityPromise=null;case 6:case"end":return e.stop()}},e,this)}))}},{key:"subscribe",value:function(e){var n=this;return this.rosterEntityPromise=this.rosterEntityPromise||this.services.syncClient.map({id:e,mode:"open_existing"}).then(function(e){e.on("itemAdded",function(e){n.upsertMember(e.item.key,e.item.value).then(function(e){n.emit("memberJoined",e)})}),e.on("itemRemoved",function(e){var t=e.key;if(n.members.has(t)){var r=n.members.get(t);n.members.delete(t),n.emit("memberLeft",r)}}),e.on("itemUpdated",function(e){n.upsertMember(e.item.key,e.item.value)});var t=[];return e.forEach(function(e){t.push(n.upsertMember(e.key,e.value))}).then(function(){return l.default.all(t)}).then(function(){return e})}).catch(function(e){throw n.rosterEntityPromise=null,p.error("Failed to get roster object for channel",n.channel.sid,e),e})}},{key:"upsertMember",value:function(n,i){return f(this,void 0,void 0,s.default.mark(function e(){var t,r=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.members.get(n))){e.next=3;break}return e.abrupt("return",t._update(i));case 3:return t=new d.Member(this.services,this.channel,i,n),this.members.set(n,t),t.on("updated",function(){return r.emit("memberUpdated",t)}),e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}))}},{key:"getMembers",value:function(){var e=this;return this.rosterEntityPromise.then(function(){var t=[];return e.members.forEach(function(e){return t.push(e)}),t})}},{key:"add",value:function(e){return this.services.session.addCommand("addMemberV2",{channelSid:this.channel.sid,username:e})}},{key:"invite",value:function(e){return this.services.session.addCommand("inviteMember",{channelSid:this.channel.sid,username:e})}},{key:"remove",value:function(e){return this.services.session.addCommand("removeMember",{channelSid:this.channel.sid,username:e})}}]),i}(h.EventEmitter);r.Members=m},{"../logger":14,"../member":16,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57,events:214}],7:[function(e,t,r){"use strict";var s=n(e("babel-runtime/core-js/json/stringify")),o=n(e("babel-runtime/regenerator")),i=n(e("babel-runtime/core-js/map")),a=n(e("babel-runtime/core-js/object/get-prototype-of")),u=n(e("babel-runtime/helpers/classCallCheck")),c=n(e("babel-runtime/helpers/createClass")),l=n(e("babel-runtime/helpers/possibleConstructorReturn")),f=n(e("babel-runtime/helpers/inherits")),h=n(e("babel-runtime/core-js/promise"));function n(e){return e&&e.__esModule?e:{default:e}}var d=function(s,o,a,u){return new(a||(a=h.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var p=e("events"),m=e("../logger"),v=e("../message"),b=e("isomorphic-form-data"),y=m.Logger.scope(""),_=function(e){function n(e,t){(0,u.default)(this,n);var r=(0,l.default)(this,(n.__proto__||(0,a.default)(n)).call(this));return r.channel=e,r.services=t,r.messagesByIndex=new i.default,r.messagesListPromise=null,r}return(0,f.default)(n,e),(0,c.default)(n,[{key:"subscribe",value:function(e){var n=this;return this.messagesListPromise=this.messagesListPromise||this.services.syncClient.list({id:e,mode:"open_existing"}).then(function(e){return e.on("itemAdded",function(e){var t=new v.Message(n.channel,n.services,e.item.index,e.item.value);n.messagesByIndex.has(t.index)?y.debug("Message arrived, but already known and ignored",n.channel.sid,t.index):(n.messagesByIndex.set(t.index,t),t.on("updated",function(){return n.emit("messageUpdated",t)}),n.emit("messageAdded",t))}),e.on("itemRemoved",function(e){var t=e.index;if(n.messagesByIndex.has(t)){var r=n.messagesByIndex.get(t);n.messagesByIndex.delete(r.index),r.removeAllListeners("updated"),n.emit("messageRemoved",r)}}),e.on("itemUpdated",function(e){var t=n.messagesByIndex.get(e.item.index);t&&t._update(e.item.value)}),e}).catch(function(e){throw n.messagesListPromise=null,y.error("Failed to get messages object for channel",n.channel.sid,e),e})}},{key:"unsubscribe",value:function(){return d(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.messagesListPromise){e.next=6;break}return e.next=3,this.messagesListPromise;case 3:e.sent.close(),this.messagesListPromise=null;case 6:case"end":return e.stop()}},e,this)}))}},{key:"send",value:function(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return d(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y.debug("Sending text message",t,r),r.constructor===Object){e.next=3;break}throw new Error("Attributes must be a valid JSON object");case 3:return e.abrupt("return",this.services.session.addCommand("sendMessage",{channelSid:this.channel.sid,text:t,attributes:(0,s.default)(r)}));case 4:case"end":return e.stop()}},e,this)}))}},{key:"sendMedia",value:function(n){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return d(this,void 0,void 0,o.default.mark(function e(){var t,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y.debug("Sending media message",n,i),i.constructor===Object){e.next=3;break}throw new Error("Attributes must be a valid JSON object");case 3:if(t=void 0,!(n instanceof b)){e.next=11;break}return y.debug("Sending media message as FormData",n,i),e.next=8,this.services.mcsClient.postFormData(n);case 8:t=e.sent,e.next=18;break;case 11:if(y.debug("Sending media message as SendMediaOptions",n,i),(r=n).contentType&&r.media){e.next=15;break}throw new Error("Media content <Channel#SendMediaOptions> must contain non-empty contentType and media");case 15:return e.next=17,this.services.mcsClient.post(r.contentType,r.media);case 17:t=e.sent;case 18:return e.abrupt("return",this.services.session.addCommand("sendMediaMessage",{channelSid:this.channel.sid,mediaSid:t.sid,attributes:(0,s.default)(i)}));case 19:case"end":return e.stop()}},e,this)}))}},{key:"getMessages",value:function(e,t,r){return t=void 0!==t?t:"end",r=r||"backwards",this._getMessages(e,t,r)}},{key:"wrapPaginator",value:function(t,r,n){var i=this,s="desc"===t,o=function(){return r.nextPage().then(function(e){return i.wrapPaginator(t,e,n)})},a=function(){return r.prevPage().then(function(e){return i.wrapPaginator(t,e,n)})};return n(r.items).then(function(e){return{items:e.sort(function(e,t){return e.index-t.index}),hasPrevPage:s?r.hasNextPage:r.hasPrevPage,hasNextPage:s?r.hasPrevPage:r.hasNextPage,prevPage:s?o:a,nextPage:s?a:o}})}},{key:"_upsertMessage",value:function(e,t){var r=this,n=this.messagesByIndex.get(e);if(n)return n;var i=new v.Message(this.channel,this.services,e,t);return this.messagesByIndex.set(i.index,i),i.on("updated",function(){return r.emit("messageUpdated",i)}),i}},{key:"_getMessages",value:function(t,r,e){var n=this;r=void 0!==r?r:"end",t=t||30;var i="backwards"===e?"desc":"asc";return this.messagesListPromise.then(function(e){return e.getItems({from:"end"!==r?r:void 0,pageSize:t,order:i})}).then(function(e){return n.wrapPaginator(i,e,function(e){return h.default.all(e.map(function(e){return n._upsertMessage(e.index,e.value)}))})})}}]),n}(p.EventEmitter);r.Messages=_},{"../logger":14,"../message":17,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57,events:214,"isomorphic-form-data":216}],8:[function(e,t,r){"use strict";var s=a(e("babel-runtime/regenerator")),i=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass")),n=a(e("babel-runtime/core-js/promise"));function a(e){return e&&e.__esModule?e:{default:e}}var u=function(s,o,a,u){return new(a||(a=n.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var c=e("../util/index"),l=e("../restpaginator"),f=e("../channeldescriptor"),h=function(){function n(e,t,r){(0,i.default)(this,n),this.client=e,this.services=t,this.url=r}return(0,o.default)(n,[{key:"getChannels",value:function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return u(this,void 0,void 0,s.default.mark(function e(){var t,r,n=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new c.UriBuilder(this.url).arg("PageToken",i.pageToken).build(),e.next=3,this.services.network.get(t);case 3:return r=e.sent,e.abrupt("return",new l.RestPaginator(r.body.channels.map(function(e){return new f.ChannelDescriptor(n.client,e)}),function(e){return n.getChannels({pageToken:e})},r.body.meta.previous_token,r.body.meta.next_token));case 5:case"end":return e.stop()}},e,this)}))}},{key:"getChannelBySid",value:function(n){return u(this,void 0,void 0,s.default.mark(function e(){var t,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new c.UriBuilder(this.url).path(n).build(),e.next=3,this.services.network.get(t);case 3:return r=e.sent,e.abrupt("return",new f.ChannelDescriptor(this.client,r.body));case 5:case"end":return e.stop()}},e,this)}))}},{key:"getChannelByUniqueName",value:function(n){return u(this,void 0,void 0,s.default.mark(function e(){var t,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new c.UriBuilder(this.url).path(n).build(),e.next=3,this.services.network.get(t);case 3:return r=e.sent,e.abrupt("return",new f.ChannelDescriptor(this.client,r.body));case 5:case"end":return e.stop()}},e,this)}))}}]),n}();r.PublicChannels=h},{"../channeldescriptor":2,"../restpaginator":19,"../util/index":30,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":57}],9:[function(e,t,r){"use strict";var s=a(e("babel-runtime/regenerator")),i=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass")),n=a(e("babel-runtime/core-js/promise"));function a(e){return e&&e.__esModule?e:{default:e}}var u=function(s,o,a,u){return new(a||(a=n.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var c=e("../util/index"),l=e("../restpaginator"),f=e("../channeldescriptor"),h=function(){function n(e,t,r){(0,i.default)(this,n),this.client=e,this.services=t,this.url=r}return(0,o.default)(n,[{key:"getChannels",value:function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return u(this,void 0,void 0,s.default.mark(function e(){var t,r,n=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new c.UriBuilder(this.url).arg("PageToken",i.pageToken).build(),e.next=3,this.services.network.get(t);case 3:return r=e.sent,e.abrupt("return",new l.RestPaginator(r.body.channels.map(function(e){return new f.ChannelDescriptor(n.client,e)}),function(e){return n.getChannels({pageToken:e})},r.body.meta.previous_token,r.body.meta.next_token));case 5:case"end":return e.stop()}},e,this)}))}}]),n}();r.UserChannels=h},{"../channeldescriptor":2,"../restpaginator":19,"../util/index":30,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":57}],10:[function(e,t,r){"use strict";var o=s(e("babel-runtime/regenerator")),n=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass")),c=s(e("babel-runtime/core-js/promise"));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(s,o,a,u){return new(a||(a=c.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var u=e("../util/index"),l=e("../restpaginator"),f=e("../userdescriptor"),h=function(){function r(e,t){(0,n.default)(this,r),this.services=e,this.url=t}return(0,i.default)(r,[{key:"getUserDescriptor",value:function(n){return a(this,void 0,void 0,o.default.mark(function e(){var t,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new u.UriBuilder(this.url).path(n).build(),e.next=3,this.services.network.get(t);case 3:return r=e.sent,e.abrupt("return",new f.UserDescriptor(this.services,r.body));case 5:case"end":return e.stop()}},e,this)}))}},{key:"getChannelUserDescriptors",value:function(i){var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return a(this,void 0,void 0,o.default.mark(function e(){var t,r,n=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new u.UriBuilder(this.url).arg("ChannelSid",i).arg("PageToken",s.pageToken).build(),e.next=3,this.services.network.get(t);case 3:return r=e.sent,e.abrupt("return",new l.RestPaginator(r.body.users.map(function(e){return new f.UserDescriptor(n.services,e)}),function(e){return n.getChannelUserDescriptors(i,{pageToken:e})},r.body.meta.prev_token,r.body.meta.next_token));case 5:case"end":return e.stop()}},e,this)}))}}]),r}();r.UserDescriptors=h},{"../restpaginator":19,"../userdescriptor":28,"../util/index":30,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":57}],11:[function(e,t,r){"use strict";var o=f(e("babel-runtime/regenerator")),n=f(e("babel-runtime/core-js/map")),i=f(e("babel-runtime/core-js/object/get-prototype-of")),s=f(e("babel-runtime/helpers/classCallCheck")),a=f(e("babel-runtime/helpers/createClass")),u=f(e("babel-runtime/helpers/possibleConstructorReturn")),c=f(e("babel-runtime/helpers/inherits")),l=f(e("babel-runtime/core-js/promise"));function f(e){return e&&e.__esModule?e:{default:e}}var h=function(s,o,a,u){return new(a||(a=l.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var d=e("events"),p=e("../user"),m=e("./userdescriptors"),v=function(e){function r(e){(0,s.default)(this,r);var t=(0,u.default)(this,(r.__proto__||(0,i.default)(r)).call(this));return t.services=e,t.fifoStack=[],t.fifoStackMaxLength=100,t.myself=new p.User(null,null,t.services),t.myself.on("updated",function(){return t.emit("userUpdated",t.myself)}),t.myself.on("userSubscribed",function(){return t.emit("userSubscribed",t.myself)}),t.myself.on("userUnsubscribed",function(){t.emit("userUnsubscribed",t.myself),t.myself._ensureFetched()}),t.services=e,t.subscribedUsers=new n.default,t.userDescriptorsPromise=t.services.session.getSessionLinks().then(function(e){return t.userDescriptors=new m.UserDescriptors({users:t,network:t.services.network},e.usersUrl),t.userDescriptors}),t.services.session.getMaxUserInfosToSubscribe().then(function(e){t.fifoStackMaxLength=e}),t.services.session.getUsersData().then(function(e){return t.myself.identity=e.identity,t.myself.entityName=e.user,t.myself._ensureFetched()}),t}return(0,c.default)(r,e),(0,a.default)(r,[{key:"handleUnsubscribeUser",value:function(r){this.subscribedUsers.has(r.identity)&&this.subscribedUsers.delete(r.identity);var n=-1;this.fifoStack.find(function(e,t){return e==r.identity&&(n=t,!0)})&&this.fifoStack.splice(n,1),this.emit("userUnsubscribed",r)}},{key:"handleSubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)||(this.fifoStack.length>=this.fifoStackMaxLength&&this.subscribedUsers.get(this.fifoStack.shift()).unsubscribe(),this.fifoStack.push(e.identity),this.subscribedUsers.set(e.identity,e),this.emit("userSubscribed",e))}},{key:"getUser",value:function(i){var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return h(this,void 0,void 0,o.default.mark(function e(){var t,r,n=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getUsersData();case 2:return e.next=4,this.myself._ensureFetched();case 4:if(i!=this.myself.identity){e.next=6;break}return e.abrupt("return",this.myself);case 6:if(t=this.subscribedUsers.get(i)){e.next=19;break}if(s){e.next=13;break}return e.next=11,this.getUserDescriptor(i);case 11:r=e.sent,s=r._getDescriptor().sync_unique_name;case 13:return(t=new p.User(i,s,this.services)).on("updated",function(){return n.emit("userUpdated",t)}),t.on("userSubscribed",function(){return n.handleSubscribeUser(t)}),t.on("userUnsubscribed",function(){return n.handleUnsubscribeUser(t)}),e.next=19,t._ensureFetched();case 19:return e.abrupt("return",t);case 20:case"end":return e.stop()}},e,this)}))}},{key:"getUserDescriptor",value:function(t){return h(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userDescriptorsPromise;case 2:return e.abrupt("return",this.userDescriptors.getUserDescriptor(t));case 3:case"end":return e.stop()}},e,this)}))}},{key:"getChannelUserDescriptors",value:function(t){return h(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userDescriptorsPromise;case 2:return e.abrupt("return",this.userDescriptors.getChannelUserDescriptors(t));case 3:case"end":return e.stop()}},e,this)}))}},{key:"getSubscribedUsers",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getUsersData();case 2:return e.next=4,this.myself._ensureFetched();case 4:return t=[this.myself],this.subscribedUsers.forEach(function(e){return t.push(e)}),e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}))}}]),r}(d.EventEmitter);r.Users=v},{"../user":27,"./userdescriptors":10,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57,events:214}],12:[function(e,t,r){"use strict";var n,i=e("babel-runtime/helpers/classCallCheck"),s=(n=i)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});var o=function e(){(0,s.default)(this,e)};o.TYPING_INDICATOR="twilio.ipmsg.typing_indicator",o.NEW_MESSAGE="twilio.channel.new_message",o.ADDED_TO_CHANNEL="twilio.channel.added_to_channel",o.INVITED_TO_CHANNEL="twilio.channel.invited_to_channel",o.REMOVED_FROM_CHANNEL="twilio.channel.removed_from_channel",o.CONSUMPTION_UPDATE="twilio.channel.consumption_update",r.NotificationTypes=o},{"babel-runtime/helpers/classCallCheck":50}],13:[function(e,t,r){"use strict";var n,i=e("babel-runtime/helpers/classCallCheck"),s=(n=i)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});var o=function e(){(0,s.default)(this,e)};o.HTTP_200_OK=200,o.HTTP_400_BAD_REQUEST=400,o.HTTP_404_NOT_FOUND=404,o.ACCESS_FORBIDDEN_FOR_IDENTITY=54007,o.LIST_NOT_FOUND=54150,r.ResponseCodes=o},{"babel-runtime/helpers/classCallCheck":50}],14:[function(e,t,r){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass")),s=o(e("babel-runtime/core-js/array/from"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=e("loglevel");function u(e,t){return[e].concat((0,s.default)(t))}var c=function(){function t(){(0,n.default)(this,t),this.prefix=""}return(0,i.default)(t,[{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.trace.apply(null,u("Chat T:"+this.prefix,t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,u("Chat D:"+this.prefix,t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.info.apply(null,u("Chat I:"+this.prefix,t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.warn.apply(null,u("Chat W:"+this.prefix,t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.error.apply(null,u("Chat E:"+this.prefix,t))}}],[{key:"scope",value:function(e){return new t}},{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.trace.apply(null,u("Chat T:",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,u("Chat D:",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.info.apply(null,u("Chat I:",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.warn.apply(null,u("Chat W:",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.error.apply(null,u("Chat E:",t))}}]),t}();r.Logger=c},{"babel-runtime/core-js/array/from":31,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,loglevel:219}],15:[function(e,t,r){"use strict";var n=o(e("babel-runtime/regenerator")),i=o(e("babel-runtime/helpers/classCallCheck")),s=o(e("babel-runtime/helpers/createClass")),c=o(e("babel-runtime/core-js/promise"));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(s,o,a,u){return new(a||(a=c.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function r(e,t){(0,i.default)(this,r),this.mcsMedia=null,this.services=t,this.state={sid:e.sid,filename:e.filename,contentType:e.contentType,size:e.size}}return(0,s.default)(r,[{key:"getContentUrl",value:function(){return a(this,void 0,void 0,n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mcsMedia){e.next=8;break}if(!this.services.mcsClient){e.next=7;break}return e.next=4,this.services.mcsClient.get(this.state.sid);case 4:this.mcsMedia=e.sent,e.next=8;break;case 7:throw new Error("Media Content Service is unavailable");case 8:return e.abrupt("return",this.mcsMedia.getContentUrl());case 9:case"end":return e.stop()}},e,this)}))}},{key:"sid",get:function(){return this.state.sid}},{key:"filename",get:function(){return this.state.filename}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}}]),r}();r.Media=u},{"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":57}],16:[function(e,t,r){"use strict";var n=s(e("babel-runtime/regenerator")),o=s(e("babel-runtime/core-js/number/is-integer")),a=s(e("babel-runtime/core-js/object/get-prototype-of")),u=s(e("babel-runtime/helpers/classCallCheck")),c=s(e("babel-runtime/helpers/possibleConstructorReturn")),i=s(e("babel-runtime/helpers/createClass")),l=s(e("babel-runtime/helpers/inherits")),f=s(e("babel-runtime/core-js/promise"));function s(e){return e&&e.__esModule?e:{default:e}}var h=function(s,o,a,u){return new(a||(a=f.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var d=function(e){function s(e,t,r,n){(0,u.default)(this,s);var i=(0,c.default)(this,(s.__proto__||(0,a.default)(s)).call(this));if(i.channel=t,i.services=e,i.state={sid:n,typingTimeout:null,isTyping:!1,identity:r.identity,roleSid:r.roleSid||null,lastConsumedMessageIndex:(0,o.default)(r.lastConsumedMessageIndex)?r.lastConsumedMessageIndex:null,lastConsumptionTimestamp:r.lastConsumptionTimestamp?new Date(r.lastConsumptionTimestamp):null,userInfo:r.userInfo},!r.identity)throw new Error("Received invalid Member object from server: Missing identity.");return i}return(0,l.default)(s,e),(0,i.default)(s,[{key:"sid",get:function(){return this.state.sid}},{key:"identity",get:function(){return this.state.identity}},{key:"isTyping",get:function(){return this.state.isTyping}},{key:"lastConsumedMessageIndex",get:function(){return this.state.lastConsumedMessageIndex}},{key:"lastConsumptionTimestamp",get:function(){return this.state.lastConsumptionTimestamp}},{key:"roleSid",get:function(){return this.state.roleSid}}]),(0,i.default)(s,[{key:"_startTyping",value:function(e){var t=this;return clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit("typingStarted",this),this.channel.emit("typingStarted",this),this.state.typingTimeout=setTimeout(function(){return t._endTyping()},e),this}},{key:"_endTyping",value:function(){this.state.typingTimeout&&(this.state.isTyping=!1,this.emit("typingEnded",this),this.channel.emit("typingEnded",this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{key:"_update",value:function(e){var t=!1;if(e.roleSid&&this.state.roleSid!==e.roleSid&&(this.state.roleSid=e.roleSid,t=!0),!(0,o.default)(e.lastConsumedMessageIndex)&&null!==e.lastConsumedMessageIndex||this.state.lastConsumedMessageIndex===e.lastConsumedMessageIndex||(this.state.lastConsumedMessageIndex=e.lastConsumedMessageIndex,t=!0),e.lastConsumptionTimestamp){var r=new Date(e.lastConsumptionTimestamp);this.state.lastConsumptionTimestamp&&this.state.lastConsumptionTimestamp.getTime()===r.getTime()||(this.state.lastConsumptionTimestamp=r,t=!0)}return t&&this.emit("updated",this),this}},{key:"getUserDescriptor",value:function(){return h(this,void 0,void 0,n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getUserDescriptor(this.state.identity));case 1:case"end":return e.stop()}},e,this)}))}},{key:"getUser",value:function(){return h(this,void 0,void 0,n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getUser(this.state.identity,this.state.userInfo));case 1:case"end":return e.stop()}},e,this)}))}},{key:"remove",value:function(){return this.channel.removeMember(this)}}]),s}(e("events").EventEmitter);r.Member=d},{"babel-runtime/core-js/number/is-integer":36,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57,events:214}],17:[function(e,t,r){"use strict";var n=s(e("babel-runtime/core-js/json/stringify")),i=s(e("babel-runtime/regenerator")),o=s(e("babel-runtime/core-js/object/get-prototype-of")),a=s(e("babel-runtime/helpers/classCallCheck")),u=s(e("babel-runtime/helpers/createClass")),c=s(e("babel-runtime/helpers/possibleConstructorReturn")),l=s(e("babel-runtime/helpers/inherits")),f=s(e("babel-runtime/core-js/promise"));function s(e){return e&&e.__esModule?e:{default:e}}var h=function(s,o,a,u){return new(a||(a=f.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var d=e("events"),p=e("./util/index"),m=e("./logger"),v=e("./media"),b=new m.Logger;function y(t,e){try{return e?JSON.parse(e):{}}catch(e){return b.warn("Got malformed attributes for the message",t),{}}}var _=function(e){function s(e,t,r,n){(0,a.default)(this,s);var i=(0,c.default)(this,(s.__proto__||(0,o.default)(s)).call(this));return i.channel=e,i.services=t,i.state={sid:n.sid,index:r,author:n.author,body:n.text,timestamp:n.timestamp?new Date(n.timestamp):null,dateUpdated:n.dateUpdated?new Date(n.dateUpdated):null,lastUpdatedBy:n.lastUpdatedBy?n.lastUpdatedBy:null,attributes:y(n.sid,n.attributes),type:n.type?n.type:"text",media:n.type&&"media"===n.type&&n.media?new v.Media(n.media,i.services):null},i}return(0,l.default)(s,e),(0,u.default)(s,[{key:"_update",value:function(e){var t=!1;!e.text&&"string"!=typeof e.text||e.text===this.state.body||(this.state.body=e.text,t=!0),e.lastUpdatedBy&&e.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=e.lastUpdatedBy,t=!0),e.dateUpdated&&new Date(e.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(e.dateUpdated),t=!0),e.timestamp&&new Date(e.timestamp).getTime()!==(this.state.timestamp&&this.state.timestamp.getTime())&&(this.state.timestamp=new Date(e.timestamp),t=!0);var r=y(this.sid,e.attributes);p.isDeepEqual(this.state.attributes,r)||(this.state.attributes=r,t=!0),t&&this.emit("updated",this)}},{key:"remove",value:function(){return h(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("deleteMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString()});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}))}},{key:"updateBody",value:function(t){return h(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new Error("Body <String> is a required parameter for updateBody");case 2:return e.next=4,this.services.session.addCommand("editMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString(),text:t});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)}))}},{key:"updateAttributes",value:function(t){return h(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=4;break}throw new Error("Attributes is a required parameter for updateAttributes");case 4:if(t.constructor===Object){e.next=6;break}throw new Error("Attributes must be a valid JSON object");case 6:return e.next=8,this.services.session.addCommand("editMessageAttributes",{channelSid:this.channel.sid,messageIdx:this.index,attributes:(0,n.default)(t)});case 8:return e.abrupt("return",this);case 9:case"end":return e.stop()}},e,this)}))}},{key:"sid",get:function(){return this.state.sid}},{key:"author",get:function(){return this.state.author}},{key:"body",get:function(){return"media"===this.type?null:this.state.body}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"index",get:function(){return this.state.index}},{key:"lastUpdatedBy",get:function(){return this.state.lastUpdatedBy}},{key:"timestamp",get:function(){return this.state.timestamp}},{key:"attributes",get:function(){return this.state.attributes}},{key:"type",get:function(){return this.state.type}},{key:"media",get:function(){return this.state.media}}]),s}(d.EventEmitter);r.Message=_},{"./logger":14,"./media":15,"./util/index":30,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57,events:214}],18:[function(e,t,r){"use strict";var n,i=e("babel-runtime/helpers/classCallCheck"),s=(n=i)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});r.PushNotification=function e(t){(0,s.default)(this,e),this.title=t.title||null,this.body=t.body||null,this.sound=t.sound||null,this.badge=t.badge||null,this.action=t.action||null,this.type=t.type||null,this.data=t.data||{}}},{"babel-runtime/helpers/classCallCheck":50}],19:[function(e,t,r){"use strict";var n=i(e("babel-runtime/core-js/promise")),s=i(e("babel-runtime/helpers/classCallCheck")),o=i(e("babel-runtime/helpers/createClass"));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function i(e,t,r,n){(0,s.default)(this,i),this.state={prevToken:r,nextToken:n,source:t,items:e}}return(0,o.default)(i,[{key:"nextPage",value:function(){return this.hasNextPage?this.state.source(this.state.nextToken):n.default.reject(new Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.state.source(this.state.prevToken):n.default.reject(new Error("No previous page"))}},{key:"hasNextPage",get:function(){return!!this.state.nextToken}},{key:"hasPrevPage",get:function(){return!!this.state.prevToken}},{key:"items",get:function(){return this.state.items}}]),i}();r.RestPaginator=a},{"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],20:[function(e,t,r){"use strict";var a=o(e("babel-runtime/core-js/promise")),i=o(e("babel-runtime/core-js/map")),n=o(e("babel-runtime/helpers/createClass")),s=o(e("babel-runtime/helpers/classCallCheck"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=e("../sessionerror"),c=function(){function t(e){(0,s.default)(this,t),this.services=e,this.consumptionHorizonRequests=new i.default,this.consumptionHorizonUpdateTimer=null}return(0,n.default)(t,[{key:"getReportInterval",value:function(){return this.services.session.getConsumptionReportInterval().then(function(e){return 1e3*e.seconds})}},{key:"delayedSendConsumptionHorizon",value:function(e){var t=this;null===this.consumptionHorizonUpdateTimer&&(this.sendConsumptionReport(!0),this.consumptionHorizonUpdateTimer=setTimeout(function(){t.sendConsumptionReport(!1)},e))}},{key:"sendConsumptionReport",value:function(e){var t=this,r=[],n=new i.default;this.consumptionHorizonRequests.forEach(function(e,t){r.push(e.entry),n.set(t,e.promises)}),0<r.length&&this.services.session.addCommand("consumptionReportV2",{report:r}).then(function(e){return t.processConsumptionReportResponse(e,n)}).catch(function(e){return t.processConsumptionReportError(e,n)}),e||(this.consumptionHorizonUpdateTimer=null),this.consumptionHorizonRequests.clear()}},{key:"processConsumptionReportResponse",value:function(e,n){e&&e.report&&Array.isArray(e.report)&&0<e.report.length&&e.report.forEach(function(e){var t=e;if(n.has(t.channelSid)){var r=null;void 0!==t.unreadMessagesCount&&null!=t.unreadMessagesCount&&(r=t.unreadMessagesCount),n.get(t.channelSid).forEach(function(e){return e.resolve(r)}),n.delete(t.channelSid)}}),this.processConsumptionReportError(new u.SessionError("Error while setting LastConsumedMessageIndex",null),n)}},{key:"processConsumptionReportError",value:function(t,e){e.forEach(function(e){return e.forEach(function(e){return e.reject(t)})})}},{key:"updateLastConsumedMessageIndexForChannel",value:function(r,n){var i=this;return new a.default(function(e,t){i.addPendingConsumptionHorizonRequest(r,{channelSid:r,messageIdx:n},{resolve:e,reject:t}),i.getReportInterval().then(function(e){return i.delayedSendConsumptionHorizon(e)})})}},{key:"advanceLastConsumedMessageIndexForChannel",value:function(r,n,i){var s=this,o=this.consumptionHorizonRequests.get(r);return new a.default(function(e,t){o&&o.entry?o.entry.messageIdx>=n?s.addPendingConsumptionHorizonRequest(r,o.entry,{resolve:e,reject:t}):s.addPendingConsumptionHorizonRequest(r,{channelSid:r,messageIdx:n},{resolve:e,reject:t}):null!==i&&n<i?s.addPendingConsumptionHorizonRequest(r,{channelSid:r,messageIdx:i},{resolve:e,reject:t}):s.addPendingConsumptionHorizonRequest(r,{channelSid:r,messageIdx:n},{resolve:e,reject:t}),s.getReportInterval().then(function(e){return s.delayedSendConsumptionHorizon(e)})})}},{key:"addPendingConsumptionHorizonRequest",value:function(e,t,r){if(this.consumptionHorizonRequests.has(e)){var n=this.consumptionHorizonRequests.get(e);n.entry=t,n.promises.push(r)}else this.consumptionHorizonRequests.set(e,{entry:t,promises:[r]})}}]),t}();r.ConsumptionHorizon=c},{"../sessionerror":24,"babel-runtime/core-js/map":35,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],21:[function(e,t,r){"use strict";var o=n(e("babel-runtime/regenerator")),u=n(e("babel-runtime/helpers/slicedToArray")),c=n(e("babel-runtime/core-js/get-iterator")),i=n(e("babel-runtime/helpers/extends")),s=n(e("babel-runtime/core-js/map")),a=n(e("babel-runtime/helpers/classCallCheck")),l=n(e("babel-runtime/helpers/createClass")),f=n(e("babel-runtime/core-js/promise"));function n(e){return e&&e.__esModule?e:{default:e}}var h=function(s,o,a,u){return new(a||(a=f.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var d=e("operation-retrier"),p=function(){function n(e,t){var r=this;(0,a.default)(this,n),this.config=e,this.services=t,this.cache=new s.default,this.cacheLifetime=0,this.services.session.getHttpCacheInterval().then(function(e){r.cacheLifetime=1e3*e.seconds,r.cleanupCache()})}return(0,l.default)(n,[{key:"backoffConfig",value:function(){return(0,i.default)(this.config.backoffConfigDefault,this.config.backoffConfigOverride)}},{key:"retryWhenThrottled",value:function(){return void 0!==this.config.retryWhenThrottledOverride?this.config.retryWhenThrottledOverride:void 0!==this.config.retryWhenThrottledDefault&&this.config.retryWhenThrottledDefault}},{key:"isExpired",value:function(e){return!this.cacheLifetime||Date.now()-e>this.cacheLifetime}},{key:"cleanupCache",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=(0,c.default)(this.cache);!(e=(n=i.next()).done);e=!0){var s=(0,u.default)(n.value,2),o=s[0],a=s[1];this.isExpired(a.timestamp)&&this.cache.delete(o)}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}0===this.cache.size&&clearInterval(this.timer)}},{key:"pokeTimer",value:function(){var e=this;this.timer=this.timer||setInterval(function(){return e.cleanupCache()},2*this.cacheLifetime)}},{key:"executeWithRetry",value:function(e){var s=this,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return new f.default(function(t,r){var n=[502,503,504];o&&n.push(429);var i=new d.default(s.backoffConfig());i.on("attempt",function(){e().then(function(e){return i.succeeded(e)}).catch(function(e){-1<n.indexOf(e.status)?i.failed(e):"Twilsock disconnected"===e.message?i.failed(e):(i.removeAllListeners(),i.cancel(),r(e))})}),i.on("succeeded",function(e){t(e)}),i.on("cancelled",function(e){return r(e)}),i.on("failed",function(e){return r(e)}),i.start()})}},{key:"get",value:function(s){return h(this,void 0,void 0,o.default.mark(function e(){var t,r,n,i=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.cache.get(s))||this.isExpired(t.timestamp)){e.next=3;break}return e.abrupt("return",t.response);case 3:return r={"X-Twilio-Token":this.config.token},e.next=6,this.executeWithRetry(function(){return i.services.transport.get(s,r)},this.retryWhenThrottled());case 6:return n=e.sent,this.cache.set(s,{response:n,timestamp:Date.now()}),this.pokeTimer(),e.abrupt("return",n);case 10:case"end":return e.stop()}},e,this)}))}}]),n}();r.Network=p},{"babel-runtime/core-js/get-iterator":32,"babel-runtime/core-js/map":35,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/extends":52,"babel-runtime/helpers/slicedToArray":55,"babel-runtime/regenerator":57,"operation-retrier":220}],22:[function(e,t,r){"use strict";var i=n(e("babel-runtime/core-js/promise")),s=n(e("babel-runtime/core-js/map")),o=n(e("babel-runtime/helpers/classCallCheck")),a=n(e("babel-runtime/helpers/createClass"));function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=e("../logger"),c=e("../interfaces/notificationtypes"),l=u.Logger.scope("TypingIndicator"),f=function(){function n(e,t,r){(0,o.default)(this,n),this.config=e,this.services=t,this.getChannel=r,this.serviceTypingTimeout=null,this.sentUpdates=new s.default}return(0,a.default)(n,[{key:"initialize",value:function(){var r=this;this.services.notificationClient.subscribe(c.NotificationTypes.TYPING_INDICATOR,"twilsock"),this.services.notificationClient.on("message",function(e,t){e===c.NotificationTypes.TYPING_INDICATOR&&r.handleRemoteTyping(t)})}},{key:"handleRemoteTyping",value:function(t){var r=this;l.trace("Got new typing indicator ",t),this.getChannel(t.channel_sid).then(function(e){e&&e.members.forEach(function(e){e.identity===t.identity&&e._startTyping(r.typingTimeout)})}).catch(function(e){throw l.error(e),e})}},{key:"send",value:function(e){var t=this.sentUpdates.get(e);return t&&t>Date.now()-this.typingTimeout?i.default.resolve():(this.sentUpdates.set(e,Date.now()),this._send(e))}},{key:"_send",value:function(e){var t=this;l.trace("Sending typing indicator");var r=this.config.typingIndicatorUri,n={"X-Twilio-Token":this.config.token,"Content-Type":"application/x-www-form-urlencoded"},i="ChannelSid="+e;return this.services.transport.post(r,n,i).then(function(e){e.body.hasOwnProperty("typing_timeout")&&(t.serviceTypingTimeout=1e3*e.body.typing_timeout)}).catch(function(e){throw l.error("Failed to send typing indicator:",e),e})}},{key:"typingTimeout",get:function(){return this.config.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.config.typingIndicatorTimeoutDefault}}]),n}();r.TypingIndicator=f},{"../interfaces/notificationtypes":12,"../logger":14,"babel-runtime/core-js/map":35,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],23:[function(e,t,r){"use strict";var i=n(e("babel-runtime/regenerator")),s=n(e("babel-runtime/core-js/map")),o=n(e("babel-runtime/helpers/createClass")),u=n(e("babel-runtime/helpers/classCallCheck")),c=n(e("babel-runtime/core-js/promise"));function n(e){return e&&e.__esModule?e:{default:e}}var a=function(s,o,a,u){return new(a||(a=c.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var l=e("uuid"),f=e("platform"),h=e("durational"),d=e("./interfaces/responsecodes"),p=e("./logger"),m=e("./sessionerror"),v=e("./util/deferred"),b=e("./../package.json").version,y=p.Logger.scope("Session");var _=function(){function n(e,t){(0,u.default)(this,n);var r="undefined"!=typeof navigator?f.parse(navigator.userAgent):f;this.services=e,this.config=t,this.sessionInfo=new v.Deferred,this.currentContext={},this.pendingCommands=new s.default,this.sessionStreamPromise=null,this.endpointPlatform=["js",b,r.os,r.name,r.version].join("|")}return(0,o.default)(n,[{key:"handleContextUpdate",value:function(e){var t;(y.info("Session context updated"),y.debug("new session context:",e),this.currentContext=e,t=e,["identity","userInfo","links","myChannels","channels"].some(function(e){return!t.hasOwnProperty(e)}))||(y.info("new session context accepted"),this.sessionInfo.set(e))}},{key:"initialize",value:function(){var t=this,e={type:"IpMsgSession",apiVersion:"3",endpointPlatform:this.endpointPlatform};return this.sessionStreamPromise=this.services.syncClient.list({purpose:"com.twilio.rtd.ipmsg",context:e}).then(function(e){return y.info("Session created",e.sid),e.on("itemAdded",function(e){return t.processCommandResponse(e.item)}),e.on("itemUpdated",function(e){return t.processCommandResponse(e.item)}),e.on("contextUpdated",function(e){return t.handleContextUpdate(e.context)}),e}).catch(function(e){throw y.error("Failed to create session",e),e}),this.sessionStreamPromise}},{key:"addCommand",value:function(e,t){return this.processCommand(e,t)}},{key:"processCommand",value:function(n,i){var s=this,o=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],a=new function e(){(0,u.default)(this,e)};return a.request=i,a.request.action=n,a.commandId=l.v4(),y.info("Adding command: ",n,a.commandId),y.debug("command arguments:",i,o),new c.default(function(t,r){s.sessionStreamPromise.then(function(e){return s.pendingCommands.set(a.commandId,{resolve:t,reject:r,commandId:a.commandId,request:a.request}),e.push(a)}).then(function(){return y.debug("Command accepted by server",a.commandId)}).catch(function(e){s.pendingCommands.delete(a.commandId),y.error("Failed to add a command to the session",e),e.code!=d.ResponseCodes.ACCESS_FORBIDDEN_FOR_IDENTITY&&e.code!==d.ResponseCodes.LIST_NOT_FOUND||!o?r(new Error("Can't add command: "+e.message)):(y.info("recreating session..."),s.initialize(),t(s.processCommand(n,i,!1)))})})}},{key:"processCommandResponse",value:function(e){if(e.value.hasOwnProperty("response")&&e.value.hasOwnProperty("commandId")&&this.pendingCommands.has(e.value.commandId)){var t=e.value,r=e.value.commandId;if(t.response.status===d.ResponseCodes.HTTP_200_OK){y.debug("Command succeeded: ",t);var n=this.pendingCommands.get(r).resolve;this.pendingCommands.delete(r),n(t.response)}else{y.error("Command failed: ",t);var i=this.pendingCommands.get(r).reject;this.pendingCommands.delete(r),i(new m.SessionError(t.response.statusText,t.response.status))}}}},{key:"getSessionContext",value:function(){return this.sessionStreamPromise.then(function(e){return e.getContext()})}},{key:"getSessionLinks",value:function(){return a(this,void 0,void 0,i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",{publicChannelsUrl:this.config.baseUrl+t.links.publicChannelsUrl,myChannelsUrl:this.config.baseUrl+t.links.myChannelsUrl,typingUrl:this.config.baseUrl+t.links.typingUrl,syncListUrl:this.config.baseUrl+t.links.syncListUrl,usersUrl:this.config.baseUrl+t.links.usersUrl,mediaServiceUrl:t.links.mediaServiceUrl});case 4:case"end":return e.stop()}},e,this)}))}},{key:"getChannelsId",value:function(){return a(this,void 0,void 0,i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",t.channels);case 4:case"end":return e.stop()}},e,this)}))}},{key:"getMyChannelsId",value:function(){return a(this,void 0,void 0,i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",t.myChannels);case 4:case"end":return e.stop()}},e,this)}))}},{key:"getMaxUserInfosToSubscribe",value:function(){return a(this,void 0,void 0,i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",this.config.userInfosToSubscribeOverride||t.userInfosToSubscribe||this.config.userInfosToSubscribeDefault);case 4:case"end":return e.stop()}},e,this)}))}},{key:"getUsersData",value:function(){return this.sessionInfo.promise.then(function(e){return{user:e.userInfo,identity:e.identity}})}},{key:"getConsumptionReportInterval",value:function(){return a(this,void 0,void 0,i.default.mark(function e(){var t,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionContext();case 2:return t=e.sent,r=this.config.consumptionReportIntervalOverride||t.consumptionReportInterval||this.config.consumptionReportIntervalDefault,e.prev=4,e.abrupt("return",h.fromString(r));case 8:return e.prev=8,e.t0=e.catch(4),y.error("Failed to parse consumption report interval",r,"using default value",this.config.consumptionReportIntervalDefault),e.abrupt("return",h.fromString(this.config.consumptionReportIntervalDefault));case 12:case"end":return e.stop()}},e,this,[[4,8]])}))}},{key:"getHttpCacheInterval",value:function(){return a(this,void 0,void 0,i.default.mark(function e(){var t,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionContext();case 2:return t=e.sent,r=this.config.httpCacheIntervalOverride||t.httpCacheInterval||this.config.httpCacheIntervalDefault,e.prev=4,e.abrupt("return",h.fromString(r));case 8:return e.prev=8,e.t0=e.catch(4),y.error("Failed to parse cache interval",r,"using default value",this.config.httpCacheIntervalDefault),e.abrupt("return",h.fromString(this.config.httpCacheIntervalDefault));case 12:case"end":return e.stop()}},e,this,[[4,8]])}))}},{key:"identity",get:function(){return this.sessionInfo.current.identity}},{key:"reachabilityEnabled",get:function(){return this.currentContext.reachabilityEnabled}}]),n}();r.Session=_},{"./../package.json":291,"./interfaces/responsecodes":13,"./logger":14,"./sessionerror":24,"./util/deferred":29,"babel-runtime/core-js/map":35,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":57,durational:212,platform:221,uuid:283}],24:[function(e,t,r){"use strict";var i=n(e("babel-runtime/core-js/object/get-prototype-of")),s=n(e("babel-runtime/helpers/classCallCheck")),o=n(e("babel-runtime/helpers/possibleConstructorReturn")),a=n(e("babel-runtime/helpers/inherits"));function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(e){function n(e,t){(0,s.default)(this,n);var r=(0,o.default)(this,(n.__proto__||(0,i.default)(n)).call(this));return r.name=r.constructor.name,r.message=e,r.code=t,Error.captureStackTrace?Error.captureStackTrace(r,r.constructor):r.stack=(new Error).stack,r}return(0,a.default)(n,e),n}(Error);r.SessionError=u},{"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],25:[function(e,t,r){"use strict";var o=s(e("babel-runtime/regenerator")),n=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass")),c=s(e("babel-runtime/core-js/promise"));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(s,o,a,u){return new(a||(a=c.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var u=e("./util/index"),l=e("./restpaginator"),f=e("./synclistdescriptor"),h=function(){function t(e){(0,n.default)(this,t),this.services=e}return(0,i.default)(t,[{key:"getPage",value:function(s){return a(this,void 0,void 0,o.default.mark(function e(){var t,r,n,i=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=s||{},e.next=3,this.services.session.getSessionLinks();case 3:return t=e.sent,r=new u.UriBuilder(t.syncListUrl).arg("PageToken",s.pageToken).build(),e.next=7,this.services.network.get(r);case 7:return n=e.sent,e.abrupt("return",new l.RestPaginator(n.body.channels.map(function(e){return new f.SyncListDescriptor(e)}),function(e){return i.getPage({pageToken:e})},n.body.meta.previous_token,n.body.meta.next_token));case 9:case"end":return e.stop()}},e,this)}))}}]),t}();r.SyncList=h},{"./restpaginator":19,"./synclistdescriptor":26,"./util/index":30,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":57}],26:[function(e,t,r){"use strict";var n,i=e("babel-runtime/helpers/classCallCheck"),s=(n=i)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});r.SyncListDescriptor=function e(t){(0,s.default)(this,e),this.descriptor=t,this.channel_sid=t.channel_sid,this.status=t.status,this.channel=t.channel,this.messages=t.messages,this.roster=t.roster,this.lastConsumedMessageIndex=t.last_consumed_message_index,this.status=t.status}},{"babel-runtime/helpers/classCallCheck":50}],27:[function(e,t,r){"use strict";var n=i(e("babel-runtime/core-js/json/stringify")),s=i(e("babel-runtime/regenerator")),o=i(e("babel-runtime/core-js/object/get-prototype-of")),a=i(e("babel-runtime/helpers/classCallCheck")),u=i(e("babel-runtime/helpers/createClass")),c=i(e("babel-runtime/helpers/possibleConstructorReturn")),l=i(e("babel-runtime/helpers/inherits")),f=i(e("babel-runtime/core-js/promise"));function i(e){return e&&e.__esModule?e:{default:e}}var h=function(s,o,a,u){return new(a||(a=f.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var d=e("events"),p=e("./logger").Logger.scope("User"),m=function(e){function i(e,t,r){(0,a.default)(this,i);var n=(0,c.default)(this,(i.__proto__||(0,o.default)(i)).call(this));return n.subscribed="initializing",n.setMaxListeners(0),n.services=r,n.state={identity:e,entityName:t,friendlyName:null,attributes:{},online:null,notifiable:null},n}return(0,l.default)(i,e),(0,u.default)(i,[{key:"_update",value:function(e,t){switch(p.debug("User for",this.state.identity,"updated:",e,t),e){case"friendlyName":this.state.friendlyName=t.value;break;case"attributes":try{this.state.attributes=JSON.parse(t.value)}catch(e){this.state.attributes={}}break;case"reachability":this.state.online=t.online,this.state.notifiable=t.notifiable;break;default:return}this.emit("updated",this)}},{key:"_updateReachabilityInfo",value:function(e,t){var r=this;return this.services.session.reachabilityEnabled?e.get("reachability").then(t).catch(function(e){p.warn("Failed to get reachability info for ",r.state.identity,e)}):f.default.resolve()}},{key:"_fetch",value:function(){return h(this,void 0,void 0,s.default.mark(function e(){var t=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.entityName){e.next=2;break}return e.abrupt("return",this);case 2:return this.promiseToFetch=this.services.syncClient.map({id:this.state.entityName,mode:"open_existing",includeItems:!0}).then(function(e){return(t.entity=e).on("itemUpdated",function(e){return t._update(e.item.key,e.item.value)}),f.default.all([e.get("friendlyName").then(function(e){return t._update(e.key,e.value)}),e.get("attributes").then(function(e){return t._update(e.key,e.value)}),t._updateReachabilityInfo(e,function(e){return t._update(e.key,e.value)})])}).then(function(){return p.debug("Fetched for",t.identity),t.subscribed="subscribed",t.emit("userSubscribed",t),t}).catch(function(e){throw t.promiseToFetch=null,e}),e.abrupt("return",this.promiseToFetch);case 4:case"end":return e.stop()}},e,this)}))}},{key:"_ensureFetched",value:function(){return this.promiseToFetch||this._fetch()}},{key:"updateAttributes",value:function(t){return h(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.constructor===Object){e.next=2;break}throw new Error("Attributes must be an object");case 2:if("unsubscribed"!=this.subscribed){e.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return e.next=6,this.services.session.addCommand("editUserAttributes",{username:this.state.identity,attributes:(0,n.default)(t)});case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}},e,this)}))}},{key:"updateFriendlyName",value:function(t){return h(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"string"==typeof t){e.next=2;break}throw new Error("friendlyName must be string or empty");case 2:if("unsubscribed"!=this.subscribed){e.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return e.next=6,this.services.session.addCommand("editUserFriendlyName",{username:this.state.identity,friendlyName:t});case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}},e,this)}))}},{key:"unsubscribe",value:function(){return h(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.promiseToFetch){e.next=7;break}return e.next=3,this.promiseToFetch;case 3:this.entity.close(),this.promiseToFetch=null,this.subscribed="unsubscribed",this.emit("userUnsubscribed",this);case 7:case"end":return e.stop()}},e,this)}))}},{key:"identity",get:function(){return this.state.identity},set:function(e){this.state.identity=e}},{key:"entityName",set:function(e){this.state.entityName=e}},{key:"attributes",get:function(){return this.state.attributes}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"online",get:function(){return this.state.online}},{key:"notifiable",get:function(){return this.state.notifiable}},{key:"isSubscribed",get:function(){return"subscribed"==this.subscribed}}]),i}(d.EventEmitter);r.User=m},{"./logger":14,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57,events:214}],28:[function(e,t,r){"use strict";var n=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./logger").Logger.scope("UserDescriptor");var a=function(){function r(e,t){(0,n.default)(this,r),this.services=e,this.descriptor=t,this.identity=t.identity,this.friendlyName=t.friendly_name,this.attributes=function(e){try{return JSON.parse(e)}catch(e){o.warn("Failed to parse user attributes",e)}return{}}(t.attributes),this.online=t.is_online,this.notifiable=t.is_notifiable}return(0,i.default)(r,[{key:"subscribe",value:function(){return this.services.users.getUser(this.identity,this.descriptor.sync_unique_name)}},{key:"_getDescriptor",value:function(){return this.descriptor}}]),r}();r.UserDescriptor=a},{"./logger":14,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],29:[function(e,t,r){"use strict";var n=o(e("babel-runtime/core-js/promise")),i=o(e("babel-runtime/helpers/classCallCheck")),s=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(){var r=this;(0,i.default)(this,e),this._promise=new n.default(function(e,t){r._resolve=e,r._reject=t})}return(0,s.default)(e,[{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}},{key:"promise",get:function(){return this._promise}}]),e}();r.Deferred=a},{"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],30:[function(e,t,r){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass")),s=o(e("babel-runtime/core-js/json/stringify"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=e("rfc6902");r.isDeepEqual=function(e,t){return 0===a.createPatch(e,t).length},r.deepClone=function(e){return JSON.parse((0,s.default)(e))},r.parseToNumber=function(e){return void 0===e||isNaN(Number(e))?null:Number(e)};var u=function(){function t(e){(0,n.default)(this,t),this.base=e.replace(/\/$/,""),this.args=[],this.paths=[]}return(0,i.default)(t,[{key:"arg",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"path",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),t}();r.UriBuilder=u},{"babel-runtime/core-js/json/stringify":34,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,rfc6902:228}],31:[function(e,t,r){t.exports={default:e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":72}],32:[function(e,t,r){t.exports={default:e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":73}],33:[function(e,t,r){t.exports={default:e("core-js/library/fn/is-iterable"),__esModule:!0}},{"core-js/library/fn/is-iterable":74}],34:[function(e,t,r){t.exports={default:e("core-js/library/fn/json/stringify"),__esModule:!0}},{"core-js/library/fn/json/stringify":75}],35:[function(e,t,r){t.exports={default:e("core-js/library/fn/map"),__esModule:!0}},{"core-js/library/fn/map":76}],36:[function(e,t,r){t.exports={default:e("core-js/library/fn/number/is-integer"),__esModule:!0}},{"core-js/library/fn/number/is-integer":77}],37:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":78}],38:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":79}],39:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/define-properties"),__esModule:!0}},{"core-js/library/fn/object/define-properties":80}],40:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":81}],41:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/freeze"),__esModule:!0}},{"core-js/library/fn/object/freeze":82}],42:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/get-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/get-prototype-of":83}],43:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":84}],44:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":85}],45:[function(e,t,r){t.exports={default:e("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":86}],46:[function(e,t,r){t.exports={default:e("core-js/library/fn/reflect/construct"),__esModule:!0}},{"core-js/library/fn/reflect/construct":87}],47:[function(e,t,r){t.exports={default:e("core-js/library/fn/set"),__esModule:!0}},{"core-js/library/fn/set":88}],48:[function(e,t,r){t.exports={default:e("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":89}],49:[function(e,t,r){t.exports={default:e("core-js/library/fn/symbol/iterator"),__esModule:!0}},{"core-js/library/fn/symbol/iterator":90}],50:[function(e,t,r){"use strict";r.__esModule=!0,r.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],51:[function(e,t,r){"use strict";r.__esModule=!0;var n,i=e("../core-js/object/define-property"),s=(n=i)&&n.__esModule?n:{default:n};r.default=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,s.default)(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}()},{"../core-js/object/define-property":40}],52:[function(e,t,r){"use strict";r.__esModule=!0;var n,i=e("../core-js/object/assign"),s=(n=i)&&n.__esModule?n:{default:n};r.default=s.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}},{"../core-js/object/assign":37}],53:[function(e,t,r){"use strict";r.__esModule=!0;var n=o(e("../core-js/object/set-prototype-of")),i=o(e("../core-js/object/create")),s=o(e("../helpers/typeof"));function o(e){return e&&e.__esModule?e:{default:e}}r.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,s.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}},{"../core-js/object/create":38,"../core-js/object/set-prototype-of":44,"../helpers/typeof":56}],54:[function(e,t,r){"use strict";r.__esModule=!0;var n,i=e("../helpers/typeof"),s=(n=i)&&n.__esModule?n:{default:n};r.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,s.default)(t))&&"function"!=typeof t?e:t}},{"../helpers/typeof":56}],55:[function(e,t,r){"use strict";r.__esModule=!0;var n=i(e("../core-js/is-iterable")),u=i(e("../core-js/get-iterator"));function i(e){return e&&e.__esModule?e:{default:e}}r.default=function(e,t){if(Array.isArray(e))return e;if((0,n.default)(Object(e)))return function(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var o,a=(0,u.default)(e);!(n=(o=a.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw s}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},{"../core-js/get-iterator":32,"../core-js/is-iterable":33}],56:[function(e,t,r){"use strict";r.__esModule=!0;var n=o(e("../core-js/symbol/iterator")),i=o(e("../core-js/symbol")),s="function"==typeof i.default&&"symbol"==typeof n.default?function(e){return typeof e}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":typeof e};function o(e){return e&&e.__esModule?e:{default:e}}r.default="function"==typeof i.default&&"symbol"===s(n.default)?function(e){return void 0===e?"undefined":s(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":s(e)}},{"../core-js/symbol":48,"../core-js/symbol/iterator":49}],57:[function(e,t,r){t.exports=e("regenerator-runtime")},{"regenerator-runtime":226}],58:[function(e,t,r){
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var n=e("./lib/backoff"),i=e("./lib/strategy/exponential"),s=e("./lib/strategy/fibonacci"),o=e("./lib/function_call.js");t.exports.Backoff=n,t.exports.FunctionCall=o,t.exports.FibonacciStrategy=s,t.exports.ExponentialStrategy=i,t.exports.fibonacci=function(e){return new n(new s(e))},t.exports.exponential=function(e){return new n(new i(e))},t.exports.call=function(e,t,r){var n=Array.prototype.slice.call(arguments);return e=n[0],t=n.slice(1,n.length-1),r=n[n.length-1],new o(e,t,r)}},{"./lib/backoff":59,"./lib/function_call.js":60,"./lib/strategy/exponential":61,"./lib/strategy/fibonacci":62}],59:[function(e,t,r){
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var n=e("events"),i=e("precond");function s(e){n.EventEmitter.call(this),this.backoffStrategy_=e,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}e("util").inherits(s,n.EventEmitter),s.prototype.failAfter=function(e){i.checkArgument(0<e,"Expected a maximum number of retry greater than 0 but got %s.",e),this.maxNumberOfRetry_=e},s.prototype.backoff=function(e){i.checkState(-1===this.timeoutID_,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",e),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,e))},s.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},s.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},t.exports=s},{events:214,precond:222,util:282}],60:[function(e,t,r){
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var n=e("events"),i=e("precond"),s=e("util"),o=e("./backoff"),a=e("./strategy/fibonacci");function u(e,t,r){n.EventEmitter.call(this),i.checkIsFunction(e,"Expected fn to be a function."),i.checkIsArray(t,"Expected args to be an array."),i.checkIsFunction(r,"Expected callback to be a function."),this.function_=e,this.arguments_=t,this.callback_=r,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=u.DEFAULT_RETRY_PREDICATE_,this.state_=u.State_.PENDING}s.inherits(u,n.EventEmitter),u.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},u.DEFAULT_RETRY_PREDICATE_=function(e){return!0},u.prototype.isPending=function(){return this.state_==u.State_.PENDING},u.prototype.isRunning=function(){return this.state_==u.State_.RUNNING},u.prototype.isCompleted=function(){return this.state_==u.State_.COMPLETED},u.prototype.isAborted=function(){return this.state_==u.State_.ABORTED},u.prototype.setStrategy=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=e,this},u.prototype.retryIf=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=e,this},u.prototype.getLastResult=function(){return this.lastResult_.concat()},u.prototype.getNumRetries=function(){return this.numRetries_},u.prototype.failAfter=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=e,this},u.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=u.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},u.prototype.start=function(e){i.checkState(!this.isAborted(),"FunctionCall is aborted."),i.checkState(this.isPending(),"FunctionCall already started.");var t=this.strategy_||new a;this.backoff_=e?e(t):new o(t),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),0<this.failAfter_&&this.backoff_.failAfter(this.failAfter_),this.state_=u.State_.RUNNING,this.doCall_(!1)},u.prototype.doCall_=function(e){e&&this.numRetries_++;var t=["call"].concat(this.arguments_);n.EventEmitter.prototype.emit.apply(this,t);var r=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(r))},u.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},u.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e,n.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var t=e[0];t&&this.retryPredicate_(t)?this.backoff_.backoff(t):(this.state_=u.State_.COMPLETED,this.doCallback_())}},u.prototype.handleBackoff_=function(e,t,r){this.emit("backoff",e,t,r)},t.exports=u},{"./backoff":59,"./strategy/fibonacci":62,events:214,precond:222,util:282}],61:[function(e,t,r){
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var n=e("util"),i=e("precond"),s=e("./strategy");function o(e){s.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=o.DEFAULT_FACTOR,e&&void 0!==e.factor&&(i.checkArgument(1<e.factor,"Exponential factor should be greater than 1 but got %s.",e.factor),this.factor_=e.factor)}n.inherits(o,s),o.DEFAULT_FACTOR=2,o.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},o.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},t.exports=o},{"./strategy":63,precond:222,util:282}],62:[function(e,t,r){
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var n=e("util"),i=e("./strategy");function s(e){i.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}n.inherits(s,i),s.prototype.next_=function(){var e=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=e},s.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},t.exports=s},{"./strategy":63,util:282}],63:[function(e,t,r){
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
e("events"),e("util");function n(e){return null!=e}function i(e){if(n((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(n(e.maxDelay)&&e.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=e.initialDelay||100,this.maxDelay_=e.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(n(e.randomisationFactor)&&(e.randomisationFactor<0||1<e.randomisationFactor))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=e.randomisationFactor||0}i.prototype.getMaxDelay=function(){return this.maxDelay_},i.prototype.getInitialDelay=function(){return this.initialDelay_},i.prototype.next=function(){var e=this.next_(),t=1+Math.random()*this.randomisationFactor_;return Math.round(e*t)},i.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},i.prototype.reset=function(){this.reset_()},i.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},t.exports=i},{events:214,util:282}],64:[function(e,t,r){"use strict";r.byteLength=function(e){return 3*e.length/4-f(e)},r.toByteArray=function(e){var t,r,n,i,s,o=e.length;i=f(e),s=new l(3*o/4-i),r=0<i?o-4:o;var a=0;for(t=0;t<r;t+=4)n=c[e.charCodeAt(t)]<<18|c[e.charCodeAt(t+1)]<<12|c[e.charCodeAt(t+2)]<<6|c[e.charCodeAt(t+3)],s[a++]=n>>16&255,s[a++]=n>>8&255,s[a++]=255&n;2===i?(n=c[e.charCodeAt(t)]<<2|c[e.charCodeAt(t+1)]>>4,s[a++]=255&n):1===i&&(n=c[e.charCodeAt(t)]<<10|c[e.charCodeAt(t+1)]<<4|c[e.charCodeAt(t+2)]>>2,s[a++]=n>>8&255,s[a++]=255&n);return s},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,i="",s=[],o=0,a=r-n;o<a;o+=16383)s.push(h(e,o,a<o+16383?a:o+16383));1===n?(t=e[r-1],i+=u[t>>2],i+=u[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=u[t>>10],i+=u[t>>4&63],i+=u[t<<2&63],i+="=");return s.push(i),s.join("")};for(var u=[],c=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,s=n.length;i<s;++i)u[i]=n[i],c[n.charCodeAt(i)]=i;function f(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function h(e,t,r){for(var n,i,s=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(u[(i=n)>>18&63]+u[i>>12&63]+u[i>>6&63]+u[63&i]);return s.join("")}c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},{}],65:[function(f,r,n){(function(O,a){!function(e){if("object"==typeof n&&void 0!==r)r.exports=e();else if("function"==typeof d&&d.amd)d([],e);else{var t;"undefined"!=typeof window?t=window:void 0!==a?t=a:"undefined"!=typeof self&&(t=self),t.Promise=e()}}(function(){var e,t,r;return function s(o,a,u){function c(r,e){if(!a[r]){if(!o[r]){var t="function"==typeof f&&f;if(!e&&t)return t(r,!0);if(l)return l(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=a[r]={exports:{}};o[r][0].call(i.exports,function(e){var t=o[r][1][e];return c(t||e)},i,i.exports,s,o,a,u)}return a[r].exports}for(var l="function"==typeof f&&f,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,t,r){"use strict";t.exports=function(e){var n=e._SomePromiseArray;function t(e){var t=new n(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,r){"use strict";var n;try{throw new Error}catch(e){n=e}var i=e("./schedule.js"),s=e("./queue.js"),o=e("./util.js");function a(){this._isTickUsed=!1,this._lateQueue=new s(16),this._normalQueue=new s(16),this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=i.isStatic?i(this.drainQueues):i}function u(e,t,r){this._lateQueue.push(e,t,r),this._queueTick()}function c(e,t,r){this._normalQueue.push(e,t,r),this._queueTick()}function l(e){this._normalQueue._pushOne(e),this._queueTick()}a.prototype.disableTrampolineIfNecessary=function(){o.hasDevTools&&(this._trampolineEnabled=!1)},a.prototype.enableTrampoline=function(){this._trampolineEnabled||(this._trampolineEnabled=!0,this._schedule=function(e){setTimeout(e,0)})},a.prototype.haveItemsQueued=function(){return 0<this._normalQueue.length()},a.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}},o.hasDevTools?(i.isStatic&&(i=function(e){setTimeout(e,0)}),a.prototype.invokeLater=function(e,t,r){this._trampolineEnabled?u.call(this,e,t,r):this._schedule(function(){setTimeout(function(){e.call(t,r)},100)})},a.prototype.invoke=function(e,t,r){this._trampolineEnabled?c.call(this,e,t,r):this._schedule(function(){e.call(t,r)})},a.prototype.settlePromises=function(e){this._trampolineEnabled?l.call(this,e):this._schedule(function(){e._settlePromises()})}):(a.prototype.invokeLater=u,a.prototype.invoke=c,a.prototype.settlePromises=l),a.prototype.invokeFirst=function(e,t,r){this._normalQueue.unshift(e,t,r),this._queueTick()},a.prototype._drainQueue=function(e){for(;0<e.length();){var t=e.shift();if("function"==typeof t){var r=e.shift(),n=e.shift();t.call(r,n)}else t._settlePromises()}},a.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._drainQueue(this._lateQueue)},a.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},a.prototype._reset=function(){this._isTickUsed=!1},t.exports=new a,t.exports.firstLineError=n},{"./queue.js":28,"./schedule.js":31,"./util.js":38}],3:[function(e,t,r){"use strict";t.exports=function(s,o,a){var r=function(e,t){this._reject(t)},u=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(r,r,null,this,e)},c=function(e,t){this._isPending()&&this._resolveCallback(t.target)},l=function(e,t){t.promiseRejectionQueued||this._reject(e)};s.prototype.bind=function(e){var t=a(e),r=new s(o);r._propagateFrom(this,1);var n=this._target();if(r._setBoundTo(t),t instanceof s){var i={promiseRejectionQueued:!1,promise:r,target:n,bindingPromise:t};n._then(o,u,r._progress,r,i),t._then(c,l,r._progress,r,i)}else r._resolveCallback(n);return r},s.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=131072|this._bitField,this._boundTo=e):this._bitField=-131073&this._bitField},s.prototype._isBound=function(){return 131072==(131072&this._bitField)},s.bind=function(e,t){var r=a(e),n=new s(o);return n._setBoundTo(r),r instanceof s?r._then(function(){n._resolveCallback(t)},n._reject,n._progress,n,null):n._resolveCallback(t),n}}},{}],4:[function(e,t,r){"use strict";var n;"undefined"!=typeof Promise&&(n=Promise);var i=e("./promise.js")();i.noConflict=function(){try{Promise===i&&(Promise=n)}catch(e){}return i},t.exports=i},{"./promise.js":23}],5:[function(e,t,r){"use strict";var n=Object.create;if(n){var i=n(null),s=n(null);i[" size"]=s[" size"]=0}t.exports=function(i){var n,s=e("./util.js"),o=s.canEvaluate;s.isIdentifier;function t(e,t){var r;if(null!=e&&(r=e[t]),"function"!=typeof r){var n="Object "+s.classString(e)+" has no method '"+s.toString(t)+"'";throw new i.TypeError(n)}return r}function a(e){return t(e,this.pop()).apply(e,this)}function u(e){return e[this]}function c(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}i.prototype.call=function(e){for(var t=arguments.length,r=new Array(t-1),n=1;n<t;++n)r[n-1]=arguments[n];return r.push(e),this._then(a,void 0,void 0,r,void 0)},i.prototype.get=function(e){var t;if("number"==typeof e)t=c;else if(o){var r=n(e);t=null!==r?r:u}else t=u;return this._then(t,void 0,void 0,e,void 0)}}},{"./util.js":38}],6:[function(i,e,t){"use strict";e.exports=function(e){var t=i("./errors.js"),r=i("./async.js"),n=t.CancellationError;e.prototype._cancel=function(e){if(!this.isCancellable())return this;for(var t,r=this;void 0!==(t=r._cancellationParent)&&t.isCancellable();)r=t;this._unsetCancellable(),r._target()._rejectCallback(e,!1,!0)},e.prototype.cancel=function(e){return this.isCancellable()&&(void 0===e&&(e=new n),r.invokeLater(this._cancel,this,e)),this},e.prototype.cancellable=function(){return this._cancellable()||(r.enableTrampoline(),this._setCancellable(),this._cancellationParent=void 0),this},e.prototype.uncancellable=function(){var e=this.then();return e._unsetCancellable(),e},e.prototype.fork=function(e,t,r){var n=this._then(e,t,r,void 0,void 0);return n._setCancellable(),n._cancellationParent=void 0,n}}},{"./async.js":2,"./errors.js":13}],7:[function(e,t,r){"use strict";t.exports=function(){var i,a=e("./async.js"),o=e("./util.js"),l=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo|instrumented)/,u=null,s=null,c=!1;function f(e){this._parent=e;var t=this._length=1+(void 0===e?0:e._length);n(this,f),32<t&&this.uncycle()}function h(e){for(var t=[],r=0;r<e.length;++r){var n=e[r],i=u.test(n)||"    (No stack trace)"===n,s=i&&p(n);i&&!s&&(c&&" "!==n.charAt(0)&&(n="    "+n),t.push(n))}return t}function d(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{t=e.toString();if(/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+function(e){if(e.length<41)return e;return e.substr(0,38)+"..."}(t)+">, no stack trace)"}o.inherits(f,Error),f.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],r={},n=0,i=this;void 0!==i;++n)t.push(i),i=i._parent;for(n=(e=this._length=n)-1;0<=n;--n){var s=t[n].stack;void 0===r[s]&&(r[s]=n)}for(n=0;n<e;++n){var o=r[t[n].stack];if(void 0!==o&&o!==n){0<o&&(t[o-1]._parent=void 0,t[o-1]._length=1),t[n]._parent=void 0,t[n]._length=1;var a=0<n?t[n-1]:this;o<e-1?(a._parent=t[o+1],a._parent.uncycle(),a._length=a._parent._length+1):(a._parent=void 0,a._length=1);for(var u=a._length+1,c=n-2;0<=c;--c)t[c]._length=u,u++;return}}}},f.prototype.parent=function(){return this._parent},f.prototype.hasParent=function(){return void 0!==this._parent},f.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=f.parseStackAndMessage(e),r=t.message,n=[t.stack],i=this;void 0!==i;)n.push(h(i.stack.split("\n"))),i=i._parent;!function(e){for(var t=e[0],r=1;r<e.length;++r){for(var n=e[r],i=t.length-1,s=t[i],o=-1,a=n.length-1;0<=a;--a)if(n[a]===s){o=a;break}for(var a=o;0<=a;--a){var u=n[a];if(t[i]!==u)break;t.pop(),i--}t=n}}(n),function(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}(n),o.notEnumerableProp(e,"stack",function(e,t){for(var r=0;r<t.length-1;++r)t[r].push("From previous event:"),t[r]=t[r].join("\n");r<t.length&&(t[r]=t[r].join("\n"));return e+"\n"+t.join("\n")}(r,n)),o.notEnumerableProp(e,"__stackCleaned__",!0)}},f.parseStackAndMessage=function(e){var t=e.stack;return{message:e.toString(),stack:h(t="string"==typeof t&&0<t.length?function(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),r=0;r<t.length;++r){var n=t[r];if("    (No stack trace)"===n||u.test(n))break}return 0<r&&(t=t.slice(r)),t}(e):["    (No stack trace)"])}},f.formatAndLogError=function(e,t){if("undefined"!=typeof console){var r;if("object"==typeof e||"function"==typeof e){var n=e.stack;r=t+s(n,e)}else r=t+String(e);"function"==typeof i?i(r):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}},f.unhandledRejection=function(e){f.formatAndLogError(e,"^--- With additional stack trace: ")},f.isSupported=function(){return"function"==typeof n},f.fireRejectionEvent=function(e,t,r,n){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(n):t(r,n))}catch(e){a.throwLater(e)}var s=!1;try{s=b(e,r,n)}catch(e){s=!0,a.throwLater(e)}var o=!1;if(v)try{o=v(e.toLowerCase(),{reason:r,promise:n})}catch(e){o=!0,a.throwLater(e)}s||i||o||"unhandledRejection"!==e||f.formatAndLogError(r,"Unhandled rejection ")};var p=function(){return!1},r=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function m(e){var t=e.match(r);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}f.setBounds=function(e,t){if(f.isSupported()){for(var r,n,i=e.stack.split("\n"),s=t.stack.split("\n"),o=-1,a=-1,u=0;u<i.length;++u){if(c=m(i[u])){r=c.fileName,o=c.line;break}}for(u=0;u<s.length;++u){var c;if(c=m(s[u])){n=c.fileName,a=c.line;break}}o<0||a<0||!r||!n||r!==n||a<=o||(p=function(e){if(l.test(e))return!0;var t=m(e);return!!(t&&t.fileName===r&&o<=t.line&&t.line<=a)})}};var v,n=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():d(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit=Error.stackTraceLimit+6,u=e,s=t;var r=Error.captureStackTrace;return p=function(e){return l.test(e)},function(e,t){Error.stackTraceLimit=Error.stackTraceLimit+6,r(e,t),Error.stackTraceLimit=Error.stackTraceLimit-6}}var n,i=new Error;if("string"==typeof i.stack&&0<=i.stack.split("\n")[0].indexOf("stackDetection@"))return u=/@/,s=t,c=!0,function(e){e.stack=(new Error).stack};try{throw new Error}catch(e){n="stack"in e}return"stack"in i||!n||"number"!=typeof Error.stackTraceLimit?(s=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?d(t):t.toString()},null):(u=e,s=t,function(t){Error.stackTraceLimit=Error.stackTraceLimit+6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit=Error.stackTraceLimit-6})}(),b=function(){if(o.isNode)return function(e,t,r){return"rejectionHandled"===e?O.emit(e,r):O.emit(e,t,r)};var n=!1,t=!0;try{var e=new self.CustomEvent("test");n=e instanceof CustomEvent}catch(e){}if(!n)try{var r=document.createEvent("CustomEvent");r.initCustomEvent("testingtheevent",!1,!0,{}),self.dispatchEvent(r)}catch(e){t=!1}t&&(v=function(e,t){var r;return n?r=new self.CustomEvent(e,{detail:t,bubbles:!1,cancelable:!0}):self.dispatchEvent&&(r=document.createEvent("CustomEvent")).initCustomEvent(e,!1,!0,t),!!r&&!self.dispatchEvent(r)});var s={};return s.unhandledRejection="onunhandledRejection".toLowerCase(),s.rejectionHandled="onrejectionHandled".toLowerCase(),function(e,t,r){var n=s[e],i=self[n];return!!i&&("rejectionHandled"===e?i.call(self,r):i.call(self,t,r),!0)}}();return"undefined"!=typeof console&&void 0!==console.warn&&(i=function(e){console.warn(e)},o.isNode&&O.stderr.isTTY?i=function(e){O.stderr.write("\x1b[31m"+e+"\x1b[39m\n")}:o.isNode||"string"!=typeof(new Error).stack||(i=function(e){console.warn("%c"+e,"color: red")})),f}},{"./async.js":2,"./util.js":38}],8:[function(n,e,t){"use strict";e.exports=function(h){var e=n("./util.js"),t=n("./errors.js"),d=e.tryCatch,p=e.errorObj,m=n("./es5.js").keys,v=t.TypeError;function r(e,t,r){this._instances=e,this._callback=t,this._promise=r}return r.prototype.doFilter=function(e){for(var t,r,n,i=this._callback,s=this._promise._boundValue(),o=0,a=this._instances.length;o<a;++o){var u=this._instances[o],c=u===Error||null!=u&&u.prototype instanceof Error;if(c&&e instanceof u)return(l=d(i).call(s,e))===p?(h.e=l.e,h):l;if("function"==typeof u&&!c){var l,f=(t=e,void 0,r={},(n=d(u).call(r,t))===p?n:m(r).length?(p.e=new v("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"),p):n);if(f===p){e=p.e;break}if(f)return(l=d(i).call(s,e))===p?(h.e=l.e,h):l}}return h.e=e,h},r}},{"./errors.js":13,"./es5.js":14,"./util.js":38}],9:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=[];function i(){this._trace=new t(s())}function s(){var e=n.length-1;if(0<=e)return n[e]}return i.prototype._pushContext=function(){r()&&void 0!==this._trace&&n.push(this._trace)},i.prototype._popContext=function(){r()&&void 0!==this._trace&&n.pop()},e.prototype._peekContext=s,e.prototype._pushContext=i.prototype._pushContext,e.prototype._popContext=i.prototype._popContext,function(){if(r())return new i}}},{}],10:[function(l,e,t){"use strict";e.exports=function(e,i){var r,n,s=e._getDomain,t=l("./async.js"),o=l("./errors.js").Warning,a=l("./util.js"),u=a.canAttachTrace,c=a.isNode&&(!!O.env.BLUEBIRD_DEBUG||"development"===O.env.NODE_ENV);return a.isNode&&0==O.env.BLUEBIRD_DEBUG&&(c=!1),c&&t.disableTrampolineIfNecessary(),e.prototype._ignoreRejections=function(){this._unsetRejectionIsUnhandled(),this._bitField=16777216|this._bitField},e.prototype._ensurePossibleRejectionHandled=function(){0==(16777216&this._bitField)&&(this._setRejectionIsUnhandled(),t.invokeLater(this._notifyUnhandledRejection,this,void 0))},e.prototype._notifyUnhandledRejectionIsHandled=function(){i.fireRejectionEvent("rejectionHandled",r,void 0,this)},e.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified(),i.fireRejectionEvent("unhandledRejection",n,e,this)}},e.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},e.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},e.prototype._isUnhandledRejectionNotified=function(){return 0<(524288&this._bitField)},e.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},e.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},e.prototype._isRejectionUnhandled=function(){return 0<(2097152&this._bitField)},e.prototype._setCarriedStackTrace=function(e){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=e},e.prototype._isCarryingStackTrace=function(){return 0<(1048576&this._bitField)},e.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},e.prototype._captureStackTrace=function(){return c&&(this._trace=new i(this._peekContext())),this},e.prototype._attachExtraTrace=function(e,t){if(c&&u(e)){var r=this._trace;if(void 0!==r&&t&&(r=r._parent),void 0!==r)r.attachExtraTrace(e);else if(!e.__stackCleaned__){var n=i.parseStackAndMessage(e);a.notEnumerableProp(e,"stack",n.message+"\n"+n.stack.join("\n")),a.notEnumerableProp(e,"__stackCleaned__",!0)}}},e.prototype._warn=function(e){var t=new o(e),r=this._peekContext();if(r)r.attachExtraTrace(t);else{var n=i.parseStackAndMessage(t);t.stack=n.message+"\n"+n.stack.join("\n")}i.formatAndLogError(t,"")},e.onPossiblyUnhandledRejection=function(e){var t=s();n="function"==typeof e?null===t?e:t.bind(e):void 0},e.onUnhandledRejectionHandled=function(e){var t=s();r="function"==typeof e?null===t?e:t.bind(e):void 0},e.longStackTraces=function(){if(t.haveItemsQueued()&&!1===c)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n");(c=i.isSupported())&&t.disableTrampolineIfNecessary()},e.hasLongStackTraces=function(){return c&&i.isSupported()},i.isSupported()||(e.longStackTraces=function(){},c=!1),function(){return c}}},{"./async.js":2,"./errors.js":13,"./util.js":38}],11:[function(e,t,r){"use strict";var a=e("./util.js").isPrimitive;t.exports=function(t){var r=function(){return this},n=function(){throw this},i=function(){},s=function(){throw void 0},o=function(e,t){return 1===t?function(){throw e}:2===t?function(){return e}:void 0};t.prototype.return=t.prototype.thenReturn=function(e){return void 0===e?this.then(i):a(e)?this._then(o(e,2),void 0,void 0,void 0,void 0):(e instanceof t&&e._ignoreRejections(),this._then(r,void 0,void 0,e,void 0))},t.prototype.throw=t.prototype.thenThrow=function(e){return void 0===e?this.then(s):a(e)?this._then(o(e,1),void 0,void 0,void 0,void 0):this._then(n,void 0,void 0,e,void 0)}}},{"./util.js":38}],12:[function(e,t,r){"use strict";t.exports=function(e,r){var n=e.reduce;e.prototype.each=function(e){return n(this,e,null,r)},e.each=function(e,t){return n(e,t,null,r)}}},{}],13:[function(e,t,r){"use strict";var n,i,s=e("./es5.js"),o=s.freeze,a=e("./util.js"),u=a.inherits,c=a.notEnumerableProp;function l(t,r){function n(e){if(!(this instanceof n))return new n(e);c(this,"message","string"==typeof e?e:r),c(this,"name",t),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return u(n,Error),n}var f=l("Warning","warning"),h=l("CancellationError","cancellation error"),d=l("TimeoutError","timeout error"),p=l("AggregateError","aggregate error");try{n=TypeError,i=RangeError}catch(e){n=l("TypeError","type error"),i=l("RangeError","range error")}for(var m="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),v=0;v<m.length;++v)"function"==typeof Array.prototype[m[v]]&&(p.prototype[m[v]]=Array.prototype[m[v]]);s.defineProperty(p.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),p.prototype.isOperational=!0;var b=0;function y(e){if(!(this instanceof y))return new y(e);c(this,"name","OperationalError"),c(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(c(this,"message",e.message),c(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}p.prototype.toString=function(){var e=Array(4*b+1).join(" "),t="\n"+e+"AggregateError of:\n";b++,e=Array(4*b+1).join(" ");for(var r=0;r<this.length;++r){for(var n=this[r]===this?"[Circular AggregateError]":this[r]+"",i=n.split("\n"),s=0;s<i.length;++s)i[s]=e+i[s];t+=(n=i.join("\n"))+"\n"}return b--,t},u(y,Error);var _=Error.__BluebirdErrorTypes__;_||(_=o({CancellationError:h,TimeoutError:d,OperationalError:y,RejectionError:y,AggregateError:p}),c(Error,"__BluebirdErrorTypes__",_)),t.exports={Error:Error,TypeError:n,RangeError:i,CancellationError:_.CancellationError,OperationalError:_.OperationalError,TimeoutError:_.TimeoutError,AggregateError:_.AggregateError,Warning:f}},{"./es5.js":14,"./util.js":38}],14:[function(e,t,r){var n=function(){"use strict";return void 0===this}();if(n)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return!(r&&!r.writable&&!r.set)}};else{var i={}.hasOwnProperty,s={}.toString,o={}.constructor.prototype,a=function(e){var t=[];for(var r in e)i.call(e,r)&&t.push(r);return t};t.exports={isArray:function(e){try{return"[object Array]"===s.call(e)}catch(e){return!1}},keys:a,names:a,defineProperty:function(e,t,r){return e[t]=r.value,e},getDescriptor:function(e,t){return{value:e[t]}},freeze:function(e){return e},getPrototypeOf:function(e){try{return Object(e).constructor.prototype}catch(e){return o}},isES5:n,propertyIsWritable:function(){return!0}}}},{}],15:[function(e,t,r){"use strict";t.exports=function(e,n){var i=e.map;e.prototype.filter=function(e,t){return i(this,e,t,n)},e.filter=function(e,t,r){return i(e,t,r,n)}}},{}],16:[function(t,e,r){"use strict";e.exports=function(s,o,a){var e=t("./util.js"),u=e.isPrimitive,c=e.thrower;function l(){return this}function f(){throw this}function h(e,t,r){var n,i,s;return n=u(t)?r?(s=t,function(){return s}):(i=t,function(){throw i}):r?l:f,e._then(n,c,void 0,t,void 0)}function n(e){var t=this.promise,r=this.handler,n=t._isBound()?r.call(t._boundValue()):r();if(void 0!==n){var i=a(n,t);if(i instanceof s)return h(i=i._target(),e,t.isFulfilled())}return t.isRejected()?(o.e=e,o):e}function i(e){var t=this.promise,r=this.handler,n=t._isBound()?r.call(t._boundValue(),e):r(e);if(void 0!==n){var i=a(n,t);if(i instanceof s)return h(i=i._target(),e,!0)}return e}s.prototype._passThroughHandler=function(e,t){if("function"!=typeof e)return this.then();var r={promise:this,handler:e};return this._then(t?n:i,t?n:void 0,void 0,r,void 0)},s.prototype.lastly=s.prototype.finally=function(e){return this._passThroughHandler(e,!0)},s.prototype.tap=function(e){return this._passThroughHandler(e,!1)}}},{"./util.js":38}],17:[function(t,e,r){"use strict";e.exports=function(a,n,i,u){var o=t("./errors.js").TypeError,e=t("./util.js"),c=e.errorObj,l=e.tryCatch,s=[];function f(e,t,r,n){(this._promise=new a(i))._captureStackTrace(),this._stack=n,this._generatorFunction=e,this._receiver=t,this._generator=void 0,this._yieldHandlers="function"==typeof r?[r].concat(s):s}f.prototype.promise=function(){return this._promise},f.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},f.prototype._continue=function(e){if(e===c)return this._promise._rejectCallback(e.e,!1,!0);var t=e.value;if(!0===e.done)this._promise._resolveCallback(t);else{var r=u(t,this._promise);if(!(r instanceof a)&&null===(r=function(e,t,r){for(var n=0;n<t.length;++n){r._pushContext();var i=l(t[n])(e);if(r._popContext(),i===c){r._pushContext();var s=a.reject(c.e);return r._popContext(),s}var o=u(i,r);if(o instanceof a)return o}return null}(r,this._yieldHandlers,this._promise)))return void this._throw(new o("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n\n".replace("%s",t)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));r._then(this._next,this._throw,void 0,this,null)}},f.prototype._throw=function(e){this._promise._attachExtraTrace(e),this._promise._pushContext();var t=l(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},f.prototype._next=function(e){this._promise._pushContext();var t=l(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},a.coroutine=function(r,e){if("function"!=typeof r)throw new o("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var n=Object(e).yieldHandler,i=f,s=(new Error).stack;return function(){var e=r.apply(this,arguments),t=new i(void 0,void 0,n,s);return t._generator=e,t._next(void 0),t.promise()}},a.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new o("fn must be a function\n\n    See http://goo.gl/916lJJ\n");s.push(e)},a.spawn=function(e){if("function"!=typeof e)return n("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var t=new f(e,this),r=t.promise();return t._run(a.spawn),r}}},{"./errors.js":13,"./util.js":38}],18:[function(i,e,t){"use strict";e.exports=function(e,o,t,r){var n=i("./util.js");n.canEvaluate,n.tryCatch,n.errorObj;e.join=function(){var e,t=arguments.length-1;0<t&&"function"==typeof arguments[t]&&(e=arguments[t]);for(var r=arguments.length,n=new Array(r),i=0;i<r;++i)n[i]=arguments[i];e&&n.pop();var s=new o(n).promise();return void 0!==e?s.spread(e):s}}},{"./util.js":38}],19:[function(r,e,t){"use strict";e.exports=function(l,e,i,f,s){var o=l._getDomain,a=r("./async.js"),t=r("./util.js"),h=t.tryCatch,d=t.errorObj,p={},u=[];function c(e,t,r,n){this.constructor$(e),this._promise._captureStackTrace();var i=o();this._callback=null===i?t:i.bind(t),this._preservedValues=n===s?new Array(this.length()):null,this._limit=r,this._inFlight=0,this._queue=1<=r?[]:u,a.invoke(m,this,void 0)}function m(){this._init$(void 0,-2)}function v(e,t,r,n){var i="object"==typeof r&&null!==r?r.concurrency:0;return new c(e,t,i="number"==typeof i&&isFinite(i)&&1<=i?i:0,n)}t.inherits(c,e),c.prototype._init=function(){},c.prototype._promiseFulfilled=function(e,t){var r=this._values,n=this.length(),i=this._preservedValues,s=this._limit;if(r[t]===p){if(r[t]=e,1<=s&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(1<=s&&this._inFlight>=s)return r[t]=e,void this._queue.push(t);null!==i&&(i[t]=e);var o=this._callback,a=this._promise._boundValue();this._promise._pushContext();var u=h(o).call(a,e,t,n);if(this._promise._popContext(),u===d)return this._reject(u.e);var c=f(u,this._promise);if(c instanceof l){if((c=c._target())._isPending())return 1<=s&&this._inFlight++,r[t]=p,c._proxyPromiseArray(this,t);if(!c._isFulfilled())return this._reject(c._reason());u=c._value()}r[t]=u}n<=++this._totalResolved&&(null!==i?this._filter(r,i):this._resolve(r))},c.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,r=this._values;0<e.length&&this._inFlight<t;){if(this._isResolved())return;var n=e.pop();this._promiseFulfilled(r[n],n)}},c.prototype._filter=function(e,t){for(var r=t.length,n=new Array(r),i=0,s=0;s<r;++s)e[s]&&(n[i++]=t[s]);n.length=i,this._resolve(n)},c.prototype.preservedValues=function(){return this._preservedValues},l.prototype.map=function(e,t){return"function"!=typeof e?i("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):v(this,e,t,null).promise()},l.map=function(e,t,r,n){return"function"!=typeof t?i("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):v(e,t,r,n).promise()}}},{"./async.js":2,"./util.js":38}],20:[function(t,e,r){"use strict";e.exports=function(s,o,e,a){var u=t("./util.js"),c=u.tryCatch;s.method=function(r){if("function"!=typeof r)throw new s.TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return function(){var e=new s(o);e._captureStackTrace(),e._pushContext();var t=c(r).apply(this,arguments);return e._popContext(),e._resolveFromSyncValue(t),e}},s.attempt=s.try=function(e,t,r){if("function"!=typeof e)return a("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var n=new s(o);n._captureStackTrace(),n._pushContext();var i=u.isArray(t)?c(e).apply(r,t):c(e).call(r,t);return n._popContext(),n._resolveFromSyncValue(i),n},s.prototype._resolveFromSyncValue=function(e){e===u.errorObj?this._rejectCallback(e.e,!1,!0):this._resolveCallback(e,!0)}}},{"./util.js":38}],21:[function(t,e,r){"use strict";e.exports=function(e){var n=t("./util.js"),i=t("./async.js"),s=n.tryCatch,o=n.errorObj;function a(e,t){if(!n.isArray(e))return u.call(this,e,t);var r=s(t).apply(this._boundValue(),[null].concat(e));r===o&&i.throwLater(r.e)}function u(e,t){var r=this._boundValue(),n=void 0===e?s(t).call(r,null):s(t).call(r,null,e);n===o&&i.throwLater(n.e)}function c(e,t){if(!e){var r=this._target()._getCarriedStackTrace();r.cause=e,e=r}var n=s(t).call(this._boundValue(),e);n===o&&i.throwLater(n.e)}e.prototype.asCallback=e.prototype.nodeify=function(e,t){if("function"==typeof e){var r=u;void 0!==t&&Object(t).spread&&(r=a),this._then(r,c,void 0,this,e)}return this}}},{"./async.js":2,"./util.js":38}],22:[function(e,t,r){"use strict";t.exports=function(a,u){var c=e("./util.js"),l=e("./async.js"),f=c.tryCatch,h=c.errorObj;a.prototype.progressed=function(e){return this._then(void 0,void 0,e,void 0,void 0)},a.prototype._progress=function(e){this._isFollowingOrFulfilledOrRejected()||this._target()._progressUnchecked(e)},a.prototype._progressHandlerAt=function(e){return 0===e?this._progressHandler0:this[(e<<2)+e-5+2]},a.prototype._doProgressWith=function(e){var t=e.value,r=e.handler,n=e.promise,i=e.receiver,s=f(r).call(i,t);if(s===h){if(null!=s.e&&"StopProgressPropagation"!==s.e.name){var o=c.canAttachTrace(s.e)?s.e:new Error(c.toString(s.e));n._attachExtraTrace(o),n._progress(s.e)}}else s instanceof a?s._then(n._progress,null,null,n,void 0):n._progress(s)},a.prototype._progressUnchecked=function(e){for(var t=this._length(),r=this._progress,n=0;n<t;n++){var i=this._progressHandlerAt(n),s=this._promiseAt(n);if(s instanceof a)"function"==typeof i?l.invoke(this._doProgressWith,this,{handler:i,promise:s,receiver:this._receiverAt(n),value:e}):l.invoke(r,s,e);else{var o=this._receiverAt(n);"function"==typeof i?i.call(o,e,s):o instanceof u&&!o._isResolved()&&o._promiseProgressed(e,s)}}}}},{"./async.js":2,"./util.js":38}],23:[function(C,j,e){"use strict";j.exports=function(){var c,a=function(){return new f("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")},e=function(){return new w.PromiseInspection(this._target())},t=function(e){return w.reject(new f(e))},s=C("./util.js");c=s.isNode?function(){var e=O.domain;return void 0===e&&(e=null),e}:function(){return null},s.notEnumerableProp(w,"_getDomain",c);var u={},l=C("./async.js"),r=C("./errors.js"),f=w.TypeError=r.TypeError;w.RangeError=r.RangeError,w.CancellationError=r.CancellationError,w.TimeoutError=r.TimeoutError,w.OperationalError=r.OperationalError,w.RejectionError=r.OperationalError,w.AggregateError=r.AggregateError;var h=function(){},o={},d={e:null},p=C("./thenables.js")(w,h),m=C("./promise_array.js")(w,h,p,t),n=C("./captured_trace.js")(),i=C("./debuggability.js")(w,n),v=C("./context.js")(w,n,i),b=C("./catch_filter.js")(d),y=C("./promise_resolver.js"),_=y._nodebackForPromise,g=s.errorObj,k=s.tryCatch;function w(e){if("function"!=typeof e)throw new f("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n");if(this.constructor!==w)throw new f("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,e!==h&&this._resolveFromResolver(e)}function x(e){var t=new w(h);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._progressHandler0=e,t._promise0=e,t._receiver0=e,t._settledValue=e}return w.prototype.toString=function(){return"[object Promise]"},w.prototype.caught=w.prototype.catch=function(e){var t=arguments.length;if(1<t){var r,n=new Array(t-1),i=0;for(r=0;r<t-1;++r){var s=arguments[r];if("function"!=typeof s)return w.reject(new f("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"));n[i++]=s}n.length=i,e=arguments[r];var o=new b(n,e,this);return this._then(void 0,o.doFilter,void 0,o,void 0)}return this._then(void 0,e,void 0,void 0,void 0)},w.prototype.reflect=function(){return this._then(e,e,void 0,this,void 0)},w.prototype.then=function(e,t,r){if(i()&&0<arguments.length&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+s.classString(e);1<arguments.length&&(n+=", "+s.classString(t)),this._warn(n)}return this._then(e,t,r,void 0,void 0)},w.prototype.done=function(e,t,r){this._then(e,t,r,void 0,void 0)._setIsFinal()},w.prototype.spread=function(e,t){return this.all()._then(e,t,void 0,o,void 0)},w.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},w.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},w.prototype.all=function(){return new m(this).promise()},w.prototype.error=function(e){return this.caught(s.originatesFromRejection,e)},w.getNewLibraryCopy=j.exports,w.is=function(e){return e instanceof w},w.fromNode=function(e){var t=new w(h),r=k(e)(_(t));return r===g&&t._rejectCallback(r.e,!0,!0),t},w.all=function(e){return new m(e).promise()},w.defer=w.pending=function(){var e=new w(h);return new y(e)},w.resolve=w.fulfilled=w.cast=function(e){var t=p(e);if(!(t instanceof w)){var r=t;(t=new w(h))._fulfillUnchecked(r)}return t},w.reject=w.rejected=function(e){var t=new w(h);return t._captureStackTrace(),t._rejectCallback(e,!0),t},w.setScheduler=function(e){if("function"!=typeof e)throw new f("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var t=l._schedule;return l._schedule=e,t},w.prototype._then=function(e,t,r,n,i){var s=void 0!==i,o=s?i:new w(h);s||(o._propagateFrom(this,5),o._captureStackTrace());var a=this._target();a!==this&&(void 0===n&&(n=this._boundTo),s||o._setIsMigrated());var u=a._addCallbacks(e,t,r,o,n,c());return a._isResolved()&&!a._isSettlePromisesQueued()&&l.invoke(a._settlePromiseAtPostResolution,a,u),o},w.prototype._settlePromiseAtPostResolution=function(e){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(e)},w.prototype._length=function(){return 131071&this._bitField},w.prototype._isFollowingOrFulfilledOrRejected=function(){return 0<(939524096&this._bitField)},w.prototype._isFollowing=function(){return 536870912==(536870912&this._bitField)},w.prototype._setLength=function(e){this._bitField=-131072&this._bitField|131071&e},w.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},w.prototype._setRejected=function(){this._bitField=134217728|this._bitField},w.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},w.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},w.prototype._isFinal=function(){return 0<(33554432&this._bitField)},w.prototype._cancellable=function(){return 0<(67108864&this._bitField)},w.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},w.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},w.prototype._setIsMigrated=function(){this._bitField=4194304|this._bitField},w.prototype._unsetIsMigrated=function(){this._bitField=-4194305&this._bitField},w.prototype._isMigrated=function(){return 0<(4194304&this._bitField)},w.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[5*e-5+4];if(t!==u)return void 0===t&&this._isBound()?this._boundValue():t},w.prototype._promiseAt=function(e){return 0===e?this._promise0:this[5*e-5+3]},w.prototype._fulfillmentHandlerAt=function(e){return 0===e?this._fulfillmentHandler0:this[5*e-5+0]},w.prototype._rejectionHandlerAt=function(e){return 0===e?this._rejectionHandler0:this[5*e-5+1]},w.prototype._boundValue=function(){var e=this._boundTo;return void 0!==e&&e instanceof w?e.isFulfilled()?e.value():void 0:e},w.prototype._migrateCallbacks=function(e,t){var r=e._fulfillmentHandlerAt(t),n=e._rejectionHandlerAt(t),i=e._progressHandlerAt(t),s=e._promiseAt(t),o=e._receiverAt(t);s instanceof w&&s._setIsMigrated(),void 0===o&&(o=u),this._addCallbacks(r,n,i,s,o,null)},w.prototype._addCallbacks=function(e,t,r,n,i,s){var o=this._length();if(131066<=o&&(o=0,this._setLength(0)),0===o)this._promise0=n,void 0!==i&&(this._receiver0=i),"function"!=typeof e||this._isCarryingStackTrace()||(this._fulfillmentHandler0=null===s?e:s.bind(e)),"function"==typeof t&&(this._rejectionHandler0=null===s?t:s.bind(t)),"function"==typeof r&&(this._progressHandler0=null===s?r:s.bind(r));else{var a=5*o-5;this[a+3]=n,this[a+4]=i,"function"==typeof e&&(this[a+0]=null===s?e:s.bind(e)),"function"==typeof t&&(this[a+1]=null===s?t:s.bind(t)),"function"==typeof r&&(this[a+2]=null===s?r:s.bind(r))}return this._setLength(o+1),o},w.prototype._setProxyHandlers=function(e,t){var r=this._length();if(131066<=r&&(r=0,this._setLength(0)),0===r)this._promise0=t,this._receiver0=e;else{var n=5*r-5;this[n+3]=t,this[n+4]=e}this._setLength(r+1)},w.prototype._proxyPromiseArray=function(e,t){this._setProxyHandlers(e,t)},w.prototype._resolveCallback=function(e,t){if(!this._isFollowingOrFulfilledOrRejected()){if(e===this)return this._rejectCallback(a(),!1,!0);var r=p(e,this);if(!(r instanceof w))return this._fulfill(e);var n=1|(t?4:0);this._propagateFrom(r,n);var i=r._target();if(i._isPending()){for(var s=this._length(),o=0;o<s;++o)i._migrateCallbacks(this,o);this._setFollowing(),this._setLength(0),this._setFollowee(i)}else i._isFulfilled()?this._fulfillUnchecked(i._value()):this._rejectUnchecked(i._reason(),i._getCarriedStackTrace())}},w.prototype._rejectCallback=function(e,t,r){r||s.markAsOriginatingFromRejection(e);var n=s.ensureErrorObject(e),i=n===e;this._attachExtraTrace(n,!!t&&i),this._reject(e,i?void 0:n)},w.prototype._resolveFromResolver=function(e){var t=this;this._captureStackTrace(),this._pushContext();var r=!0,n=k(e)(function(e){null!==t&&(t._resolveCallback(e),t=null)},function(e){null!==t&&(t._rejectCallback(e,r),t=null)});r=!1,this._popContext(),void 0!==n&&n===g&&null!==t&&(t._rejectCallback(n.e,!0,!0),t=null)},w.prototype._settlePromiseFromHandler=function(e,t,r,n){var i;if(!n._isRejected())if(n._pushContext(),i=t!==o||this._isRejected()?k(e).call(t,r):k(e).apply(this._boundValue(),r),n._popContext(),i===g||i===n||i===d){var s=i===n?a():i.e;n._rejectCallback(s,!1,!0)}else n._resolveCallback(i)},w.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},w.prototype._followee=function(){return this._rejectionHandler0},w.prototype._setFollowee=function(e){this._rejectionHandler0=e},w.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},w.prototype._propagateFrom=function(e,t){0<(1&t)&&e._cancellable()&&(this._setCancellable(),this._cancellationParent=e),0<(4&t)&&e._isBound()&&this._setBoundTo(e._boundTo)},w.prototype._fulfill=function(e){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(e)},w.prototype._reject=function(e,t){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(e,t)},w.prototype._settlePromiseAt=function(e){var t=this._promiseAt(e),r=t instanceof w;if(r&&t._isMigrated())return t._unsetIsMigrated(),l.invoke(this._settlePromiseAt,this,e);var n=this._isFulfilled()?this._fulfillmentHandlerAt(e):this._rejectionHandlerAt(e),i=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,s=this._settledValue,o=this._receiverAt(e);this._clearCallbackDataAtIndex(e),"function"==typeof n?r?this._settlePromiseFromHandler(n,o,s,t):n.call(o,s,t):o instanceof m?o._isResolved()||(this._isFulfilled()?o._promiseFulfilled(s,t):o._promiseRejected(s,t)):r&&(this._isFulfilled()?t._fulfill(s):t._reject(s,i)),4<=e&&4==(31&e)&&l.invokeLater(this._setLength,this,0)},w.prototype._clearCallbackDataAtIndex=function(e){if(0===e)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var t=5*e-5;this[t+3]=this[t+4]=this[t+0]=this[t+1]=this[t+2]=void 0}},w.prototype._isSettlePromisesQueued=function(){return-1073741824==(-1073741824&this._bitField)},w.prototype._setSettlePromisesQueued=function(){this._bitField=-1073741824|this._bitField},w.prototype._unsetSettlePromisesQueued=function(){this._bitField=1073741823&this._bitField},w.prototype._queueSettlePromises=function(){l.settlePromises(this),this._setSettlePromisesQueued()},w.prototype._fulfillUnchecked=function(e){if(e===this){var t=a();return this._attachExtraTrace(t),this._rejectUnchecked(t,void 0)}this._setFulfilled(),this._settledValue=e,this._cleanValues(),0<this._length()&&this._queueSettlePromises()},w.prototype._rejectUncheckedCheckError=function(e){var t=s.ensureErrorObject(e);this._rejectUnchecked(e,t===e?void 0:t)},w.prototype._rejectUnchecked=function(e,t){if(e===this){var r=a();return this._attachExtraTrace(r),this._rejectUnchecked(r)}this._setRejected(),this._settledValue=e,this._cleanValues(),this._isFinal()?l.throwLater(function(e){throw"stack"in e&&l.invokeFirst(n.unhandledRejection,void 0,e),e},void 0===t?e:t):(void 0!==t&&t!==e&&this._setCarriedStackTrace(t),0<this._length()?this._queueSettlePromises():this._ensurePossibleRejectionHandled())},w.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var e=this._length(),t=0;t<e;t++)this._settlePromiseAt(t)},s.notEnumerableProp(w,"_makeSelfResolutionError",a),C("./progress.js")(w,m),C("./method.js")(w,h,p,t),C("./bind.js")(w,h,p),C("./finally.js")(w,d,p),C("./direct_resolve.js")(w),C("./synchronous_inspection.js")(w),C("./join.js")(w,m,p,h),w.version="2.11.0",w.Promise=w,C("./map.js")(w,m,t,p,h),C("./cancel.js")(w),C("./using.js")(w,t,p,v),C("./generators.js")(w,t,h,p),C("./nodeify.js")(w),C("./call_get.js")(w),C("./props.js")(w,m,p,t),C("./race.js")(w,h,p,t),C("./reduce.js")(w,m,t,p,h),C("./settle.js")(w,m),C("./some.js")(w,m,t),C("./promisify.js")(w,h),C("./any.js")(w),C("./each.js")(w,h),C("./timers.js")(w,h),C("./filter.js")(w,h),s.toFastProperties(w),s.toFastProperties(w.prototype),x({a:1}),x({b:2}),x({c:3}),x(1),x(function(){}),x(void 0),x(!1),x(new w(h)),n.setBounds(l.firstLineError,s.lastLineError),w}},{"./any.js":1,"./async.js":2,"./bind.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./context.js":9,"./debuggability.js":10,"./direct_resolve.js":11,"./each.js":12,"./errors.js":13,"./filter.js":15,"./finally.js":16,"./generators.js":17,"./join.js":18,"./map.js":19,"./method.js":20,"./nodeify.js":21,"./progress.js":22,"./promise_array.js":24,"./promise_resolver.js":25,"./promisify.js":26,"./props.js":27,"./race.js":29,"./reduce.js":30,"./settle.js":32,"./some.js":33,"./synchronous_inspection.js":34,"./thenables.js":35,"./timers.js":36,"./using.js":37,"./util.js":38}],24:[function(t,e,r){"use strict";e.exports=function(l,n,f,h){var d=t("./util.js").isArray;function e(e){var t,r=this._promise=new l(n);e instanceof l&&(t=e,r._propagateFrom(t,5)),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return e.prototype.length=function(){return this._length},e.prototype.promise=function(){return this._promise},e.prototype._init=function e(t,r){var n=f(this._values,this._promise);if(n instanceof l){if(n=n._target(),!(this._values=n)._isFulfilled())return n._isPending()?void n._then(e,this._reject,void 0,this,r):void this._reject(n._reason());if(n=n._value(),!d(n)){var i=new l.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");return void this.__hardReject__(i)}}else if(!d(n))return void this._promise._reject(h("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n")._reason());if(0!==n.length){var s=this.getActualLength(n.length);this._length=s,this._values=this.shouldCopyValues()?new Array(s):this._values;for(var o=this._promise,a=0;a<s;++a){var u=this._isResolved(),c=f(n[a],o);c instanceof l?(c=c._target(),u?c._ignoreRejections():c._isPending()?c._proxyPromiseArray(this,a):c._isFulfilled()?this._promiseFulfilled(c._value(),a):this._promiseRejected(c._reason(),a)):u||this._promiseFulfilled(c,a)}}else-5===r?this._resolveEmptyArray():this._resolve(function(e){switch(e){case-2:return[];case-3:return{}}}(r))},e.prototype._isResolved=function(){return null===this._values},e.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},e.prototype.__hardReject__=e.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1,!0)},e.prototype._promiseProgressed=function(e,t){this._promise._progress({index:t,value:e})},e.prototype._promiseFulfilled=function(e,t){this._values[t]=e,++this._totalResolved>=this._length&&this._resolve(this._values)},e.prototype._promiseRejected=function(e,t){this._totalResolved++,this._reject(e)},e.prototype.shouldCopyValues=function(){return!0},e.prototype.getActualLength=function(e){return e},e}},{"./util.js":38}],25:[function(e,t,r){"use strict";var o=e("./util.js"),a=o.maybeWrapAsError,n=e("./errors.js"),i=n.TimeoutError,u=n.OperationalError,s=o.haveGetters,c=e("./es5.js");var l,f=/^(?:name|message|stack|cause)$/;function h(e){var t,r;if((r=e)instanceof Error&&c.getPrototypeOf(r)===Error.prototype){(t=new u(e)).name=e.name,t.message=e.message,t.stack=e.stack;for(var n=c.keys(e),i=0;i<n.length;++i){var s=n[i];f.test(s)||(t[s]=e[s])}return t}return o.markAsOriginatingFromRejection(e),e}function d(o){return function(e,t){if(null!==o){if(e){var r=h(a(e));o._attachExtraTrace(r),o._reject(r)}else if(2<arguments.length){for(var n=arguments.length,i=new Array(n-1),s=1;s<n;++s)i[s-1]=arguments[s];o._fulfill(i)}else o._fulfill(t);o=null}}}if(l=s?function(e){this.promise=e}:function(e){this.promise=e,this.asCallback=d(e),this.callback=this.asCallback},s){var p={get:function(){return d(this.promise)}};c.defineProperty(l.prototype,"asCallback",p),c.defineProperty(l.prototype,"callback",p)}l._nodebackForPromise=d,l.prototype.toString=function(){return"[object PromiseResolver]"},l.prototype.resolve=l.prototype.fulfill=function(e){if(!(this instanceof l))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._resolveCallback(e)},l.prototype.reject=function(e){if(!(this instanceof l))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._rejectCallback(e)},l.prototype.progress=function(e){if(!(this instanceof l))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._progress(e)},l.prototype.cancel=function(e){this.promise.cancel(e)},l.prototype.timeout=function(){this.reject(new i("timeout"))},l.prototype.isResolved=function(){return this.promise.isResolved()},l.prototype.toJSON=function(){return this.promise.toJSON()},t.exports=l},{"./errors.js":13,"./es5.js":14,"./util.js":38}],26:[function(n,e,t){"use strict";e.exports=function(u,c){var h={},p=n("./util.js"),l=n("./promise_resolver.js")._nodebackForPromise,f=p.withAppended,d=p.maybeWrapAsError,e=p.canEvaluate,m=n("./errors").TypeError,v={__isPromisified__:!0},t=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),b=function(e){return p.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e};function s(e){return!t.test(e)}function y(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function _(e,t,r,n){for(var i,s,o,a,u=p.inheritedDataKeys(e),c=[],l=0;l<u.length;++l){var f=u[l],h=e[f],d=n===b||b(f,h,e);"function"!=typeof h||y(h)||(i=e,s=f,o=t,void 0,(a=p.getDataPropertyOrDefault(i,s+o,v))&&y(a))||!n(f,h,e,d)||c.push(f,h)}return function(e,t,r){for(var n=0;n<e.length;n+=2){var i=e[n];if(r.test(i))for(var s=i.replace(r,""),o=0;o<e.length;o+=2)if(e[o]===s)throw new m("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",t))}}(c,t,r),c}var r,g=function(e){return e.replace(/([$])/,"\\$")};var k=e?r:function(i,s,e,t){var o=function(){return this}(),a=i;function r(){var e=s;s===h&&(e=this);var t=new u(c);t._captureStackTrace();var r="string"==typeof a&&this!==o?this[a]:i,n=l(t);try{r.apply(e,f(arguments,n))}catch(e){t._rejectCallback(d(e),!0,!0)}return t}return"string"==typeof a&&(i=t),p.notEnumerableProp(r,"__isPromisified__",!0),r};function w(e,t,r,n){for(var i=new RegExp(g(t)+"$"),s=_(e,t,i,r),o=0,a=s.length;o<a;o+=2){var u=s[o],c=s[o+1],l=u+t;if(n===k)e[l]=k(u,h,u,c,t);else{var f=n(c,function(){return k(u,h,u,c,t)});p.notEnumerableProp(f,"__isPromisified__",!0),e[l]=f}}return p.toFastProperties(e),e}u.promisify=function(e,t){if("function"!=typeof e)throw new m("fn must be a function\n\n    See http://goo.gl/916lJJ\n");if(y(e))return e;var r,n,i=(r=e,n=arguments.length<2?h:t,k(r,n,void 0,r));return p.copyDescriptors(e,i,s),i},u.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new m("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n");var r=(t=Object(t)).suffix;"string"!=typeof r&&(r="Async");var n=t.filter;"function"!=typeof n&&(n=b);var i=t.promisifier;if("function"!=typeof i&&(i=k),!p.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n");for(var s=p.inheritedDataKeys(e),o=0;o<s.length;++o){var a=e[s[o]];"constructor"!==s[o]&&p.isClass(a)&&(w(a.prototype,r,n,i),w(a,r,n,i))}return w(e,r,n,i)}}},{"./errors":13,"./promise_resolver.js":25,"./util.js":38}],27:[function(c,e,t){"use strict";e.exports=function(n,e,i,s){var t=c("./util.js"),o=t.isObject,a=c("./es5.js");function u(e){for(var t=a.keys(e),r=t.length,n=new Array(2*r),i=0;i<r;++i){var s=t[i];n[i]=e[s],n[i+r]=s}this.constructor$(n)}function r(e){var t,r=i(e);return o(r)?(t=r instanceof n?r._then(n.props,void 0,void 0,void 0,void 0):new u(r).promise(),r instanceof n&&t._propagateFrom(r,4),t):s("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}t.inherits(u,e),u.prototype._init=function(){this._init$(void 0,-3)},u.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){for(var r={},n=this.length(),i=0,s=this.length();i<s;++i)r[this._values[i+n]]=this._values[i];this._resolve(r)}},u.prototype._promiseProgressed=function(e,t){this._promise._progress({key:this._values[t+this.length()],value:e})},u.prototype.shouldCopyValues=function(){return!1},u.prototype.getActualLength=function(e){return e>>1},n.prototype.props=function(){return r(this)},n.props=function(e){return r(e)}}},{"./es5.js":14,"./util.js":38}],28:[function(e,t,r){"use strict";function n(e){this._capacity=e,this._length=0,this._front=0}n.prototype._willBeOverCapacity=function(e){return this._capacity<e},n.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},n.prototype._unshiftOne=function(e){var t=this._capacity;this._checkCapacity(this.length()+1);var r=(this._front-1&t-1^t)-t;this[r]=e,this._front=r,this._length=this.length()+1},n.prototype.unshift=function(e,t,r){this._unshiftOne(r),this._unshiftOne(t),this._unshiftOne(e)},n.prototype.push=function(e,t,r){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(e),this._pushOne(t),void this._pushOne(r);var i=this._front+n-3;this._checkCapacity(n);var s=this._capacity-1;this[i+0&s]=e,this[i+1&s]=t,this[i+2&s]=r,this._length=n},n.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},n.prototype.length=function(){return this._length},n.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},n.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,function(e,t,r,n,i){for(var s=0;s<i;++s)r[s+n]=e[s+t],e[s+t]=void 0}(this,0,this,t,this._front+this._length&t-1)},t.exports=n},{}],29:[function(e,t,r){"use strict";t.exports=function(c,l,f,h){var d=e("./util.js").isArray,p=function(t){return t.then(function(e){return r(e,t)})};function r(e,t){var r=f(e);if(r instanceof c)return p(r);if(!d(e))return h("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");var n=new c(l);void 0!==t&&n._propagateFrom(t,5);for(var i=n._fulfill,s=n._reject,o=0,a=e.length;o<a;++o){var u=e[o];(void 0!==u||o in e)&&c.cast(u)._then(i,s,void 0,n,null)}return n}c.race=function(e){return r(e,void 0)},c.prototype.race=function(){return r(this,void 0)}}},{"./util.js":38}],30:[function(r,e,t){"use strict";e.exports=function(p,e,i,m,u){var c=p._getDomain,l=r("./async.js"),t=r("./util.js"),v=t.tryCatch,b=t.errorObj;function s(e,t,r,n){this.constructor$(e),this._promise._captureStackTrace(),this._preservedValues=n===u?[]:null,this._zerothIsAccum=void 0===r,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var i=m(r,this._promise),s=!1,o=i instanceof p;o&&((i=i._target())._isPending()?i._proxyPromiseArray(this,-1):i._isFulfilled()?(r=i._value(),this._gotAccum=!0):(this._reject(i._reason()),s=!0)),o||this._zerothIsAccum||(this._gotAccum=!0);var a=c();this._callback=null===a?t:a.bind(t),this._accum=r,s||l.invoke(f,this,void 0)}function f(){this._init$(void 0,-5)}function o(e,t,r,n){return"function"!=typeof t?i("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):new s(e,t,r,n).promise()}t.inherits(s,e),s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},s.prototype._promiseFulfilled=function(e,t){var r=this._values;r[t]=e;var n,i=this.length(),s=this._preservedValues,o=null!==s,a=this._gotAccum,u=this._valuesPhase;if(!u)for(u=this._valuesPhase=new Array(i),n=0;n<i;++n)u[n]=0;if(n=u[t],0===t&&this._zerothIsAccum?(this._accum=e,this._gotAccum=a=!0,u[t]=0===n?1:2):-1===t?(this._accum=e,this._gotAccum=a=!0):0===n?u[t]=1:(u[t]=2,this._accum=e),a){for(var c,l=this._callback,f=this._promise._boundValue(),h=this._reducingIndex;h<i;++h)if(2!==(n=u[h])){if(1!==n)return;if(e=r[h],this._promise._pushContext(),o?(s.push(e),c=v(l).call(f,e,h,i)):c=v(l).call(f,this._accum,e,h,i),this._promise._popContext(),c===b)return this._reject(c.e);var d=m(c,this._promise);if(d instanceof p){if((d=d._target())._isPending())return u[h]=4,d._proxyPromiseArray(this,h);if(!d._isFulfilled())return this._reject(d._reason());c=d._value()}this._reducingIndex=h+1,this._accum=c}else this._reducingIndex=h+1;this._resolve(o?s:this._accum)}},p.prototype.reduce=function(e,t){return o(this,e,t,null)},p.reduce=function(e,t,r,n){return o(e,t,r,n)}}},{"./async.js":2,"./util.js":38}],31:[function(e,t,r){"use strict";var n,i=e("./util");if(i.isNode&&"undefined"==typeof MutationObserver){var s=a.setImmediate,o=O.nextTick;n=i.isRecentNode?function(e){s.call(a,e)}:function(e){o.call(O,e)}}else"undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&window.navigator.standalone?n="undefined"!=typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}:(n=function(e){var t=document.createElement("div");return new MutationObserver(e).observe(t,{attributes:!0}),function(){t.classList.toggle("foo")}}).isStatic=!0;t.exports=n},{"./util":38}],32:[function(i,e,t){"use strict";e.exports=function(e,t){var n=e.PromiseInspection;function r(e){this.constructor$(e)}i("./util.js").inherits(r,t),r.prototype._promiseResolved=function(e,t){this._values[e]=t,++this._totalResolved>=this._length&&this._resolve(this._values)},r.prototype._promiseFulfilled=function(e,t){var r=new n;r._bitField=268435456,r._settledValue=e,this._promiseResolved(t,r)},r.prototype._promiseRejected=function(e,t){var r=new n;r._bitField=134217728,r._settledValue=e,this._promiseResolved(t,r)},e.settle=function(e){return new r(e).promise()},e.prototype.settle=function(){return new r(this).promise()}}},{"./util.js":38}],33:[function(c,e,t){"use strict";e.exports=function(e,t,i){var r=c("./util.js"),n=c("./errors.js").RangeError,s=c("./errors.js").AggregateError,o=r.isArray;function a(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function u(e,t){if((0|t)!==t||t<0)return i("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n");var r=new a(e),n=r.promise();return r.setHowMany(t),r.init(),n}r.inherits(a,t),a.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var e=o(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},a.prototype.init=function(){this._initialized=!0,this._init()},a.prototype.setUnwrap=function(){this._unwrap=!0},a.prototype.howMany=function(){return this._howMany},a.prototype.setHowMany=function(e){this._howMany=e},a.prototype._promiseFulfilled=function(e){this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values))},a.prototype._promiseRejected=function(e){if(this._addRejected(e),this.howMany()>this._canPossiblyFulfill()){for(var t=new s,r=this.length();r<this._values.length;++r)t.push(this._values[r]);this._reject(t)}},a.prototype._fulfilled=function(){return this._totalResolved},a.prototype._rejected=function(){return this._values.length-this.length()},a.prototype._addRejected=function(e){this._values.push(e)},a.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},a.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},a.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new n(t)},a.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(e,t){return u(e,t)},e.prototype.some=function(e){return u(this,e)},e._SomePromiseArray=a}},{"./errors.js":13,"./util.js":38}],34:[function(e,t,r){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValue=e._settledValue):(this._bitField=0,this._settledValue=void 0)}t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return this._settledValue},t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return this._settledValue},t.prototype.isFulfilled=e.prototype._isFulfilled=function(){return 0<(268435456&this._bitField)},t.prototype.isRejected=e.prototype._isRejected=function(){return 0<(134217728&this._bitField)},t.prototype.isPending=e.prototype._isPending=function(){return 0==(402653184&this._bitField)},t.prototype.isResolved=e.prototype._isResolved=function(){return 0<(402653184&this._bitField)},e.prototype.isPending=function(){return this._target()._isPending()},e.prototype.isRejected=function(){return this._target()._isRejected()},e.prototype.isFulfilled=function(){return this._target()._isFulfilled()},e.prototype.isResolved=function(){return this._target()._isResolved()},e.prototype._value=function(){return this._settledValue},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue},e.prototype.value=function(){var e=this._target();if(!e.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return e._settledValue},e.prototype.reason=function(){var e=this._target();if(!e.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return e._unsetRejectionIsUnhandled(),e._settledValue},e.PromiseInspection=t}},{}],35:[function(e,t,r){"use strict";t.exports=function(a,u){var c=e("./util.js"),l=c.errorObj,s=c.isObject;function o(e){return e.then}var f={}.hasOwnProperty;return function(e,t){if(s(e)){if(e instanceof a)return e;if(i=e,f.call(i,"_promise0")){var r=new a(u);return e._then(r._fulfillUnchecked,r._rejectUncheckedCheckError,r._progressUnchecked,r,null),r}var n=c.tryCatch(o)(e);if(n===l)return t&&t._pushContext(),r=a.reject(n.e),t&&t._popContext(),r;if("function"==typeof n)return function(e,t,r){var n=new a(u),i=n;r&&r._pushContext(),n._captureStackTrace(),r&&r._popContext();var s=!0,o=c.tryCatch(t).call(e,function(e){n&&(n._resolveCallback(e),n=null)},function(e){n&&(n._rejectCallback(e,s,!0),n=null)},function(e){n&&"function"==typeof n._progress&&n._progress(e)});return s=!1,n&&o===l&&(n._rejectCallback(o.e,!0,!0),n=null),i}(e,n,t)}var i;return e}}},{"./util.js":38}],36:[function(e,t,r){"use strict";t.exports=function(n,i){var s=e("./util.js"),o=n.TimeoutError,a=function(e){return t(+this).thenReturn(e)},t=n.delay=function(e,t){if(void 0===t){t=e,e=void 0;var r=new n(i);return setTimeout(function(){r._fulfill()},t),r}return t=+t,n.resolve(e)._then(a,null,null,t,void 0)};function r(e){var t=this;return t instanceof Number&&(t=+t),clearTimeout(t),e}function u(e){var t=this;throw t instanceof Number&&(t=+t),clearTimeout(t),e}n.prototype.delay=function(e){return t(this,e)},n.prototype.timeout=function(e,n){e=+e;var i=this.then().cancellable();i._cancellationParent=this;var t=setTimeout(function(){var e,t,r;t=n,(e=i).isPending()&&(!s.isPrimitive(t)&&t instanceof Error?r=t:("string"!=typeof t&&(t="operation timed out"),r=new o(t)),s.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._cancel(r))},e);return i._then(r,u,void 0,t,void 0)}}},{"./util.js":38}],37:[function(o,e,t){"use strict";e.exports=function(l,f,h,t){var r=o("./errors.js").TypeError,e=o("./util.js").inherits,n=l.PromiseInspection;function d(e){for(var t=e.length,r=0;r<t;++r){var n=e[r];if(n.isRejected())return l.reject(n.error());e[r]=n._settledValue}return e}function c(e){setTimeout(function(){throw e},0)}function i(i,s){var o=0,a=i.length,u=l.defer();return function e(){if(a<=o)return u.resolve();var t,r,n=(t=i[o++],(r=h(t))!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&r._setDisposable(t._getDisposer()),r);if(n instanceof l&&n._isDisposable()){try{n=h(n._getDisposer().tryDispose(s),i.promise)}catch(e){return c(e)}if(n instanceof l)return n._then(e,c,null,null,null)}e()}(),u.promise}function p(e){var t=new n;return t._settledValue=e,t._bitField=268435456,i(this,t).thenReturn(e)}function m(e){var t=new n;return t._settledValue=e,t._bitField=134217728,i(this,t).thenThrow(e)}function v(e,t,r){this._data=e,this._promise=t,this._context=r}function s(e,t,r){this.constructor$(e,t,r)}function b(e){return v.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}v.prototype.data=function(){return this._data},v.prototype.promise=function(){return this._promise},v.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},v.prototype.tryDispose=function(e){var t=this.resource(),r=this._context;void 0!==r&&r._pushContext();var n=null!==t?this.doDispose(t,e):null;return void 0!==r&&r._popContext(),this._promise._unsetDisposable(),this._data=null,n},v.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},e(s,v),s.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},l.using=function(){var e=arguments.length;if(e<2)return f("you must pass at least 2 arguments to Promise.using");var t,r=arguments[e-1];if("function"!=typeof r)return f("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var n=!0;2===e&&Array.isArray(arguments[0])?(e=(t=arguments[0]).length,n=!1):(t=arguments,e--);for(var i=new Array(e),s=0;s<e;++s){var o=t[s];if(v.isDisposer(o)){var a=o;(o=o.promise())._setDisposable(a)}else{var u=h(o);u instanceof l&&(o=u._then(b,null,null,{resources:i,index:s},void 0))}i[s]=o}var c=l.settle(i).then(d).then(function(e){var t;c._pushContext();try{t=n?r.apply(void 0,e):r.call(void 0,e)}finally{c._popContext()}return t})._then(p,m,void 0,i,void 0);return i.promise=c},l.prototype._setDisposable=function(e){this._bitField=262144|this._bitField,this._disposer=e},l.prototype._isDisposable=function(){return 0<(262144&this._bitField)},l.prototype._getDisposer=function(){return this._disposer},l.prototype._unsetDisposable=function(){this._bitField=-262145&this._bitField,this._disposer=void 0},l.prototype.disposer=function(e){if("function"==typeof e)return new s(e,this,t());throw new r}}},{"./errors.js":13,"./util.js":38}],38:[function(e,t,r){"use strict";var c=e("./es5.js"),n="undefined"==typeof navigator,i=function(){try{var e={};return c.defineProperty(e,"f",{get:function(){return 3}}),3===e.f}catch(e){return!1}}(),s={e:{}},o;function a(){try{var e=o;return o=null,e.apply(this,arguments)}catch(e){return s.e=e,s}}function u(e){return o=e,a}var l=function(t,r){var n={}.hasOwnProperty;function e(){for(var e in this.constructor=t,(this.constructor$=r).prototype)n.call(r.prototype,e)&&"$"!==e.charAt(e.length-1)&&(this[e+"$"]=r.prototype[e])}return e.prototype=r.prototype,t.prototype=new e,t.prototype};function f(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function h(e){return!f(e)}function d(e){return f(e)?new Error(j(e)):e}function p(e,t){var r,n=e.length,i=new Array(n+1);for(r=0;r<n;++r)i[r]=e[r];return i[r]=t,i}function m(e,t,r){if(!c.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var n=Object.getOwnPropertyDescriptor(e,t);return null!=n?null==n.get&&null==n.set?n.value:r:void 0}function v(e,t,r){if(f(e))return e;var n={value:r,configurable:!0,enumerable:!1,writable:!0};return c.defineProperty(e,t,n),e}function b(e){throw e}var y=function(){var i=[Array.prototype,Object.prototype,Function.prototype],a=function(e){for(var t=0;t<i.length;++t)if(i[t]===e)return!0;return!1};if(c.isES5){var u=Object.getOwnPropertyNames;return function(e){for(var t=[],r=Object.create(null);null!=e&&!a(e);){var n;try{n=u(e)}catch(e){return t}for(var i=0;i<n.length;++i){var s=n[i];if(!r[s]){r[s]=!0;var o=Object.getOwnPropertyDescriptor(e,s);null!=o&&null==o.get&&null==o.set&&t.push(s)}}e=c.getPrototypeOf(e)}return t}}var s={}.hasOwnProperty;return function(e){if(a(e))return[];var t=[];e:for(var r in e)if(s.call(e,r))t.push(r);else{for(var n=0;n<i.length;++n)if(s.call(i[n],r))continue e;t.push(r)}return t}}(),_=/this\s*\.\s*\S+\s*=/;function g(e){try{if("function"==typeof e){var t=c.names(e.prototype),r=c.isES5&&1<t.length,n=0<t.length&&!(1===t.length&&"constructor"===t[0]),i=_.test(e+"")&&0<c.names(e).length;if(r||n||i)return!0}return!1}catch(e){return!1}}function k(e){function t(){}t.prototype=e;for(var r=8;r--;)new t;return e}var w=/^[a-z$_][a-z$_0-9]*$/i;function x(e){return w.test(e)}function C(e,t,r){for(var n=new Array(e),i=0;i<e;++i)n[i]=t+i+r;return n}function j(e){try{return e+""}catch(e){return"[no string representation]"}}function S(e){try{v(e,"isOperational",!0)}catch(e){}}function E(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function T(e){return e instanceof Error&&c.propertyIsWritable(e,"stack")}var I="stack"in new Error?function(e){return T(e)?e:new Error(j(e))}:function(e){if(T(e))return e;try{throw new Error(j(e))}catch(e){return e}};function R(e){return{}.toString.call(e)}function M(e,t,r){for(var n=c.names(e),i=0;i<n.length;++i){var s=n[i];if(r(s))try{c.defineProperty(t,s,c.getDescriptor(e,s))}catch(e){}}}var P={isClass:g,isIdentifier:x,inheritedDataKeys:y,getDataPropertyOrDefault:m,thrower:b,isArray:c.isArray,haveGetters:i,notEnumerableProp:v,isPrimitive:f,isObject:h,canEvaluate:n,errorObj:s,tryCatch:u,inherits:l,withAppended:p,maybeWrapAsError:d,toFastProperties:k,filledRange:C,toString:j,canAttachTrace:T,ensureErrorObject:I,originatesFromRejection:E,markAsOriginatingFromRejection:S,classString:R,copyDescriptors:M,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:void 0!==O&&"[object process]"===R(O).toLowerCase()},A;P.isRecentNode=P.isNode&&(A=O.versions.node.split(".").map(Number),0===A[0]&&10<A[1]||0<A[0]),P.isNode&&P.toFastProperties(O);try{throw new Error}catch(e){P.lastLineError=e}t.exports=P},{"./es5.js":14}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,f("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:225}],66:[function(t,r,e){(function(){var e,s=function(e,t){return function(){return e.apply(t,arguments)}},u=[].slice;e=function(){function a(e,t,r,n,i){this.maxNb=null!=e?e:0,this.minTime=null!=t?t:0,this.highWater=null!=r?r:-1,this.strategy=null!=n?n:a.prototype.strategy.LEAK,this.rejectOnDrop=null!=i&&i,this.schedulePriority=s(this.schedulePriority,this),this.submitPriority=s(this.submitPriority,this),this.submit=s(this.submit,this),this._nextRequest=Date.now(),this._nbRunning=0,this._queues=this._makeQueues(),this._running={},this._nextIndex=0,this._unblockTime=0,this.penalty=15*this.minTime||5e3,this.interrupt=!1,this.reservoir=null,this.limiter=null,this.events={}}return(a.default=a).strategy=a.prototype.strategy={LEAK:1,OVERFLOW:2,OVERFLOW_PRIORITY:4,BLOCK:3},a.Cluster=a.prototype.Cluster=t("./Cluster"),a.DLList=a.prototype.DLList=t("./DLList"),a.Promise=a.prototype.Promise=function(){try{return t("bluebird")}catch(e){return e,"undefined"!=typeof Promise&&null!==Promise?Promise:function(){throw new Error("Bottleneck: install 'bluebird' or use Node 0.12 or higher for Promise support")}}}(),a.prototype._trigger=function(t,r){return this.rejectOnDrop&&"dropped"===t&&r[0].cb.apply({},[new Error("This job has been dropped by Bottleneck")]),setTimeout((n=this,function(){var e;return null!=(e=n.events[t])?e.forEach(function(e){return e.apply({},r)}):void 0}),0);var n},a.prototype._makeQueues=function(){var e,t;for(t=[],e=1,10;e<=10;++e)t.push(new a.prototype.DLList);return t},a.prototype.chain=function(e){return this.limiter=e,this},a.prototype.isBlocked=function(){return this._unblockTime>=Date.now()},a.prototype._sanitizePriority=function(e){var t;return(t=~~e!==e?5:e)<0?0:9<t?9:t},a.prototype._find=function(e,t){var r,n,i,s;for(r=n=0,i=e.length;n<i;r=++n)if(t(s=e[r]))return s;return[]},a.prototype.nbQueued=function(e){return null!=e?this._queues[this._sanitizePriority(e)].length:this._queues.reduce(function(e,t){return e+t.length},0)},a.prototype.nbRunning=function(){return this._nbRunning},a.prototype._getFirst=function(e){return this._find(e,function(e){return 0<e.length})},a.prototype._conditionsCheck=function(){return(this.nbRunning()<this.maxNb||this.maxNb<=0)&&(null==this.reservoir||0<this.reservoir)},a.prototype.check=function(){return this._conditionsCheck()&&this._nextRequest-Date.now()<=0},a.prototype._tryToRun=function(){var t,r,n,e,i,s;return!!(this._conditionsCheck()&&0<(e=this.nbQueued()))&&(this._nbRunning++,null!=this.reservoir&&this.reservoir--,i=Math.max(this._nextRequest-Date.now(),0),this._nextRequest=Date.now()+i+this.minTime,n=this._getFirst(this._queues).shift(),1===e&&this._trigger("empty",[]),t=!1,r=this._nextIndex++,this._running[r]={timeout:setTimeout((s=this,function(){var e;return e=function(){var e;if(!t&&(t=!0,delete s._running[r],s._nbRunning--,s._tryToRun(),0===s.nbRunning()&&0===s.nbQueued()&&s._trigger("idle",[]),!s.interrupt))return null!=(e=n.cb)?e.apply({},Array.prototype.slice.call(arguments,0)):void 0},null!=s.limiter?s.limiter.submit.apply(s.limiter,Array.prototype.concat(n.task,n.args,e)):n.task.apply({},n.args.concat(e))}),i),job:n},!0)},a.prototype.submit=function(){var e;return e=1<=arguments.length?u.call(arguments,0):[],this.submitPriority.apply({},Array.prototype.concat(5,e))},a.prototype.submitPriority=function(){var e,t,r,n,i;return r=arguments[0],t={task:arguments[1],args:4<=arguments.length?u.call(arguments,2,e=arguments.length-1):(e=2,[]),cb:arguments[e++]},r=this._sanitizePriority(r),n=0<=this.highWater&&this.nbQueued()===this.highWater&&!this.check(),this.strategy===a.prototype.strategy.BLOCK&&(n||this.isBlocked())?(this._unblockTime=Date.now()+this.penalty,this._nextRequest=this._unblockTime+this.minTime,this._queues=this._makeQueues(),this._trigger("dropped",[t]),!0):(n&&(null!=(i=this.strategy===a.prototype.strategy.LEAK?this._getFirst(this._queues.slice(r).reverse()).shift():this.strategy===a.prototype.strategy.OVERFLOW_PRIORITY?this._getFirst(this._queues.slice(r+1).reverse()).shift():this.strategy===a.prototype.strategy.OVERFLOW?t:void 0)&&this._trigger("dropped",[i]),null==i||this.strategy===a.prototype.strategy.OVERFLOW)||(this._queues[r].push(t),this._tryToRun()),n)},a.prototype.schedule=function(){var e;return e=1<=arguments.length?u.call(arguments,0):[],this.schedulePriority.apply({},Array.prototype.concat(5,e))},a.prototype.schedulePriority=function(){var e,n,i,s,o;return n=arguments[0],i=arguments[1],e=3<=arguments.length?u.call(arguments,2):[],s=function(){var e,t,r;return e=2<=arguments.length?u.call(arguments,0,r=arguments.length-1):(r=0,[]),t=arguments[r++],i.apply({},e).then(function(){var e;return e=1<=arguments.length?u.call(arguments,0):[],t.apply({},Array.prototype.concat(null,e))}).catch(function(){var e;return e=1<=arguments.length?u.call(arguments,0):[],t.apply({},e)})},new a.prototype.Promise((o=this,function(t,r){return o.submitPriority.apply({},Array.prototype.concat(n,s,e,function(){var e;return(null!=(e=1<=arguments.length?u.call(arguments,0):[])[0]?r:(e.shift(),t)).apply({},e)}))}))},a.prototype.changeSettings=function(e,t,r,n,i){for(this.maxNb=null!=e?e:this.maxNb,this.minTime=null!=t?t:this.minTime,this.highWater=null!=r?r:this.highWater,this.strategy=null!=n?n:this.strategy,this.rejectOnDrop=null!=i?i:this.rejectOnDrop;this._tryToRun(););return this},a.prototype.changePenalty=function(e){return this.penalty=null!=e?e:this.penalty,this},a.prototype.changeReservoir=function(e){for(this.reservoir=e;this._tryToRun(););return this},a.prototype.incrementReservoir=function(e){return null==e&&(e=0),this.changeReservoir(this.reservoir+e),this},a.prototype.on=function(e,t){return null!=this.events[e]?this.events[e].push(t):this.events[e]=[t],this},a.prototype.removeAllListeners=function(e){return null==e&&(e=null),null!=e?delete this.events[e]:this.events={},this},a.prototype.stopAll=function(e){var t,r,n,i,s,o,a;for(this.interrupt=null!=e?e:this.interrupt,t=0,o=(i=Object.keys(this._running)).length;t<o;t++)n=i[t],clearTimeout(this._running[n].timeout);if(this._tryToRun=function(){},this.check=function(){return!1},this.submit=this.submitPriority=function(){var e;return 2<=arguments.length?u.call(arguments,0,e=arguments.length-1):(e=0,[]),(0,arguments[e++])(new Error("This limiter is stopped"))},this.schedule=this.schedulePriority=function(){return Promise.reject(new Error("This limiter is stopped"))},this.interrupt)for(s=0,a=i.length;s<a;s++)n=i[s],this._trigger("dropped",[this._running[n].job]);for(;r=this._getFirst(this._queues).shift();)this._trigger("dropped",[r]);return this._trigger("empty",[]),0===this.nbRunning()&&this._trigger("idle",[]),this},a}(),r.exports=e}).call(this)},{"./Cluster":67,"./DLList":68,bluebird:65}],67:[function(o,t,e){(function(){var e,s={}.hasOwnProperty;e=function(){function e(e,t,r,n,i){this.maxNb=e,this.minTime=t,this.highWater=r,this.strategy=n,this.rejectOnDrop=i,this.limiters={},this.Bottleneck=o("./Bottleneck"),this.timeout=3e5,this.startAutoCleanup()}return e.prototype.key=function(e){var t;return null==e&&(e=""),null!=(t=this.limiters[e])?t:this.limiters[e]=new this.Bottleneck(this.maxNb,this.minTime,this.highWater,this.strategy,this.rejectOnDrop)},e.prototype.deleteKey=function(e){return null==e&&(e=""),delete this.limiters[e]},e.prototype.all=function(e){var t,r,n,i;for(t in n=[],r=this.limiters)s.call(r,t)&&(i=r[t],n.push(e(i)));return n},e.prototype.keys=function(){return Object.keys(this.limiters)},e.prototype.startAutoCleanup=function(){var e,i;return this.stopAutoCleanup(),"function"==typeof(e=this.interval=setInterval((i=this,function(){var e,t,r,n;for(e in n=Date.now(),r=[],t=i.limiters)t[e]._nextRequest+i.timeout<n?r.push(i.deleteKey(e)):r.push(void 0);return r}),this.timeout/10)).unref?e.unref():void 0},e.prototype.stopAutoCleanup=function(){return clearInterval(this.interval)},e.prototype.changeTimeout=function(e){return this.timeout=e,this.startAutoCleanup()},e}(),t.exports=e}).call(this)},{"./Bottleneck":66}],68:[function(e,t,r){(function(){var e;e=function(){function e(){this._first=null,this._last=null,this.length=0}return e.prototype.push=function(e){var t;this.length++,t={value:e,next:null},null!=this._last?(this._last.next=t,this._last=t):this._first=this._last=t},e.prototype.shift=function(){var e,t;if(null!=this._first)return this.length--,t=this._first.value,this._first=null!=(e=this._first.next)?e:this._last=null,t},e.prototype.getArray=function(){var e,t,r;for(e=this._first,r=[];null!=e;)r.push((e=(t=e).next,t.value));return r},e}(),t.exports=e}).call(this)},{}],69:[function(t,r,e){(function(e){(function(){r.exports=t("./Bottleneck"),null!=e.window&&(e.window.Bottleneck=r.exports)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Bottleneck":66}],70:[function(e,t,r){},{}],71:[function(e,t,r){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
"use strict";var n=e("base64-js"),s=e("ieee754");r.Buffer=f,r.SlowBuffer=function(e){+e!=e&&(e=0);return f.alloc(+e)},r.INSPECT_MAX_BYTES=50;var i=2147483647;function o(e){if(i<e)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=f.prototype,t}function f(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(e)}return a(e,t,r)}function a(e,t,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return D(e)||e&&D(e.buffer)?function(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return n.__proto__=f.prototype,n}(e,t,r):"string"==typeof e?function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!f.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|d(e,t),n=o(r),i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t):function(e){if(f.isBuffer(e)){var t=0|h(e.length),r=o(t);return 0===r.length||e.copy(r,0,0,t),r}if(e){if(ArrayBuffer.isView(e)||"length"in e)return"number"!=typeof e.length||U(e.length)?o(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object.")}(e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('"size" argument must not be negative')}function c(e){return u(e),o(e<0?0:0|h(e))}function l(e){for(var t=e.length<0?0:0|h(e.length),r=o(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function h(e){if(i<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|e}function d(e,t){if(f.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return A(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return O(e).length;default:if(n)return A(e).length;t=(""+t).toLowerCase(),n=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),U(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=f.from(t,n)),f.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,i){var s,o=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a/=o=2,u/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(s=r;s<a;s++)if(c(e,s)===c(t,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===u)return l*o}else-1!==l&&(s-=s-l),l=-1}else for(a<r+u&&(r=a-u),s=r;0<=s;s--){for(var f=!0,h=0;h<u;h++)if(c(e,s+h)!==c(t,h)){f=!1;break}if(f)return s}return-1}function b(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?i<(n=Number(n))&&(n=i):n=i;var s=t.length;s/2<n&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(t.substr(2*o,2),16);if(U(a))return o;e[r+o]=a}return o}function y(e,t,r,n){return N(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function _(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function g(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,o,a,u,c=e[i],l=null,f=239<c?4:223<c?3:191<c?2:1;if(i+f<=r)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(s=e[i+1]))&&127<(u=(31&c)<<6|63&s)&&(l=u);break;case 3:s=e[i+1],o=e[i+2],128==(192&s)&&128==(192&o)&&2047<(u=(15&c)<<12|(63&s)<<6|63&o)&&(u<55296||57343<u)&&(l=u);break;case 4:s=e[i+1],o=e[i+2],a=e[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&65535<(u=(15&c)<<18|(63&s)<<12|(63&o)<<6|63&a)&&u<1114112&&(l=u)}null===l?(l=65533,f=1):65535<l&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=f}return function(e){var t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=k));return r}(n)}r.kMaxLength=i,(f.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(f.prototype,"parent",{get:function(){if(this instanceof f)return this.buffer}}),Object.defineProperty(f.prototype,"offset",{get:function(){if(this instanceof f)return this.byteOffset}}),"undefined"!=typeof Symbol&&Symbol.species&&f[Symbol.species]===f&&Object.defineProperty(f,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),f.poolSize=8192,f.from=function(e,t,r){return a(e,t,r)},f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array,f.alloc=function(e,t,r){return i=t,s=r,u(n=e),n<=0?o(n):void 0!==i?"string"==typeof s?o(n).fill(i,s):o(n).fill(i):o(n);var n,i,s},f.allocUnsafe=function(e){return c(e)},f.allocUnsafeSlow=function(e){return c(e)},f.isBuffer=function(e){return null!=e&&!0===e._isBuffer},f.compare=function(e,t){if(!f.isBuffer(e)||!f.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},f.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return f.alloc(0);var r;if(void 0===t)for(r=t=0;r<e.length;++r)t+=e[r].length;var n=f.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(ArrayBuffer.isView(s)&&(s=f.from(s)),!f.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},f.byteLength=d,f.prototype._isBuffer=!0,f.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},f.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},f.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},f.prototype.toLocaleString=f.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?g(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,r);case"utf8":case"utf-8":return g(this,t,r);case"ascii":return w(this,t,r);case"latin1":case"binary":return x(this,t,r);case"base64":return _(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},f.prototype.equals=function(e){if(!f.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===f.compare(this,e)},f.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},f.prototype.compare=function(e,t,r,n,i){if(!f.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(i<=n&&r<=t)return 0;if(i<=n)return-1;if(r<=t)return 1;if(this===e)return 0;for(var s=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),a=Math.min(s,o),u=this.slice(n,i),c=e.slice(t,r),l=0;l<a;++l)if(u[l]!==c[l]){s=u[l],o=c[l];break}return s<o?-1:o<s?1:0},f.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},f.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},f.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)},f.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||i<r)&&(r=i),0<e.length&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s,o,a,u,c,l,f,h,d,p=!1;;)switch(n){case"hex":return b(this,e,t,r);case"utf8":case"utf-8":return h=t,d=r,N(A(e,(f=this).length-h),f,h,d);case"ascii":return y(this,e,t,r);case"latin1":case"binary":return y(this,e,t,r);case"base64":return u=this,c=t,l=r,N(O(e),u,c,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o=t,a=r,N(function(e,t){for(var r,n,i,s=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(e,(s=this).length-o),s,o,a);default:if(p)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),p=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function w(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function x(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function C(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||n<r)&&(r=n);for(var i="",s=t;s<r;++s)i+=P(e[s]);return i}function j(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function S(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function E(e,t,r,n,i,s){if(!f.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<t||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function T(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function I(e,t,r,n,i){return t=+t,r>>>=0,i||T(e,0,r,4),s.write(e,t,r,n,23,4),r+4}function R(e,t,r,n,i){return t=+t,r>>>=0,i||T(e,0,r,8),s.write(e,t,r,n,52,8),r+8}f.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=f.prototype,n},f.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||S(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},f.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||S(e,t,this.length);for(var n=this[e+--t],i=1;0<t&&(i*=256);)n+=this[e+--t]*i;return n},f.prototype.readUInt8=function(e,t){return e>>>=0,t||S(e,1,this.length),this[e]},f.prototype.readUInt16LE=function(e,t){return e>>>=0,t||S(e,2,this.length),this[e]|this[e+1]<<8},f.prototype.readUInt16BE=function(e,t){return e>>>=0,t||S(e,2,this.length),this[e]<<8|this[e+1]},f.prototype.readUInt32LE=function(e,t){return e>>>=0,t||S(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},f.prototype.readUInt32BE=function(e,t){return e>>>=0,t||S(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},f.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||S(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return(i*=128)<=n&&(n-=Math.pow(2,8*t)),n},f.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||S(e,t,this.length);for(var n=t,i=1,s=this[e+--n];0<n&&(i*=256);)s+=this[e+--n]*i;return(i*=128)<=s&&(s-=Math.pow(2,8*t)),s},f.prototype.readInt8=function(e,t){return e>>>=0,t||S(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},f.prototype.readInt16LE=function(e,t){e>>>=0,t||S(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},f.prototype.readInt16BE=function(e,t){e>>>=0,t||S(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},f.prototype.readInt32LE=function(e,t){return e>>>=0,t||S(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},f.prototype.readInt32BE=function(e,t){return e>>>=0,t||S(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},f.prototype.readFloatLE=function(e,t){return e>>>=0,t||S(e,4,this.length),s.read(this,e,!0,23,4)},f.prototype.readFloatBE=function(e,t){return e>>>=0,t||S(e,4,this.length),s.read(this,e,!1,23,4)},f.prototype.readDoubleLE=function(e,t){return e>>>=0,t||S(e,8,this.length),s.read(this,e,!0,52,8)},f.prototype.readDoubleBE=function(e,t){return e>>>=0,t||S(e,8,this.length),s.read(this,e,!1,52,8)},f.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||E(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},f.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||E(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,s=1;for(this[t+i]=255&e;0<=--i&&(s*=256);)this[t+i]=e/s&255;return t+r},f.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,1,255,0),this[t]=255&e,t+1},f.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},f.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},f.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},f.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},f.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);E(this,e,t,r,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<r&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},f.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);E(this,e,t,r,i-1,-i)}var s=r-1,o=1,a=0;for(this[t+s]=255&e;0<=--s&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},f.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},f.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},f.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},f.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},f.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},f.prototype.writeFloatLE=function(e,t,r){return I(this,e,t,!0,r)},f.prototype.writeFloatBE=function(e,t,r){return I(this,e,t,!1,r)},f.prototype.writeDoubleLE=function(e,t,r){return R(this,e,t,!0,r)},f.prototype.writeDoubleBE=function(e,t,r){return R(this,e,t,!1,r)},f.prototype.copy=function(e,t,r,n){if(!f.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),0<n&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var s=i-1;0<=s;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},f.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!f.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var o=f.isBuffer(e)?e:new f(e,n),a=o.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<r-t;++s)this[s+t]=o[s%a]}return this};var M=/[^+/0-9A-Za-z-_]/g;function P(e){return e<16?"0"+e.toString(16):e.toString(16)}function A(e,t){var r;t=t||1/0;for(var n=e.length,i=null,s=[],o=0;o<n;++o){if(55295<(r=e.charCodeAt(o))&&r<57344){if(!i){if(56319<r){-1<(t-=3)&&s.push(239,191,189);continue}if(o+1===n){-1<(t-=3)&&s.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(t-=3)&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(t-=3)&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function O(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function N(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function D(e){return e instanceof ArrayBuffer||null!=e&&null!=e.constructor&&"ArrayBuffer"===e.constructor.name&&"number"==typeof e.byteLength}function U(e){return e!=e}},{"base64-js":64,ieee754:215}],72:[function(e,t,r){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":106,"../../modules/es6.array.from":180,"../../modules/es6.string.iterator":196}],73:[function(e,t,r){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":178,"../modules/es6.string.iterator":196,"../modules/web.dom.iterable":208}],74:[function(e,t,r){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.is-iterable")},{"../modules/core.is-iterable":179,"../modules/es6.string.iterator":196,"../modules/web.dom.iterable":208}],75:[function(e,t,r){var n=e("../../modules/_core"),i=n.JSON||(n.JSON={stringify:JSON.stringify});t.exports=function(e){return i.stringify.apply(i,arguments)}},{"../../modules/_core":106}],76:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.map"),e("../modules/es7.map.to-json"),e("../modules/es7.map.of"),e("../modules/es7.map.from"),t.exports=e("../modules/_core").Map},{"../modules/_core":106,"../modules/es6.map":182,"../modules/es6.object.to-string":192,"../modules/es6.string.iterator":196,"../modules/es7.map.from":198,"../modules/es7.map.of":199,"../modules/es7.map.to-json":200,"../modules/web.dom.iterable":208}],77:[function(e,t,r){e("../../modules/es6.number.is-integer"),t.exports=e("../../modules/_core").Number.isInteger},{"../../modules/_core":106,"../../modules/es6.number.is-integer":183}],78:[function(e,t,r){e("../../modules/es6.object.assign"),t.exports=e("../../modules/_core").Object.assign},{"../../modules/_core":106,"../../modules/es6.object.assign":184}],79:[function(e,t,r){e("../../modules/es6.object.create");var n=e("../../modules/_core").Object;t.exports=function(e,t){return n.create(e,t)}},{"../../modules/_core":106,"../../modules/es6.object.create":185}],80:[function(e,t,r){e("../../modules/es6.object.define-properties");var n=e("../../modules/_core").Object;t.exports=function(e,t){return n.defineProperties(e,t)}},{"../../modules/_core":106,"../../modules/es6.object.define-properties":186}],81:[function(e,t,r){e("../../modules/es6.object.define-property");var n=e("../../modules/_core").Object;t.exports=function(e,t,r){return n.defineProperty(e,t,r)}},{"../../modules/_core":106,"../../modules/es6.object.define-property":187}],82:[function(e,t,r){e("../../modules/es6.object.freeze"),t.exports=e("../../modules/_core").Object.freeze},{"../../modules/_core":106,"../../modules/es6.object.freeze":188}],83:[function(e,t,r){e("../../modules/es6.object.get-prototype-of"),t.exports=e("../../modules/_core").Object.getPrototypeOf},{"../../modules/_core":106,"../../modules/es6.object.get-prototype-of":189}],84:[function(e,t,r){e("../../modules/es6.object.keys"),t.exports=e("../../modules/_core").Object.keys},{"../../modules/_core":106,"../../modules/es6.object.keys":190}],85:[function(e,t,r){e("../../modules/es6.object.set-prototype-of"),t.exports=e("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":106,"../../modules/es6.object.set-prototype-of":191}],86:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),e("../modules/es7.promise.finally"),e("../modules/es7.promise.try"),t.exports=e("../modules/_core").Promise},{"../modules/_core":106,"../modules/es6.object.to-string":192,"../modules/es6.promise":193,"../modules/es6.string.iterator":196,"../modules/es7.promise.finally":201,"../modules/es7.promise.try":202,"../modules/web.dom.iterable":208}],87:[function(e,t,r){e("../../modules/es6.reflect.construct"),t.exports=e("../../modules/_core").Reflect.construct},{"../../modules/_core":106,"../../modules/es6.reflect.construct":194}],88:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.set"),e("../modules/es7.set.to-json"),e("../modules/es7.set.of"),e("../modules/es7.set.from"),t.exports=e("../modules/_core").Set},{"../modules/_core":106,"../modules/es6.object.to-string":192,"../modules/es6.set":195,"../modules/es6.string.iterator":196,"../modules/es7.set.from":203,"../modules/es7.set.of":204,"../modules/es7.set.to-json":205,"../modules/web.dom.iterable":208}],89:[function(e,t,r){e("../../modules/es6.symbol"),e("../../modules/es6.object.to-string"),e("../../modules/es7.symbol.async-iterator"),e("../../modules/es7.symbol.observable"),t.exports=e("../../modules/_core").Symbol},{"../../modules/_core":106,"../../modules/es6.object.to-string":192,"../../modules/es6.symbol":197,"../../modules/es7.symbol.async-iterator":206,"../../modules/es7.symbol.observable":207}],90:[function(e,t,r){e("../../modules/es6.string.iterator"),e("../../modules/web.dom.iterable"),t.exports=e("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":175,"../../modules/es6.string.iterator":196,"../../modules/web.dom.iterable":208}],91:[function(e,t,r){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],92:[function(e,t,r){t.exports=function(){}},{}],93:[function(e,t,r){t.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},{}],94:[function(e,t,r){var n=e("./_is-object");t.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":127}],95:[function(e,t,r){var n=e("./_for-of");t.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},{"./_for-of":116}],96:[function(e,t,r){var u=e("./_to-iobject"),c=e("./_to-length"),l=e("./_to-absolute-index");t.exports=function(a){return function(e,t,r){var n,i=u(e),s=c(i.length),o=l(r,s);if(a&&t!=t){for(;o<s;)if((n=i[o++])!=n)return!0}else for(;o<s;o++)if((a||o in i)&&i[o]===t)return a||o||0;return!a&&-1}}},{"./_to-absolute-index":166,"./_to-iobject":168,"./_to-length":169}],97:[function(e,t,r){var _=e("./_ctx"),g=e("./_iobject"),k=e("./_to-object"),w=e("./_to-length"),n=e("./_array-species-create");t.exports=function(f,e){var h=1==f,d=2==f,p=3==f,m=4==f,v=6==f,b=5==f||v,y=e||n;return function(e,t,r){for(var n,i,s=k(e),o=g(s),a=_(t,r,3),u=w(o.length),c=0,l=h?y(e,u):d?y(e,0):void 0;c<u;c++)if((b||c in o)&&(i=a(n=o[c],c,s),f))if(h)l[c]=i;else if(i)switch(f){case 3:return!0;case 5:return n;case 6:return c;case 2:l.push(n)}else if(m)return!1;return v?-1:p||m?m:l}}},{"./_array-species-create":99,"./_ctx":108,"./_iobject":123,"./_to-length":169,"./_to-object":170}],98:[function(e,t,r){var n=e("./_is-object"),i=e("./_is-array"),s=e("./_wks")("species");t.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),n(t)&&null===(t=t[s])&&(t=void 0)),void 0===t?Array:t}},{"./_is-array":125,"./_is-object":127,"./_wks":176}],99:[function(e,t,r){var n=e("./_array-species-constructor");t.exports=function(e,t){return new(n(e))(t)}},{"./_array-species-constructor":98}],100:[function(e,t,r){"use strict";var s=e("./_a-function"),o=e("./_is-object"),a=e("./_invoke"),u=[].slice,c={};t.exports=Function.bind||function(t){var r=s(this),n=u.call(arguments,1),i=function(){var e=n.concat(u.call(arguments));return this instanceof i?function(e,t,r){if(!(t in c)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";c[t]=Function("F,a","return new F("+n.join(",")+")")}return c[t](e,r)}(r,e.length,e):a(r,e,t)};return o(r.prototype)&&(i.prototype=r.prototype),i}},{"./_a-function":91,"./_invoke":122,"./_is-object":127}],101:[function(e,t,r){var i=e("./_cof"),s=e("./_wks")("toStringTag"),o="Arguments"==i(function(){return arguments}());t.exports=function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),s))?r:o?i(t):"Object"==(n=i(t))&&"function"==typeof t.callee?"Arguments":n}},{"./_cof":102,"./_wks":176}],102:[function(e,t,r){var n={}.toString;t.exports=function(e){return n.call(e).slice(8,-1)}},{}],103:[function(e,t,r){"use strict";var o=e("./_object-dp").f,a=e("./_object-create"),u=e("./_redefine-all"),c=e("./_ctx"),l=e("./_an-instance"),f=e("./_for-of"),n=e("./_iter-define"),i=e("./_iter-step"),s=e("./_set-species"),h=e("./_descriptors"),d=e("./_meta").fastKey,p=e("./_validate-collection"),m=h?"_s":"size",v=function(e,t){var r,n=d(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};t.exports={getConstructor:function(e,s,r,n){var i=e(function(e,t){l(e,i,s,"_i"),e._t=s,e._i=a(null),e._f=void 0,e._l=void 0,e[m]=0,null!=t&&f(t,r,e[n],e)});return u(i.prototype,{clear:function(){for(var e=p(this,s),t=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete t[r.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var t=p(this,s),r=v(t,e);if(r){var n=r.n,i=r.p;delete t._i[r.i],r.r=!0,i&&(i.n=n),n&&(n.p=i),t._f==r&&(t._f=n),t._l==r&&(t._l=i),t[m]--}return!!r},forEach:function(e){p(this,s);for(var t,r=c(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.n:this._f;)for(r(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!v(p(this,s),e)}}),h&&o(i.prototype,"size",{get:function(){return p(this,s)[m]}}),i},def:function(e,t,r){var n,i,s=v(e,t);return s?s.v=r:(e._l=s={i:i=d(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=s),n&&(n.n=s),e[m]++,"F"!==i&&(e._i[i]=s)),e},getEntry:v,setStrong:function(e,r,t){n(e,r,function(e,t){this._t=p(e,r),this._k=t,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?i(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,i(1))},t?"entries":"values",!t,!0),s(r)}}},{"./_an-instance":93,"./_ctx":108,"./_descriptors":110,"./_for-of":116,"./_iter-define":130,"./_iter-step":132,"./_meta":135,"./_object-create":139,"./_object-dp":140,"./_redefine-all":154,"./_set-species":159,"./_validate-collection":173}],104:[function(e,t,r){var n=e("./_classof"),i=e("./_array-from-iterable");t.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},{"./_array-from-iterable":95,"./_classof":101}],105:[function(e,t,r){"use strict";var f=e("./_global"),h=e("./_export"),d=e("./_meta"),p=e("./_fails"),m=e("./_hide"),v=e("./_redefine-all"),b=e("./_for-of"),y=e("./_an-instance"),_=e("./_is-object"),g=e("./_set-to-string-tag"),k=e("./_object-dp").f,w=e("./_array-methods")(0),x=e("./_descriptors");t.exports=function(r,e,t,n,i,s){var o=f[r],a=o,u=i?"set":"add",c=a&&a.prototype,l={};return x&&"function"==typeof a&&(s||c.forEach&&!p(function(){(new a).entries().next()}))?(a=e(function(e,t){y(e,a,r,"_c"),e._c=new o,null!=t&&b(t,i,e[u],e)}),w("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(n){var i="add"==n||"set"==n;n in c&&(!s||"clear"!=n)&&m(a.prototype,n,function(e,t){if(y(this,a,n),!i&&s&&!_(e))return"get"==n&&void 0;var r=this._c[n](0===e?0:e,t);return i?this:r})}),s||k(a.prototype,"size",{get:function(){return this._c.size}})):(a=n.getConstructor(e,r,i,u),v(a.prototype,t),d.NEED=!0),g(a,r),l[r]=a,h(h.G+h.W+h.F,l),s||n.setStrong(a,r,i),a}},{"./_an-instance":93,"./_array-methods":97,"./_descriptors":110,"./_export":114,"./_fails":115,"./_for-of":116,"./_global":117,"./_hide":119,"./_is-object":127,"./_meta":135,"./_object-dp":140,"./_redefine-all":154,"./_set-to-string-tag":160}],106:[function(e,t,r){var n=t.exports={version:"2.5.3"};"number"==typeof __e&&(__e=n)},{}],107:[function(e,t,r){"use strict";var n=e("./_object-dp"),i=e("./_property-desc");t.exports=function(e,t,r){t in e?n.f(e,t,i(0,r)):e[t]=r}},{"./_object-dp":140,"./_property-desc":153}],108:[function(e,t,r){var s=e("./_a-function");t.exports=function(n,i,e){if(s(n),void 0===i)return n;switch(e){case 1:return function(e){return n.call(i,e)};case 2:return function(e,t){return n.call(i,e,t)};case 3:return function(e,t,r){return n.call(i,e,t,r)}}return function(){return n.apply(i,arguments)}}},{"./_a-function":91}],109:[function(e,t,r){t.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},{}],110:[function(e,t,r){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":115}],111:[function(e,t,r){var n=e("./_is-object"),i=e("./_global").document,s=n(i)&&n(i.createElement);t.exports=function(e){return s?i.createElement(e):{}}},{"./_global":117,"./_is-object":127}],112:[function(e,t,r){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],113:[function(e,t,r){var a=e("./_object-keys"),u=e("./_object-gops"),c=e("./_object-pie");t.exports=function(e){var t=a(e),r=u.f;if(r)for(var n,i=r(e),s=c.f,o=0;i.length>o;)s.call(e,n=i[o++])&&t.push(n);return t}},{"./_object-gops":145,"./_object-keys":148,"./_object-pie":149}],114:[function(e,t,r){var m=e("./_global"),v=e("./_core"),b=e("./_ctx"),y=e("./_hide"),_="prototype",g=function(e,t,r){var n,i,s,o=e&g.F,a=e&g.G,u=e&g.S,c=e&g.P,l=e&g.B,f=e&g.W,h=a?v:v[t]||(v[t]={}),d=h[_],p=a?m:u?m[t]:(m[t]||{})[_];for(n in a&&(r=t),r)(i=!o&&p&&void 0!==p[n])&&n in h||(s=i?p[n]:r[n],h[n]=a&&"function"!=typeof p[n]?r[n]:l&&i?b(s,m):f&&p[n]==s?function(n){var e=function(e,t,r){if(this instanceof n){switch(arguments.length){case 0:return new n;case 1:return new n(e);case 2:return new n(e,t)}return new n(e,t,r)}return n.apply(this,arguments)};return e[_]=n[_],e}(s):c&&"function"==typeof s?b(Function.call,s):s,c&&((h.virtual||(h.virtual={}))[n]=s,e&g.R&&d&&!d[n]&&y(d,n,s)))};g.F=1,g.G=2,g.S=4,g.P=8,g.B=16,g.W=32,g.U=64,g.R=128,t.exports=g},{"./_core":106,"./_ctx":108,"./_global":117,"./_hide":119}],115:[function(e,t,r){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],116:[function(e,t,r){var h=e("./_ctx"),d=e("./_iter-call"),p=e("./_is-array-iter"),m=e("./_an-object"),v=e("./_to-length"),b=e("./core.get-iterator-method"),y={},_={};(r=t.exports=function(e,t,r,n,i){var s,o,a,u,c=i?function(){return e}:b(e),l=h(r,n,t?2:1),f=0;if("function"!=typeof c)throw TypeError(e+" is not iterable!");if(p(c)){for(s=v(e.length);f<s;f++)if((u=t?l(m(o=e[f])[0],o[1]):l(e[f]))===y||u===_)return u}else for(a=c.call(e);!(o=a.next()).done;)if((u=d(a,l,o.value,t))===y||u===_)return u}).BREAK=y,r.RETURN=_},{"./_an-object":94,"./_ctx":108,"./_is-array-iter":124,"./_iter-call":128,"./_to-length":169,"./core.get-iterator-method":177}],117:[function(e,t,r){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],118:[function(e,t,r){var n={}.hasOwnProperty;t.exports=function(e,t){return n.call(e,t)}},{}],119:[function(e,t,r){var n=e("./_object-dp"),i=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},{"./_descriptors":110,"./_object-dp":140,"./_property-desc":153}],120:[function(e,t,r){var n=e("./_global").document;t.exports=n&&n.documentElement},{"./_global":117}],121:[function(e,t,r){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":110,"./_dom-create":111,"./_fails":115}],122:[function(e,t,r){t.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},{}],123:[function(e,t,r){var n=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},{"./_cof":102}],124:[function(e,t,r){var n=e("./_iterators"),i=e("./_wks")("iterator"),s=Array.prototype;t.exports=function(e){return void 0!==e&&(n.Array===e||s[i]===e)}},{"./_iterators":133,"./_wks":176}],125:[function(e,t,r){var n=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==n(e)}},{"./_cof":102}],126:[function(e,t,r){var n=e("./_is-object"),i=Math.floor;t.exports=function(e){return!n(e)&&isFinite(e)&&i(e)===e}},{"./_is-object":127}],127:[function(e,t,r){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],128:[function(e,t,r){var s=e("./_an-object");t.exports=function(t,e,r,n){try{return n?e(s(r)[0],r[1]):e(r)}catch(e){var i=t.return;throw void 0!==i&&s(i.call(t)),e}}},{"./_an-object":94}],129:[function(e,t,r){"use strict";var n=e("./_object-create"),i=e("./_property-desc"),s=e("./_set-to-string-tag"),o={};e("./_hide")(o,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,r){e.prototype=n(o,{next:i(1,r)}),s(e,t+" Iterator")}},{"./_hide":119,"./_object-create":139,"./_property-desc":153,"./_set-to-string-tag":160,"./_wks":176}],130:[function(e,t,r){"use strict";var _=e("./_library"),g=e("./_export"),k=e("./_redefine"),w=e("./_hide"),x=e("./_has"),C=e("./_iterators"),j=e("./_iter-create"),S=e("./_set-to-string-tag"),E=e("./_object-gpo"),T=e("./_wks")("iterator"),I=!([].keys&&"next"in[].keys()),R="values",M=function(){return this};t.exports=function(e,t,r,n,i,s,o){j(r,t,n);var a,u,c,l=function(e){if(!I&&e in p)return p[e];switch(e){case"keys":case R:return function(){return new r(this,e)}}return function(){return new r(this,e)}},f=t+" Iterator",h=i==R,d=!1,p=e.prototype,m=p[T]||p["@@iterator"]||i&&p[i],v=!I&&m||l(i),b=i?h?l("entries"):v:void 0,y="Array"==t&&p.entries||m;if(y&&(c=E(y.call(new e)))!==Object.prototype&&c.next&&(S(c,f,!0),_||x(c,T)||w(c,T,M)),h&&m&&m.name!==R&&(d=!0,v=function(){return m.call(this)}),_&&!o||!I&&!d&&p[T]||w(p,T,v),C[t]=v,C[f]=M,i)if(a={values:h?v:l(R),keys:s?v:l("keys"),entries:b},o)for(u in a)u in p||k(p,u,a[u]);else g(g.P+g.F*(I||d),t,a);return a}},{"./_export":114,"./_has":118,"./_hide":119,"./_iter-create":129,"./_iterators":133,"./_library":134,"./_object-gpo":146,"./_redefine":155,"./_set-to-string-tag":160,"./_wks":176}],131:[function(e,t,r){var s=e("./_wks")("iterator"),o=!1;try{var n=[7][s]();n.return=function(){o=!0},Array.from(n,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!o)return!1;var r=!1;try{var n=[7],i=n[s]();i.next=function(){return{done:r=!0}},n[s]=function(){return i},e(n)}catch(e){}return r}},{"./_wks":176}],132:[function(e,t,r){t.exports=function(e,t){return{value:t,done:!!e}}},{}],133:[function(e,t,r){t.exports={}},{}],134:[function(e,t,r){t.exports=!0},{}],135:[function(e,t,r){var n=e("./_uid")("meta"),i=e("./_is-object"),s=e("./_has"),o=e("./_object-dp").f,a=0,u=Object.isExtensible||function(){return!0},c=!e("./_fails")(function(){return u(Object.preventExtensions({}))}),l=function(e){o(e,n,{value:{i:"O"+ ++a,w:{}}})},f=t.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!s(e,n)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[n].i},getWeak:function(e,t){if(!s(e,n)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[n].w},onFreeze:function(e){return c&&f.NEED&&u(e)&&!s(e,n)&&l(e),e}}},{"./_fails":115,"./_has":118,"./_is-object":127,"./_object-dp":140,"./_uid":172}],136:[function(e,t,r){var a=e("./_global"),u=e("./_task").set,c=a.MutationObserver||a.WebKitMutationObserver,l=a.process,f=a.Promise,h="process"==e("./_cof")(l);t.exports=function(){var r,n,i,e=function(){var e,t;for(h&&(e=l.domain)&&e.exit();r;){t=r.fn,r=r.next;try{t()}catch(e){throw r?i():n=void 0,e}}n=void 0,e&&e.enter()};if(h)i=function(){l.nextTick(e)};else if(!c||a.navigator&&a.navigator.standalone)if(f&&f.resolve){var t=f.resolve();i=function(){t.then(e)}}else i=function(){u.call(a,e)};else{var s=!0,o=document.createTextNode("");new c(e).observe(o,{characterData:!0}),i=function(){o.data=s=!s}}return function(e){var t={fn:e,next:void 0};n&&(n.next=t),r||(r=t,i()),n=t}}},{"./_cof":102,"./_global":117,"./_task":165}],137:[function(e,t,r){"use strict";
// 25.4.1.5 NewPromiseCapability(C)
var i=e("./_a-function");t.exports.f=function(e){return new function(e){var r,n;this.promise=new e(function(e,t){if(void 0!==r||void 0!==n)throw TypeError("Bad Promise constructor");r=e,n=t}),this.resolve=i(r),this.reject=i(n)}(e)}},{"./_a-function":91}],138:[function(e,t,r){"use strict";var h=e("./_object-keys"),d=e("./_object-gops"),p=e("./_object-pie"),m=e("./_to-object"),v=e("./_iobject"),i=Object.assign;t.exports=!i||e("./_fails")(function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=i({},e)[r]||Object.keys(i({},t)).join("")!=n})?function(e,t){for(var r=m(e),n=arguments.length,i=1,s=d.f,o=p.f;i<n;)for(var a,u=v(arguments[i++]),c=s?h(u).concat(s(u)):h(u),l=c.length,f=0;f<l;)o.call(u,a=c[f++])&&(r[a]=u[a]);return r}:i},{"./_fails":115,"./_iobject":123,"./_object-gops":145,"./_object-keys":148,"./_object-pie":149,"./_to-object":170}],139:[function(n,e,t){var i=n("./_an-object"),s=n("./_object-dps"),o=n("./_enum-bug-keys"),a=n("./_shared-key")("IE_PROTO"),u=function(){},c="prototype",l=function(){var e,t=n("./_dom-create")("iframe"),r=o.length;for(t.style.display="none",n("./_html").appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;r--;)delete l[c][o[r]];return l()};e.exports=Object.create||function(e,t){var r;return null!==e?(u[c]=i(e),r=new u,u[c]=null,r[a]=e):r=l(),void 0===t?r:s(r,t)}},{"./_an-object":94,"./_dom-create":111,"./_enum-bug-keys":112,"./_html":120,"./_object-dps":141,"./_shared-key":161}],140:[function(e,t,r){var n=e("./_an-object"),i=e("./_ie8-dom-define"),s=e("./_to-primitive"),o=Object.defineProperty;r.f=e("./_descriptors")?Object.defineProperty:function(e,t,r){if(n(e),t=s(t,!0),n(r),i)try{return o(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},{"./_an-object":94,"./_descriptors":110,"./_ie8-dom-define":121,"./_to-primitive":171}],141:[function(e,t,r){var o=e("./_object-dp"),a=e("./_an-object"),u=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){a(e);for(var r,n=u(t),i=n.length,s=0;s<i;)o.f(e,r=n[s++],t[r]);return e}},{"./_an-object":94,"./_descriptors":110,"./_object-dp":140,"./_object-keys":148}],142:[function(e,t,r){var n=e("./_object-pie"),i=e("./_property-desc"),s=e("./_to-iobject"),o=e("./_to-primitive"),a=e("./_has"),u=e("./_ie8-dom-define"),c=Object.getOwnPropertyDescriptor;r.f=e("./_descriptors")?c:function(e,t){if(e=s(e),t=o(t,!0),u)try{return c(e,t)}catch(e){}if(a(e,t))return i(!n.f.call(e,t),e[t])}},{"./_descriptors":110,"./_has":118,"./_ie8-dom-define":121,"./_object-pie":149,"./_property-desc":153,"./_to-iobject":168,"./_to-primitive":171}],143:[function(e,t,r){var n=e("./_to-iobject"),i=e("./_object-gopn").f,s={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(e){return o&&"[object Window]"==s.call(e)?function(e){try{return i(e)}catch(e){return o.slice()}}(e):i(n(e))}},{"./_object-gopn":144,"./_to-iobject":168}],144:[function(e,t,r){var n=e("./_object-keys-internal"),i=e("./_enum-bug-keys").concat("length","prototype");r.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},{"./_enum-bug-keys":112,"./_object-keys-internal":147}],145:[function(e,t,r){r.f=Object.getOwnPropertySymbols},{}],146:[function(e,t,r){var n=e("./_has"),i=e("./_to-object"),s=e("./_shared-key")("IE_PROTO"),o=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},{"./_has":118,"./_shared-key":161,"./_to-object":170}],147:[function(e,t,r){var o=e("./_has"),a=e("./_to-iobject"),u=e("./_array-includes")(!1),c=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var r,n=a(e),i=0,s=[];for(r in n)r!=c&&o(n,r)&&s.push(r);for(;t.length>i;)o(n,r=t[i++])&&(~u(s,r)||s.push(r));return s}},{"./_array-includes":96,"./_has":118,"./_shared-key":161,"./_to-iobject":168}],148:[function(e,t,r){var n=e("./_object-keys-internal"),i=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return n(e,i)}},{"./_enum-bug-keys":112,"./_object-keys-internal":147}],149:[function(e,t,r){r.f={}.propertyIsEnumerable},{}],150:[function(e,t,r){var i=e("./_export"),s=e("./_core"),o=e("./_fails");t.exports=function(e,t){var r=(s.Object||{})[e]||Object[e],n={};n[e]=t(r),i(i.S+i.F*o(function(){r(1)}),"Object",n)}},{"./_core":106,"./_export":114,"./_fails":115}],151:[function(e,t,r){t.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},{}],152:[function(e,t,r){var n=e("./_an-object"),i=e("./_is-object"),s=e("./_new-promise-capability");t.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=s.f(e);return(0,r.resolve)(t),r.promise}},{"./_an-object":94,"./_is-object":127,"./_new-promise-capability":137}],153:[function(e,t,r){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],154:[function(e,t,r){var i=e("./_hide");t.exports=function(e,t,r){for(var n in t)r&&e[n]?e[n]=t[n]:i(e,n,t[n]);return e}},{"./_hide":119}],155:[function(e,t,r){t.exports=e("./_hide")},{"./_hide":119}],156:[function(e,t,r){"use strict";var n=e("./_export"),o=e("./_a-function"),a=e("./_ctx"),u=e("./_for-of");t.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,i,s=arguments[1];return o(this),(t=void 0!==s)&&o(s),null==e?new this:(r=[],t?(n=0,i=a(s,arguments[2],2),u(e,!1,function(e){r.push(i(e,n++))})):u(e,!1,r.push,r),new this(r))}})}},{"./_a-function":91,"./_ctx":108,"./_export":114,"./_for-of":116}],157:[function(e,t,r){"use strict";var n=e("./_export");t.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},{"./_export":114}],158:[function(t,e,r){var n=t("./_is-object"),i=t("./_an-object"),s=function(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,r,n){try{(n=t("./_ctx")(Function.call,t("./_object-gopd").f(Object.prototype,"__proto__").set,2))(e,[]),r=!(e instanceof Array)}catch(e){r=!0}return function(e,t){return s(e,t),r?e.__proto__=t:n(e,t),e}}({},!1):void 0),check:s}},{"./_an-object":94,"./_ctx":108,"./_is-object":127,"./_object-gopd":142}],159:[function(e,t,r){"use strict";var n=e("./_global"),i=e("./_core"),s=e("./_object-dp"),o=e("./_descriptors"),a=e("./_wks")("species");t.exports=function(e){var t="function"==typeof i[e]?i[e]:n[e];o&&t&&!t[a]&&s.f(t,a,{configurable:!0,get:function(){return this}})}},{"./_core":106,"./_descriptors":110,"./_global":117,"./_object-dp":140,"./_wks":176}],160:[function(e,t,r){var n=e("./_object-dp").f,i=e("./_has"),s=e("./_wks")("toStringTag");t.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,s)&&n(e,s,{configurable:!0,value:t})}},{"./_has":118,"./_object-dp":140,"./_wks":176}],161:[function(e,t,r){var n=e("./_shared")("keys"),i=e("./_uid");t.exports=function(e){return n[e]||(n[e]=i(e))}},{"./_shared":162,"./_uid":172}],162:[function(e,t,r){var n=e("./_global"),i="__core-js_shared__",s=n[i]||(n[i]={});t.exports=function(e){return s[e]||(s[e]={})}},{"./_global":117}],163:[function(e,t,r){var i=e("./_an-object"),s=e("./_a-function"),o=e("./_wks")("species");t.exports=function(e,t){var r,n=i(e).constructor;return void 0===n||null==(r=i(n)[o])?t:s(r)}},{"./_a-function":91,"./_an-object":94,"./_wks":176}],164:[function(e,t,r){var u=e("./_to-integer"),c=e("./_defined");t.exports=function(a){return function(e,t){var r,n,i=String(c(e)),s=u(t),o=i.length;return s<0||o<=s?a?"":void 0:(r=i.charCodeAt(s))<55296||56319<r||s+1===o||(n=i.charCodeAt(s+1))<56320||57343<n?a?i.charAt(s):r:a?i.slice(s,s+2):n-56320+(r-55296<<10)+65536}}},{"./_defined":109,"./_to-integer":167}],165:[function(e,t,r){var n,i,s,o=e("./_ctx"),a=e("./_invoke"),u=e("./_html"),c=e("./_dom-create"),l=e("./_global"),f=l.process,h=l.setImmediate,d=l.clearImmediate,p=l.MessageChannel,m=l.Dispatch,v=0,b={},y="onreadystatechange",_=function(){var e=+this;if(b.hasOwnProperty(e)){var t=b[e];delete b[e],t()}},g=function(e){_.call(e.data)};h&&d||(h=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return b[++v]=function(){a("function"==typeof e?e:Function(e),t)},n(v),v},d=function(e){delete b[e]},"process"==e("./_cof")(f)?n=function(e){f.nextTick(o(_,e,1))}:m&&m.now?n=function(e){m.now(o(_,e,1))}:p?(s=(i=new p).port2,i.port1.onmessage=g,n=o(s.postMessage,s,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(n=function(e){l.postMessage(e+"","*")},l.addEventListener("message",g,!1)):n=y in c("script")?function(e){u.appendChild(c("script"))[y]=function(){u.removeChild(this),_.call(e)}}:function(e){setTimeout(o(_,e,1),0)}),t.exports={set:h,clear:d}},{"./_cof":102,"./_ctx":108,"./_dom-create":111,"./_global":117,"./_html":120,"./_invoke":122}],166:[function(e,t,r){var n=e("./_to-integer"),i=Math.max,s=Math.min;t.exports=function(e,t){return(e=n(e))<0?i(e+t,0):s(e,t)}},{"./_to-integer":167}],167:[function(e,t,r){var n=Math.ceil,i=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(0<e?i:n)(e)}},{}],168:[function(e,t,r){var n=e("./_iobject"),i=e("./_defined");t.exports=function(e){return n(i(e))}},{"./_defined":109,"./_iobject":123}],169:[function(e,t,r){var n=e("./_to-integer"),i=Math.min;t.exports=function(e){return 0<e?i(n(e),9007199254740991):0}},{"./_to-integer":167}],170:[function(e,t,r){var n=e("./_defined");t.exports=function(e){return Object(n(e))}},{"./_defined":109}],171:[function(e,t,r){var i=e("./_is-object");t.exports=function(e,t){if(!i(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!i(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!i(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!i(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":127}],172:[function(e,t,r){var n=0,i=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},{}],173:[function(e,t,r){var n=e("./_is-object");t.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},{"./_is-object":127}],174:[function(e,t,r){var n=e("./_global"),i=e("./_core"),s=e("./_library"),o=e("./_wks-ext"),a=e("./_object-dp").f;t.exports=function(e){var t=i.Symbol||(i.Symbol=s?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:o.f(e)})}},{"./_core":106,"./_global":117,"./_library":134,"./_object-dp":140,"./_wks-ext":175}],175:[function(e,t,r){r.f=e("./_wks")},{"./_wks":176}],176:[function(e,t,r){var n=e("./_shared")("wks"),i=e("./_uid"),s=e("./_global").Symbol,o="function"==typeof s;(t.exports=function(e){return n[e]||(n[e]=o&&s[e]||(o?s:i)("Symbol."+e))}).store=n},{"./_global":117,"./_shared":162,"./_uid":172}],177:[function(e,t,r){var n=e("./_classof"),i=e("./_wks")("iterator"),s=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||s[n(e)]}},{"./_classof":101,"./_core":106,"./_iterators":133,"./_wks":176}],178:[function(e,t,r){var n=e("./_an-object"),i=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},{"./_an-object":94,"./_core":106,"./core.get-iterator-method":177}],179:[function(e,t,r){var n=e("./_classof"),i=e("./_wks")("iterator"),s=e("./_iterators");t.exports=e("./_core").isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||s.hasOwnProperty(n(t))}},{"./_classof":101,"./_core":106,"./_iterators":133,"./_wks":176}],180:[function(e,t,r){"use strict";var h=e("./_ctx"),n=e("./_export"),d=e("./_to-object"),p=e("./_iter-call"),m=e("./_is-array-iter"),v=e("./_to-length"),b=e("./_create-property"),y=e("./core.get-iterator-method");n(n.S+n.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,n,i,s=d(e),o="function"==typeof this?this:Array,a=arguments.length,u=1<a?arguments[1]:void 0,c=void 0!==u,l=0,f=y(s);if(c&&(u=h(u,2<a?arguments[2]:void 0,2)),null==f||o==Array&&m(f))for(r=new o(t=v(s.length));l<t;l++)b(r,l,c?u(s[l],l):s[l]);else for(i=f.call(s),r=new o;!(n=i.next()).done;l++)b(r,l,c?p(i,u,[n.value,l],!0):n.value);return r.length=l,r}})},{"./_create-property":107,"./_ctx":108,"./_export":114,"./_is-array-iter":124,"./_iter-call":128,"./_iter-detect":131,"./_to-length":169,"./_to-object":170,"./core.get-iterator-method":177}],181:[function(e,t,r){"use strict";var n=e("./_add-to-unscopables"),i=e("./_iter-step"),s=e("./_iterators"),o=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values"),s.Arguments=s.Array,n("keys"),n("values"),n("entries")},{"./_add-to-unscopables":92,"./_iter-define":130,"./_iter-step":132,"./_iterators":133,"./_to-iobject":168}],182:[function(e,t,r){"use strict";var n=e("./_collection-strong"),i=e("./_validate-collection");t.exports=e("./_collection")("Map",function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{get:function(e){var t=n.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(i(this,"Map"),0===e?0:e,t)}},n,!0)},{"./_collection":105,"./_collection-strong":103,"./_validate-collection":173}],183:[function(e,t,r){var n=e("./_export");n(n.S,"Number",{isInteger:e("./_is-integer")})},{"./_export":114,"./_is-integer":126}],184:[function(e,t,r){var n=e("./_export");n(n.S+n.F,"Object",{assign:e("./_object-assign")})},{"./_export":114,"./_object-assign":138}],185:[function(e,t,r){var n=e("./_export");n(n.S,"Object",{create:e("./_object-create")})},{"./_export":114,"./_object-create":139}],186:[function(e,t,r){var n=e("./_export");n(n.S+n.F*!e("./_descriptors"),"Object",{defineProperties:e("./_object-dps")})},{"./_descriptors":110,"./_export":114,"./_object-dps":141}],187:[function(e,t,r){var n=e("./_export");n(n.S+n.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":110,"./_export":114,"./_object-dp":140}],188:[function(e,t,r){var n=e("./_is-object"),i=e("./_meta").onFreeze;e("./_object-sap")("freeze",function(t){return function(e){return t&&n(e)?t(i(e)):e}})},{"./_is-object":127,"./_meta":135,"./_object-sap":150}],189:[function(e,t,r){var n=e("./_to-object"),i=e("./_object-gpo");e("./_object-sap")("getPrototypeOf",function(){return function(e){return i(n(e))}})},{"./_object-gpo":146,"./_object-sap":150,"./_to-object":170}],190:[function(e,t,r){var n=e("./_to-object"),i=e("./_object-keys");e("./_object-sap")("keys",function(){return function(e){return i(n(e))}})},{"./_object-keys":148,"./_object-sap":150,"./_to-object":170}],191:[function(e,t,r){var n=e("./_export");n(n.S,"Object",{setPrototypeOf:e("./_set-proto").set})},{"./_export":114,"./_set-proto":158}],192:[function(e,t,r){arguments[4][70][0].apply(r,arguments)},{dup:70}],193:[function(r,e,t){"use strict";var n,i,s,o,a=r("./_library"),u=r("./_global"),c=r("./_ctx"),l=r("./_classof"),f=r("./_export"),h=r("./_is-object"),d=r("./_a-function"),p=r("./_an-instance"),m=r("./_for-of"),v=r("./_species-constructor"),b=r("./_task").set,y=r("./_microtask")(),_=r("./_new-promise-capability"),g=r("./_perform"),k=r("./_promise-resolve"),w="Promise",x=u.TypeError,C=u.process,j=u[w],S="process"==l(C),E=function(){},T=i=_.f,I=!!function(){try{var e=j.resolve(1),t=(e.constructor={})[r("./_wks")("species")]=function(e){e(E,E)};return(S||"function"==typeof PromiseRejectionEvent)&&e.then(E)instanceof t}catch(e){}}(),R=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},M=function(c,r){if(!c._n){c._n=!0;var n=c._c;y(function(){for(var a=c._v,u=1==c._s,e=0,t=function(e){var t,r,n=u?e.ok:e.fail,i=e.resolve,s=e.reject,o=e.domain;try{n?(u||(2==c._h&&O(c),c._h=1),!0===n?t=a:(o&&o.enter(),t=n(a),o&&o.exit()),t===e.promise?s(x("Promise-chain cycle")):(r=R(t))?r.call(t,i,s):i(t)):s(a)}catch(e){s(e)}};n.length>e;)t(n[e++]);c._c=[],c._n=!1,r&&!c._h&&P(c)})}},P=function(s){b.call(u,function(){var e,t,r,n=s._v,i=A(s);if(i&&(e=g(function(){S?C.emit("unhandledRejection",n,s):(t=u.onunhandledrejection)?t({promise:s,reason:n}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",n)}),s._h=S||A(s)?2:1),s._a=void 0,i&&e.e)throw e.v})},A=function(e){return 1!==e._h&&0===(e._a||e._c).length},O=function(t){b.call(u,function(){var e;S?C.emit("rejectionHandled",t):(e=u.onrejectionhandled)&&e({promise:t,reason:t._v})})},N=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),M(t,!0))},D=function(e){var r,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw x("Promise can't be resolved itself");(r=R(e))?y(function(){var t={_w:n,_d:!1};try{r.call(e,c(D,t,1),c(N,t,1))}catch(e){N.call(t,e)}}):(n._v=e,n._s=1,M(n,!1))}catch(e){N.call({_w:n,_d:!1},e)}}};I||(j=function(e){p(this,j,w,"_h"),d(e),n.call(this);try{e(c(D,this,1),c(N,this,1))}catch(e){N.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r("./_redefine-all")(j.prototype,{then:function(e,t){var r=T(v(this,j));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=S?C.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&M(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),s=function(){var e=new n;this.promise=e,this.resolve=c(D,e,1),this.reject=c(N,e,1)},_.f=T=function(e){return e===j||e===o?new s(e):i(e)}),f(f.G+f.W+f.F*!I,{Promise:j}),r("./_set-to-string-tag")(j,w),r("./_set-species")(w),o=r("./_core")[w],f(f.S+f.F*!I,w,{reject:function(e){var t=T(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(a||!I),w,{resolve:function(e){return k(a&&this===o?j:this,e)}}),f(f.S+f.F*!(I&&r("./_iter-detect")(function(e){j.all(e).catch(E)})),w,{all:function(e){var o=this,t=T(o),a=t.resolve,u=t.reject,r=g(function(){var n=[],i=0,s=1;m(e,!1,function(e){var t=i++,r=!1;n.push(void 0),s++,o.resolve(e).then(function(e){r||(r=!0,n[t]=e,--s||a(n))},u)}),--s||a(n)});return r.e&&u(r.v),t.promise},race:function(e){var t=this,r=T(t),n=r.reject,i=g(function(){m(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return i.e&&n(i.v),r.promise}})},{"./_a-function":91,"./_an-instance":93,"./_classof":101,"./_core":106,"./_ctx":108,"./_export":114,"./_for-of":116,"./_global":117,"./_is-object":127,"./_iter-detect":131,"./_library":134,"./_microtask":136,"./_new-promise-capability":137,"./_perform":151,"./_promise-resolve":152,"./_redefine-all":154,"./_set-species":159,"./_set-to-string-tag":160,"./_species-constructor":163,"./_task":165,"./_wks":176}],194:[function(e,t,r){var n=e("./_export"),a=e("./_object-create"),u=e("./_a-function"),c=e("./_an-object"),l=e("./_is-object"),i=e("./_fails"),f=e("./_bind"),h=(e("./_global").Reflect||{}).construct,d=i(function(){function e(){}return!(h(function(){},[],e)instanceof e)}),p=!i(function(){h(function(){})});n(n.S+n.F*(d||p),"Reflect",{construct:function(e,t){u(e),c(t);var r=arguments.length<3?e:u(arguments[2]);if(p&&!d)return h(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return n.push.apply(n,t),new(f.apply(e,n))}var i=r.prototype,s=a(l(i)?i:Object.prototype),o=Function.apply.call(e,s,t);return l(o)?o:s}})},{"./_a-function":91,"./_an-object":94,"./_bind":100,"./_export":114,"./_fails":115,"./_global":117,"./_is-object":127,"./_object-create":139}],195:[function(e,t,r){"use strict";var n=e("./_collection-strong"),i=e("./_validate-collection");t.exports=e("./_collection")("Set",function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{add:function(e){return n.def(i(this,"Set"),e=0===e?0:e,e)}},n)},{"./_collection":105,"./_collection-strong":103,"./_validate-collection":173}],196:[function(e,t,r){"use strict";var n=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":130,"./_string-at":164}],197:[function(e,t,r){"use strict";var n=e("./_global"),o=e("./_has"),i=e("./_descriptors"),s=e("./_export"),a=e("./_redefine"),u=e("./_meta").KEY,c=e("./_fails"),l=e("./_shared"),f=e("./_set-to-string-tag"),h=e("./_uid"),d=e("./_wks"),p=e("./_wks-ext"),m=e("./_wks-define"),v=e("./_enum-keys"),b=e("./_is-array"),y=e("./_an-object"),_=e("./_is-object"),g=e("./_to-iobject"),k=e("./_to-primitive"),w=e("./_property-desc"),x=e("./_object-create"),C=e("./_object-gopn-ext"),j=e("./_object-gopd"),S=e("./_object-dp"),E=e("./_object-keys"),T=j.f,I=S.f,R=C.f,M=n.Symbol,P=n.JSON,A=P&&P.stringify,O="prototype",N=d("_hidden"),D=d("toPrimitive"),U={}.propertyIsEnumerable,L=l("symbol-registry"),F=l("symbols"),q=l("op-symbols"),B=Object[O],z="function"==typeof M,W=n.QObject,H=!W||!W[O]||!W[O].findChild,V=i&&c(function(){return 7!=x(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a})?function(e,t,r){var n=T(B,t);n&&delete B[t],I(e,t,r),n&&e!==B&&I(B,t,n)}:I,G=function(e){var t=F[e]=x(M[O]);return t._k=e,t},J=z&&"symbol"==typeof M.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof M},Q=function(e,t,r){return e===B&&Q(q,t,r),y(e),t=k(t,!0),y(r),o(F,t)?(r.enumerable?(o(e,N)&&e[N][t]&&(e[N][t]=!1),r=x(r,{enumerable:w(0,!1)})):(o(e,N)||I(e,N,w(1,{})),e[N][t]=!0),V(e,t,r)):I(e,t,r)},K=function(e,t){y(e);for(var r,n=v(t=g(t)),i=0,s=n.length;i<s;)Q(e,r=n[i++],t[r]);return e},$=function(e){var t=U.call(this,e=k(e,!0));return!(this===B&&o(F,e)&&!o(q,e))&&(!(t||!o(this,e)||!o(F,e)||o(this,N)&&this[N][e])||t)},X=function(e,t){if(e=g(e),t=k(t,!0),e!==B||!o(F,t)||o(q,t)){var r=T(e,t);return!r||!o(F,t)||o(e,N)&&e[N][t]||(r.enumerable=!0),r}},Y=function(e){for(var t,r=R(g(e)),n=[],i=0;r.length>i;)o(F,t=r[i++])||t==N||t==u||n.push(t);return n},Z=function(e){for(var t,r=e===B,n=R(r?q:g(e)),i=[],s=0;n.length>s;)!o(F,t=n[s++])||r&&!o(B,t)||i.push(F[t]);return i};z||(a((M=function(){if(this instanceof M)throw TypeError("Symbol is not a constructor!");var t=h(0<arguments.length?arguments[0]:void 0),r=function(e){this===B&&r.call(q,e),o(this,N)&&o(this[N],t)&&(this[N][t]=!1),V(this,t,w(1,e))};return i&&H&&V(B,t,{configurable:!0,set:r}),G(t)})[O],"toString",function(){return this._k}),j.f=X,S.f=Q,e("./_object-gopn").f=C.f=Y,e("./_object-pie").f=$,e("./_object-gops").f=Z,i&&!e("./_library")&&a(B,"propertyIsEnumerable",$,!0),p.f=function(e){return G(d(e))}),s(s.G+s.W+s.F*!z,{Symbol:M});for(var ee="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),te=0;ee.length>te;)d(ee[te++]);for(var re=E(d.store),ne=0;re.length>ne;)m(re[ne++]);s(s.S+s.F*!z,"Symbol",{for:function(e){return o(L,e+="")?L[e]:L[e]=M(e)},keyFor:function(e){if(!J(e))throw TypeError(e+" is not a symbol!");for(var t in L)if(L[t]===e)return t},useSetter:function(){H=!0},useSimple:function(){H=!1}}),s(s.S+s.F*!z,"Object",{create:function(e,t){return void 0===t?x(e):K(x(e),t)},defineProperty:Q,defineProperties:K,getOwnPropertyDescriptor:X,getOwnPropertyNames:Y,getOwnPropertySymbols:Z}),P&&s(s.S+s.F*(!z||c(function(){var e=M();return"[null]"!=A([e])||"{}"!=A({a:e})||"{}"!=A(Object(e))})),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(_(t)||void 0!==e)&&!J(e))return b(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!J(t))return t}),n[1]=t,A.apply(P,n)}}),M[O][D]||e("./_hide")(M[O],D,M[O].valueOf),f(M,"Symbol"),f(Math,"Math",!0),f(n.JSON,"JSON",!0)},{"./_an-object":94,"./_descriptors":110,"./_enum-keys":113,"./_export":114,"./_fails":115,"./_global":117,"./_has":118,"./_hide":119,"./_is-array":125,"./_is-object":127,"./_library":134,"./_meta":135,"./_object-create":139,"./_object-dp":140,"./_object-gopd":142,"./_object-gopn":144,"./_object-gopn-ext":143,"./_object-gops":145,"./_object-keys":148,"./_object-pie":149,"./_property-desc":153,"./_redefine":155,"./_set-to-string-tag":160,"./_shared":162,"./_to-iobject":168,"./_to-primitive":171,"./_uid":172,"./_wks":176,"./_wks-define":174,"./_wks-ext":175}],198:[function(e,t,r){e("./_set-collection-from")("Map")},{"./_set-collection-from":156}],199:[function(e,t,r){e("./_set-collection-of")("Map")},{"./_set-collection-of":157}],200:[function(e,t,r){var n=e("./_export");n(n.P+n.R,"Map",{toJSON:e("./_collection-to-json")("Map")})},{"./_collection-to-json":104,"./_export":114}],201:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_core"),s=e("./_global"),o=e("./_species-constructor"),a=e("./_promise-resolve");n(n.P+n.R,"Promise",{finally:function(t){var r=o(this,i.Promise||s.Promise),e="function"==typeof t;return this.then(e?function(e){return a(r,t()).then(function(){return e})}:t,e?function(e){return a(r,t()).then(function(){throw e})}:t)}})},{"./_core":106,"./_export":114,"./_global":117,"./_promise-resolve":152,"./_species-constructor":163}],202:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_new-promise-capability"),s=e("./_perform");n(n.S,"Promise",{try:function(e){var t=i.f(this),r=s(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},{"./_export":114,"./_new-promise-capability":137,"./_perform":151}],203:[function(e,t,r){e("./_set-collection-from")("Set")},{"./_set-collection-from":156}],204:[function(e,t,r){e("./_set-collection-of")("Set")},{"./_set-collection-of":157}],205:[function(e,t,r){var n=e("./_export");n(n.P+n.R,"Set",{toJSON:e("./_collection-to-json")("Set")})},{"./_collection-to-json":104,"./_export":114}],206:[function(e,t,r){e("./_wks-define")("asyncIterator")},{"./_wks-define":174}],207:[function(e,t,r){e("./_wks-define")("observable")},{"./_wks-define":174}],208:[function(e,t,r){e("./es6.array.iterator");for(var n=e("./_global"),i=e("./_hide"),s=e("./_iterators"),o=e("./_wks")("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<a.length;u++){var c=a[u],l=n[c],f=l&&l.prototype;f&&!f[o]&&i(f,o,c),s[c]=s.Array}},{"./_global":117,"./_hide":119,"./_iterators":133,"./_wks":176,"./es6.array.iterator":181}],209:[function(e,t,r){r.UINT32=e("./lib/uint32"),r.UINT64=e("./lib/uint64")},{"./lib/uint32":210,"./lib/uint64":211}],210:[function(e,t,r){!function(e){n(Math.pow(36,5)),n(Math.pow(16,7)),n(Math.pow(10,9)),n(Math.pow(2,30)),n(36),n(16),n(10),n(2);function n(e,t){return this instanceof n?(this._low=0,this._high=0,this.remainder=null,void 0===t?i.call(this,e):"string"==typeof e?s.call(this,e,t):void r.call(this,e,t)):new n(e,t)}function r(e,t){return this._low=0|e,this._high=0|t,this}function i(e){return this._low=65535&e,this._high=e>>>16,this}function s(e,t){var r=parseInt(e,t||10);return this._low=65535&r,this._high=r>>>16,this}n.prototype.fromBits=r,n.prototype.fromNumber=i,n.prototype.fromString=s,n.prototype.toNumber=function(){return 65536*this._high+this._low},n.prototype.toString=function(e){return this.toNumber().toString(e||10)},n.prototype.add=function(e){var t=this._low+e._low,r=t>>>16;return r+=this._high+e._high,this._low=65535&t,this._high=65535&r,this},n.prototype.subtract=function(e){return this.add(e.clone().negate())},n.prototype.multiply=function(e){var t,r,n=this._high,i=this._low,s=e._high,o=e._low;return t=(r=i*o)>>>16,t+=n*o,t&=65535,t+=i*s,this._low=65535&r,this._high=65535&t,this},n.prototype.div=function(e){if(0==e._low&&0==e._high)throw Error("division by zero");if(0==e._high&&1==e._low)return this.remainder=new n(0),this;if(e.gt(this))return this.remainder=this.clone(),this._low=0,this._high=0,this;if(this.eq(e))return this.remainder=new n(0),this._low=1,this._high=0,this;for(var t=e.clone(),r=-1;!this.lt(t);)t.shiftLeft(1,!0),r++;for(this.remainder=this.clone(),this._low=0,this._high=0;0<=r;r--)t.shiftRight(1),this.remainder.lt(t)||(this.remainder.subtract(t),16<=r?this._high|=1<<r-16:this._low|=1<<r);return this},n.prototype.negate=function(){var e=1+(65535&~this._low);return this._low=65535&e,this._high=~this._high+(e>>>16)&65535,this},n.prototype.equals=n.prototype.eq=function(e){return this._low==e._low&&this._high==e._high},n.prototype.greaterThan=n.prototype.gt=function(e){return this._high>e._high||!(this._high<e._high)&&this._low>e._low},n.prototype.lessThan=n.prototype.lt=function(e){return this._high<e._high||!(this._high>e._high)&&this._low<e._low},n.prototype.or=function(e){return this._low|=e._low,this._high|=e._high,this},n.prototype.and=function(e){return this._low&=e._low,this._high&=e._high,this},n.prototype.not=function(){return this._low=65535&~this._low,this._high=65535&~this._high,this},n.prototype.xor=function(e){return this._low^=e._low,this._high^=e._high,this},n.prototype.shiftRight=n.prototype.shiftr=function(e){return 16<e?(this._low=this._high>>e-16,this._high=0):16==e?(this._low=this._high,this._high=0):(this._low=this._low>>e|this._high<<16-e&65535,this._high>>=e),this},n.prototype.shiftLeft=n.prototype.shiftl=function(e,t){return 16<e?(this._high=this._low<<e-16,this._low=0,t||(this._high&=65535)):16==e?(this._high=this._low,this._low=0):(this._high=this._high<<e|this._low>>16-e,this._low=this._low<<e&65535,t||(this._high&=65535)),this},n.prototype.rotateLeft=n.prototype.rotl=function(e){var t=this._high<<16|this._low;return t=t<<e|t>>>32-e,this._low=65535&t,this._high=t>>>16,this},n.prototype.rotateRight=n.prototype.rotr=function(e){var t=this._high<<16|this._low;return t=t>>>e|t<<32-e,this._low=65535&t,this._high=t>>>16,this},n.prototype.clone=function(){return new n(this._low,this._high)},void 0!==d&&d.amd?d([],function(){return n}):void 0!==t&&t.exports?t.exports=n:e.UINT32=n}(this)},{}],211:[function(e,t,r){!function(e){var a={16:u(Math.pow(16,5)),10:u(Math.pow(10,5)),2:u(Math.pow(2,5))},s={16:u(16),10:u(10),2:u(2)};function u(e,t,r,n){return this instanceof u?(this.remainder=null,"string"==typeof e?c.call(this,e,t):void 0===t?o.call(this,e):void i.apply(this,arguments)):new u(e,t,r,n)}function i(e,t,r,n){return void 0===r?(this._a00=65535&e,this._a16=e>>>16,this._a32=65535&t,this._a48=t>>>16):(this._a00=0|e,this._a16=0|t,this._a32=0|r,this._a48=0|n),this}function o(e){return this._a00=65535&e,this._a16=e>>>16,this._a32=0,this._a48=0,this}function c(e,t){t=t||10,this._a00=0,this._a16=0,this._a32=0,this._a48=0;for(var r=a[t]||new u(Math.pow(t,5)),n=0,i=e.length;n<i;n+=5){var s=Math.min(5,i-n),o=parseInt(e.slice(n,n+s),t);this.multiply(s<5?new u(Math.pow(t,s)):r).add(new u(o))}return this}u.prototype.fromBits=i,u.prototype.fromNumber=o,u.prototype.fromString=c,u.prototype.toNumber=function(){return 65536*this._a16+this._a00},u.prototype.toString=function(e){var t=s[e=e||10]||new u(e);if(!this.gt(t))return this.toNumber().toString(e);for(var r=this.clone(),n=new Array(64),i=63;0<=i&&(r.div(t),n[i]=r.remainder.toNumber().toString(e),r.gt(t));i--);return n[i-1]=r.toNumber().toString(e),n.join("")},u.prototype.add=function(e){var t=this._a00+e._a00,r=t>>>16,n=(r+=this._a16+e._a16)>>>16,i=(n+=this._a32+e._a32)>>>16;return i+=this._a48+e._a48,this._a00=65535&t,this._a16=65535&r,this._a32=65535&n,this._a48=65535&i,this},u.prototype.subtract=function(e){return this.add(e.clone().negate())},u.prototype.multiply=function(e){var t=this._a00,r=this._a16,n=this._a32,i=this._a48,s=e._a00,o=e._a16,a=e._a32,u=t*s,c=u>>>16,l=(c+=t*o)>>>16;c&=65535,l+=(c+=r*s)>>>16;var f=(l+=t*a)>>>16;return l&=65535,f+=(l+=r*o)>>>16,l&=65535,f+=(l+=n*s)>>>16,f+=t*e._a48,f&=65535,f+=r*a,f&=65535,f+=n*o,f&=65535,f+=i*s,this._a00=65535&u,this._a16=65535&c,this._a32=65535&l,this._a48=65535&f,this},u.prototype.div=function(e){if(0==e._a16&&0==e._a32&&0==e._a48){if(0==e._a00)throw Error("division by zero");if(1==e._a00)return this.remainder=new u(0),this}if(e.gt(this))return this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0,this;if(this.eq(e))return this.remainder=new u(0),this._a00=1,this._a16=0,this._a32=0,this._a48=0,this;for(var t=e.clone(),r=-1;!this.lt(t);)t.shiftLeft(1,!0),r++;for(this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0;0<=r;r--)t.shiftRight(1),this.remainder.lt(t)||(this.remainder.subtract(t),48<=r?this._a48|=1<<r-48:32<=r?this._a32|=1<<r-32:16<=r?this._a16|=1<<r-16:this._a00|=1<<r);return this},u.prototype.negate=function(){var e=1+(65535&~this._a00);return this._a00=65535&e,e=(65535&~this._a16)+(e>>>16),this._a16=65535&e,e=(65535&~this._a32)+(e>>>16),this._a32=65535&e,this._a48=~this._a48+(e>>>16)&65535,this},u.prototype.equals=u.prototype.eq=function(e){return this._a48==e._a48&&this._a00==e._a00&&this._a32==e._a32&&this._a16==e._a16},u.prototype.greaterThan=u.prototype.gt=function(e){return this._a48>e._a48||!(this._a48<e._a48)&&(this._a32>e._a32||!(this._a32<e._a32)&&(this._a16>e._a16||!(this._a16<e._a16)&&this._a00>e._a00))},u.prototype.lessThan=u.prototype.lt=function(e){return this._a48<e._a48||!(this._a48>e._a48)&&(this._a32<e._a32||!(this._a32>e._a32)&&(this._a16<e._a16||!(this._a16>e._a16)&&this._a00<e._a00))},u.prototype.or=function(e){return this._a00|=e._a00,this._a16|=e._a16,this._a32|=e._a32,this._a48|=e._a48,this},u.prototype.and=function(e){return this._a00&=e._a00,this._a16&=e._a16,this._a32&=e._a32,this._a48&=e._a48,this},u.prototype.xor=function(e){return this._a00^=e._a00,this._a16^=e._a16,this._a32^=e._a32,this._a48^=e._a48,this},u.prototype.not=function(){return this._a00=65535&~this._a00,this._a16=65535&~this._a16,this._a32=65535&~this._a32,this._a48=65535&~this._a48,this},u.prototype.shiftRight=u.prototype.shiftr=function(e){return 48<=(e%=64)?(this._a00=this._a48>>e-48,this._a16=0,this._a32=0,this._a48=0):32<=e?(e-=32,this._a00=65535&(this._a32>>e|this._a48<<16-e),this._a16=this._a48>>e&65535,this._a32=0,this._a48=0):16<=e?(e-=16,this._a00=65535&(this._a16>>e|this._a32<<16-e),this._a16=65535&(this._a32>>e|this._a48<<16-e),this._a32=this._a48>>e&65535,this._a48=0):(this._a00=65535&(this._a00>>e|this._a16<<16-e),this._a16=65535&(this._a16>>e|this._a32<<16-e),this._a32=65535&(this._a32>>e|this._a48<<16-e),this._a48=this._a48>>e&65535),this},u.prototype.shiftLeft=u.prototype.shiftl=function(e,t){return 48<=(e%=64)?(this._a48=this._a00<<e-48,this._a32=0,this._a16=0,this._a00=0):32<=e?(e-=32,this._a48=this._a16<<e|this._a00>>16-e,this._a32=this._a00<<e&65535,this._a16=0,this._a00=0):16<=e?(e-=16,this._a48=this._a32<<e|this._a16>>16-e,this._a32=65535&(this._a16<<e|this._a00>>16-e),this._a16=this._a00<<e&65535,this._a00=0):(this._a48=this._a48<<e|this._a32>>16-e,this._a32=65535&(this._a32<<e|this._a16>>16-e),this._a16=65535&(this._a16<<e|this._a00>>16-e),this._a00=this._a00<<e&65535),t||(this._a48&=65535),this},u.prototype.rotateLeft=u.prototype.rotl=function(e){if(0==(e%=64))return this;if(32<=e){var t=this._a00;if(this._a00=this._a32,this._a32=t,t=this._a48,this._a48=this._a16,this._a16=t,32==e)return this;e-=32}var r=this._a48<<16|this._a32,n=this._a16<<16|this._a00,i=r<<e|n>>>32-e,s=n<<e|r>>>32-e;return this._a00=65535&s,this._a16=s>>>16,this._a32=65535&i,this._a48=i>>>16,this},u.prototype.rotateRight=u.prototype.rotr=function(e){if(0==(e%=64))return this;if(32<=e){var t=this._a00;if(this._a00=this._a32,this._a32=t,t=this._a48,this._a48=this._a16,this._a16=t,32==e)return this;e-=32}var r=this._a48<<16|this._a32,n=this._a16<<16|this._a00,i=r>>>e|n<<32-e,s=n>>>e|r<<32-e;return this._a00=65535&s,this._a16=s>>>16,this._a32=65535&i,this._a48=i>>>16,this},u.prototype.clone=function(){return new u(this._a00,this._a16,this._a32,this._a48)},void 0!==d&&d.amd?d([],function(){return u}):void 0!==t&&t.exports?t.exports=u:e.UINT64=u}(this)},{}],212:[function(e,t,r){t.exports=e("./lib")},{"./lib":213}],213:[function(e,t,r){var n=/^PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?$/;function i(e){return void 0===e?0:parseInt(e,10)}r.fromSeconds=function(e){if("number"!=typeof e)throw new TypeError("Argument `seconds` must be a number");var t=e%60,r=(e-t)%3600;return{hours:(e-t-r)/3600,minutes:r/60,seconds:t}},r.fromString=function(e){if("string"!=typeof e)throw new TypeError("Argument `string` must be a string");var t=e.match(n);if(null===t||void 0===t[1]&&void 0===t[2]&&void 0===t[3])throw new Error('Could not parse "'+e+'" as a duration.');return{hours:i(t[1]),minutes:i(t[2]),seconds:i(t[3])}},r.toString=function(e){"number"==typeof e&&(e=r.fromSeconds(e));var t="PT";return 0<e.hours&&(t+=e.hours+"H"),0<e.minutes&&(t+=e.minutes+"M"),0<e.seconds&&(t+=e.seconds+"S"),"PT"===t&&(t+="0S"),t},r.toSeconds=function(e){var t=e;return"string"==typeof e&&(t=r.fromString(e)),3600*t.hours+60*t.minutes+t.seconds}},{}],214:[function(e,t,r){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function u(e){return"function"==typeof e}function c(e){return"object"==typeof e&&null!==e}function l(e){return void 0===e}((t.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,i,s,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||c(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var a=new Error('Uncaught, unspecified "error" event. ('+t+")");throw a.context=t,a}if(l(r=this._events[e]))return!1;if(u(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),r.apply(this,i)}else if(c(r))for(i=Array.prototype.slice.call(arguments,1),n=(o=r.slice()).length,s=0;s<n;s++)o[s].apply(this,i);return!0},n.prototype.on=n.prototype.addListener=function(e,t){var r;if(!u(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,u(t.listener)?t.listener:t),this._events[e]?c(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,c(this._events[e])&&!this._events[e].warned&&(r=l(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(e,t){if(!u(t))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var r,n,i,s;if(!u(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=(r=this._events[e]).length,n=-1,r===t||u(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(c(r)){for(s=i;0<s--;)if(r[s]===t||r[s].listener&&r[s].listener===t){n=s;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(u(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?u(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(u(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],215:[function(e,t,r){r.read=function(e,t,r,n,i){var s,o,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,f=r?i-1:0,h=r?-1:1,d=e[t+f];for(f+=h,s=d&(1<<-l)-1,d>>=-l,l+=a;0<l;s=256*s+e[t+f],f+=h,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=n;0<l;o=256*o+e[t+f],f+=h,l-=8);if(0===s)s=1-c;else{if(s===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),s-=c}return(d?-1:1)*o*Math.pow(2,s-n)},r.write=function(e,t,r,n,i,s){var o,a,u,c=8*s-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),2<=(t+=1<=o+f?h/u:h*Math.pow(2,1-f))*u&&(o++,u/=2),l<=o+f?(a=0,o=l):1<=o+f?(a=(t*u-1)*Math.pow(2,i),o+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));8<=i;e[r+d]=255&a,d+=p,a/=256,i-=8);for(o=o<<i|a,c+=i;0<c;e[r+d]=255&o,d+=p,o/=256,c-=8);e[r+d-p]|=128*m}},{}],216:[function(e,t,r){t.exports=window.FormData},{}],217:[function(e,t,r){
/*

  Javascript State Machine Library - https://github.com/jakesgordon/javascript-state-machine

  Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors
  Released under the MIT license - https://github.com/jakesgordon/javascript-state-machine/blob/master/LICENSE

*/var h;h={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(e,t){var r="string"==typeof e.initial?{state:e.initial}:e.initial,n=e.terminal||e.final,i=t||e.target||{},s=e.events||[],o=e.callbacks||{},a={},u={},c=function(e){var t=Array.isArray(e.from)?e.from:e.from?[e.from]:[h.WILDCARD];a[e.name]=a[e.name]||{};for(var r=0;r<t.length;r++)u[t[r]]=u[t[r]]||[],u[t[r]].push(e.name),a[e.name][t[r]]=e.to||t[r];e.to&&(u[e.to]=u[e.to]||[])};r&&(r.event=r.event||"startup",c({name:r.event,from:"none",to:r.state}));for(var l=0;l<s.length;l++)c(s[l]);for(var f in a)a.hasOwnProperty(f)&&(i[f]=h.buildEvent(f,a[f]));for(var f in o)o.hasOwnProperty(f)&&(i[f]=o[f]);return i.current="none",i.is=function(e){return Array.isArray(e)?0<=e.indexOf(this.current):this.current===e},i.can=function(e){return!this.transition&&void 0!==a[e]&&(a[e].hasOwnProperty(this.current)||a[e].hasOwnProperty(h.WILDCARD))},i.cannot=function(e){return!this.can(e)},i.transitions=function(){return(u[this.current]||[]).concat(u[h.WILDCARD]||[])},i.isFinished=function(){return this.is(n)},i.error=e.error||function(e,t,r,n,i,s,o){throw o||s},i.states=function(){return Object.keys(u).sort()},r&&!r.defer&&i[r.event](),i},doCallback:function(t,e,r,n,i,s){if(e)try{return e.apply(t,[r,n,i].concat(s))}catch(e){return t.error(r,n,i,s,h.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",e)}},beforeAnyEvent:function(e,t,r,n,i){return h.doCallback(e,e.onbeforeevent,t,r,n,i)},afterAnyEvent:function(e,t,r,n,i){return h.doCallback(e,e.onafterevent||e.onevent,t,r,n,i)},leaveAnyState:function(e,t,r,n,i){return h.doCallback(e,e.onleavestate,t,r,n,i)},enterAnyState:function(e,t,r,n,i){return h.doCallback(e,e.onenterstate||e.onstate,t,r,n,i)},changeState:function(e,t,r,n,i){return h.doCallback(e,e.onchangestate,t,r,n,i)},beforeThisEvent:function(e,t,r,n,i){return h.doCallback(e,e["onbefore"+t],t,r,n,i)},afterThisEvent:function(e,t,r,n,i){return h.doCallback(e,e["onafter"+t]||e["on"+t],t,r,n,i)},leaveThisState:function(e,t,r,n,i){return h.doCallback(e,e["onleave"+r],t,r,n,i)},enterThisState:function(e,t,r,n,i){return h.doCallback(e,e["onenter"+n]||e["on"+n],t,r,n,i)},beforeEvent:function(e,t,r,n,i){if(!1===h.beforeThisEvent(e,t,r,n,i)||!1===h.beforeAnyEvent(e,t,r,n,i))return!1},afterEvent:function(e,t,r,n,i){h.afterThisEvent(e,t,r,n,i),h.afterAnyEvent(e,t,r,n,i)},leaveState:function(e,t,r,n,i){var s=h.leaveThisState(e,t,r,n,i),o=h.leaveAnyState(e,t,r,n,i);return!1!==s&&!1!==o&&(h.ASYNC===s||h.ASYNC===o?h.ASYNC:void 0)},enterState:function(e,t,r,n,i){h.enterThisState(e,t,r,n,i),h.enterAnyState(e,t,r,n,i)},buildEvent:function(s,o){return function(){var e=this.current,t=o[e]||(o[h.WILDCARD]!=h.WILDCARD?o[h.WILDCARD]:e)||e,r=Array.prototype.slice.call(arguments);if(this.transition)return this.error(s,e,t,r,h.Error.PENDING_TRANSITION,"event "+s+" inappropriate because previous transition did not complete");if(this.cannot(s))return this.error(s,e,t,r,h.Error.INVALID_TRANSITION,"event "+s+" inappropriate in current state "+this.current);if(!1===h.beforeEvent(this,s,e,t,r))return h.Result.CANCELLED;if(e===t)return h.afterEvent(this,s,e,t,r),h.Result.NOTRANSITION;var n=this;this.transition=function(){return n.transition=null,n.current=t,h.enterState(n,s,e,t,r),h.changeState(n,s,e,t,r),h.afterEvent(n,s,e,t,r),h.Result.SUCCEEDED},this.transition.cancel=function(){n.transition=null,h.afterEvent(n,s,e,t,r)};var i=h.leaveState(this,s,e,t,r);return!1===i?(this.transition=null,h.Result.CANCELLED):h.ASYNC===i?h.Result.PENDING:this.transition?this.transition():void 0}}},void 0!==r?(void 0!==t&&t.exports&&(r=t.exports=h),r.StateMachine=h):"function"==typeof d&&d.amd?d(function(e){return h}):"undefined"!=typeof window?window.StateMachine=h:"undefined"!=typeof self&&(self.StateMachine=h)},{}],218:[function(e,t,r){"use strict";var a=o(e("babel-runtime/regenerator")),u=o(e("babel-runtime/core-js/get-iterator")),n=o(e("babel-runtime/core-js/symbol/iterator")),i=o(e("babel-runtime/helpers/classCallCheck")),s=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function r(e,t){(0,i.default)(this,r),this.balanceFactor=0,this.key=e,this.value=t,this.parent=null,this.left=null,this.right=null}return(0,s.default)(r,[{key:"update",value:function(e){this.value=e}},{key:"replace",value:function(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}},{key:"isRoot",get:function(){return null===this.parent}},{key:"isLeaf",get:function(){return null===this.left&&null===this.right}},{key:"isLeftChild",get:function(){return this.parent.left===this}}]),r}(),l=function(){function r(e,t){(0,i.default)(this,r),this.isLessThan=e||function(e,t){return e<t},this.isEqual=t||function(e,t){return e===t},this.root=null,this.count=null}return(0,s.default)(r,[{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(e,t){var r=this.getNode(e);r?r.update(t):this.insert(e,t)}},{key:"insert",value:function(e,t){var r=new c(e,t);if(this.count++,this.root){for(var n=this.root;;)if(this.isLessThan(e,n.key)){if(!n.left){n.left=r;break}n=n.left}else{if(!n.right){n.right=r;break}n=n.right}for(r.parent=n,n=r;n.parent;){var i=n.parent,s=i.balanceFactor;if(n.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(s))break;if(i.balanceFactor<-1||1<i.balanceFactor){this.rebalance(i);break}n=i}}else this.root=r}},{key:"get",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"delete",value:function(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var r=t.parent,n=t.left,i=t.right;if(!!n!=!!i){var s=n||i;r||s?r&&!s?this.root=s:(r.replace(t,null),this.rebalance(r)):this.root=null}else{for(var o=t.left;o.right;)o=o.right;if(t.left===o)t.isRoot?(this.root=o).parent=null:(t.isLeftChild?t.parent.left=o:t.parent.right=o,o.parent=t.parent),o.right=t.right,(o.right.parent=o).balanceFactor=t.balanceFactor,t={parent:o,isLeftChild:!0};else{var a=o.parent,u=o.left;(a.right=u)&&(u.parent=a),t.isRoot?(this.root=o).parent=null:(t.isLeftChild?t.parent.left=o:t.parent.right=o,o.parent=t.parent),o.right=t.right,(o.right.parent=o).left=t.left,(o.left.parent=o).balanceFactor=t.balanceFactor,t={parent:a,isLeftChild:!1}}}for(this.count--;t.parent;){var c=t.parent,l=c.balanceFactor;if(t.isLeftChild?c.balanceFactor-=1:c.balanceFactor+=1,Math.abs(c.balanceFactor)>Math.abs(l)){if(!(c.balanceFactor<-1||1<c.balanceFactor))break;if(this.rebalance(c),0!==c.parent.balanceFactor)break;t=c.parent}else t=c}return null}},{key:"getNode",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"rebalance",value:function(e){e.balanceFactor<0?(0<e.right.balanceFactor&&this.rotateRight(e.right),this.rotateLeft(e)):0<e.balanceFactor&&(e.left.balanceFactor<0&&this.rotateLeft(e.left),this.rotateRight(e))}},{key:"rotateLeft",value:function(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,(t.left=e).parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}},{key:"rotateRight",value:function(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,(t.right=e).parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}},{key:n.default,value:a.default.mark(function e(){var t,r,n,i,s,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,r=!1,n=void 0,e.prev=3,i=(0,u.default)(this.getIterator());case 5:if(t=(s=i.next()).done){e.next=12;break}return o=s.value,e.next=9,o;case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,n=e.t0;case 18:e.prev=18,e.prev=19,!t&&i.return&&i.return();case 21:if(e.prev=21,!r){e.next=24;break}throw n;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])})},{key:"getIterator",value:a.default.mark(function e(){var t,r,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.root;case 1:if(!t){e.next=7;break}if(!this.isEqual(n,t.key)&&(null!==n||t.left)){e.next=4;break}return e.abrupt("break",7);case 4:t=this.isLessThan(n,t.key)||null===n?t.left:t.right,e.next=1;break;case 7:if(t){e.next=9;break}return e.abrupt("return",null);case 9:r=!0;case 10:if(!r){e.next=28;break}return e.next=13,[t.key,t.value];case 13:if(r=!1,!t.right){e.next=20;break}for(t=t.right;t.left;)t=t.left;r=!0,e.next=26;break;case 20:if(!t.parent){e.next=25;break}r=t.parent.left===t,t=t.parent,e.next=26;break;case 25:return e.abrupt("break",36);case 26:e.next=34;break;case 28:if(!t.parent){e.next=33;break}r=t.parent.left===t,t=t.parent,e.next=34;break;case 33:return e.abrupt("break",36);case 34:e.next=10;break;case 36:return e.abrupt("return",null);case 37:case"end":return e.stop()}},e,this)})},{key:"getReverseIterator",value:a.default.mark(function e(){var t,r,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.root;case 1:if(!t){e.next=7;break}if(!this.isEqual(n,t.key)&&(null!==n||t.right)){e.next=4;break}return e.abrupt("break",7);case 4:t=this.isLessThan(n,t.key)&&null!==n?t.left:t.right,e.next=1;break;case 7:if(t){e.next=9;break}return e.abrupt("return",null);case 9:r=!0;case 10:if(!r){e.next=28;break}return e.next=13,[t.key,t.value];case 13:if(r=!1,!t.left){e.next=20;break}for(t=t.left;t.right;)t=t.right;r=!0,e.next=26;break;case 20:if(!t.parent){e.next=25;break}r=t.parent.right===t,t=t.parent,e.next=26;break;case 25:return e.abrupt("break",36);case 26:e.next=34;break;case 28:if(!t.parent){e.next=33;break}r=t.parent.right===t,t=t.parent,e.next=34;break;case 33:return e.abrupt("break",36);case 34:e.next=10;break;case 36:return e.abrupt("return",null);case 37:case"end":return e.stop()}},e,this)})},{key:"size",get:function(){return this.count}}]),r}();r.TreeMap=l},{"babel-runtime/core-js/get-iterator":32,"babel-runtime/core-js/symbol/iterator":49,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":57}],219:[function(e,r,t){
/*
* loglevel - https://github.com/pimterry/loglevel
*
* Copyright (c) 2013 Tim Perry
* Licensed under the MIT license.
*/
!function(e,t){"use strict";"function"==typeof d&&d.amd?d(t):"object"==typeof r&&r.exports?r.exports=t():e.log=t()}(this,function(){"use strict";var i=function(){},u="undefined",c=["trace","debug","info","warn","error"];function s(t,e){var r=t[e];if("function"==typeof r.bind)return r.bind(t);try{return Function.prototype.bind.call(r,t)}catch(e){return function(){return Function.prototype.apply.apply(r,[t,arguments])}}}function l(e,t){for(var r=0;r<c.length;r++){var n=c[r];this[n]=r<e?i:this.methodFactory(n,e,t)}this.log=this.debug}function f(e,t,r){return"debug"===(n=e)&&(n="log"),typeof console!==u&&(void 0!==console[n]?s(console,n):void 0!==console.log?s(console,"log"):i)||function(e,t,r){return function(){typeof console!==u&&(l.call(this,t,r),this[e].apply(this,arguments))}}.apply(this,arguments);var n}function r(r,e,t){var n,i=this,s="loglevel";function o(){var e;if(typeof window!==u){try{e=window.localStorage[s]}catch(e){}if(typeof e===u)try{var t=window.document.cookie,r=t.indexOf(encodeURIComponent(s)+"=");-1!==r&&(e=/^([^;]+)/.exec(t.slice(r))[1])}catch(e){}return void 0===i.levels[e]&&(e=void 0),e}}r&&(s+=":"+r),i.name=r,i.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},i.methodFactory=t||f,i.getLevel=function(){return n},i.setLevel=function(e,t){if("string"==typeof e&&void 0!==i.levels[e.toUpperCase()]&&(e=i.levels[e.toUpperCase()]),!("number"==typeof e&&0<=e&&e<=i.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;if(n=e,!1!==t&&function(e){var t=(c[e]||"silent").toUpperCase();if(typeof window!==u){try{return window.localStorage[s]=t}catch(e){}try{window.document.cookie=encodeURIComponent(s)+"="+t+";"}catch(e){}}}(e),l.call(i,e,r),typeof console===u&&e<i.levels.SILENT)return"No console available for logging"},i.setDefaultLevel=function(e){o()||i.setLevel(e,!1)},i.enableAll=function(e){i.setLevel(i.levels.TRACE,e)},i.disableAll=function(e){i.setLevel(i.levels.SILENT,e)};var a=o();null==a&&(a=null==e?"WARN":e),i.setLevel(a,!1)}var n=new r,o={};n.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=o[e];return t||(t=o[e]=new r(e,n.getLevel(),n.methodFactory)),t};var e=typeof window!==u?window.log:void 0;return n.noConflict=function(){return typeof window!==u&&window.log===n&&(window.log=e),n},n.getLoggers=function(){return o},n})},{}],220:[function(e,t,r){"use strict";var n=o(e("babel-runtime/core-js/promise")),i=o(e("babel-runtime/core-js/object/create")),s=o(e("babel-runtime/core-js/object/set-prototype-of"));function o(e){return e&&e.__esModule?e:{default:e}}var a,u=(a=s.default||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?(0,i.default)(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var c=function(r){function e(e){var t=r.call(this)||this;return t.minDelay=e.min,t.maxDelay=e.max,t.initialDelay=e.initial||0,t.maxAttemptsCount=e.maxAttemptsCount||0,t.maxAttemptsTime=e.maxAttemptsTime||0,t.randomness=e.randomness||0,t.inProgress=!1,t.attemptNum=0,t.prevDelay=0,t.currDelay=0,t}return u(e,r),e.prototype.attempt=function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)},e.prototype.nextDelay=function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;var t=this.currDelay+this.prevDelay;return this.prevDelay=this.currDelay,this.currDelay=t},e.prototype.randomize=function(e){var t=e*this.randomness,r=Math.round(Math.random()*t*2-t);return Math.max(0,e+r)},e.prototype.scheduleAttempt=function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var r=this.nextDelay(e);r=this.randomize(r),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+r&&(this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),this.reject(new Error("Maximum attempt time limit reached"))),this.timeout=setTimeout(function(){return t.attempt()},r)},e.prototype.cleanup=function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0},e.prototype.start=function(){var r=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new n.default(function(e,t){r.resolve=e,r.reject=t,r.startTimestamp=Date.now(),r.scheduleAttempt(r.initialDelay)})},e.prototype.cancel=function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))},e.prototype.succeeded=function(e){this.emit("succeeded",e),this.resolve(e)},e.prototype.failed=function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)},e.prototype.run=function(e){var t=this;return this.on("attempt",function(){e().then(function(e){return t.succeeded(e)}).catch(function(e){return t.failed(e)})}),this.start()},e}(e("events").EventEmitter);r.Retrier=c,r.default=c},{"babel-runtime/core-js/object/create":38,"babel-runtime/core-js/object/set-prototype-of":44,"babel-runtime/core-js/promise":45,events:214}],221:[function(e,l,f){(function(c){(function(){"use strict";var e={function:!0,object:!0},D=e[typeof window]&&window||this,r=e[typeof f]&&f,t=e[typeof l]&&l&&!l.nodeType&&l,n=r&&t&&"object"==typeof c&&c;!n||n.global!==n&&n.window!==n&&n.self!==n||(D=n);var s=Math.pow(2,53)-1,U=/\bOpera/,i=Object.prototype,o=i.hasOwnProperty,L=i.toString;function a(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function F(e){return e=H(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:a(e)}function q(e,t){for(var r in e)o.call(e,r)&&t(e[r],r,e)}function B(e){return null==e?a(e):L.call(e).slice(8,-1)}function z(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function W(r,n){var i=null;return function(e,t){var r=-1,n=e?e.length:0;if("number"==typeof n&&-1<n&&n<=s)for(;++r<n;)t(e[r],r,e);else q(e,t)}(r,function(e,t){i=n(i,e,t,r)}),i}function H(e){return String(e).replace(/^ +| +$/g,"")}var u=function e(a){var t=D,r=a&&"object"==typeof a&&"String"!=B(a);r&&(t=a,a=null);var n=t.navigator||{},i=n.userAgent||"";a||(a=i);var s,o,u,c,l,f=r?!!n.likeChrome:/\bChrome\b/.test(a)&&!/internal|\n/i.test(L.toString()),h="Object",d=r?h:"ScriptBridgingProxyObject",p=r?h:"Environment",m=r&&t.java?"JavaPackage":B(t.java),v=r?h:"RuntimeObject",b=/\bJava/.test(m)&&t.java,y=b&&B(t.environment)==p,_=b?"a":"\u03b1",g=b?"b":"\u03b2",k=t.document||{},w=t.operamini||t.opera,x=U.test(x=r&&w?w["[[Class]]"]:B(w))?x:w=null,C=a,j=[],S=null,E=a==i,T=E&&w&&"function"==typeof w.version&&w.version(),I=W([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],function(e,t){return e||RegExp("\\b"+(t.pattern||z(t))+"\\b","i").exec(a)&&(t.label||t)}),R=W(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"],function(e,t){return e||RegExp("\\b"+(t.pattern||z(t))+"\\b","i").exec(a)&&(t.label||t)}),M=O([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),P=W({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}},function(e,t,r){return e||(t[M]||t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(M)]||RegExp("\\b"+z(r)+"(?:\\b|\\w*\\d)","i").exec(a))&&r}),A=W(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],function(e,t){var r,n,i,s,o=t.pattern||z(t);return!e&&(e=RegExp("\\b"+o+"(?:/[\\d.]+|[ \\w.]*)","i").exec(a))&&(r=e,n=o,i=t.label||t,s={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"},n&&i&&/^Win/i.test(r)&&!/^Windows Phone /i.test(r)&&(s=s[/[\d.]+$/.exec(r)])&&(r="Windows "+s),r=String(r),n&&i&&(r=r.replace(RegExp(n,"i"),i)),e=r=F(r.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])),e});function O(e){return W(e,function(e,t){var r=t.pattern||z(t);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(a)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(a)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(a))&&((e=String(t.label&&!RegExp(r,"i").test(t.label)?t.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),t=t.label||t,e=F(e[0].replace(RegExp(r,"i"),t).replace(RegExp("; *(?:"+t+"[_-])?","i")," ").replace(RegExp("("+t+")[-_.]?(\\w)","i"),"$1 $2"))),e})}if(I&&(I=[I]),P&&!M&&(M=O([P])),(s=/\bGoogle TV\b/.exec(M))&&(M=s[0]),/\bSimulator\b/i.test(a)&&(M=(M?M+" ":"")+"Simulator"),"Opera Mini"==R&&/\bOPiOS\b/.test(a)&&j.push("running in Turbo/Uncompressed mode"),"IE"==R&&/\blike iPhone OS\b/.test(a)?(P=(s=e(a.replace(/like iPhone OS/,""))).manufacturer,M=s.product):/^iP/.test(M)?(R||(R="Safari"),A="iOS"+((s=/ OS ([\d_]+)/i.exec(a))?" "+s[1].replace(/_/g,"."):"")):"Konqueror"!=R||/buntu/i.test(A)?P&&"Google"!=P&&(/Chrome/.test(R)&&!/\bMobile Safari\b/i.test(a)||/\bVita\b/.test(M))||/\bAndroid\b/.test(A)&&/^Chrome/.test(R)&&/\bVersion\//i.test(a)?(R="Android Browser",A=/\bAndroid\b/.test(A)?A:"Android"):"Silk"==R?(/\bMobi/i.test(a)||(A="Android",j.unshift("desktop mode")),/Accelerated *= *true/i.test(a)&&j.unshift("accelerated")):"PaleMoon"==R&&(s=/\bFirefox\/([\d.]+)\b/.exec(a))?j.push("identifying as Firefox "+s[1]):"Firefox"==R&&(s=/\b(Mobile|Tablet|TV)\b/i.exec(a))?(A||(A="Firefox OS"),M||(M=s[1])):!R||(s=!/\bMinefield\b/i.test(a)&&/\b(?:Firefox|Safari)\b/.exec(R))?(R&&!M&&/[\/,]|^[^(]+?\)/.test(a.slice(a.indexOf(s+"/")+8))&&(R=null),(s=M||P||A)&&(M||P||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(A))&&(R=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(A)?A:s)+" Browser")):"Electron"==R&&(s=(/\bChrome\/([\d.]+)\b/.exec(a)||0)[1])&&j.push("Chromium "+s):A="Kubuntu",T||(T=W(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",z(R),"(?:Firefox|Minefield|NetFront)"],function(e,t){return e||(RegExp(t+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(a)||0)[1]||null})),(s=("iCab"==I&&3<parseFloat(T)?"WebKit":/\bOpera\b/.test(R)&&(/\bOPR\b/.test(a)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(a)&&!/^(?:Trident|EdgeHTML)$/.test(I)&&"WebKit"||!I&&/\bMSIE\b/i.test(a)&&("Mac OS"==A?"Tasman":"Trident")||"WebKit"==I&&/\bPlayStation\b(?! Vita\b)/i.test(R)&&"NetFront")&&(I=[s]),"IE"==R&&(s=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(a)||0)[1])?(R+=" Mobile",A="Windows Phone "+(/\+$/.test(s)?s:s+".x"),j.unshift("desktop mode")):/\bWPDesktop\b/i.test(a)?(R="IE Mobile",A="Windows Phone 8.x",j.unshift("desktop mode"),T||(T=(/\brv:([\d.]+)/.exec(a)||0)[1])):"IE"!=R&&"Trident"==I&&(s=/\brv:([\d.]+)/.exec(a))&&(R&&j.push("identifying as "+R+(T?" "+T:"")),R="IE",T=s[1]),E){if(c="global",l=null!=(u=t)?typeof u[c]:"number",/^(?:boolean|number|string|undefined)$/.test(l)||"object"==l&&!u[c])B(s=t.runtime)==d?(R="Adobe AIR",A=s.flash.system.Capabilities.os):B(s=t.phantom)==v?(R="PhantomJS",T=(s=s.version||null)&&s.major+"."+s.minor+"."+s.patch):"number"==typeof k.documentMode&&(s=/\bTrident\/(\d+)/i.exec(a))?(T=[T,k.documentMode],(s=+s[1]+4)!=T[1]&&(j.push("IE "+T[1]+" mode"),I&&(I[1]=""),T[1]=s),T="IE"==R?String(T[1].toFixed(1)):T[0]):"number"==typeof k.documentMode&&/^(?:Chrome|Firefox)\b/.test(R)&&(j.push("masking as "+R+" "+T),R="IE",T="11.0",I=["Trident"],A="Windows");else if(b&&(C=(s=b.lang.System).getProperty("os.arch"),A=A||s.getProperty("os.name")+" "+s.getProperty("os.version")),y){try{T=t.require("ringo/engine").version.join("."),R="RingoJS"}catch(e){(s=t.system)&&s.global.system==t.system&&(R="Narwhal",A||(A=s[0].os||null))}R||(R="Rhino")}else"object"==typeof t.process&&!t.process.browser&&(s=t.process)&&("object"==typeof s.versions&&("string"==typeof s.versions.electron?(j.push("Node "+s.versions.node),R="Electron",T=s.versions.electron):"string"==typeof s.versions.nw&&(j.push("Chromium "+T,"Node "+s.versions.node),R="NW.js",T=s.versions.nw)),R||(R="Node.js",C=s.arch,A=s.platform,T=(T=/[\d.]+/.exec(s.version))?T[0]:null));A=A&&F(A)}if(T&&(s=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(T)||/(?:alpha|beta)(?: ?\d)?/i.exec(a+";"+(E&&n.appMinorVersion))||/\bMinefield\b/i.test(a)&&"a")&&(S=/b/i.test(s)?"beta":"alpha",T=T.replace(RegExp(s+"\\+?$"),"")+("beta"==S?g:_)+(/\d+\+?/.exec(s)||"")),"Fennec"==R||"Firefox"==R&&/\b(?:Android|Firefox OS)\b/.test(A))R="Firefox Mobile";else if("Maxthon"==R&&T)T=T.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(M))"Xbox 360"==M&&(A=null),"Xbox 360"==M&&/\bIEMobile\b/.test(a)&&j.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(R)&&(!R||M||/Browser|Mobi/.test(R))||"Windows CE"!=A&&!/Mobi/i.test(a))if("IE"==R&&E)try{null===t.external&&j.unshift("platform preview")}catch(e){j.unshift("embedded")}else(/\bBlackBerry\b/.test(M)||/\bBB10\b/.test(a))&&(s=(RegExp(M.replace(/ +/g," *")+"/([.\\d]+)","i").exec(a)||0)[1]||T)?(A=((s=[s,/BB10/.test(a)])[1]?(M=null,P="BlackBerry"):"Device Software")+" "+s[0],T=null):this!=q&&"Wii"!=M&&(E&&w||/Opera/.test(R)&&/\b(?:MSIE|Firefox)\b/i.test(a)||"Firefox"==R&&/\bOS X (?:\d+\.){2,}/.test(A)||"IE"==R&&(A&&!/^Win/.test(A)&&5.5<T||/\bWindows XP\b/.test(A)&&8<T||8==T&&!/\bTrident\b/.test(a)))&&!U.test(s=e.call(q,a.replace(U,"")+";"))&&s.name&&(s="ing as "+s.name+((s=s.version)?" "+s:""),U.test(R)?(/\bIE\b/.test(s)&&"Mac OS"==A&&(A=null),s="identify"+s):(s="mask"+s,R=x?F(x.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(s)&&(A=null),E||(T=null)),I=["Presto"],j.push(s));else R+=" Mobile";(s=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(a)||0)[1])&&(s=[parseFloat(s.replace(/\.(\d)$/,".0$1")),s],"Safari"==R&&"+"==s[1].slice(-1)?(R="WebKit Nightly",S="alpha",T=s[1].slice(0,-1)):T!=s[1]&&T!=(s[2]=(/\bSafari\/([\d.]+\+?)/i.exec(a)||0)[1])||(T=null),s[1]=(/\bChrome\/([\d.]+)/i.exec(a)||0)[1],537.36==s[0]&&537.36==s[2]&&28<=parseFloat(s[1])&&"WebKit"==I&&(I=["Blink"]),E&&(f||s[1])?(I&&(I[1]="like Chrome"),s=s[1]||((s=s[0])<530?1:s<532?2:s<532.05?3:s<533?4:s<534.03?5:s<534.07?6:s<534.1?7:s<534.13?8:s<534.16?9:s<534.24?10:s<534.3?11:s<535.01?12:s<535.02?"13+":s<535.07?15:s<535.11?16:s<535.19?17:s<536.05?18:s<536.1?19:s<537.01?20:s<537.11?"21+":s<537.13?23:s<537.18?24:s<537.24?25:s<537.36?26:"Blink"!=I?"27":"28")):(I&&(I[1]="like Safari"),s=(s=s[0])<400?1:s<500?2:s<526?3:s<533?4:s<534?"4+":s<535?5:s<537?6:s<538?7:s<601?8:"8"),I&&(I[1]+=" "+(s+="number"==typeof s?".x":/[.+]/.test(s)?"":"+")),"Safari"==R&&(!T||45<parseInt(T))&&(T=s)),"Opera"==R&&(s=/\bzbov|zvav$/.exec(A))?(R+=" ",j.unshift("desktop mode"),"zvav"==s?(R+="Mini",T=null):R+="Mobile",A=A.replace(RegExp(" *"+s+"$"),"")):"Safari"==R&&/\bChrome\b/.exec(I&&I[1])&&(j.unshift("desktop mode"),R="Chrome Mobile",T=null,/\bOS X\b/.test(A)?(P="Apple",A="iOS 4.3+"):A=null),T&&0==T.indexOf(s=/[\d.]+$/.exec(A))&&-1<a.indexOf("/"+s+"-")&&(A=H(A.replace(s,""))),I&&!/\b(?:Avant|Nook)\b/.test(R)&&(/Browser|Lunascape|Maxthon/.test(R)||"Safari"!=R&&/^iOS/.test(A)&&/\bSafari\b/.test(I[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(R)&&I[1])&&(s=I[I.length-1])&&j.push(s),j.length&&(j=["("+j.join("; ")+")"]),P&&M&&M.indexOf(P)<0&&j.push("on "+P),M&&j.push((/^on /.test(j[j.length-1])?"":"on ")+M),A&&(s=/ ([\d.+]+)$/.exec(A),o=s&&"/"==A.charAt(A.length-s[0].length-1),A={architecture:32,family:s&&!o?A.replace(s[0],""):A,version:s?s[1]:null,toString:function(){var e=this.version;return this.family+(e&&!o?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(s=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(C))&&!/\bi686\b/i.test(C)?(A&&(A.architecture=64,A.family=A.family.replace(RegExp(" *"+s),"")),R&&(/\bWOW64\b/i.test(a)||E&&/\w(?:86|32)$/.test(n.cpuClass||n.platform)&&!/\bWin64; x64\b/i.test(a))&&j.unshift("32-bit")):A&&/^OS X/.test(A.family)&&"Chrome"==R&&39<=parseFloat(T)&&(A.architecture=64),a||(a=null);var N={};return N.description=a,N.layout=I&&I[0],N.manufacturer=P,N.name=R,N.prerelease=S,N.product=M,N.ua=a,N.version=R&&T,N.os=A||{architecture:null,family:null,version:null,toString:function(){return"null"}},N.parse=e,N.toString=function(){return this.description||""},N.version&&j.unshift(T),N.name&&j.unshift(R),A&&R&&(A!=String(A).split(" ")[0]||A!=R.split(" ")[0]&&!M)&&j.push(M?"("+A+")":"on "+A),j.length&&(N.description=j.join(" ")),N}();"function"==typeof d&&"object"==typeof d.amd&&d.amd?(D.platform=u,d(function(){return u})):r&&t?q(u,function(e,t){r[t]=e}):D.platform=u}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],222:[function(e,t,r){
/*
 * Copyright (c) 2012 Mathieu Turcotte
 * Licensed under the MIT license.
 */
t.exports=e("./lib/checks")},{"./lib/checks":223}],223:[function(e,t,r){
/*
 * Copyright (c) 2012 Mathieu Turcotte
 * Licensed under the MIT license.
 */
var s=e("util"),o=t.exports=e("./errors");function a(e,t,r,n){r=r||"";var i=new e(s.format.apply(this,[r].concat(n)));throw Error.captureStackTrace(i,t),i}function i(e,t,r){a(o.IllegalArgumentError,e,t,r)}function u(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array"}return t}function n(n){return function(e,t){var r=u(e);if(r==n)return e;i(arguments.callee,t||'Expected "'+n+'" but got "'+r+'".',Array.prototype.slice.call(arguments,2))}}t.exports.checkArgument=function(e,t){e||i(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkState=function(e,t){var r,n,i;e||(r=arguments.callee,n=t,i=Array.prototype.slice.call(arguments,2),a(o.IllegalStateError,r,n,i))},t.exports.checkIsDef=function(e,t){if(void 0!==e)return e;i(arguments.callee,t||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},t.exports.checkIsDefAndNotNull=function(e,t){if(null!=e)return e;i(arguments.callee,t||'Expected value to be defined and not null but got "'+u(e)+'".',Array.prototype.slice.call(arguments,2))},t.exports.checkIsString=n("string"),t.exports.checkIsArray=n("array"),t.exports.checkIsNumber=n("number"),t.exports.checkIsBoolean=n("boolean"),t.exports.checkIsFunction=n("function"),t.exports.checkIsObject=n("object")},{"./errors":224,util:282}],224:[function(e,t,r){
/*
 * Copyright (c) 2012 Mathieu Turcotte
 * Licensed under the MIT license.
 */
var n=e("util");function i(e){Error.call(this,e),this.message=e}function s(e){Error.call(this,e),this.message=e}n.inherits(i,Error),i.prototype.name="IllegalArgumentError",n.inherits(s,Error),s.prototype.name="IllegalStateError",t.exports.IllegalStateError=s,t.exports.IllegalArgumentError=i},{util:282}],225:[function(e,t,r){var n,i,s=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,l=[],f=!1,h=-1;function d(){f&&c&&(f=!1,c.length?l=c.concat(l):h=-1,l.length&&p())}function p(){if(!f){var e=u(d);f=!0;for(var t=l.length;t;){for(c=l,l=[];++h<t;)c&&c[h].run();h=-1,t=l.length}c=null,f=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function v(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new m(e,t)),1!==l.length||f||u(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=v,s.addListener=v,s.once=v,s.off=v,s.removeListener=v,s.removeAllListeners=v,s.emit=v,s.prependListener=v,s.prependOnceListener=v,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],226:[function(e,t,r){
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n=function(){return this}()||Function("return this")(),i=n.regeneratorRuntime&&0<=Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime"),s=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,t.exports=e("./runtime"),i)n.regeneratorRuntime=s;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},{"./runtime":227}],227:[function(e,P,t){
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(e){"use strict";var u,t=Object.prototype,c=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",n=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag",o="object"==typeof P,a=e.regeneratorRuntime;if(a)o&&(P.exports=a);else{(a=e.regeneratorRuntime=o?P.exports:{}).wrap=_;var f="suspendedStart",h="suspendedYield",d="executing",p="completed",m={},l={};l[i]=function(){return this};var v=Object.getPrototypeOf,b=v&&v(v(R([])));b&&b!==t&&c.call(b,i)&&(l=b);var y=x.prototype=k.prototype=Object.create(l);w.prototype=y.constructor=x,x.constructor=w,x[s]=w.displayName="GeneratorFunction",a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(y),e},a.awrap=function(e){return{__await:e}},C(j.prototype),j.prototype[n]=function(){return this},a.AsyncIterator=j,a.async=function(e,t,r,n){var i=new j(_(e,t,r,n));return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},C(y),y[s]="Generator",y[i]=function(){return this},y.toString=function(){return"[object Generator]"},a.keys=function(r){var n=[];for(var e in r)n.push(e);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=R,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=u)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return s.type="throw",s.arg=r,n.next=e,t&&(n.method="next",n.arg=u),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],s=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var o=c.call(i,"catchLoc"),a=c.call(i,"finallyLoc");if(o&&a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=u),m}}}function _(e,t,r,n){var s,o,a,u,i=t&&t.prototype instanceof k?t:k,c=Object.create(i.prototype),l=new I(n||[]);return c._invoke=(s=e,o=r,a=l,u=f,function(e,t){if(u===d)throw new Error("Generator is already running");if(u===p){if("throw"===e)throw t;return M()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){var n=S(r,a);if(n){if(n===m)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(u===f)throw u=p,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);u=d;var i=g(s,o,a);if("normal"===i.type){if(u=a.done?p:h,i.arg===m)continue;return{value:i.arg,done:a.done}}"throw"===i.type&&(u=p,a.method="throw",a.arg=i.arg)}}),c}function g(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function k(){}function w(){}function x(){}function C(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function j(u){var t;this._invoke=function(r,n){function e(){return new Promise(function(e,t){!function t(e,r,n,i){var s=g(u[e],u,r);if("throw"!==s.type){var o=s.arg,a=o.value;return a&&"object"==typeof a&&c.call(a,"__await")?Promise.resolve(a.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):Promise.resolve(a).then(function(e){o.value=e,n(o)},i)}i(s.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}}function S(e,t){var r=e.iterator[t.method];if(r===u){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=u,S(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var n=g(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,m;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=u),t.delegate=null,m):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function R(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=u,e.done=!0,e};return n.next=n}}return{next:M}}function M(){return{value:u,done:!0}}}(function(){return this}()||Function("return this")())},{}],228:[function(f,r,n){(function(t){!function(e){if("object"==typeof n&&void 0!==r)r.exports=e();else if("function"==typeof d&&d.amd)d([],e);else{("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:this).rfc6902=e()}}(function(){return function s(o,a,u){function c(r,e){if(!a[r]){if(!o[r]){var t="function"==typeof f&&f;if(!e&&t)return t(r,!0);if(l)return l(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=a[r]={exports:{}};o[r][0].call(i.exports,function(e){var t=o[r][1][e];return c(t||e)},i,i.exports,s,o,a,u)}return a[r].exports}for(var l="function"==typeof f&&f,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,t,r){"use strict";var d=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){for(var r,n=[],i=e[Symbol.iterator]();!(r=i.next()).done&&(n.push(r.value),!t||n.length!==t););return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},p=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)};r.isDestructive=function(e){var t=e.op;return"remove"===t||"replace"===t||"copy"===t||"move"===t},r.subtract=s,r.intersection=o,r.objectType=a,r.diffArrays=u,r.diffObjects=c,r.diffValues=l,r.diffAny=v,Object.defineProperty(r,"__esModule",{value:!0});var m=e("./equal").compare;function s(e,t){var r={};for(var n in e)r[n]=1;for(var i in t)delete r[i];return Object.keys(r)}function o(e){var r={};e.forEach(function(e){for(var t in e)r[t]=(r[t]||0)+1});var t=e.length;for(var n in r)r[n]<t&&delete r[n];return Object.keys(r)}function a(e){return void 0===e?"undefined":null===e?"null":Array.isArray(e)?"array":typeof e}function u(u,c,l){var f={"0,0":{operations:[],cost:0}};var h=isNaN(u.length)||u.length<=0?0:u.length,e=isNaN(c.length)||c.length<=0?0:c.length,t=function e(t,r){var n=f[t+","+r];if(void 0===n){if(m(u[t-1],c[r-1]))n=e(t-1,r-1);else{var i=[];if(0<t){var s=e(t-1,r);i.push({operations:s.operations.concat({op:"remove",index:t-1}),cost:s.cost+1})}if(0<r){var o=e(t,r-1);i.push({operations:o.operations.concat({op:"add",index:t-1,value:c[r-1]}),cost:o.cost+1})}if(0<t&&0<r){var a=e(t-1,r-1);i.push({operations:a.operations.concat({op:"replace",index:t-1,original:u[t-1],value:c[r-1]}),cost:a.cost+1})}n=i.sort(function(e,t){return e.cost-t.cost})[0]}f[t+","+r]=n}return n}(h,e).operations.reduce(function(e,t){var r=d(e,2),n=r[0],i=r[1];if("add"===t.op){var s=t.index+1+i,o=s<h+i?String(s):"-",a={op:t.op,path:l.add(o).toString(),value:t.value};return[n.concat(a),i+1]}if("remove"===t.op){a={op:t.op,path:l.add(String(t.index+i)).toString()};return[n.concat(a),i-1]}var u=l.add(String(t.index+i)),c=v(t.original,t.value,u);return[n.concat.apply(n,p(c)),i]},[[],0]),r=d(t,2),n=r[0];r[1];return n}function c(t,r,n){var i=[];return s(t,r).forEach(function(e){i.push({op:"remove",path:n.add(e).toString()})}),s(r,t).forEach(function(e){i.push({op:"add",path:n.add(e).toString(),value:r[e]})}),o([t,r]).forEach(function(e){i.push.apply(i,p(v(t[e],r[e],n.add(e))))}),i}function l(e,t,r){return m(e,t)?[]:[{op:"replace",path:r.toString(),value:t}]}function v(e,t,r){var n=a(e),i=a(t);return"array"==n&&"array"==i?u(e,t,r):"object"==n&&"object"==i?c(e,t,r):l(e,t,r)}},{"./equal":2}],2:[function(e,t,r){"use strict";function s(e,t){return e.length===t.length&&function(e,t){for(var r=[],n=0,i=e.length;n<i;n++)r.push([e[n],t[n]]);return r}(e,t).every(function(e){return o(e[0],e[1])})}function o(e,t){return e===t||(Array.isArray(e)&&Array.isArray(t)?s(e,t):Object(e)===e&&Object(t)===t&&(r=e,n=t,!!s(i=Object.keys(r),Object.keys(n))&&i.every(function(e){return o(r[e],n[e])})));var r,n,i}r.compare=o,Object.defineProperty(r,"__esModule",{value:!0})},{}],3:[function(e,t,r){"use strict";var n=function e(t,r,n){var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,r,n)}if("value"in i&&i.writable)return i.value;var o=i.get;return void 0!==o?o.call(n):void 0},i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};Object.defineProperty(r,"__esModule",{value:!0});r.MissingError=function(e){function t(e){s(this,t),n(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,"Value required at path: "+e),this.path=e,this.name=this.constructor.name}return i(t,e),t}(Error),r.InvalidOperationError=function(e){function t(e){s(this,t),n(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,"Invalid operation: "+e),this.op=e,this.name=this.constructor.name}return i(t,e),t}(Error),r.TestError=function(e){function r(e,t){s(this,r),n(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,"Test failed: "+e+" != "+t),this.actual=e,this.expected=t,this.name=this.constructor.name,this.actual=e,this.expected=t}return i(r,e),r}(Error)},{}],4:[function(e,t,r){"use strict";r.applyPatch=function(r,e){return e.map(function(e){var t=o[e.op];return void 0===t?new i(e.op):t(r,e)})},r.createPatch=function(e,t){var r=new s;return u(e,t,r)},r.createTests=function(n,e){var i=new Array;return e.filter(c).forEach(function(e){var t=l(n,e.path);if(t&&i.push(t),"from"in e){var r=l(n,e.from);r&&i.push(r)}}),i},Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("./errors").InvalidOperationError,s=e("./pointer").Pointer,o=(n=e("./patch"))&&n.__esModule?n:{default:n},a=e("./diff"),u=a.diffAny,c=a.isDestructive;function l(e,t){var r=s.fromJSON(t).evaluate(e);if(void 0!==r)return{op:"test",path:t,value:r.value}}},{"./diff":1,"./errors":3,"./patch":5,"./pointer":6}],5:[function(e,t,r){"use strict";r.add=function(e,t){var r=i.fromJSON(t.path).evaluate(e);if(void 0===r.parent)return new o(t.path);return u(r.parent,r.key,t.value),null},r.remove=function(e,t){var r=i.fromJSON(t.path).evaluate(e);if(void 0===r.value)return new o(t.path);return c(r.parent,r.key),null},r.replace=function(e,t){var r=i.fromJSON(t.path).evaluate(e);if(void 0===r.value)return new o(t.path);return r.parent[r.key]=t.value,null},r.move=function(e,t){var r=i.fromJSON(t.from).evaluate(e);if(void 0===r.value)return new o(t.from);var n=i.fromJSON(t.path).evaluate(e);if(void 0===n.parent)return new o(t.path);return c(r.parent,r.key),u(n.parent,n.key,r.value),null},r.copy=function(e,t){var r=i.fromJSON(t.from).evaluate(e);if(void 0===r.value)return new o(t.from);var n=i.fromJSON(t.path).evaluate(e);if(void 0===n.parent)return new o(t.path);return c(r.parent,r.key),u(n.parent,n.key,r.value),null},r.test=function(e,t){var r=i.fromJSON(t.path).evaluate(e);if(!n(r.value,t.value))return new a(r.value,t.value);return null},Object.defineProperty(r,"__esModule",{value:!0});var i=e("./pointer").Pointer,n=e("./equal").compare,s=e("./errors"),o=s.MissingError,a=s.TestError;function u(e,t,r){Array.isArray(e)?"-"==t?e.push(r):e.splice(t,0,r):e[t]=r}function c(e,t){Array.isArray(e)?e.splice(t,1):delete e[t]}},{"./equal":2,"./errors":3,"./pointer":6}],6:[function(e,t,r){"use strict";var n=function(){function n(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function s(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function o(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(r,"__esModule",{value:!0});r.Pointer=function(){function r(){var e=void 0===arguments[0]?[""]:arguments[0];i(this,r),this.tokens=e}return n(r,{toString:{value:function(){return this.tokens.map(o).join("/")}},evaluate:{value:function(e){for(var t=null,r=null,n=1,i=this.tokens.length;n<i;n++)e=((t=e)||{})[r=this.tokens[n]];return{parent:t,key:r,value:e}}},push:{value:function(e){this.tokens.push(e)}},add:{value:function(e){return new r(this.tokens.concat(String(e)))}}},{fromJSON:{value:function(e){var t=e.split("/").map(s);if(""!==t[0])throw new Error("Invalid JSON Pointer: "+e);return new r(t)}}}),r}()},{}]},{},[4])(4)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],229:[function(e,t,r){"use strict";var s=l(e("babel-runtime/regenerator")),n=l(e("babel-runtime/core-js/object/get-prototype-of")),i=l(e("babel-runtime/helpers/createClass")),o=l(e("babel-runtime/helpers/possibleConstructorReturn")),a=l(e("babel-runtime/helpers/inherits")),u=l(e("babel-runtime/helpers/classCallCheck")),c=l(e("babel-runtime/core-js/promise"));function l(e){return e&&e.__esModule?e:{default:e}}var f=function(s,o,a,u){return new(a||(a=c.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var h=e("events"),d=e("operation-retrier"),p=e("./configuration"),m=e("./logger"),v=e("./persistentState"),b=e("twilio-transport");var y=function(e){function r(e){(0,u.default)(this,r);var t=(0,o.default)(this,(r.__proto__||(0,n.default)(r)).call(this));return(e=e||{}).transport=e.transport||new b.Transport(e.twilsockClient||null),t.state=new v.PersistentState,t.config=new p.default(e),t.twilsock=e.twilsockClient,t.transport=e.transport,t}return(0,a.default)(r,e),(0,i.default)(r,[{key:"setToken",value:function(r){return f(this,void 0,void 0,s.default.mark(function e(){var t;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentFpaToken!==r&&(this.currentFpaToken=r,t=this.currentTokenRequest,this.currentTokenRequest=this.establishToken(r),this.notifyRejected(t)),e.abrupt("return",this.currentTokenRequest.promise);case 2:case"end":return e.stop()}},e,this)}))}},{key:"notifyRejected",value:function(e){e&&setTimeout(function(){return e.reject(new Error("Operation has been cancelled by next token"))},0)}},{key:"establishToken",value:function(r){var n=this,i=new function e(){(0,u.default)(this,e)},e=new c.default(function(e,t){n.establishTokenImpl(r).then(e).catch(t),i.resolve=e,i.reject=t});return i.promise=e,i}},{key:"establishTokenImpl",value:function(i){return f(this,void 0,void 0,s.default.mark(function e(){var n=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new d.default({min:500,max:2e3}).run(function(){return n.requestRtdToken(i)}).then(function(e){if("ok"!=e.status)throw e.exception;if(n.currentFpaToken===i){n.state.continuationToken=e.response.continuation_token;var t=e.response.twilio_rtd_token;"NEW"===e.response.status.status?n.emit("tokenCreated",t):n.emit("tokenUpdated",t),n.emit("token",t);var r={token:e.response.twilio_rtd_token,ttl:e.response.ttl,status:e.response.status.status,reason:e.response.status.reason||null,identity:e.response.identity||null,accountSid:e.response.account_sid,serviceSids:e.response.instance_sids};return n.emit("response",r),r}}).catch(function(e){throw m.default.error(e),e}));case 1:case"end":return e.stop()}},e,this)}))}},{key:"requestRtdToken",value:function(i){return f(this,void 0,void 0,s.default.mark(function e(){var t,r,n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={"Content-Type":"application/json"},r={fpa_token:i,continuation_token:this.state.continuationToken},m.default.debug("Token request",r),e.prev=3,e.next=6,this.transport.post(this.config.url,t,r);case 6:return n=e.sent,m.default.debug("Token response:",n),e.abrupt("return",{status:"ok",token:i,response:n.body});case 11:if(e.prev=11,e.t0=e.catch(3),401!==e.t0.status&&403!==e.t0.status){e.next=16;break}return e.t0 instanceof Error||(e.t0.body?e.t0=new Error(e.t0.body.message):e.t0.description&&(e.t0=new Error(e.t0.description))),e.abrupt("return",{status:"denied",exception:e.t0,token:null,response:null});case 16:throw e.t0;case 17:case"end":return e.stop()}},e,this,[[3,11]])}))}}]),r}(h.EventEmitter),_=r.EmsClient=y;r.EMSClient=_,r.default=_},{"./configuration":230,"./logger":231,"./persistentState":232,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57,events:214,"operation-retrier":220,"twilio-transport":273}],230:[function(e,t,r){"use strict";var n,i=e("babel-runtime/helpers/classCallCheck"),s=(n=i)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(t){(0,s.default)(this,e);var r=t.emsClient||{},n="https://ems."+(t.realm||"us1")+".twilio.com",i=r.url||r.emsUri||r.emsUrl||n+"/v1/token";this.url=i}},{"babel-runtime/helpers/classCallCheck":50}],231:[function(e,t,r){"use strict";var n,i=e("babel-runtime/core-js/array/from"),s=(n=i)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});var o=e("loglevel");function a(e,t){return[e].concat((0,s.default)(t))}r.default={setLevel:function(e){o.setLevel(e)},trace:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.trace.apply(null,a("EMS T:",t))},debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.debug.apply(null,a("EMS D:",t))},info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.info.apply(null,a("EMS I:",t))},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.warn.apply(null,a("EMS W:",t))},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.error.apply(null,a("EMS E:",t))}}},{"babel-runtime/core-js/array/from":31,loglevel:219}],232:[function(e,t,r){"use strict";var n=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./logger"),a="Twilio::RTD::EmsClient::InstanceId",u="Twilio::RTD::EndpointId",c=function(){function r(){(0,n.default)(this,r),this.cachedContinuationToken=null,this.myInstanceNumber=this.initializeInstanceId()}return(0,i.default)(r,[{key:"initializeInstanceId",value:function(){var e=function(){try{if(sessionStorage)return parseInt(sessionStorage.getItem(a))||0}catch(e){return 0}}();r.instancesCounter<e&&(r.instancesCounter=e);var t=r.instancesCounter++;try{sessionStorage&&(sessionStorage.setItem(a,r.instancesCounter.toString()),window&&window.addEventListener("beforeunload",function(){sessionStorage.removeItem(a)}))}catch(e){}return t}},{key:"shouldUsePersistentToken",get:function(){return 0===this.myInstanceNumber}},{key:"continuationToken",get:function(){if(this.cachedContinuationToken)return this.cachedContinuationToken;try{if(this.shouldUsePersistentToken&&sessionStorage)return this.cachedContinuationToken=sessionStorage.getItem(u),this.cachedContinuationToken}catch(e){o.default.info("Can't access persistent storage",e.message)}return null},set:function(e){this.cachedContinuationToken=e;try{this.shouldUsePersistentToken&&sessionStorage&&sessionStorage.setItem(u,e)}catch(e){o.default.info("Can't access persistent storage",e.message)}}}]),r}();c.instancesCounter=0,r.PersistentState=c},{"./logger":231,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],233:[function(e,t,r){"use strict";var i=a(e("babel-runtime/regenerator")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass")),n=a(e("babel-runtime/core-js/promise"));function a(e){return e&&e.__esModule?e:{default:e}}var u=function(s,o,a,u){return new(a||(a=n.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var c=e("./logger"),l=e("./configuration"),f=e("./media");r.Media=f.Media,r.McsMedia=f.Media;var h=e("twilio-transport"),d=e("./services/network"),p=c.Logger.scope(""),m=e("./../package.json").version,v="A valid Twilio token should be provided",b=function(){function n(e,t,r){if((0,s.default)(this,n),this.options=r||{},this.options.logLevel=this.options.logLevel||"error",this.config=new l.Configuration(e,t,this.options),!e)throw new Error(v);p.setLevel(this.options.logLevel),this.options.transport=this.options.transport||new h.Transport(null,this.options),this.transport=this.options.transport,this.network=new d.Network(this.config,this.transport)}return(0,o.default)(n,[{key:"updateToken",value:function(e){if(p.info("updateToken"),!e)throw new Error(v);this.config.updateToken(e)}},{key:"get",value:function(r){return u(this,void 0,void 0,i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.get(this.config.baseUrl+"/"+r);case 2:return t=e.sent,e.abrupt("return",new f.Media(this.config,this.network,t.body));case 4:case"end":return e.stop()}},e,this)}))}},{key:"post",value:function(r,n){return u(this,void 0,void 0,i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.post(this.config.baseUrl,n,r);case 2:return t=e.sent,e.abrupt("return",new f.Media(this.config,this.network,t.body));case 4:case"end":return e.stop()}},e,this)}))}},{key:"postFormData",value:function(r){return u(this,void 0,void 0,i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.post(this.config.baseUrl,r);case 2:return t=e.sent,e.abrupt("return",new f.Media(this.config,this.network,t.body));case 4:case"end":return e.stop()}},e,this)}))}}]),n}();b.version=m,r.Client=b,r.McsClient=b,r.default=b},{"./../package.json":239,"./configuration":234,"./logger":236,"./media":237,"./services/network":238,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":57,"twilio-transport":273}],234:[function(e,t,r){"use strict";var i=n(e("babel-runtime/helpers/classCallCheck")),s=n(e("babel-runtime/helpers/createClass"));function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o="https://mcs.us1.twilio.com",a=function(){function n(e,t,r){(0,i.default)(this,n),this.options=r.MCS||r||{},this.token=e,this.baseUrl=(void 0===this.options.realm?o:"https://mcs."+this.options.realm+".twilio.com")+t}return(0,s.default)(n,[{key:"updateToken",value:function(e){this.token=e}},{key:"backoffConfigOverride",get:function(){return this.options.backoffConfigOverride}},{key:"retryWhenThrottledOverride",get:function(){return this.options.retryWhenThrottledOverride}}],[{key:"backoffConfigDefault",get:function(){return{min:1e3,max:4e3,maxAttemptsCount:3}}},{key:"retryWhenThrottledDefault",get:function(){return!0}}]),n}();r.Configuration=a},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],235:[function(e,t,r){"use strict";var n=e("./client");t.exports=n},{"./client":233}],236:[function(e,t,r){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass")),s=o(e("babel-runtime/core-js/array/from"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=e("loglevel");function u(e,t){return[e].concat((0,s.default)(t))}var c=function(){function t(){(0,n.default)(this,t),this.prefix=""}return(0,i.default)(t,[{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.trace.apply(null,u("MCS T:"+this.prefix,t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,u("MCS D:"+this.prefix,t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.info.apply(null,u("MCS I:"+this.prefix,t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.warn.apply(null,u("MCS W:"+this.prefix,t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.error.apply(null,u("MCS E:"+this.prefix,t))}}],[{key:"scope",value:function(e){return new t}},{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.trace.apply(null,u("MCS T:",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,u("MCS D:",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.info.apply(null,u("MCS I:",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.warn.apply(null,u("MCS W:",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.error.apply(null,u("MCS E:",t))}}]),t}();r.Logger=c},{"babel-runtime/core-js/array/from":31,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,loglevel:219}],237:[function(e,t,r){"use strict";var i=n(e("babel-runtime/regenerator")),s=n(e("babel-runtime/helpers/classCallCheck")),o=n(e("babel-runtime/helpers/createClass")),c=n(e("babel-runtime/core-js/promise"));function n(e){return e&&e.__esModule?e:{default:e}}var a=function(s,o,a,u){return new(a||(a=c.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function n(e,t,r){(0,s.default)(this,n),this.config=e,this.network=t,this._update(r)}return(0,o.default)(n,[{key:"getContentUrl",value:function(){return a(this,void 0,void 0,i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.get(this.config.baseUrl+"/"+this.sid);case 2:return t=e.sent,this._update(t.body),e.abrupt("return",c.default.resolve(this.state.contentDirectUrl));case 5:case"end":return e.stop()}},e,this)}))}},{key:"_update",value:function(e){this.state={sid:e.sid,serviceSid:e.service_sid,channelSid:e.channel_sid,messageSid:e.message_sid,dateCreated:e.date_created?new Date(e.date_created):null,dateUpdated:e.date_updated?new Date(e.date_updated):null,size:e.size,contentType:e.content_type,url:e.url,contentUrl:e.links.content,contentDirectUrl:e.links.content_direct_temporary,filename:e.filename?e.filename:null}}},{key:"sid",get:function(){return this.state.sid}},{key:"serviceSid",get:function(){return this.state.serviceSid}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"fileName",get:function(){return this.state.filename}}]),n}();r.Media=u},{"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":57}],238:[function(e,t,r){"use strict";var o=s(e("babel-runtime/regenerator")),a=s(e("babel-runtime/helpers/extends")),n=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass")),c=s(e("babel-runtime/core-js/promise"));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(s,o,a,u){return new(a||(a=c.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var l=e("operation-retrier"),f=e("../logger"),h=e("../configuration"),d=e("isomorphic-form-data"),p=f.Logger.scope(""),m=function(){function r(e,t){(0,n.default)(this,r),this.config=e,this.transport=t}return(0,i.default)(r,[{key:"backoffConfig",value:function(){return(0,a.default)(h.Configuration.backoffConfigDefault,this.config.backoffConfigOverride)}},{key:"retryWhenThrottled",value:function(){return void 0!==this.config.retryWhenThrottledOverride?this.config.retryWhenThrottledOverride:void 0!==h.Configuration.retryWhenThrottledDefault&&h.Configuration.retryWhenThrottledDefault}},{key:"executeWithRetry",value:function(e){var s=this,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return new c.default(function(t,r){var n=[502,503,504];o&&n.push(429);var i=new l.default(s.backoffConfig());i.on("attempt",function(){e().then(function(e){return i.succeeded(e)}).catch(function(e){-1<n.indexOf(e.status)?i.failed(e):"Twilsock disconnected"===e.message?i.failed(e):(i.removeAllListeners(),i.cancel(),r(e))})}),i.on("succeeded",function(e){t(e)}),i.on("cancelled",function(e){return r(e)}),i.on("failed",function(e){return r(e)}),i.start()})}},{key:"get",value:function(i){return u(this,void 0,void 0,o.default.mark(function e(){var t,r,n=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={"X-Twilio-Token":this.config.token},p.trace("sending GET request to ",i," headers ",t),e.next=4,this.executeWithRetry(function(){return n.transport.get(i,t)},this.retryWhenThrottled());case 4:return r=e.sent,p.trace("response",r),e.abrupt("return",r);case 7:case"end":return e.stop()}},e,this)}))}},{key:"post",value:function(n,i,s){return u(this,void 0,void 0,o.default.mark(function e(){var t,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={"X-Twilio-Token":this.config.token},i instanceof d||!s||(0,a.default)(t,{"Content-Type":s}),r=void 0,p.trace("sending POST request to ",n," headers ",t),e.prev=4,e.next=7,this.transport.post(n,t,i);case 7:r=e.sent,e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(4),!(e.t0 instanceof TypeError)){e.next=16;break}throw new TypeError("Posting FormData supported only with browser engine's FormData");case 16:throw e.t0;case 17:return p.trace("response",r),e.abrupt("return",r);case 19:case"end":return e.stop()}},e,this,[[4,10]])}))}}]),r}();r.Network=m},{"../configuration":234,"../logger":236,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/extends":52,"babel-runtime/regenerator":57,"isomorphic-form-data":216,"operation-retrier":220}],239:[function(e,t,r){t.exports={_args:[[{raw:"twilio-mcs-client@^0.0.4",scope:null,escapedName:"twilio-mcs-client",name:"twilio-mcs-client",rawSpec:"^0.0.4",spec:">=0.0.4 <0.0.5",type:"range"},"/var/lib/jenkins/jobs/twilio-chat.js/workspace"]],_from:"twilio-mcs-client@>=0.0.4 <0.0.5",_id:"twilio-mcs-client@0.0.4",_inCache:!0,_location:"/twilio-mcs-client",_nodeVersion:"8.4.0",_npmOperationalInternal:{host:"s3://npm-registry-packages",tmp:"tmp/twilio-mcs-client-0.0.4.tgz_1507280871206_0.1071092204656452"},_npmUser:{name:"twilio-ci",email:"mroberts+twilio-ci@twilio.com"},_npmVersion:"5.3.0",_phantomChildren:{},_requested:{raw:"twilio-mcs-client@^0.0.4",scope:null,escapedName:"twilio-mcs-client",name:"twilio-mcs-client",rawSpec:"^0.0.4",spec:">=0.0.4 <0.0.5",type:"range"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/twilio-mcs-client/-/twilio-mcs-client-0.0.4.tgz",_shasum:"369ccc8f1dfef9e914192dcd5d2c05377468a1da",_shrinkwrap:null,_spec:"twilio-mcs-client@^0.0.4",_where:"/var/lib/jenkins/jobs/twilio-chat.js/workspace",author:{name:"Twilio"},browser:"browser/index.js",dependencies:{"body-parser":"^1.18.2",dotenv:"^4.0.0","isomorphic-form-data":"^1.0.0",loglevel:"^1.5.0","operation-retrier":"^1.3.2",pug:"^2.0.0-rc.4","twilio-transport":"^0.1.4"},description:"Twilio Media Content Service client library",devDependencies:{"@types/chai":"^3.5.2","@types/chai-as-promised":"0.0.31","@types/chai-datetime":"0.0.30","@types/chai-string":"^1.1.30","@types/core-js":"^0.9.42","@types/form-data":"0.0.33","@types/mocha":"^2.2.43","@types/node":"^7.0.18","@types/sinon":"^2.3.5","@types/sinon-chai":"^2.7.27",async:"^2.5.0","async-test-tools":"^1.0.7","babel-eslint":"^7.2.3","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-istanbul":"^4.1.5","babel-plugin-transform-async-to-generator":"^6.24.1","babel-plugin-transform-object-assign":"^6.22.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-es2015":"^6.24.1","babel-require":"^1.0.1","babel-runtime":"^6.23.0",babelify:"^7.3.0",browserify:"^14.3.0",chai:"^3.5.0","chai-as-promised":"^6.0.0","chai-datetime":"^1.5.0","chai-string":"^1.3.0",cheerio:"^0.22.0",del:"^3.0.0",express:"^4.16.1",gulp:"^3.9.1","gulp-babel":"^6.1.2","gulp-derequire":"^2.1.0","gulp-insert":"^0.5.0","gulp-mocha":"^4.3.1","gulp-rename":"^1.2.2","gulp-tap":"^1.0.1","gulp-tslint":"^8.0.0","gulp-typescript":"^3.2.1","gulp-uglify":"^3.0.0","gulp-util":"^3.0.8",gulpclass:"^0.1.2","ink-docstrap":"^1.3.0",jsdoc:"^3.5.3","jsdoc-strip-async-await":"^0.1.0",karma:"^1.7.0","karma-babel-preprocessor":"^6.0.1","karma-browserify":"^5.1.1","karma-browserstack-launcher":"^1.3.0","karma-chrome-launcher":"^2.2.0","karma-env-preprocessor":"^0.1.1","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.3","karma-sinon-chai":"^1.3.1","karma-sinon-ie":"^2.0.0","karma-typescript":"^3.0.7","loglevel-message-prefix":"^2.0.1",nyc:"^11.2.1",proxyquire:"^1.8.0",sinon:"^2.3.8","sinon-chai":"^2.14.0",t:"^0.5.1","ts-node":"^3.2.0",tslint:"^5.5.0",twilio:"^3.7.0",typescript:"^2.5.3","uglify-save-license":"^0.4.1","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0",watchify:"^3.9.0"},directories:{},dist:{integrity:"sha512-4NWzSInfENIP48G58gyN13E5XlqItX8hU93yVsMX+FrIvcpUS3A4snXko6NvIt1ZTMhG+sXrt6OF3Mx555tTPw==",shasum:"369ccc8f1dfef9e914192dcd5d2c05377468a1da",tarball:"https://registry.npmjs.org/twilio-mcs-client/-/twilio-mcs-client-0.0.4.tgz"},engines:{node:">=6"},gitHead:"339764692c93f2bd32b56889048ea7a05266abdd",license:"MIT",main:"lib/index.js",maintainers:[{name:"twilio-ci",email:"mroberts+twilio-ci@twilio.com"}],name:"twilio-mcs-client",optionalDependencies:{},readme:"ERROR: No README data found!",scripts:{start:"node app.js"},types:"./lib/client.d.ts",version:"0.0.4"}},{}],240:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=a(e("babel-runtime/core-js/promise")),d=a(e("babel-runtime/core-js/object/define-properties")),p=a(e("babel-runtime/core-js/object/get-prototype-of")),m=a(e("babel-runtime/helpers/classCallCheck")),i=a(e("babel-runtime/helpers/createClass")),v=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits")),b=a(e("./configuration")),o=a(e("events")),y=a(e("./logger")),_=a(e("bottleneck")),g=a(e("./registrar")),k=a(e("twilsock")),w=a(e("twilio-transport")),x=e("twilio-ems-client");function a(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function h(e,t){(0,m.default)(this,h);var r=(0,v.default)(this,(h.__proto__||(0,p.default)(h)).call(this));if(!e)throw new Error("Token is required for Notifications client");(t=t||{}).logLevel=t.logLevel||"error",y.default.setLevel(t.logLevel);var n=t.minTokenRefreshInterval||1e4,i=t.productId||"notifications";t.twilsockClient=t.twilsockClient||new k.default(e,t),t.transport=t.transport||new w.default(t.twilsockClient),t.emsClient=t.emsClient||new x.EMSClient(t);var s,o,a,u,c=t.twilsockClient,l=t.transport,f=new b.default(null,t);return(0,d.default)(r,{_config:{value:f},_emsClient:{value:t.emsClient},_registrar:{value:new g.default(i,l,c,f)},_twilsock:{value:c},_reliableTransportState:{value:{overall:!1,transport:!1,registration:!1,lastEmitted:null}},updateToken:{value:(s=r._updateToken.bind(r),o=1,a=n,u=new _.default(o,a,1,_.default.strategy.LEAK),function(){var e=Array.prototype.slice.call(arguments,0);return e.unshift(s),u.schedule.apply(u,e)}),enumerable:!0},connectionState:{get:function(){return"disconnected"===r._twilsock.state?"disconnected":"disconnecting"===r._twilsock.state?"disconnecting":"connected"===r._twilsock.state&&r._reliableTransportState.registration?"connected":"rejected"===r._twilsock.state?"denied":"connecting"}}}),r._emsClient.setToken(e).then(function(e){r._config.updateToken(e.token),r._registrar.updateToken()}).catch(function(e){y.default.warn("Failed to set token",e)}),r._onTransportStateChange(r._twilsock.connected),r._registrar.on("transportReady",function(e){r._onRegistrationStateChange(e?"registered":"")}),r._registrar.on("stateChanged",function(e){r._onRegistrationStateChange(e)}),r._registrar.on("needReliableTransport",r._onNeedReliableTransport.bind(r)),r._twilsock.on("message",function(e,t){return r._routeMessage(e,t)}),r._twilsock.on("connected",function(e){r._onTransportStateChange(!0),r._registrar.setNotificationId("twilsock",e)}),r._twilsock.on("disconnected",function(){r._onTransportStateChange(!1)}),r}return(0,s.default)(h,e),(0,i.default)(h,[{key:"_routeMessage",value:function(e,t){y.default.trace("Message arrived: ",e,t),this.emit("message",e,t)}},{key:"_onNeedReliableTransport",value:function(e){e?this._twilsock.connect():this._twilsock.disconnect()}},{key:"_onRegistrationStateChange",value:function(e){this._reliableTransportState.registration="registered"===e,this._updateTransportState()}},{key:"_onTransportStateChange",value:function(e){this._reliableTransportState.transport=e,this._updateTransportState()}},{key:"_updateTransportState",value:function(){var e=this._reliableTransportState.transport&&this._reliableTransportState.registration;this._reliableTransportState.overall!==e&&(this._reliableTransportState.overall=e,y.default.info("Transport ready "+e),this.emit("transportReady",e)),this._reliableTransportState.lastEmitted!==this.connectionState&&(this._reliableTransportState.lastEmitted=this.connectionState,this.emit("connectionStateChanged",this.connectionState))}},{key:"subscribe",value:function(e,t){return t=t||"twilsock",y.default.trace("Add subscriptions for message type: ",e,t),this._registrar.subscribe(e,t)}},{key:"unsubscribe",value:function(e,t){return t=t||"twilsock",y.default.trace("Remove subscriptions for message type: ",e,t),this._registrar.unsubscribe(e,t)}},{key:"handlePushNotification",value:function(e){y.default.warn("Push message passed, but no functionality implemented yet: "+e)}},{key:"setPushRegistrationId",value:function(e,t){this._registrar.setNotificationId(t||"gcm",e)}},{key:"_updateToken",value:function(e){var t=this;return y.default.info("authTokenUpdated"),this._fpaToken===e?n.default.resolve():(this._twilsock.updateToken(e),this._emsClient.setToken(e).then(function(e){return e.token}).then(function(e){t._config.updateToken(e),t._registrar.updateToken()}))}}]),h}(o.default);r.default=u,t.exports=r.default},{"./configuration":241,"./logger":243,"./registrar":245,"babel-runtime/core-js/object/define-properties":39,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,bottleneck:69,events:214,"twilio-ems-client":229,"twilio-transport":273,twilsock:276}],241:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=i(e("babel-runtime/core-js/object/define-properties")),o=i(e("babel-runtime/helpers/classCallCheck")),n=i(e("babel-runtime/helpers/createClass"));function i(e){return e&&e.__esModule?e:{default:e}}var a="https://ers.twilio.com",u="/v1/registrations",c=function(){function i(e,t){var r=this;(0,o.default)(this,i);var n=(t=(t||{}).Notification||{}).ersUri||a;(0,s.default)(this,{_registrarUri:{value:n+u},_token:{value:e,writable:!0},registrarUri:{get:function(){return r._registrarUri}},token:{get:function(){return r._token}}})}return(0,n.default)(i,[{key:"updateToken",value:function(e){this._token=e}}]),i}();r.default=c,t.exports=r.default},{"babel-runtime/core-js/object/define-properties":39,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],242:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("./client"),s=(n=i)&&n.__esModule?n:{default:n};r.default=s.default,t.exports=r.default},{"./client":240}],243:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=s(e("babel-runtime/core-js/array/from")),i=s(e("loglevel"));function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return[e].concat((0,n.default)(t))}r.default={setLevel:function(e){i.default.setLevel(e)},trace:function(){i.default.trace.apply(null,o("Notify T:",arguments))},debug:function(){i.default.debug.apply(null,o("Notify D:",arguments))},info:function(){i.default.info.apply(null,o("Notify I:",arguments))},warn:function(){i.default.warn.apply(null,o("Notify W:",arguments))},error:function(){i.default.error.apply(null,o("Notify E:",arguments))}},t.exports=r.default},{"babel-runtime/core-js/array/from":31,loglevel:219}],244:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=v(e("babel-runtime/core-js/object/freeze")),i=v(e("babel-runtime/core-js/promise")),u=v(e("babel-runtime/core-js/set")),c=v(e("babel-runtime/core-js/object/define-properties")),l=v(e("babel-runtime/core-js/object/get-prototype-of")),f=v(e("babel-runtime/helpers/classCallCheck")),s=v(e("babel-runtime/helpers/createClass")),h=v(e("babel-runtime/helpers/possibleConstructorReturn")),o=v(e("babel-runtime/helpers/inherits")),a=v(e("events")),d=v(e("./logger")),p=v(e("javascript-state-machine")),m=v(e("backoff"));function v(e){return e&&e.__esModule?e:{default:e}}function b(e){var t=[];return e.forEach(function(e){return t.push(e)}),t}var y=function(e){function a(e,t,r,n){(0,f.default)(this,a);var i=(0,h.default)(this,(a.__proto__||(0,l.default)(a)).call(this)),s=p.default.create({initial:{state:"unregistered",event:"init",defer:!0},events:[{name:"userUpdate",from:["unregistered"],to:"registering"},{name:"userUpdate",from:["registered"],to:"unregistering"},{name:"registered",from:["registering","retrying"],to:"registered"},{name:"unregistered",from:["unregistering"],to:"unregistered"},{name:"retry",from:["retrying"],to:"retrying"},{name:"failure",from:["registering"],to:"retrying"},{name:"failure",from:["retrying"],to:"retrying"},{name:"failure",from:["unregistering"],to:"unregistered"}],callbacks:{onregistering:function(e,t,r,n){return i._register(n)},onunregistering:function(){return i._unregister()},onregistered:function(){return i._onRegistered()},onunregistered:function(){return i._onUnregistered()},onretrying:function(e,t,r,n){return i._initRetry(n)},onfailure:function(e,t,r,n){"retrying"===t&&i._initRetry(n)}}}),o=m.default.exponential({randomisationFactor:.2,initialDelay:2e3,maxDelay:12e4});return o.on("ready",function(){i._retry()}),(0,c.default)(i,{_transport:{value:t},_context:{value:e},_url:{value:r.registrarUri,writable:!1},_config:{value:r},_fsm:{value:s},_backoff:{value:o},_channelType:{value:n},_registrationId:{value:!1,writable:!0},_notificationId:{value:!1,writable:!0},_messageTypes:{value:new u.default,writable:!0},_pendingUpdate:{value:null,writable:!0}}),s.init(),i}return(0,o.default)(a,e),(0,s.default)(a,[{key:"setNotificationId",value:function(e){this._notificationId!==e&&(this._notificationId=e,this._updateRegistration())}},{key:"updateToken",value:function(){return this._updateRegistration()}},{key:"has",value:function(e){return this._messageTypes.has(e)}},{key:"subscribe",value:function(e){return this._messageTypes.has(e)?(d.default.debug("Message type already registered ",e),!1):(this._messageTypes.add(e),this._updateRegistration(),!0)}},{key:"unsubscribe",value:function(e){return!!this._messageTypes.has(e)&&(this._messageTypes.delete(e),0<this._messageTypes.size?this._updateRegistration():this._removeRegistration(),!0)}},{key:"_updateRegistration",value:function(){this._notificationId&&this._update(this._notificationId,b(this._messageTypes))}},{key:"_removeRegistration",value:function(){this._notificationId&&this._update(this._notificationId,b(this._messageTypes))}},{key:"_update",value:function(e,t){var r={notificationId:e,messageTypes:t};this._fsm.is("unregistered")?r.notificationId&&0<r.messageTypes.length&&this._fsm.userUpdate(r):(this._fsm.is("registered")&&this._fsm.userUpdate(r),this._setPendingUpdate(r))}},{key:"_setPendingUpdate",value:function(e){this._pendingUpdate=e}},{key:"_checkPendingUpdate",value:function(){if(this._pendingUpdate){var e=this._pendingUpdate;this._pendingUpdate=null,this._updateRegistration(e.notificationId,e.messageTypes)}}},{key:"_initRetry",value:function(e){this._pendingUpdate||this._setPendingUpdate(e),this._backoff.backoff()}},{key:"_retry",value:function(){if(this._pendingUpdate){var e=this._pendingUpdate;this._pendingUpdate=null,this._register(e)}}},{key:"_onRegistered",value:function(){this._backoff.reset(),this.emit("stateChanged","registered"),this._checkPendingUpdate()}},{key:"_onUnregistered",value:function(){this._backoff.reset(),this.emit("stateChanged","unregistered"),this._checkPendingUpdate()}},{key:"_register",value:function(t){var r=this,e={endpoint_platform:this._context.platform,channel_type:this._channelType,version:"2",message_types:t.messageTypes,data:{},ttl:"PT24H"};"twilsock"===this._channelType?e.data.url=t.notificationId:e.data.registration_id=t.notificationId;var n=this._url+"?productId="+this._context.productId,i={"Content-Type":"application/json","X-Twilio-Token":this._config.token};return d.default.trace("Creating registration for channel ",this._channelType),this._transport.post(n,i,e).then(function(e){r._registrationId=e.body.id,r._registrationData=t,d.default.debug("Registration created: ",e),r._fsm.registered()}).catch(function(e){return d.default.error("Registration failed: ",e),r._fsm.failure(t),e})}},{key:"_unregister",value:function(){var t=this;if(!this._registrationId)return i.default.resolve();var e=this._url+"/"+this._registrationId+"?productId="+this._context.productId,r={"Content-Type":"application/json","X-Twilio-Token":this._config.token};return d.default.trace("Removing registration for ",this._channelType),this._transport.delete(e,r).then(function(){d.default.debug("Registration removed for ",t._channelType),t._registrationId=!1,t._fsm.unregistered()}).catch(function(e){return d.default.error("Failed to remove of registration ",t.channelType,e),t._fsm.failure(),e})}}]),a}(a.default);r.default=y,(0,n.default)(y),t.exports=r.default},{"./logger":243,"babel-runtime/core-js/object/define-properties":39,"babel-runtime/core-js/object/freeze":41,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/core-js/set":47,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,backoff:58,events:214,"javascript-state-machine":217}],245:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=p(e("babel-runtime/core-js/object/freeze")),a=p(e("babel-runtime/core-js/map")),u=p(e("babel-runtime/core-js/object/define-properties")),c=p(e("babel-runtime/core-js/object/get-prototype-of")),l=p(e("babel-runtime/helpers/classCallCheck")),i=p(e("babel-runtime/helpers/createClass")),f=p(e("babel-runtime/helpers/possibleConstructorReturn")),s=p(e("babel-runtime/helpers/inherits")),o=p(e("events")),h=p(e("./registrar.connector")),d=p(e("./twilsock.connector"));function p(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function o(e,t,r,n){(0,l.default)(this,o);var i=(0,f.default)(this,(o.__proto__||(0,c.default)(o)).call(this));(0,u.default)(i,{_conf:{value:n},_connectors:{value:new a.default}});var s=i._detectPlatform();return i._connectors.set("twilsock",new d.default({productId:e,platform:s},r,n)),i._connectors.set("gcm",new h.default({productId:e,platform:s},t,n,"gcm")),i._connectors.set("fcm",new h.default({productId:e,platform:s},t,n,"fcm")),i._connectors.set("apn",new h.default({productId:e,platform:s},t,n,"apn")),i._connectors.get("twilsock").on("transportReady",function(e){return i.emit("transportReady",e)}),i}return(0,s.default)(o,e),(0,i.default)(o,[{key:"setNotificationId",value:function(e,t){this._connector(e).setNotificationId(t)}},{key:"hasSubscription",value:function(e,t){this._connector(t).has(e)}},{key:"subscribe",value:function(e,t){this._connector(t).subscribe(e)}},{key:"unsubscribe",value:function(e,t){this._connector(t).unsubscribe(e)}},{key:"updateToken",value:function(){this._connectors.forEach(function(e){return e.updateToken()})}},{key:"_connector",value:function(e){var t=this._connectors.get(e);if(!t)throw new Error("Unknown channel type: "+e);return t}},{key:"_detectPlatform",value:function(){var e="";return"undefined"!=typeof navigator?(e="unknown",void 0!==navigator.product&&(e=navigator.product),void 0!==navigator.userAgent&&(e=navigator.userAgent)):e="web",e.substring(0,128)}}]),o}(o.default);r.default=m,(0,n.default)(m),t.exports=r.default},{"./registrar.connector":244,"./twilsock.connector":246,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/define-properties":39,"babel-runtime/core-js/object/freeze":41,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,events:214}],246:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=p(e("babel-runtime/core-js/object/freeze")),s=p(e("babel-runtime/core-js/set")),o=p(e("babel-runtime/core-js/object/define-properties")),a=p(e("babel-runtime/core-js/object/get-prototype-of")),u=p(e("babel-runtime/helpers/classCallCheck")),c=p(e("babel-runtime/helpers/createClass")),l=p(e("babel-runtime/helpers/possibleConstructorReturn")),f=p(e("babel-runtime/helpers/inherits")),h=p(e("uuid")),d=p(e("./logger")),i=p(e("events"));function p(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function i(t,r,e){(0,u.default)(this,i);var n=(0,l.default)(this,(i.__proto__||(0,a.default)(i)).call(this));return t.id=h.default.v4(),(0,o.default)(n,{_twilsock:{value:r},_messageTypes:{value:new s.default},config:{value:e},context:{value:t}}),r.on("stateChanged",function(e){"connected"!==e&&n.emit("transportReady",!1)}),r.on("registered",function(e){t&&e===t.id&&"connected"===r.state&&n.emit("transportReady",!0)}),n}return(0,f.default)(i,e),(0,c.default)(i,[{key:"setNotificationId",value:function(){return!1}},{key:"updateToken",value:function(){this._twilsock.removeNotificationsContext(this.context.id),this.context.id=h.default.v4(),this._updateContext()}},{key:"has",value:function(e){return this._messageTypes.has(e)}},{key:"subscribe",value:function(e){return this._messageTypes.has(e)?(d.default.trace("Message type already registered ",e),!1):(this._messageTypes.add(e),this._updateContext(),!0)}},{key:"unsubscribe",value:function(e){return!!this._messageTypes.has(e)&&(this._messageTypes.delete(e),0<this._messageTypes.size?this._updateContext():this._twilsock.removeNotificationsContext(this.context.id),!0)}},{key:"_updateContext",value:function(){if(this.config.token){var e,t,r=(e=this._messageTypes,t=[],e.forEach(function(e){return t.push(e)}),t),n={product_id:this.context.productId,notification_protocol_version:4,endpoint_platform:this.context.platform,ttl:172800,token:this.config.token,message_types:r};this.emit("transportReady",!1),this._twilsock.setNotificationsContext(this.context.id,n)}}}]),i}(i.default);r.default=m,(0,n.default)(m),t.exports=r.default},{"./logger":243,"babel-runtime/core-js/object/define-properties":39,"babel-runtime/core-js/object/freeze":41,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/set":47,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,events:214,uuid:283}],247:[function(e,t,r){"use strict";var n=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("karibu"),a=function(){function r(e,t){(0,n.default)(this,r),this.value=e,this.revision=t||0}return(0,i.default)(r,[{key:"isValid",get:function(){return!0}}]),r}(),u=function(){function t(e){(0,n.default)(this,t),this.revision=e}return(0,i.default)(t,[{key:"isValid",get:function(){return!1}}]),t}(),c=function(){function e(){(0,n.default)(this,e),this.items=new o.TreeMap}return(0,i.default)(e,[{key:"store",value:function(e,t,r){var n=this.items.get(e);return n&&n.revision>r?n.isValid?n.value:null:(this.items.set(e,new a(t,r)),t)}},{key:"delete",value:function(e,t){var r=this.items.get(e);(!r||r.revision<t)&&this.items.set(e,new u(t))}},{key:"isKnown",value:function(e,t){var r=this.items.get(e);return r&&r.revision>=t}},{key:"get",value:function(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}},{key:"has",value:function(e){var t=this.items.get(e);return t&&t.isValid}}]),e}();r.Cache=c,r.default=c},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,karibu:218}],248:[function(e,t,r){"use strict";var u=o(e("babel-runtime/regenerator")),d=o(e("babel-runtime/core-js/object/get-prototype-of")),p=o(e("babel-runtime/helpers/classCallCheck")),n=o(e("babel-runtime/helpers/createClass")),m=o(e("babel-runtime/helpers/possibleConstructorReturn")),i=o(e("babel-runtime/helpers/inherits")),s=o(e("babel-runtime/helpers/extends")),c=o(e("babel-runtime/core-js/promise"));function o(e){return e&&e.__esModule?e:{default:e}}var l=function(s,o,a,u){return new(a||(a=c.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var a=e("events"),f=e("xxhashjs"),v=e("twilsock"),b=e("twilio-transport"),y=e("twilio-ems-client"),_=e("twilio-notifications"),g=e("./utils"),k=e("./logger"),w=e("./configuration"),x=e("./subscriptions"),C=e("./router"),j=e("./network"),S=e("./syncdocument"),E=e("./synclist"),T=e("./syncmap"),I=e("./clientInfo"),R=e("./entitiesCache"),M=e("./services/storage"),P=e("./utils"),A=e("./utils/deferred"),O=e("./syncerror"),N=e("./streams/syncstream"),D="data_sync",U=e("../package.json").version;function L(e){return e._subscribe(),e}function F(e){if(e){if("string"==typeof e)return{id:e,mode:"open_or_create"};g.validateOptionalTtl(e.ttl);var t=e.mode||(e.id?"open_or_create":"create_new");return(0,s.default)({},e,{mode:t})}return{mode:"create_new"}}var h=function(e){function h(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,p.default)(this,h);var r=(0,m.default)(this,(h.__proto__||(0,d.default)(h)).call(this));if(!e)throw new Error("Sync library needs a valid Twilio token to be passed");t.hasOwnProperty("logLevel")&&k.default.setLevel(t.logLevel),r.productId=t.productId=t.productId||D;var n=t.twilsockClient=t.twilsockClient||new v(e,t),i=t.transport=t.transport||new b.Transport(t.twilsockClient,{concurrentHttpRequestLimit:20}),s=t.emsClient=t.emsClient||new y.EmsClient(t),o=t.notificationsClient=t.notificationsClient||new _(e,t),a=new w.Configuration(null,t),u=new j.Network(r.productId,new I.ClientInfo(U),a,i),c=new M.SessionStorage(a);r.localStorageId=null,r.fpaToken=e,r.authData=new A.Deferred,r.authData.promise.then(function(e){return r.handleEmsResponse(e)}),s.once("response",function(e){return r.authData.update(e)}),s.setToken(e).catch(function(e){k.default.warn("Failed to set token",e)}),n.connect(),r.services={config:a,twilsock:n,notifications:o,network:u,emsClient:s,storage:c,router:null,subscriptions:null};var l=new x.Subscriptions(r.services),f=new C.Router({config:a,subscriptions:l,notifications:o});return r.services.router=f,r.services.subscriptions=l,r.entities=new R.EntitiesCache,o.on("connectionStateChanged",function(){r.emit("connectionStateChanged",r.services.notifications.connectionState)}),r}return(0,i.default)(h,e),(0,n.default)(h,[{key:"handleEmsResponse",value:function(e){this.services.config.updateToken(e.token);try{var t=e.identity,r=e.serviceSids[this.productId],n=f.h64().update("TW::"+t+"::"+r).digest().toString(16);this.services.storage.updateStorageId(n)}catch(e){k.default.error("Failed to initialize persistent storage",e)}}},{key:"ensureReady",value:function(){return l(this,void 0,void 0,u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.authData.promise;case 2:case"end":return e.stop()}},e,this)}))}},{key:"storeRootInSessionCache",value:function(e,t,r){if(this.services.config.sessionStorageEnabled&&t){var n=P.deepClone(r);e!==E.SyncList.type&&e!==T.SyncMap.type||(n.last_event_id=null,delete n.items),this.services.storage.store(e,t,n)}}},{key:"readRootFromSessionCache",value:function(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}},{key:"_get",value:function(n,i){var s=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return l(this,void 0,void 0,u.default.mark(function e(){var t,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",null);case 2:return t=new g.UriBuilder(n).pathSegment(i).queryParam("Include",s?"items":void 0).build(),e.next=5,this.services.network.get(t);case 5:return r=e.sent,e.abrupt("return",r.body);case 7:case"end":return e.stop()}},e,this)}))}},{key:"_createDocument",value:function(e,t,r){var n={unique_name:e,data:t||{}};return"number"==typeof r&&(n.ttl=r),this.services.network.post(this.services.config.documentsUri,n).then(function(e){return e.body.data=n.data,e.body})}},{key:"_getDocument",value:function(t){return l(this,void 0,void 0,u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(S.SyncDocument.type,t)||this._get(this.services.config.documentsUri,t));case 1:case"end":return e.stop()}},e,this)}))}},{key:"_createList",value:function(e,t,r,n){var i={unique_name:e,purpose:t,context:r};return"number"==typeof n&&(i.ttl=n),this.services.network.post(this.services.config.listsUri,i).then(function(e){return e.body})}},{key:"_getList",value:function(t){return l(this,void 0,void 0,u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(E.SyncList.type,t)||this._get(this.services.config.listsUri,t));case 1:case"end":return e.stop()}},e,this)}))}},{key:"_createMap",value:function(e,t){var r={unique_name:e};return"number"==typeof t&&(r.ttl=t),this.services.network.post(this.services.config.mapsUri,r).then(function(e){return e.body})}},{key:"_getMap",value:function(t){var r=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return l(this,void 0,void 0,u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(T.SyncMap.type,t)||this._get(this.services.config.mapsUri,t,r));case 1:case"end":return e.stop()}},e,this)}))}},{key:"_getStream",value:function(t){return l(this,void 0,void 0,u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(N.SyncStream.type,t)||this._get(this.services.config.streamsUri,t,!1));case 1:case"end":return e.stop()}},e,this)}))}},{key:"_createStream",value:function(i,s){return l(this,void 0,void 0,u.default.mark(function e(){var t,r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={unique_name:i},"number"==typeof s&&(t.ttl=s),e.next=4,this.services.network.post(this.services.config.streamsUri,t);case 4:return r=e.sent,n=r.body,e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}))}},{key:"getCached",value:function(e,t){return e&&this.entities.get(e,t)||null}},{key:"removeFromCacheAndSession",value:function(e,t,r){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,r)}},{key:"document",value:function(o){return l(this,void 0,void 0,u.default.mark(function e(){var t,r,n,i,s=this;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if(t=F(o),r=void 0,"create_new"!==t.mode){e.next=10;break}return e.next=7,this._createDocument(t.id,t.value,t.ttl);case 7:r=e.sent,e.next=40;break;case 10:if(!(n=this.getCached(t.id,S.SyncDocument.type))){e.next=15;break}return e.abrupt("return",n);case 15:return e.prev=15,e.next=18,this._getDocument(t.id);case 18:r=e.sent,e.next=40;break;case 21:if(e.prev=21,e.t0=e.catch(15),404===e.t0.status&&"open_existing"!==t.mode){e.next=27;break}throw e.t0;case 27:return e.prev=27,e.next=30,this._createDocument(t.id,t.value,t.ttl);case 30:r=e.sent,e.next=40;break;case 33:if(e.prev=33,e.t1=e.catch(27),409!==e.t1.status){e.next=39;break}return e.abrupt("return",this.document(o));case 39:throw e.t1;case 40:return this.storeRootInSessionCache(S.SyncDocument.type,t.id,r),i=new S.SyncDocument(this.services,r,function(e,t,r){return s.removeFromCacheAndSession(e,t,r)}),i=this.entities.store(i),e.abrupt("return",L(i));case 44:case"end":return e.stop()}},e,this,[[15,21],[27,33]])}))}},{key:"map",value:function(o){return l(this,void 0,void 0,u.default.mark(function e(){var t,r,n,i,s=this;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if(t=F(o),r=void 0,"create_new"!==t.mode){e.next=10;break}return e.next=7,this._createMap(t.id,t.ttl);case 7:r=e.sent,e.next=40;break;case 10:if(!(n=this.getCached(t.id,T.SyncMap.type))){e.next=15;break}return e.abrupt("return",n);case 15:return e.prev=15,e.next=18,this._getMap(t.id,t.includeItems);case 18:r=e.sent,e.next=40;break;case 21:if(e.prev=21,e.t0=e.catch(15),404===e.t0.status&&"open_existing"!==t.mode){e.next=27;break}throw e.t0;case 27:return e.prev=27,e.next=30,this._createMap(t.id,t.ttl);case 30:r=e.sent,e.next=40;break;case 33:if(e.prev=33,e.t1=e.catch(27),409!==e.t1.status){e.next=39;break}return e.abrupt("return",this.map(o));case 39:throw e.t1;case 40:return this.storeRootInSessionCache(T.SyncMap.type,t.id,r),i=new T.SyncMap(this.services,r,function(e,t,r){return s.removeFromCacheAndSession(e,t,r)}),i=this.entities.store(i),e.abrupt("return",L(i));case 44:case"end":return e.stop()}},e,this,[[15,21],[27,33]])}))}},{key:"list",value:function(o){return l(this,void 0,void 0,u.default.mark(function e(){var t,r,n,i,s=this;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if(t=F(o),r=void 0,"create_new"!==t.mode){e.next=10;break}return e.next=7,this._createList(t.id,t.purpose,t.context,t.ttl);case 7:r=e.sent,e.next=40;break;case 10:if(!(n=this.getCached(t.id,E.SyncList.type))){e.next=15;break}return e.abrupt("return",n);case 15:return e.prev=15,e.next=18,this._getList(t.id);case 18:r=e.sent,e.next=40;break;case 21:if(e.prev=21,e.t0=e.catch(15),404===e.t0.status&&"open_existing"!==t.mode){e.next=27;break}throw e.t0;case 27:return e.prev=27,e.next=30,this._createList(t.id,t.purpose,t.context,t.ttl);case 30:r=e.sent,e.next=40;break;case 33:if(e.prev=33,e.t1=e.catch(27),409!==e.t1.status){e.next=39;break}return e.abrupt("return",this.list(o));case 39:throw e.t1;case 40:return this.storeRootInSessionCache(E.SyncList.type,t.id,r),i=new E.SyncList(this.services,r,function(e,t,r){return s.removeFromCacheAndSession(e,t,r)}),i=this.entities.store(i),e.abrupt("return",L(i));case 44:case"end":return e.stop()}},e,this,[[15,21],[27,33]])}))}},{key:"stream",value:function(a){return l(this,void 0,void 0,u.default.mark(function e(){var t,r,n,i,s,o=this;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if(t=F(a),r=void 0,"create_new"!==t.mode){e.next=10;break}return e.next=7,this._createStream(t.id,t.ttl);case 7:r=e.sent,e.next=40;break;case 10:if(!(n=this.getCached(t.id,N.SyncStream.type))){e.next=15;break}return e.abrupt("return",n);case 15:return e.prev=15,e.next=18,this._getStream(t.id);case 18:r=e.sent,e.next=40;break;case 21:if(e.prev=21,e.t0=e.catch(15),404===e.t0.status&&"open_existing"!==t.mode){e.next=27;break}throw e.t0;case 27:return e.prev=27,e.next=30,this._createStream(t.id,t.ttl);case 30:r=e.sent,e.next=40;break;case 33:if(e.prev=33,e.t1=e.catch(27),409!==e.t1.status){e.next=39;break}return e.abrupt("return",this.stream(a));case 39:throw e.t1;case 40:return this.storeRootInSessionCache(N.SyncStream.type,t.id,r),i=function(e,t,r){return o.removeFromCacheAndSession(e,t,r)},s=new N.SyncStream(this.services,r,i),s=this.entities.store(s),e.abrupt("return",L(s));case 45:case"end":return e.stop()}},e,this,[[15,21],[27,33]])}))}},{key:"shutdown",value:function(){return l(this,void 0,void 0,u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.subscriptions.shutdown();case 2:return e.next=4,this.services.twilsock.disconnect();case 4:case"end":return e.stop()}},e,this)}))}},{key:"updateToken",value:function(r){return l(this,void 0,void 0,u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.emsClient.setToken(r);case 2:if("NEW"!==(t=e.sent).status){e.next=8;break}throw k.default.error("Failed to update token: "+t.reason),new O.default("Failed to update token: "+t.reason,400,0);case 8:return this.services.config.updateToken(t.token),e.next=11,c.default.all([this.services.notifications.updateToken(r),this.services.twilsock.updateToken(r)]);case 11:this.fpaToken=r;case 12:case"end":return e.stop()}},e,this)}))}},{key:"connectionState",get:function(){return this.services.notifications.connectionState}}],[{key:"version",get:function(){return U}}]),h}(a.EventEmitter);r.Client=h,r.SyncClient=h,r.default=h},{"../package.json":271,"./clientInfo":249,"./configuration":250,"./entitiesCache":251,"./logger":255,"./network":258,"./router":260,"./services/storage":261,"./streams/syncstream":262,"./subscriptions":263,"./syncdocument":265,"./syncerror":266,"./synclist":267,"./syncmap":268,"./utils":269,"./utils/deferred":270,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/extends":52,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57,events:214,"twilio-ems-client":229,"twilio-notifications":242,"twilio-transport":273,twilsock:276,xxhashjs:288}],249:[function(e,t,r){"use strict";var n,i=e("babel-runtime/helpers/classCallCheck"),s=(n=i)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});var o=e("platform"),a=function e(t){(0,s.default)(this,e),this.sdk="js",this.sdkVer=t,this.os=o.os.family,this.osVer=o.os.version,this.pl=o.name,this.plVer=o.version};r.ClientInfo=a,r.default=a},{"babel-runtime/helpers/classCallCheck":50,platform:221}],250:[function(e,t,r){"use strict";var a=i(e("babel-runtime/helpers/classCallCheck")),n=i(e("babel-runtime/helpers/createClass"));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u="https://cds.twilio.com",c="/v4/Subscriptions",l="/v3/Maps",f="/v3/Lists",h="/v3/Documents",d="/v3/Streams";var s=function(){function o(e,t){(0,a.default)(this,o);var r,n,i,s=(t=(t=t||{}).Sync||t.DataSync||{}).cdsUri||u;this._token=e,this.settings={subscriptionsUri:s+c,documentsUri:s+h,listsUri:s+f,mapsUri:s+l,streamsUri:s+d,sessionStorageEnabled:(r=t,n="enableSessionStorage",i=!0,r&&void 0!==r[n]?r[n]:i)}}return(0,n.default)(o,[{key:"updateToken",value:function(e){this._token=e}},{key:"token",get:function(){return this._token}},{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"streamsUri",get:function(){return this.settings.streamsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}}]),o}();r.Configuration=s},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],251:[function(e,t,r){"use strict";var n=o(e("babel-runtime/core-js/map")),i=o(e("babel-runtime/helpers/classCallCheck")),s=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(){(0,i.default)(this,e),this.names=new n.default,this.entities=new n.default}return(0,s.default)(e,[{key:"store",value:function(e){var t=this.entities.get(e.sid);return t||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}},{key:"getResolved",value:function(e,t){var r=this.names.get(t+"::"+e);return r?this.entities.get(r):null}},{key:"get",value:function(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}},{key:"remove",value:function(e){var t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}]),e}();r.EntitiesCache=a},{"babel-runtime/core-js/map":35,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],252:[function(e,t,r){"use strict";var i=n(e("babel-runtime/core-js/object/get-prototype-of")),s=n(e("babel-runtime/helpers/classCallCheck")),o=n(e("babel-runtime/helpers/createClass")),a=n(e("babel-runtime/helpers/possibleConstructorReturn")),u=n(e("babel-runtime/helpers/inherits"));function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){function n(e,t){(0,s.default)(this,n);var r=(0,a.default)(this,(n.__proto__||(0,i.default)(n)).call(this));return r.services=e,r.removalHandler=t,r.subscriptionState="none",r}return(0,u.default)(n,e),(0,o.default)(n,[{key:"_advanceLastEventId",value:function(e,t){}},{key:"reportFailure",value:function(e){404===e.status?this.onRemoved(!1):this.emit("failure",e)}},{key:"_subscribe",value:function(){return this.services.router.subscribe(this.sid,this),this}},{key:"_unsubscribe",value:function(){return this.services.router.unsubscribe(this.sid,this),this}},{key:"_setSubscriptionState",value:function(e){this.subscriptionState=e,this.emit("_subscriptionStateChanged",e)}},{key:"close",value:function(){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName)}}]),n}(e("events").EventEmitter);r.SyncEntity=c,r.default=c},{"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,events:214}],253:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./client");r.SyncClient=n.SyncClient;var i=e("./syncdocument");r.SyncDocument=i.SyncDocument;var s=e("./synclist");r.SyncList=s.SyncList;var o=e("./listitem");r.SyncListItem=o.ListItem;var a=e("./syncmap");r.SyncMap=a.SyncMap;var u=e("./mapitem");r.SyncMapItem=u.MapItem,r.default=n.SyncClient,t.exports=n.SyncClient,t.exports.SyncClient=n.SyncClient},{"./client":248,"./listitem":254,"./mapitem":256,"./syncdocument":265,"./synclist":267,"./syncmap":268}],254:[function(e,t,r){"use strict";var n=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(e){(0,n.default)(this,t),this.data=e}return(0,i.default)(t,[{key:"update",value:function(e,t,r,n){return this.data.lastEventId=e,this.data.revision=t,this.data.value=r,this.data.dateUpdated=n,this}},{key:"updateDateExpires",value:function(e){this.data.dateExpires=e}},{key:"uri",get:function(){return this.data.uri}},{key:"revision",get:function(){return this.data.revision}},{key:"lastEventId",get:function(){return this.data.lastEventId}},{key:"dateUpdated",get:function(){return this.data.dateUpdated}},{key:"dateExpires",get:function(){return this.data.dateExpires}},{key:"index",get:function(){return this.data.index}},{key:"value",get:function(){return this.data.value}}]),t}();r.ListItem=o,r.default=o},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],255:[function(e,t,r){"use strict";var n,i=e("babel-runtime/core-js/array/from"),s=(n=i)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});var o=e("loglevel");function a(e,t){return[e].concat((0,s.default)(t))}r.default={setLevel:function(e){o.setLevel(e)},trace:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.trace.apply(null,a("Sync T:",t))},debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.debug.apply(null,a("Sync D:",t))},info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.info.apply(null,a("Sync I:",t))},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.warn.apply(null,a("Sync W:",t))},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.error.apply(null,a("Sync E:",t))}}},{"babel-runtime/core-js/array/from":31,loglevel:219}],256:[function(e,t,r){"use strict";var n=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(e){(0,n.default)(this,t),this.descriptor=e}return(0,i.default)(t,[{key:"update",value:function(e,t,r,n){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=r,this.descriptor.date_updated=n,this}},{key:"updateDateExpires",value:function(e){this.descriptor.date_expires=e}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"key",get:function(){return this.descriptor.key}},{key:"value",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}]),t}();r.MapItem=o,r.default=o},{"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],257:[function(e,t,r){"use strict";var s=a(e("babel-runtime/regenerator")),n=a(e("babel-runtime/core-js/map")),i=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass")),c=a(e("babel-runtime/core-js/promise"));function a(e){return e&&e.__esModule?e:{default:e}}var u=function(s,o,a,u){return new(a||(a=c.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function t(e){(0,i.default)(this,t),this.queuedRequests=[],this.isRequestInFlight=!1,this.inputMergingFunction=e}return(0,o.default)(t,[{key:"add",value:function(r,n){var i=this,e=new c.default(function(e,t){return i.queuedRequests.push({input:r,requestFunction:n,resolve:e,reject:t})});return this.wakeupQueue(),e}},{key:"squashAndAdd",value:function(e,t){var r=this.queuedRequests;this.queuedRequests=[];var n=void 0;0<r.length?(n=r.map(function(e){return e.input}).reduce(this.inputMergingFunction),n=this.inputMergingFunction(n,e)):n=e;var i=this.add(n,t);return r.forEach(function(e){return i.then(e.resolve,e.reject)}),i}},{key:"isEmpty",value:function(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}},{key:"wakeupQueue",value:function(){var t=this;if(0!==this.queuedRequests.length&&!this.isRequestInFlight){var e=this.queuedRequests.shift();this.isRequestInFlight=!0,e.requestFunction(e.input).then(e.resolve,e.reject).then(function(e){t.isRequestInFlight=!1,t.wakeupQueue()})}}}]),t}();r.MergingQueue=l;var f=function(){function t(e){(0,i.default)(this,t),this.queueByNamespaceKey=new n.default,this.inputReducer=e}return(0,o.default)(t,[{key:"add",value:function(t,r,n){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,function(e){return e.add(r,n)}));case 1:case"end":return e.stop()}},e,this)}))}},{key:"squashAndAdd",value:function(t,r,n){return u(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,function(e){return e.squashAndAdd(r,n)}));case 1:case"end":return e.stop()}},e,this)}))}},{key:"invokeQueueMethod",value:function(n,i){return u(this,void 0,void 0,s.default.mark(function e(){var t,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.queueByNamespaceKey.has(n)||this.queueByNamespaceKey.set(n,new l(this.inputReducer)),t=this.queueByNamespaceKey.get(n),r=i(t),this.queueByNamespaceKey.get(n).isEmpty()&&this.queueByNamespaceKey.delete(n),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}))}}]),t}();r.NamespacedMergingQueue=f},{"babel-runtime/core-js/map":35,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":57}],258:[function(e,t,r){"use strict";var n=i(e("babel-runtime/core-js/promise")),s=i(e("babel-runtime/helpers/extends")),o=i(e("babel-runtime/core-js/json/stringify")),a=i(e("babel-runtime/helpers/classCallCheck")),u=i(e("babel-runtime/helpers/createClass"));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=e("uuid"),l=e("./logger"),f=e("./syncerror"),h=e("./syncNetworkError"),d=e("operation-retrier"),p=e("twilio-transport");function m(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function v(e){return e.body?e.body.code:0}function b(e){return 409===e.status?new h.SyncNetworkError(m(e),e.status,v(e),e.body):e.status?new f.SyncError(m(e),e.status,v(e)):e instanceof p.TwilsockUnavailableError?e:new f.SyncError(e.message,0,0)}var y=function(){function i(e,t,r,n){(0,a.default)(this,i),this.productId=e,this.clientInfo=t,this.config=r,this.transport=n}return(0,u.default)(i,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":(0,o.default)(this.clientInfo),"Twilio-Request-Id":"RQ"+c.v4().replace(/-/g,""),"X-Twilio-Product-Id":this.productId,"X-Twilio-Token":this.config.token}}},{key:"backoffConfig",value:function(){return(0,s.default)({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(e){var s=this,o=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return new n.default(function(t,r){var n=[502,503,504];o&&n.push(429);var i=new d.default(s.backoffConfig());i.on("attempt",function(){e().then(function(e){return i.succeeded(e)}).catch(function(e){if(-1!==n.indexOf(e.status)){var t=parseInt(e.headers?e.headers["Retry-After"]:null);i.failed(b(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?i.failed(b(e)):e.message&&-1!==e.message.indexOf("Twilsock: request timeout")?i.failed(b(e)):(i.removeAllListeners(),i.cancel(),r(b(e)))})}),i.on("succeeded",function(e){t(e)}),i.on("cancelled",function(e){return r(b(e))}),i.on("failed",function(e){return r(b(e))}),i.start()})}},{key:"get",value:function(e){var t=this,r=this.createHeaders();return l.default.debug("GET",e,"ID:",r["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport.get(e,r)},!0)}},{key:"post",value:function(e,t,r,n){var i=this,s=this.createHeaders();return null!=r&&(s["If-Match"]=r),l.default.debug("POST",e,"ID:",s["Twilio-Request-Id"]),this.executeWithRetry(function(){return i.transport.post(e,s,t,n)},!1)}},{key:"put",value:function(e,t,r){var n=this,i=this.createHeaders();return null!=r&&(i["If-Match"]=r),l.default.debug("PUT",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry(function(){return n.transport.put(e,i,t)},!1)}},{key:"delete",value:function(e){var t=this,r=this.createHeaders();return l.default.debug("DELETE",e,"ID:",r["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport.delete(e,r)},!1)}}]),i}();r.Network=y,r.default=y},{"./logger":255,"./syncNetworkError":264,"./syncerror":266,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/extends":52,"operation-retrier":220,"twilio-transport":273,uuid:283}],259:[function(e,t,r){"use strict";var n=a(e("babel-runtime/regenerator")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass")),i=a(e("babel-runtime/core-js/promise"));function a(e){return e&&e.__esModule?e:{default:e}}var u=function(s,o,a,u){return new(a||(a=i.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function i(e,t,r,n){(0,s.default)(this,i),this.prevToken=r,this.nextToken=n,this.items=e,this.source=t}return(0,o.default)(i,[{key:"nextPage",value:function(){return u(this,void 0,void 0,n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new Error("No next page");case 2:return e.abrupt("return",this.source(this.nextToken));case 3:case"end":return e.stop()}},e,this)}))}},{key:"prevPage",value:function(){return u(this,void 0,void 0,n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPrevPage){e.next=2;break}throw new Error("No previous page");case 2:return e.abrupt("return",this.source(this.prevToken));case 3:case"end":return e.stop()}},e,this)}))}},{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}}]),i}();r.Paginator=c,r.default=c},{"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":57}],260:[function(e,t,r){"use strict";var n=o(e("babel-runtime/regenerator")),i=o(e("babel-runtime/helpers/classCallCheck")),s=o(e("babel-runtime/helpers/createClass")),c=o(e("babel-runtime/core-js/promise"));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(s,o,a,u){return new(a||(a=c.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var u=e("./logger"),l="com.twilio.rtd.cds.document",f="com.twilio.rtd.cds.list",h="com.twilio.rtd.cds.map",d="twilio.sync.event",p=function(){function t(e){var r=this;(0,i.default)(this,t),this.config=e.config,this.subscriptions=e.subscriptions,this.notifications=e.notifications,this.notifications.subscribe(d),this.notifications.subscribe(l),this.notifications.subscribe(f),this.notifications.subscribe(h),this.notifications.on("message",function(e,t){return r.onMessage(e,t)}),this.notifications.on("transportReady",function(e){return r.onConnectionStateChanged(e)})}return(0,s.default)(t,[{key:"onMessage",value:function(e,t){switch(u.default.trace("Notification type:",e,"content:",t),e){case l:case f:case h:this.subscriptions.acceptMessage(t,!1);break;case d:this.subscriptions.acceptMessage(t,!0)}}},{key:"subscribe",value:function(t,r){return a(this,void 0,void 0,n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.subscriptions.add(t,r);case 2:case"end":return e.stop()}},e,this)}))}},{key:"unsubscribe",value:function(t,e){return a(this,void 0,void 0,n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.subscriptions.remove(t);case 2:case"end":return e.stop()}},e,this)}))}},{key:"onConnectionStateChanged",value:function(e){this.subscriptions.onConnectionStateChanged(e)}}]),t}();r.Router=p,r.default=p},{"./logger":255,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/regenerator":57}],261:[function(e,t,r){"use strict";var n=a(e("babel-runtime/helpers/extends")),i=a(e("babel-runtime/core-js/json/stringify")),s=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function r(e,t){(0,s.default)(this,r),this.config=e,this.storageId=null;try{this.storage=t||sessionStorage}catch(e){}}return(0,o.default)(r,[{key:"storageKey",value:function(e,t){return this.storageId+"::"+e+"::"+t}},{key:"updateStorageId",value:function(e){this.storageId=e}},{key:"store",value:function(e,t,r){return this.isReady?this._store(this.storageKey(e,t),r):null}},{key:"read",value:function(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}},{key:"remove",value:function(e,t,r){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),r&&this.storage.removeItem(this.storageKey(e,r))}catch(e){}}},{key:"update",value:function(e,t,r,n){if(!this.isReady)return null;this._apply(this.storageKey(e,t),n),r&&this._apply(this.storageKey(e,r),n)}},{key:"_store",value:function(e,t){try{this.storage.setItem(e,(0,i.default)(t))}catch(e){}}},{key:"_read",value:function(e){try{var t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(e){}return null}},{key:"_apply",value:function(e,t){var r=this._read(e);if(!r)return!1;this._store(e,(0,n.default)(r,t))}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}}]),r}();r.SessionStorage=u},{"babel-runtime/core-js/json/stringify":34,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/extends":52}],262:[function(e,t,r){"use strict";var o=l(e("babel-runtime/regenerator")),s=l(e("babel-runtime/core-js/object/get-prototype-of")),a=l(e("babel-runtime/helpers/classCallCheck")),n=l(e("babel-runtime/helpers/createClass")),u=l(e("babel-runtime/helpers/possibleConstructorReturn")),c=l(e("babel-runtime/helpers/inherits")),i=l(e("babel-runtime/core-js/promise"));function l(e){return e&&e.__esModule?e:{default:e}}var f=function(s,o,a,u){return new(a||(a=i.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var h=e("../entity"),d=e("../utils"),p=function(e){function i(e,t,r){(0,a.default)(this,i);var n=(0,u.default)(this,(i.__proto__||(0,s.default)(i)).call(this,e,r));return n.descriptor=t,n}return(0,c.default)(i,e),(0,n.default)(i,[{key:"publishMessage",value:function(s){return f(this,void 0,void 0,o.default.mark(function e(){var t,r,n,i;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={data:s},e.next=3,this.services.network.post(this.links.messages,t);case 3:return r=e.sent,n=r.body,i=this._handleMessagePublished(n.sid,s,!1),e.abrupt("return",i);case 7:case"end":return e.stop()}},e,this)}))}},{key:"setTtl",value:function(n){return f(this,void 0,void 0,o.default.mark(function e(){var t,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d.validateMandatoryTtl(n),e.prev=1,t={ttl:n},e.next=5,this.services.network.post(this.uri,t);case 5:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])}))}},{key:"removeStream",value:function(){return f(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}))}},{key:"_update",value:function(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}},{key:"_handleMessagePublished",value:function(e,t,r){var n={sid:e,value:t};return this.emit("messagePublished",{message:n,isLocal:!r}),n}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e})}},{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"stream"}},{key:"lastEventId",get:function(){return null}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}}],[{key:"type",get:function(){return"stream"}}]),i}(h.SyncEntity);r.SyncStream=p,r.default=p},{"../entity":252,"../utils":269,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57}],263:[function(e,t,r){"use strict";var C=a(e("babel-runtime/regenerator")),d=a(e("babel-runtime/helpers/slicedToArray")),j=a(e("babel-runtime/core-js/get-iterator")),i=a(e("babel-runtime/helpers/extends")),s=a(e("babel-runtime/core-js/map")),o=a(e("babel-runtime/helpers/classCallCheck")),n=a(e("babel-runtime/helpers/createClass")),c=a(e("babel-runtime/core-js/promise"));function a(e){return e&&e.__esModule?e:{default:e}}var u=function(s,o,a,u){return new(a||(a=c.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var l=e("backoff"),S=e("./logger"),f=e("./syncerror"),E=e("twilio-transport"),h=function(){function t(e){(0,o.default)(this,t),this.localObject=e,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return(0,n.default)(t,[{key:"update",value:function(e,t){this.localObject._update(e,t)}},{key:"updatePending",value:function(e,t){this.pendingAction=e,this.pendingCorrelationId=t}},{key:"reset",value:function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.localObject._setSubscriptionState("none")}},{key:"markAsFailed",value:function(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new f.SyncError("Failed to subscribe on service events: "+e.error.message,e.error.status,e.error.code))}},{key:"complete",value:function(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}},{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"isEstablished",get:function(){return this.established}}]),t}(),p=function(){function t(e){var n=this;(0,o.default)(this,t),this.isConnected=!1,this.maxBatchSize=100,this.subscriptionTtlTimer=null,this.pendingPokeReason=null,this.services=e,this.subscriptions=new s.default,this.persisted=new s.default,this.latestPokeResponseArrivalTimestampByCorrelationId=new s.default;this.backoff=l.exponential((0,i.default)({randomisationFactor:.2,initialDelay:100,maxDelay:12e4},this.services.config.backoffConfig)),this.backoff.on("ready",function(){var e=n.getSubscriptionUpdateBatch(),t=e.action,r=e.subscriptions;t?n.applyNewSubscriptionUpdateBatch(t,r):(n.backoff.reset(),S.default.debug("All subscriptions resolved."))})}return(0,n.default)(t,[{key:"getSubscriptionUpdateBatch",value:function(){function e(e,t,r,n){var i=[],s=!0,o=!1,a=void 0;try{for(var u,c=(0,j.default)(e);!(s=(u=c.next()).done);s=!0){var l=(0,d.default)(u.value,2),f=l[0],h=l[1];if(!t.get(f)&&r!==h.pendingAction&&!h.rejectedWithError&&(i.push(h),n&&i.length>=n))break}}catch(e){o=!0,a=e}finally{try{!s&&c.return&&c.return()}finally{if(o)throw a}}return i}var t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(0<t.length)return{action:"establish",subscriptions:t};var r=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return 0<r.length?{action:"cancel",subscriptions:r}:{action:null,subscriptions:null}}},{key:"persist",value:function(){try{this.backoff.backoff()}catch(e){}}},{key:"applyNewSubscriptionUpdateBatch",value:function(w,x){return u(this,void 0,void 0,C.default.mark(function e(){var t,r,n,i,s,o,a,u,c,l,f,h,d,p,m,v,b,y,_,g,k=this;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=4;break}return S.default.debug("Twilsock connection (required for subscription) not ready; waiting\u2026"),this.backoff.reset(),e.abrupt("return");case 4:for(x=this.processLocalActions(w,x),t=(new Date).getTime(),r=!0,n=!1,i=void 0,e.prev=9,s=(0,j.default)(x);!(r=(o=s.next()).done);r=!0)a=o.value,this.recordActionAttemptOn(a,w,t);e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),n=!0,i=e.t0;case 17:e.prev=17,e.prev=18,!r&&s.return&&s.return();case 20:if(e.prev=20,!n){e.next=23;break}throw i;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return u=this.pendingPokeReason,this.pendingPokeReason=null,e.prev=27,e.next=30,this.request(w,t,u,x);case 30:c=e.sent,l=c.body.max_batch_size,!isNaN(parseInt(l))&&isFinite(l)&&0<l&&(this.maxBatchSize=l),this.subscriptionTtlTimer||(f=c.body.ttl_in_s,h=!isNaN(parseFloat(f))&&isFinite(f),h&&0<f&&(this.subscriptionTtlTimer=setTimeout(function(){return k.onSubscriptionTtlElapsed()},1e3*f))),"establish"===w&&(d=c.body.estimated_delivery_in_ms,p=!isNaN(parseFloat(d))&&isFinite(d),p&&0<d?setTimeout(function(){return k.verifyPokeDelivery(t,d,x)},d):S.default.error("Invalid timeout: "+d),x.filter(function(e){return e.pendingCorrelationId===t}).forEach(function(e){return e.localObject._setSubscriptionState("response_in_flight")})),this.backoff.reset(),e.next=60;break;case 38:for(e.prev=38,e.t1=e.catch(27),m=!0,v=!1,b=void 0,e.prev=43,y=(0,j.default)(x);!(m=(_=y.next()).done);m=!0)g=_.value,this.recordActionFailureOn(g,w);e.next=51;break;case 47:e.prev=47,e.t2=e.catch(43),v=!0,b=e.t2;case 51:e.prev=51,e.prev=52,!m&&y.return&&y.return();case 54:if(e.prev=54,!v){e.next=57;break}throw b;case 57:return e.finish(54);case 58:return e.finish(51);case 59:e.t1 instanceof E.TwilsockUnavailableError?(S.default.debug("Twilsock connection (required for subscription) not ready (c:"+t+"); waiting\u2026"),this.backoff.reset()):(S.default.debug("Failed an attempt to "+w+" subscriptions (c:"+t+"); retrying",e.t1),this.persist());case 60:case"end":return e.stop()}},e,this,[[9,13,17,25],[18,,20,24],[27,38],[43,47,51,59],[52,,54,58]])}))}},{key:"verifyPokeDelivery",value:function(t,e,r){var n=this,i=this.latestPokeResponseArrivalTimestampByCorrelationId.get(t),s=i?(new Date).getTime()-i:e;e<=s?(r.filter(function(e){return e.pendingCorrelationId===t}).forEach(function(e){e.updatePending(null,null),e.retryCount++,n.persisted.delete(e.sid)}),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(t)):setTimeout(function(){return n.verifyPokeDelivery(t,e,r)},e-s)}},{key:"processLocalActions",value:function(e,t){return"cancel"===e?t.filter(function(e){return!e.rejectedWithError}):t}},{key:"recordActionAttemptOn",value:function(e,t,r){if(e.localObject._setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,r);else{var n=this.persisted.get(e.sid);n&&n.updatePending(t,r)}}},{key:"recordActionFailureOn",value:function(e,t){e.localObject._setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted.delete(e.sid)}},{key:"request",value:function(t,e,r,n){var i=n.map(function(e){return{object_sid:e.sid,object_type:e.type,last_event_id:"establish"===t?e.lastEventId:void 0}}),s=n.filter(function(e){return 0<e.retryCount}).length;S.default.debug("Attempting '"+t+"' request (c:"+e+"):",i);var o={event_protocol_version:3,action:t,correlation_id:e,retried_requests:s,ttl_in_s:-1,requests:i};return"ttl"===r&&(o.reason=r),this.services.network.post(this.services.config.subscriptionsUri,o,null,!0)}},{key:"add",value:function(e,t){S.default.debug("Establishing intent to subscribe to "+e);var r=this.subscriptions.get(e);r&&r.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,new h(t)),this.persist())}},{key:"remove",value:function(e){S.default.debug("Establishing intent to unsubscribe from "+e),this.subscriptions.delete(e)&&this.persist()}},{key:"acceptMessage",value:function(e,t){switch(S.default.trace("Subscriptions received",e),e.correlation_id&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(e.correlation_id,(new Date).getTime()),e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(e.event,e.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(e.event,e.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(e.event,e.correlation_id);break;case(e.event_type.match(/^(?:map|list|document|stream)_/)||{}).input:this.applyEventToSubscribedEntity(e.event_type.match(/^map_/)?e.event.map_sid:e.event_type.match(/^list_/)?e.event.list_sid:e.event_type.match(/^document_/)?e.event.document_sid:e.event_type.match(/^stream_/)?e.event.stream_sid:void 0,e,t);break;default:S.default.debug("Dropping unknown message type "+e.event_type)}}},{key:"applySubscriptionEstablishedMessage",value:function(e,t){var r=e.object_sid,n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?"interrupted"===e.replay_status?(S.default.debug("Event Replay for subscription to "+r+" (c:"+t+") interrupted; continuing eagerly."),n.updatePending(null,null),this.persisted.delete(n.sid),this.backoff.reset()):"completed"===e.replay_status&&(S.default.debug("Event Replay for subscription to "+r+" (c:"+t+") completed. Subscription is ready."),n.complete(e.last_event_id),this.persisted.set(e.object_sid,n),n.localObject._setSubscriptionState("established"),this.backoff.reset()):S.default.debug("Late message for "+e.object_sid+" (c:"+t+") dropped."),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(e,t){var r=this.persisted.get(e.object_sid);r&&r.pendingCorrelationId===t?(r.updatePending(null,null),r.localObject._setSubscriptionState("none"),this.persisted.delete(e.object_sid)):S.default.debug("Late message for "+e.object_sid+" (c:"+t+") dropped."),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(e,t){var r=e.object_sid,n=this.subscriptions.get(r),i=this.persisted.get(r);n&&i?i.pendingCorrelationId===t&&(S.default.error("Failed to subscribe on "+i.sid,e.error),i.markAsFailed(e),i.localObject._setSubscriptionState("none")):!n&&i&&(this.persisted.delete(r),i.localObject._setSubscriptionState("none")),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(e,t,r){if(e){var n;r=r||(n=this.persisted.get(e))&&n.isEstablished;var i=this.subscriptions.get(e);i?(t.event.type=t.event_type,i.update(t.event,r)):S.default.debug("Message dropped for SID '"+e+"', for which there is no subscription.")}}},{key:"onConnectionStateChanged",value:function(e){(this.isConnected=e)&&this.poke("reconnect")}},{key:"onSubscriptionTtlElapsed",value:function(){this.isConnected&&this.poke("ttl")}},{key:"poke",value:function(e){S.default.debug("Triggering event replay for all subscriptions, reason="+e),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var t=[],r=!0,n=!1,i=void 0;try{for(var s,o=(0,j.default)(this.persisted.values());!(r=(s=o.next()).done);r=!0){var a=s.value;a.reset(),a.rejectedWithError&&t.push(a)}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}this.persisted.clear();var u=!0,c=!1,l=void 0;try{for(var f,h=(0,j.default)(t);!(u=(f=h.next()).done);u=!0){var d=f.value;this.persisted.set(d.sid,d)}}catch(e){c=!0,l=e}finally{try{!u&&h.return&&h.return()}finally{if(c)throw l}}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),t}();r.Subscriptions=p,r.default=p},{"./logger":255,"./syncerror":266,"babel-runtime/core-js/get-iterator":32,"babel-runtime/core-js/map":35,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/extends":52,"babel-runtime/helpers/slicedToArray":55,"babel-runtime/regenerator":57,backoff:58,"twilio-transport":273}],264:[function(e,t,r){"use strict";var o=i(e("babel-runtime/core-js/object/get-prototype-of")),a=i(e("babel-runtime/helpers/classCallCheck")),u=i(e("babel-runtime/helpers/possibleConstructorReturn")),n=i(e("babel-runtime/helpers/inherits"));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=function(e){function s(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=arguments[3];(0,a.default)(this,s);var i=(0,u.default)(this,(s.__proto__||(0,o.default)(s)).call(this,e,t,r));return i.body=n,i}return(0,n.default)(s,e),s}(e("./syncerror").SyncError);r.SyncNetworkError=s,r.default=s},{"./syncerror":266,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],265:[function(e,t,r){"use strict";var n=i(e("babel-runtime/helpers/extends")),o=i(e("babel-runtime/regenerator")),s=i(e("babel-runtime/core-js/object/get-prototype-of")),a=i(e("babel-runtime/helpers/classCallCheck")),u=i(e("babel-runtime/helpers/createClass")),c=i(e("babel-runtime/helpers/possibleConstructorReturn")),l=i(e("babel-runtime/helpers/inherits")),f=i(e("babel-runtime/core-js/promise"));function i(e){return e&&e.__esModule?e:{default:e}}var h=function(s,o,a,u){return new(a||(a=f.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var d=e("./logger"),p=e("./entity"),m=e("./utils"),v=e("./mergingqueue"),b=e("./syncerror"),y=function(e){function i(e,t,r){(0,a.default)(this,i);var n=(0,c.default)(this,(i.__proto__||(0,s.default)(i)).call(this,e,r));n.isDeleted=!1;return n.updateMergingQueue=new v.MergingQueue(function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e}),n.descriptor=t,n.descriptor.data=n.descriptor.data||{},n.descriptor.date_updated=new Date(n.descriptor.date_updated),n}return(0,l.default)(i,e),(0,u.default)(i,[{key:"_update",value:function(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":e.id>this.lastEventId?(this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.emit("updated",{value:e.document_data,isLocal:!1}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,date_updated:e.date_created,data:e.document_data})):d.default.trace("Document update skipped, current:",this.lastEventId,", remote:",e.id);break;case"document_removed":this.onRemoved(!1)}}},{key:"set",value:function(n,i){return h(this,void 0,void 0,o.default.mark(function e(){var t,r=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i||{},m.validateOptionalTtl(t.ttl),e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,function(e){return r._setUnconditionally(n,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}))}},{key:"mutate",value:function(n,i){return h(this,void 0,void 0,o.default.mark(function e(){var t,r=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i||{},m.validateOptionalTtl(t.ttl),e.abrupt("return",this.updateMergingQueue.add(t,function(e){return r._setWithIfMatch(n,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}))}},{key:"update",value:function(t,r){return h(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(function(e){return(0,n.default)(e,t)},r));case 1:case"end":return e.stop()}},e,this)}))}},{key:"setTtl",value:function(r){return h(this,void 0,void 0,o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return m.validateMandatoryTtl(r),e.next=3,this._postUpdateToServer({ttl:r});case 3:t=e.sent,this.descriptor.date_expires=t.date_expires;case 5:case"end":return e.stop()}},e,this)}))}},{key:"_setUnconditionally",value:function(r,n){return h(this,void 0,void 0,o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._postUpdateToServer({data:r,revision:void 0,ttl:n});case 2:return t=e.sent,this._handleSuccessfulUpdateResult(t),e.abrupt("return",this.value);case 5:case"end":return e.stop()}},e,this)}))}},{key:"_setWithIfMatch",value:function(i,s){return h(this,void 0,void 0,o.default.mark(function e(){var t,r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=i(m.deepClone(this.value)))){e.next=22;break}return r=this.revision,e.prev=3,e.next=6,this._postUpdateToServer({data:t,revision:r,ttl:s});case 6:return n=e.sent,this._handleSuccessfulUpdateResult(n),e.abrupt("return",this.value);case 11:if(e.prev=11,e.t0=e.catch(3),412!==e.t0.status){e.next=19;break}return e.next=16,this._softSync();case 16:return e.abrupt("return",this._setWithIfMatch(i));case 19:throw e.t0;case 20:e.next=23;break;case 22:return e.abrupt("return",this.value);case 23:case"end":return e.stop()}},e,this,[[3,11]])}))}},{key:"_handleSuccessfulUpdateResult",value:function(e){e.last_event_id>this.descriptor.last_event_id&&(this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,date_updated:e.date_updated,data:e.data}),this.emit("updated",{value:this.value,isLocal:!0}))}},{key:"_postUpdateToServer",value:function(i){return h(this,void 0,void 0,o.default.mark(function e(){var t,r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=17;break}return t={data:i.data},"number"==typeof i.ttl&&(t.ttl=i.ttl),r=i.revision,e.prev=4,e.next=7,this.services.network.post(this.uri,t,r);case 7:return n=e.sent,e.abrupt("return",{revision:n.body.revision,data:i.data,last_event_id:n.body.last_event_id,date_updated:n.body.date_updated,date_expires:n.body.date_expires});case 11:throw e.prev=11,e.t0=e.catch(4),404===e.t0.status&&this.onRemoved(!1),e.t0;case 15:e.next=18;break;case 17:return e.abrupt("return",f.default.reject(new b.SyncError("The Document has been removed",404,54100)));case 18:case"end":return e.stop()}},e,this,[[4,11]])}))}},{key:"_softSync",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){var r=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.network.get(this.uri).then(function(e){var t={type:"document_updated",id:e.body.last_event_id,document_revision:e.body.revision,document_data:e.body.data,date_created:e.body.date_updated};return r._update(t),r}).catch(function(e){404===e.status?r.onRemoved(!1):d.default.error("Can't get updates for "+r.sid+":",e)}));case 1:case"end":return e.stop()}},e,this)}))}},{key:"onRemoved",value:function(e){this.isDeleted||(this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e}))}},{key:"removeDocument",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=6;break}return e.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0),e.next=7;break;case 6:return e.abrupt("return",f.default.reject(new b.SyncError("The Document has been removed",404,54100)));case 7:case"end":return e.stop()}},e,this)}))}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"document"}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"value",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}}],[{key:"type",get:function(){return"document"}}]),i}(p.SyncEntity);r.SyncDocument=y,r.default=y},{"./entity":252,"./logger":255,"./mergingqueue":257,"./syncerror":266,"./utils":269,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/extends":52,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57}],266:[function(e,t,r){"use strict";var s=i(e("babel-runtime/core-js/object/get-prototype-of")),o=i(e("babel-runtime/helpers/classCallCheck")),a=i(e("babel-runtime/helpers/possibleConstructorReturn")),n=i(e("babel-runtime/helpers/inherits"));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(e){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;(0,o.default)(this,i);var n=(0,a.default)(this,(i.__proto__||(0,s.default)(i)).call(this));return n.name=n.constructor.name,n.message=e+" (status: "+t+", code: "+r+")",n.status=t,n.code=r,n}return(0,n.default)(i,e),i}(Error);r.SyncError=u,r.default=u},{"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54}],267:[function(e,t,r){"use strict";var s=f(e("babel-runtime/helpers/extends")),u=f(e("babel-runtime/regenerator")),o=f(e("babel-runtime/core-js/object/get-prototype-of")),a=f(e("babel-runtime/helpers/classCallCheck")),n=f(e("babel-runtime/helpers/createClass")),c=f(e("babel-runtime/helpers/possibleConstructorReturn")),l=f(e("babel-runtime/helpers/inherits")),i=f(e("babel-runtime/core-js/promise"));function f(e){return e&&e.__esModule?e:{default:e}}var h=function(s,o,a,u){return new(a||(a=i.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var d=e("./utils"),p=e("./logger"),m=e("./entity"),v=e("./listitem"),b=e("./paginator"),y=e("./cache"),_=e("./mergingqueue"),g=e("./syncerror"),k=function(e){function i(e,t,r){(0,a.default)(this,i);var n=(0,c.default)(this,(i.__proto__||(0,o.default)(i)).call(this,e,r));return n.updateMergingQueue=new _.NamespacedMergingQueue(function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e}),n.cache=new y.Cache,n.descriptor=t,n.descriptor.date_updated=new Date(n.descriptor.date_updated),n}return(0,l.default)(i,e),(0,n.default)(i,[{key:"_addOrUpdateItemOnServer",value:function(n,i,s,o){return h(this,void 0,void 0,u.default.mark(function e(){var t,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={data:i},"number"==typeof o&&(t.ttl=o),e.next=4,this.services.network.post(n,t,s);case 4:return(r=e.sent).body.data=i,r.body.date_updated=new Date(r.body.date_updated),e.abrupt("return",r.body);case 8:case"end":return e.stop()}},e,this)}))}},{key:"push",value:function(i,s){return h(this,void 0,void 0,u.default.mark(function e(){var t,r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(s||{}).ttl,d.validateOptionalTtl(t),e.next=4,this._addOrUpdateItemOnServer(this.links.items,i,void 0,t);case 4:return r=e.sent,n=Number(r.index),this._handleItemMutated(n,r.url,r.last_event_id,r.revision,i,r.date_updated,r.date_expires,!0,!1),e.abrupt("return",this.cache.get(n));case 8:case"end":return e.stop()}},e,this)}))}},{key:"set",value:function(t,r,e){var n=this,i=e||{};return d.validateOptionalTtl(i.ttl),this.updateMergingQueue.squashAndAdd(t,i,function(e){return n._updateItemUnconditionally(t,r,e.ttl)})}},{key:"_updateItemUnconditionally",value:function(n,i,s){return h(this,void 0,void 0,u.default.mark(function e(){var t,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(n);case 2:return t=e.sent,e.next=5,this._addOrUpdateItemOnServer(t.uri,i,void 0,s);case 5:return r=e.sent,this._handleItemMutated(n,r.url,r.last_event_id,r.revision,r.data,r.date_updated,r.date_expires,!1,!1),e.abrupt("return",this.cache.get(n));case 8:case"end":return e.stop()}},e,this)}))}},{key:"_updateItemWithIfMatch",value:function(s,o,a){return h(this,void 0,void 0,u.default.mark(function e(){var t,r,n,i;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(s);case 2:if(t=e.sent,!(r=o(d.deepClone(t.value)))){e.next=25;break}return n=t.revision,e.prev=6,e.next=9,this._addOrUpdateItemOnServer(t.uri,r,n,a);case 9:return i=e.sent,this._handleItemMutated(s,i.url,i.last_event_id,i.revision,i.data,i.date_updated,i.date_expires,!1,!1),e.abrupt("return",this.cache.get(s));case 14:if(e.prev=14,e.t0=e.catch(6),412!==e.t0.status){e.next=22;break}return e.next=19,this._getItemFromServer(s);case 19:return e.abrupt("return",this._updateItemWithIfMatch(s,o,a));case 22:throw e.t0;case 23:e.next=26;break;case 25:return e.abrupt("return",t);case 26:case"end":return e.stop()}},e,this,[[6,14]])}))}},{key:"mutate",value:function(n,i,s){return h(this,void 0,void 0,u.default.mark(function e(){var t,r=this;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s||{},d.validateOptionalTtl(t.ttl),e.abrupt("return",this.updateMergingQueue.add(n,t,function(e){return r._updateItemWithIfMatch(n,i,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}))}},{key:"update",value:function(t,r,n){return h(this,void 0,void 0,u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,function(e){return(0,s.default)(e,r)},n));case 1:case"end":return e.stop()}},e,this)}))}},{key:"remove",value:function(n){return h(this,void 0,void 0,u.default.mark(function e(){var t,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(n);case 2:return t=e.sent,e.next=5,this.services.network.delete(t.uri);case 5:r=e.sent,this._handleItemRemoved(n,r.body.last_event_id,void 0,new Date(r.body.date_updated),!1);case 7:case"end":return e.stop()}},e,this)}))}},{key:"get",value:function(r){return h(this,void 0,void 0,u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.cache.get(r))){e.next=5;break}return e.abrupt("return",t);case 5:return e.abrupt("return",this._getItemFromServer(r));case 6:case"end":return e.stop()}},e,this)}))}},{key:"_getItemFromServer",value:function(r){return h(this,void 0,void 0,u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({index:r});case 2:if(!((t=e.sent).items.length<1)){e.next=7;break}throw new g.SyncError("No item with index "+r+" found",404,54151);case 7:return e.abrupt("return",t.items[0]);case 8:case"end":return e.stop()}},e,this)}))}},{key:"queryItems",value:function(o){return h(this,void 0,void 0,u.default.mark(function e(){var t,r,n,i,s=this;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=o||{},t=new d.UriBuilder(this.links.items).queryParam("From",o.from).queryParam("PageSize",o.limit).queryParam("Index",o.index).queryParam("PageToken",o.pageToken).queryParam("Order",o.order).build(),e.next=4,this.services.network.get(t);case 4:return r=e.sent,n=r.body.items.map(function(e){return e.date_updated=new Date(e.date_updated),s.cache.get(e.index)?s._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):s.cache.store(Number(e.index),new v.ListItem({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,dateUpdated:e.date_updated,dateExpires:e.date_expires,value:e.data}),e.last_event_id),s.cache.get(e.index)}),i=r.body.meta,e.abrupt("return",new b.Paginator(n,function(e){return s.queryItems({pageToken:e})},i.previous_token,i.next_token));case 8:case"end":return e.stop()}},e,this)}))}},{key:"getItems",value:function(t){return h(this,void 0,void 0,u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},d.validatePageSize(t.pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}},e,this)}))}},{key:"getContext",value:function(){return h(this,void 0,void 0,u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.context){e.next=5;break}return e.next=3,this.services.network.get(this.links.context);case 3:t=e.sent,this._updateContextIfRequired(t.body.data,t.body.last_event_id);case 5:return e.abrupt("return",this.context);case 6:case"end":return e.stop()}},e,this)}))}},{key:"setTtl",value:function(n){return h(this,void 0,void 0,u.default.mark(function e(){var t,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d.validateMandatoryTtl(n),e.prev=1,t={ttl:n},e.next=5,this.services.network.post(this.uri,t);case 5:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])}))}},{key:"setItemTtl",value:function(i,s){return h(this,void 0,void 0,u.default.mark(function e(){var t,r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d.validateMandatoryTtl(s),e.next=3,this.get(i);case 3:return t=e.sent,r={ttl:s},e.next=7,this.services.network.post(t.uri,r);case 7:n=e.sent,t.updateDateExpires(n.body.date_expires);case 9:case"end":return e.stop()}},e,this)}))}},{key:"removeList",value:function(){return h(this,void 0,void 0,u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}))}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){var r=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(r,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(r,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,r,n,i,s,o,a,u){if(this.shouldIgnoreEvent(e,r))p.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",r);else{this._updateRootDateUpdated(s);var c=this.cache.get(e);if(c)c.lastEventId<=r&&(c.update(r,n,i,s),void 0!==o&&c.updateDateExpires(o),this.emitItemMutationEvent(c,u,!1));else{var l=new v.ListItem({index:e,uri:t,lastEventId:r,revision:n,value:i,dateUpdated:s,dateExpires:o});this.cache.store(e,l,r),this.emitItemMutationEvent(l,u,a)}}}},{key:"emitItemMutationEvent",value:function(e,t,r){var n=r?"itemAdded":"itemUpdated";this.emit(n,{item:e,isLocal:!t})}},{key:"_handleItemRemoved",value:function(e,t,r,n,i){this._updateRootDateUpdated(n),this.cache.delete(e,t),this.emit("itemRemoved",{index:e,isLocal:!i,value:r})}},{key:"_handleContextUpdate",value:function(e,t,r){this._updateRootDateUpdated(r),this._updateContextIfRequired(e,t)&&this.emit("contextUpdated",{context:e,isLocal:!1})}},{key:"_updateContextIfRequired",value:function(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(p.default.trace("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"list"}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}],[{key:"type",get:function(){return"list"}}]),i}(m.SyncEntity);r.SyncList=k,r.default=k},{"./cache":247,"./entity":252,"./listitem":254,"./logger":255,"./mergingqueue":257,"./paginator":259,"./syncerror":266,"./utils":269,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/extends":52,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57}],268:[function(e,t,r){"use strict";var s=i(e("babel-runtime/helpers/extends")),l=i(e("babel-runtime/regenerator")),o=i(e("babel-runtime/core-js/object/get-prototype-of")),a=i(e("babel-runtime/helpers/classCallCheck")),n=i(e("babel-runtime/helpers/createClass")),u=i(e("babel-runtime/helpers/possibleConstructorReturn")),c=i(e("babel-runtime/helpers/inherits")),f=i(e("babel-runtime/core-js/promise"));function i(e){return e&&e.__esModule?e:{default:e}}var h=function(s,o,a,u){return new(a||(a=f.default))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var d=e("./utils"),p=e("./logger"),m=e("./entity"),v=e("./mapitem"),b=e("./paginator"),y=e("./cache"),_=e("./mergingqueue"),g=e("./syncerror"),k=function(e){function i(e,t,r){(0,a.default)(this,i);var n=(0,u.default)(this,(i.__proto__||(0,o.default)(i)).call(this,e,r));return n.updateMergingQueue=new _.NamespacedMergingQueue(function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e}),n.cache=new y.Cache,n.descriptor=t,n.descriptor.date_updated=new Date(n.descriptor.date_updated),t.items&&t.items.forEach(function(e){e.date_updated=new Date(e.date_updated),n.cache.store(e.key,new v.MapItem(e),e.last_event_id)}),n}return(0,c.default)(i,e),(0,n.default)(i,[{key:"set",value:function(n,i,s){return h(this,void 0,void 0,l.default.mark(function e(){var t,r=this;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s||{},d.validateOptionalTtl(t.ttl),e.abrupt("return",this.updateMergingQueue.squashAndAdd(n,t,function(e){return r._putItemUnconditionally(n,i,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}))}},{key:"get",value:function(t){return h(this,void 0,void 0,l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=4;break}return e.abrupt("return",this.cache.get(t));case 4:return e.abrupt("return",this._getItemFromServer(t));case 5:case"end":return e.stop()}},e,this)}))}},{key:"_getItemFromServer",value:function(r){return h(this,void 0,void 0,l.default.mark(function e(){var t;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({key:r});case 2:if(!((t=e.sent).items.length<1)){e.next=7;break}throw new g.SyncError("No item with key "+r+" found",404,54201);case 7:return e.abrupt("return",t.items[0]);case 8:case"end":return e.stop()}},e,this)}))}},{key:"mutate",value:function(n,i,s){return h(this,void 0,void 0,l.default.mark(function e(){var t,r=this;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s||{},d.validateOptionalTtl(t.ttl),e.abrupt("return",this.updateMergingQueue.add(n,t,function(e){return r._putItemWithIfMatch(n,i,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}))}},{key:"update",value:function(t,r,n){return h(this,void 0,void 0,l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,function(e){return(0,s.default)(e,r)},n));case 1:case"end":return e.stop()}},e,this)}))}},{key:"_putItemUnconditionally",value:function(n,i,s){return h(this,void 0,void 0,l.default.mark(function e(){var t,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._putItemToServer(n,i,void 0,s);case 2:return t=e.sent,r=t.item,this._handleItemMutated(r.key,r.url,r.last_event_id,r.revision,r.data,r.date_updated,r.date_expires,t.added,!1),e.abrupt("return",this.cache.get(r.key));case 6:case"end":return e.stop()}},e,this)}))}},{key:"_putItemWithIfMatch",value:function(o,a,u){return h(this,void 0,void 0,l.default.mark(function e(){var t,r,n,i,s;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(o).catch(function(e){if(404===e.status)return new v.MapItem({key:o,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw e});case 2:if(t=e.sent,!(r=a(d.deepClone(t.value)))){e.next=26;break}return n=t.revision,e.prev=6,e.next=9,this._putItemToServer(o,r,n,u);case 9:return i=e.sent,s=i.item,this._handleItemMutated(s.key,s.url,s.last_event_id,s.revision,s.data,s.date_updated,s.date_expires,i.added,!1),e.abrupt("return",this.cache.get(s.key));case 15:if(e.prev=15,e.t0=e.catch(6),412!==e.t0.status){e.next=23;break}return e.next=20,this._getItemFromServer(o);case 20:return e.abrupt("return",this._putItemWithIfMatch(o,a,u));case 23:throw e.t0;case 24:e.next=27;break;case 26:return e.abrupt("return",t);case 27:case"end":return e.stop()}},e,this,[[6,15]])}))}},{key:"_putItemToServer",value:function(o,a,u,c){return h(this,void 0,void 0,l.default.mark(function e(){var t,r,n,i,s;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.UriBuilder(this.links.items).pathSegment(o).build(),r={data:a},"number"==typeof c&&(r.ttl=c),e.prev=3,e.next=6,this.services.network.put(t,r,u);case 6:return n=e.sent,(i=n.body).data=a,i.date_updated=new Date(i.date_updated),s=201===n.status.code,e.abrupt("return",{added:s,item:i});case 14:throw e.prev=14,e.t0=e.catch(3),404===e.t0.status&&this.onRemoved(!1),e.t0;case 18:case"end":return e.stop()}},e,this,[[3,14]])}))}},{key:"remove",value:function(n){return h(this,void 0,void 0,l.default.mark(function e(){var t,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==n){e.next=2;break}throw new Error("Key argument is invalid");case 2:return e.next=4,this.get(n);case 4:return t=e.sent,e.next=7,this.services.network.delete(t.uri);case 7:r=e.sent,this._handleItemRemoved(n,r.body.last_event_id,void 0,new Date(r.body.date_updated),!1);case 9:case"end":return e.stop()}},e,this)}))}},{key:"queryItems",value:function(o){return h(this,void 0,void 0,l.default.mark(function e(){var t,r,n,i,s=this;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=o||{},t=new d.UriBuilder(this.links.items).queryParam("From",o.from).queryParam("PageSize",o.limit).queryParam("Key",o.key).queryParam("PageToken",o.pageToken).queryParam("Order",o.order).build(),e.next=4,this.services.network.get(t);case 4:return r=e.sent,n=r.body.items.map(function(e){return e.date_updated=new Date(e.date_updated),s.cache.get(e.key)?s._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):s.cache.store(e.key,new v.MapItem(e),e.last_event_id),s.cache.get(e.key)}),i=r.body.meta,e.abrupt("return",new b.Paginator(n,function(e){return s.queryItems({pageToken:e})},i.previous_token,i.next_token));case 8:case"end":return e.stop()}},e,this)}))}},{key:"getItems",value:function(t){return h(this,void 0,void 0,l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},d.validatePageSize(t.pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}},e,this)}))}},{key:"forEach",value:function(i){var e=this;return new f.default(function(r,n){e.queryItems().then(function e(t){t.items.forEach(function(e){return i(e)}),t.hasNextPage?t.nextPage().then(e).catch(n):r()}).catch(n)})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,r,n,i,s,o,a,u){if(this.shouldIgnoreEvent(e,r))p.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",r);else{this._updateRootDateUpdated(s);var c=this.cache.get(e);c?c.lastEventId<=r&&(c.update(r,n,i,s),void 0!==o&&c.updateDateExpires(o),this.emitItemMutationEvent(c,u,!1)):(c=new v.MapItem({key:e,url:t,last_event_id:r,revision:n,data:i,date_updated:s,date_expires:o}),this.cache.store(e,c,r),this.emitItemMutationEvent(c,u,a))}}},{key:"emitItemMutationEvent",value:function(e,t,r){var n=r?"itemAdded":"itemUpdated";this.emit(n,{item:e,isLocal:!t})}},{key:"_handleItemRemoved",value:function(e,t,r,n,i){this._updateRootDateUpdated(n),this.cache.delete(e,t),this.emit("itemRemoved",{key:e,isLocal:!i,value:r})}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e})}},{key:"setTtl",value:function(n){return h(this,void 0,void 0,l.default.mark(function e(){var t,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d.validateMandatoryTtl(n),e.prev=1,t={ttl:n},e.next=5,this.services.network.post(this.uri,t);case 5:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])}))}},{key:"setItemTtl",value:function(i,s){return h(this,void 0,void 0,l.default.mark(function e(){var t,r,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d.validateMandatoryTtl(s),e.next=3,this.get(i);case 3:return t=e.sent,r={ttl:s},e.next=7,this.services.network.post(t.uri,r);case 7:n=e.sent,t.updateDateExpires(n.body.date_expires);case 9:case"end":return e.stop()}},e,this)}))}},{key:"removeMap",value:function(){return h(this,void 0,void 0,l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}))}},{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"map"}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}],[{key:"type",get:function(){return"map"}}]),i}(m.SyncEntity);r.SyncMap=k,r.default=k},{"./cache":247,"./entity":252,"./logger":255,"./mapitem":256,"./mergingqueue":257,"./paginator":259,"./syncerror":266,"./utils":269,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/extends":52,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/regenerator":57}],269:[function(e,t,r){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass")),s=o(e("babel-runtime/core-js/json/stringify"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./syncerror");function u(e){return!isNaN(parseInt(e))&&isFinite(e)}function c(e){return u(e)&&0<=e}r.deepClone=function(e){return JSON.parse((0,s.default)(e))},r.validateOptionalTtl=function(e){if(void 0!==e&&!c(e))throw new a.default("Invalid TTL value, expected a positive integer, was '"+e+"'",400,54011)},r.validateMandatoryTtl=function(e){if(!c(e))throw new a.default("Invalid TTL value, expected a positive integer, was '"+e+"'",400,54011)},r.validatePageSize=function(e){var t;if(!(void 0===e||u(t=e)&&0<t))throw new a.default("Invalid pageSize parameter. Expected a positive integer, was '"+e+"'.",400,54455)};var l=function(){function t(e){(0,n.default)(this,t),this.base=e,this.args=new Array,this.paths=new Array}return(0,i.default)(t,[{key:"pathSegment",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"queryParam",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),t}();r.UriBuilder=l},{"./syncerror":266,"babel-runtime/core-js/json/stringify":34,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],270:[function(e,t,r){arguments[4][29][0].apply(r,arguments)},{"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,dup:29}],271:[function(e,t,r){t.exports={_args:[[{raw:"twilio-sync@^0.7.4",scope:null,escapedName:"twilio-sync",name:"twilio-sync",rawSpec:"^0.7.4",spec:">=0.7.4 <0.8.0",type:"range"},"/var/lib/jenkins/jobs/twilio-chat.js/workspace"]],_from:"twilio-sync@>=0.7.4 <0.8.0",_id:"twilio-sync@0.7.4",_inCache:!0,_location:"/twilio-sync",_nodeVersion:"7.7.1",_npmOperationalInternal:{host:"s3://npm-registry-packages",tmp:"tmp/twilio-sync-0.7.4.tgz_1516105521077_0.08853570837527514"},_npmUser:{name:"twilio-ci",email:"mroberts+twilio-ci@twilio.com"},_npmVersion:"4.1.2",_phantomChildren:{},_requested:{raw:"twilio-sync@^0.7.4",scope:null,escapedName:"twilio-sync",name:"twilio-sync",rawSpec:"^0.7.4",spec:">=0.7.4 <0.8.0",type:"range"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/twilio-sync/-/twilio-sync-0.7.4.tgz",_shasum:"f890954bfd8b6d73d0ff0309d982cce9d212eee1",_shrinkwrap:null,_spec:"twilio-sync@^0.7.4",_where:"/var/lib/jenkins/jobs/twilio-chat.js/workspace",author:{name:"Twilio"},browser:"browser/index.js",dependencies:{"babel-runtime":"^6.23.0",karibu:"^1.0.1",loglevel:"^1.4.1","operation-retrier":"^1.1.2",platform:"^1.3.3",rfc6902:"^1.3.0","twilio-ems-client":"^0.2.6","twilio-notifications":"^0.4.4","twilio-transport":"^0.1.4",twilsock:"^0.3.5",uuid:"^3.0.1",xxhashjs:"^0.2.1"},description:"Twilio Sync client library",devDependencies:{"@types/chai":"^3.4.35","@types/chai-as-promised":"0.0.29","@types/loglevel":"^1.4.29","@types/mocha":"^2.2.39","@types/node":"^7.0.5","@types/sinon":"^2.3.3","@types/sinon-chai":"^2.7.27","async-test-tools":"^1.0.6","babel-cli":"^6.23.0","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-array-includes":"^2.0.3","babel-plugin-transform-object-assign":"^6.22.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-es2015":"^6.22.0",babelify:"^7.3.0",backoff:"^2.5.0",browserify:"^14.1.0",chai:"^3.5.0","chai-as-promised":"^6.0.0",cheerio:"^0.22.0",del:"^2.2.2",gulp:"^3.9.1","gulp-babel":"^6.1.2","gulp-derequire":"^2.1.0","gulp-exit":"0.0.2","gulp-insert":"^0.5.0","gulp-istanbul":"^1.1.1","gulp-mocha":"^4.0.1","gulp-rename":"^1.2.2","gulp-replace":"^0.5.4","gulp-tap":"^0.1.3","gulp-tslint":"^7.1.0","gulp-typescript":"^3.1.5","gulp-uglify":"^2.0.1","gulp-util":"^3.0.8","ink-docstrap":"^1.3.0",isparta:"^4.0.0",jsdoc:"^3.4.3",jsonwebtoken:"^7.3.0",karma:"^1.5.0","karma-browserify":"^5.1.1","karma-browserstack-launcher":"^1.2.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.2","run-sequence":"^1.2.2",sinon:"^2.3.3","sinon-chai":"^2.8.0","ts-node":"^3.0.0",tslint:"^4.5.1",twilio:"^3.10.0",typescript:"2.2.1",underscore:"^1.8.3","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0",watchify:"^3.9.0"},directories:{},dist:{shasum:"f890954bfd8b6d73d0ff0309d982cce9d212eee1",tarball:"https://registry.npmjs.org/twilio-sync/-/twilio-sync-0.7.4.tgz"},engines:{node:">=6"},gitHead:"29cc7329e06175be1c71a1c8f1a00144ec336881",license:"MIT",main:"lib/index.js",maintainers:[{name:"schertkov",email:"schertkov@twilio.com"},{name:"twilio-ci",email:"mroberts+twilio-ci@twilio.com"}],name:"twilio-sync",optionalDependencies:{},readme:"ERROR: No README data found!",scripts:{prepare:"gulp build",test:"gulp unit-test"},version:"0.7.4"}},{}],272:[function(e,t,r){"use strict";var o=s(e("babel-runtime/core-js/json/stringify")),n=s(e("babel-runtime/core-js/promise")),i=s(e("babel-runtime/core-js/object/define-property"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,i.default)(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();var u="undefined"==typeof XMLHttpRequest?e("xmlhttprequest").XMLHttpRequest:XMLHttpRequest;var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return a(e,null,[{key:"request",value:function(t,r){return new n.default(function(n,i){var s=new u;for(var e in s.open(t,r.url,!0),s.onreadystatechange=function(){if(4===s.readyState){var e,t=(e=s.getAllResponseHeaders())?e.split("\r\n").map(function(e){return e.split(": ")}).filter(function(e){return 2===e.length&&0<e[1].length}).reduce(function(e,t){return e[t[0]]=t[1],e},{}):{},r=function(t){var e=t.getResponseHeader("Content-Type");if(!e||0!==e.indexOf("application/json")||0===t.responseText.length)return t.responseText;try{return JSON.parse(t.responseText)}catch(e){return t.responseText}}(s);200<=s.status&&s.status<300?n({status:s.status,headers:t,body:r}):i({status:s.status,description:s.statusText,headers:t,body:r})}},r.headers)s.setRequestHeader(e,r.headers[e]),"Content-Type"===e&&"application/json"===r.headers[e]&&(r.body=(0,o.default)(r.body));s.send(r.body)})}},{key:"get",value:function(e){return this.request("GET",e)}},{key:"post",value:function(e){return this.request("POST",e)}},{key:"put",value:function(e){return this.request("PUT",e)}},{key:"delete",value:function(e){return this.request("DELETE",e)}}]),e}();r.default=c,t.exports=c,t.exports=r.default},{"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/object/define-property":40,"babel-runtime/core-js/promise":45,xmlhttprequest:70}],273:[function(e,t,r){"use strict";var o=p(e("babel-runtime/core-js/promise")),i=p(e("babel-runtime/core-js/map")),s=p(e("babel-runtime/core-js/object/define-properties")),a=p(e("babel-runtime/core-js/object/keys")),n=p(e("babel-runtime/core-js/object/get-prototype-of")),u=p(e("babel-runtime/core-js/array/from")),c=p(e("babel-runtime/core-js/reflect/construct")),l=p(e("babel-runtime/core-js/object/set-prototype-of")),f=p(e("babel-runtime/core-js/object/create")),h=p(e("babel-runtime/helpers/typeof")),d=p(e("babel-runtime/core-js/object/define-property"));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.TwilsockUnavailableError=r.Transport=void 0;var m,v=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,d.default)(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),b=e("./httprequest"),y=(m=b)&&m.__esModule?m:{default:m};function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(t){function e(){var e=(0,c.default)(t,(0,u.default)(arguments));return(0,l.default)(e,(0,n.default)(this)),e}return e.prototype=(0,f.default)(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),l.default?(0,l.default)(e,t):e.__proto__=t,e}function k(e,t){var r=function(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var r={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7]};if(0<r.search.length){var n=r.search.substring(1);r.params=n.split("&").map(function(e){return e.split("=")}).reduce(function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e},{})}return r}throw new Error("Incorrect URI: "+e)}(t),n={method:e,host:r.host,path:r.pathname};return r.params&&(n.params=r.params),n}function w(e,t,r,n){return{to:k(e,t),headers:r,body:n}}function x(e){return{status:e.header.http_status,headers:e.header.http_headers,body:e.body}}function C(e,t,r){return{url:e,headers:t,body:r}}function j(e){try{e.body=JSON.parse(e.body)}catch(e){}return e}function S(e){for(var t=(0,a.default)(e.headers),r=t.length,n={};r--;){var i=t[r];n[i.toLowerCase()]=e.headers[i]}return e.headers=n,e}var E=function(e){function t(){return _(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,h.default)(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||(0,n.default)(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,h.default)(t)));e.prototype=(0,f.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(l.default?(0,l.default)(e,t):e.__proto__=t)}(t,g(Error)),t}(),T=function(){function n(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_(this,n),(0,s.default)(this,{_activeGetRequests:{value:new i.default},_twilsock:{value:e},_http:{value:y.default},_twilsockIsAvailable:{get:function(){return t._twilsock&&t._twilsock.isConnected}},_concurrentHttpRequestLimit:{value:r.concurrentHttpRequestLimit||1/0},_concurrentHttpRequestCount:{value:0,writable:!0},_requestQueue:{value:[]}}),e&&(e.connect(),e.on("connected",function(){return t._processQueuedRequests()}))}return v(n,[{key:"get",value:function(t,e,r){var n=this;if(this._activeGetRequests.has(t))return this._activeGetRequests.get(t);var i=this._get(t,e,r).then(function(e){return n._activeGetRequests.delete(t),e}).catch(function(e){throw n._activeGetRequests.delete(t),e});return this._activeGetRequests.set(t,i),i}},{key:"_oneOfBasedOnChannelAvailability",value:function(r,e){var t,n,i,s=this;return(t=r,n=t.sendViaTwilsock,i=t.sendDirectHttp,s._twilsockIsAvailable?n():e?o.default.reject(new E):s._concurrentHttpRequestCount>=s._concurrentHttpRequestLimit?new o.default(function(e,t){return s._requestQueue.push({sendingOptions:r,resolve:e,reject:t})}):(s._concurrentHttpRequestCount++,i().then(function(e){return s._concurrentHttpRequestCount--,s._processQueuedRequests(),e}).catch(function(e){throw s._concurrentHttpRequestCount--,s._processQueuedRequests(),e}))).then(S)}},{key:"_processQueuedRequests",value:function(){for(;0<this._requestQueue.length&&(this._twilsockIsAvailable||this._concurrentHttpRequestCount<this._concurrentHttpRequestLimit);){var e=this._requestQueue.shift();this._oneOfBasedOnChannelAvailability(e.sendingOptions,!1).then(e.resolve).catch(e.reject)}}},{key:"_get",value:function(e,t,r){var n=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return n._twilsock.send(w("GET",e,t)).then(x)},sendDirectHttp:function(){return n._http.get(C(e,t)).then(j)}},r)}},{key:"post",value:function(e,t,r,n){var i=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return i._twilsock.send(w("POST",e,t,r)).then(x)},sendDirectHttp:function(){return i._http.post(C(e,t,r)).then(j)}},n)}},{key:"put",value:function(e,t,r,n){var i=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return i._twilsock.send(w("PUT",e,t,r)).then(x)},sendDirectHttp:function(){return i._http.put(C(e,t,r)).then(j)}},n)}},{key:"delete",value:function(e,t,r){var n=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return n._twilsock.send(w("DELETE",e,t)).then(x)},sendDirectHttp:function(){return n._http.delete(C(e,t)).then(j)}},r)}}]),n}();r.default=T,r.Transport=T,r.TwilsockUnavailableError=E},{"./httprequest":272,"babel-runtime/core-js/array/from":31,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/create":38,"babel-runtime/core-js/object/define-properties":39,"babel-runtime/core-js/object/define-property":40,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/object/keys":43,"babel-runtime/core-js/object/set-prototype-of":44,"babel-runtime/core-js/promise":45,"babel-runtime/core-js/reflect/construct":46,"babel-runtime/helpers/typeof":56}],274:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=_(e("babel-runtime/core-js/object/freeze")),a=_(e("babel-runtime/core-js/set")),i=_(e("babel-runtime/core-js/promise")),u=_(e("babel-runtime/core-js/map")),c=_(e("babel-runtime/core-js/object/define-properties")),l=_(e("babel-runtime/core-js/object/get-prototype-of")),f=_(e("babel-runtime/helpers/classCallCheck")),s=_(e("babel-runtime/helpers/createClass")),h=_(e("babel-runtime/helpers/possibleConstructorReturn")),d=_(e("babel-runtime/helpers/inherits")),o=_(e("events")),p=_(e("./logger")),m=_(e("uuid")),v=_(e("./configuration")),b=_(e("./twilsock")),y=_(e("./packetinterface"));function _(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function o(e,t){(0,f.default)(this,o);var r=(0,h.default)(this,(o.__proto__||(0,l.default)(o)).call(this));(t=t||{}).logLevel=t.logLevel||"error",p.default.setLevel(t.logLevel);var n=new v.default(e,t),i=new b.default(n),s=new y.default(i);return(0,c.default)(r,{_config:{value:n},_socket:{value:i},_packet:{value:s},_registrations:{value:new u.default},_registrationsInProgress:{value:new u.default},isConnected:{get:function(){return r._socket.isConnected}},connected:{get:function(){return r._socket.isConnected}},state:{get:function(){return r._socket.state}}}),r._socket.on("message",function(e,t){return setTimeout(function(){r.emit("message",e,t)},0)}),r._socket.on("connected",function(){return r._updateRegistrations()}),r._socket.on("connected",function(){return r.emit("connected")}),r._socket.on("disconnected",function(){return r.emit("disconnected")}),r._socket.on("stateChanged",function(e){return r.emit("stateChanged",e)}),"undefined"!=typeof window&&void 0!==window.addEventListener&&window.addEventListener("online",function(){p.default.debug("Got online"),i.isRetrying()&&i.reconnect()}),r}return(0,d.default)(o,e),(0,s.default)(o,[{key:"send",value:function(e){return this._packet.send(e.to,e.headers,e.body)}},{key:"updateToken",value:function(e){return p.default.info("updateToken"),this._config.token===e||(this._config.updateToken(e),this._socket.updateToken()),i.default.resolve()}},{key:"_updateRegistration",value:function(t,r){var n=this;p.default.info("update registration for context",t);var i=this._registrationsInProgress.get(t);i||(i=new a.default,this._registrationsInProgress.set(t,i));var s=m.default.v4();return i.add(s),this._packet.putNotificationContext(t,r).then(function(){p.default.info("registration attempt succeeded for context",r),i.delete(s),0===(void 0!==i.size?i.size:(i._c||{}).size)&&(n._registrationsInProgress.delete(t),n.emit("registered",t))}).catch(function(e){p.default.info("registration attempt failed for context",r),p.default.debug(e),i.delete(s),0===(void 0!==i.size?i.size:(i._c||{}).size)&&(n._registrationsInProgress.delete(t),n.emit("registrationFailed",t,e))})}},{key:"_updateRegistrations",value:function(){var r=this;p.default.info("refreshing all registrations"),this._registrations.forEach(function(e,t){r._updateRegistration(t,e)})}},{key:"setNotificationsContext",value:function(e,t){if(!e||!t)throw new Error("Invalid arguments provided");this._registrations.set(e,t),this._socket.isConnected&&this._updateRegistration(e,t)}},{key:"removeNotificationsContext",value:function(e){this._registrations.has(e)&&(this._registrations.delete(e),this._socket.isConnected&&this._packet.deleteNotificationContext(e))}},{key:"connect",value:function(){return this._socket.connect()}},{key:"disconnect",value:function(){return this._socket.disconnect()}}]),o}(o.default);r.default=g,(0,n.default)(g),t.exports=r.default},{"./configuration":275,"./logger":277,"./packetinterface":278,"./twilsock":279,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/define-properties":39,"babel-runtime/core-js/object/freeze":41,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/core-js/set":47,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,events:214,uuid:283}],275:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=i(e("babel-runtime/core-js/object/define-properties")),o=i(e("babel-runtime/helpers/classCallCheck")),n=i(e("babel-runtime/helpers/createClass"));function i(e){return e&&e.__esModule?e:{default:e}}var a="wss://tsock.twilio.com",u="/v3/wsconnect",c=function(){function i(e,t){var r=this;(0,o.default)(this,i);var n=((t=t||{}).Twilsock||{}).uri||t.wsServer||a;(0,s.default)(this,{_twilsockWsHost:{value:n+u},_token:{value:e,writable:!0},twilsockUri:{get:function(){return r._twilsockWsHost}},token:{get:function(){return r._token}}})}return(0,n.default)(i,[{key:"updateToken",value:function(e){this._token=e}}]),i}();r.default=c,t.exports=r.default},{"babel-runtime/core-js/object/define-properties":39,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],276:[function(e,t,r){arguments[4][242][0].apply(r,arguments)},{"./client":274,dup:242}],277:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=s(e("babel-runtime/core-js/array/from")),i=s(e("loglevel"));function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return[e].concat((0,n.default)(t))}r.default={setLevel:function(e){i.default.setLevel(e)},trace:function(){i.default.trace.apply(null,o("Twilsock T:",arguments))},debug:function(){i.default.debug.apply(null,o("Twilsock D:",arguments))},info:function(){i.default.info.apply(null,o("Twilsock I:",arguments))},warn:function(){i.default.warn.apply(null,o("Twilsock W:",arguments))},error:function(){i.default.error.apply(null,o("Twilsock E:",arguments))}},t.exports=r.default},{"babel-runtime/core-js/array/from":31,loglevel:219}],278:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=c(e("babel-runtime/core-js/promise")),n=c(e("babel-runtime/core-js/map")),i=c(e("babel-runtime/core-js/object/define-properties")),s=c(e("babel-runtime/helpers/classCallCheck")),o=c(e("babel-runtime/helpers/createClass")),u=c(e("./logger"));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return 200<=e&&e<300}var f=function(){function r(e){var t=this;(0,s.default)(this,r),(0,i.default)(this,{_activeRequests:{value:new n.default},_socket:{value:e}}),this._socket.on("reply",this._processReply.bind(this)),this._socket.on("disconnected",function(){t._activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new Error("Twilsock disconnected"))}),t._activeRequests.clear()})}return(0,o.default)(r,[{key:"_processReply",value:function(t){var r=this._activeRequests.get(t.id);r&&(clearTimeout(r.timeout),this._activeRequests.delete(t.id),setTimeout(function(){var e;l(t.status.code)?(e=t)&&e.header&&e.header.http_status&&!l(t.header.http_status.code)?r.reject({status:t.header.http_status.code,description:t.header.http_status.status,body:t.body}):r.resolve(t):r.reject(new Error("Transport failure: "+t.status.status))},0))}},{key:"_storeRequest",value:function(e,t,r){var n={resolve:t,reject:r,timeout:setTimeout(function(){u.default.debug("request",e,"is timed out"),r(new Error("Twilsock: request timeout: "+e))},3e4)};this._activeRequests.set(e,n)}},{key:"send",value:function(n,i,s){var o=this;return new a.default(function(e,t){o._socket.isConnected||(u.default.info("Can not send upstream message. Twilsock is not in connected state"),t(new Error("Twilsock is not connected")));var r=o._socket.sendUpstreamMessage(n,i,s);u.default.trace("message sent: ",{id:r,address:n,headers:i,body:s}),o._storeRequest(r,e,t)})}},{key:"putNotificationContext",value:function(i,s){var o=this;return new a.default(function(e,t){o._socket.isConnected||(u.default.info("Can not send put notification context. Twilsock is not in connected state"),t(new Error("Twilsock is not connected")));var r={method:"put_notification_ctx",notification_ctx_id:i},n=o._socket.send(r,s);o._storeRequest(n,e,t)})}},{key:"deleteNotificationContext",value:function(i){var s=this;return new a.default(function(e,t){s._socket.isConnected||(u.default.info("Can not send delete notification context. Twilsock is not in connected state"),t(new Error("Twilsock is not connected")));var r={method:"delete_notification_ctx",notification_ctx_id:i},n=s._socket.send(r);s._storeRequest(n,e,t)})}},{key:"shutdown",value:function(){this._activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new Error("Twilsock: request cancelled by user"))}),this._activeRequests.clear()}}]),r}();r.default=f,t.exports=r.default},{"./logger":277,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/define-properties":39,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51}],279:[function(j,S,E){(function(e){"use strict";Object.defineProperty(E,"__esModule",{value:!0});var t=_(j("babel-runtime/core-js/object/freeze")),n=_(j("babel-runtime/core-js/promise")),u=_(j("babel-runtime/helpers/slicedToArray")),c=_(j("babel-runtime/core-js/get-iterator")),s=_(j("babel-runtime/core-js/map")),o=_(j("babel-runtime/core-js/object/define-properties")),a=_(j("babel-runtime/core-js/object/get-prototype-of")),l=_(j("babel-runtime/helpers/classCallCheck")),i=_(j("babel-runtime/helpers/createClass")),f=_(j("babel-runtime/helpers/possibleConstructorReturn")),h=_(j("babel-runtime/helpers/inherits")),d=_(j("babel-runtime/core-js/json/stringify")),p=_(j("babel-runtime/helpers/typeof")),r=_(j("events")),m=_(j("./logger")),v=_(j("uuid")),b=_(j("backoff")),y=_(j("javascript-state-machine"));function _(e){return e&&e.__esModule?e:{default:e}}var g=e.WebSocket||e.MozWebSocket||j("ws");function k(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}).length}function w(e){var t=Array.prototype.map.call(e,function(e){return String.fromCharCode(e)}).join("").replace(/(.)/g,function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r});return decodeURIComponent(t)}function x(e){var t=w(e);try{return JSON.parse(t)}catch(e){throw m.default.error("failed to parse input: ",t),e}}var C=function(e){function r(e){(0,l.default)(this,r);var i=(0,f.default)(this,(r.__proto__||(0,a.default)(r)).call(this));e.logLevel&&m.default.setLevel(e.logLevel);var t=b.default.exponential({randomisationFactor:.2,initialDelay:2e3,maxDelay:12e4});return t.on("ready",function(){i._retry()}),i.on("reply",function(e){i._processReply(e)}),(0,o.default)(i,{_config:{value:e},_transportReady:{value:!1,writable:!0},_disconnectedPromiseResolve:{value:null,writable:!0},_backoffDefault:{value:t},_backoff:{value:t,writable:!0},_fsm:{value:null,writable:!0},_watchTimer:{value:null,writable:!0},_timestamp:{value:0,writable:!0},_socket:{value:null,writable:!0},_activeToken:{value:null,writable:!0},activeToken:{enumerable:!0,get:function(){return i._activeToken}},state:{enumberable:!0,get:function(){return i._getState()}},isConnected:{enumberable:!0,get:function(){return i._isConnected()}},_activeRequests:{value:new s.default},_disconnectingTimer:{value:null,writable:!0},_isDeferredUpdate:{value:!1,writable:!0}}),i._fsm=y.default.create({initial:"disconnected",events:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"}],callbacks:{onconnecting:function(){i._startWatchdogTimer(),i._setupSocket(),i.emit("connecting")},onenterinitialising:function(){i._sendInit()},onleaveinitialising:function(){i._cancelInit()},onenterupdating:function(){i._sendUpdate()},onleaveupdating:function(){i._cancelUpdate()},onenterretrying:function(){i._initRetry(),i.emit("connecting")},onenterconnected:function(){i._resetBackoff(),i._onConnected()},onuserUpdateToken:function(){i._resetBackoff()},ontokenRejected:function(){i._resetBackoff(),i._closeSocket(),i._finalizeSocket()},onuserDisconnect:function(){i._closeSocket()},onenterdisconnecting:function(){i._startDisconnectTimer()},onleavedisconnecting:function(){i._cancelDisconnectTimer()},onenterwaitSocketClosed:function(){i._startDisconnectTimer()},onleavewaitSocketClosed:function(){i._cancelDisconnectTimer()},onenterwaitOffloadSocketClosed:function(){i._startDisconnectTimer()},onleavewaitOffloadSocketClosed:function(){i._cancelDisconnectTimer()},ondisconnected:function(){i._resetBackoff(),i._finalizeSocket()},onreceiveClose:function(e,t,r,n){m.default.debug("onreceiveClose: ",n),i._onCloseReceived(n)},onreceiveOffload:function(e,t,r,n){m.default.debug("onreceiveoffload: ",n),i._modifyBackoff(n.body),i._onCloseReceived(n.status)},onunsupported:function(){i._closeSocket(),i._finalizeSocket()},onerror:function(){i._closeSocket(),i._finalizeSocket()},onenterstate:function(e,t,r){i._changeState(e,t,r)}},error:function(){m.default.warn("FSM: unexpected transition",arguments)}}),i}return(0,h.default)(r,e),(0,i.default)(r,[{key:"_changeState",value:function(e,t,r){var n=this;m.default.debug("FSM: ",e,": ",t,">>",r),this.emit("stateChanged",this.state),this._isDeferredUpdate&&(this._isDeferredUpdate=!1,setTimeout(function(){n.updateToken()},0))}},{key:"_resetBackoff",value:function(){m.default.trace("_resetBackoff"),this._backoff=this._backoffDefault,this._backoff.reset()}},{key:"_modifyBackoff",value:function(e){var t=this;m.default.trace("_modifyBackoff",e);var r=e?e.backoff_policy:null;if(r){var n=r.reconnect_min_ms||2e3,i=r.reconnect_max_ms||12e4;m.default.debug("new backoff policy",n,i),this._backoff=b.default.exponential({randomisationFactor:.2,initialDelay:n,maxDelay:i}),this._backoff.on("ready",function(){t._retry()})}}},{key:"_startDisconnectTimer",value:function(){var e=this;m.default.trace("_startDisconnectTimer"),this._disconnectingTimer&&(clearTimeout(this._disconnectingTimer),this._disconnectingTimer=null),this._disconnectingTimer=setTimeout(function(){m.default.debug("disconnecting is timed out"),e._closeSocket()},3e3)}},{key:"_cancelDisconnectTimer",value:function(){m.default.trace("_cancelDisconnectTimer"),this._disconnectingTimer&&(clearTimeout(this._disconnectingTimer),this._disconnectingTimer=null)}},{key:"_processReply",value:function(e){m.default.debug("receive reply:",e);var t=this._activeRequests.get(e.id);if(t)switch(clearTimeout(t.timeout),this._activeRequests.delete(e.id),t.reqType){case"init":200<=e.status.code&&e.status.code<300?this._fsm.initSuccess(e.body):401===e.status.code||403===e.status.code?this._fsm.tokenRejected(e.status):(429===e.status.code&&this._modifyBackoff(e.body),this._fsm.initError(e.status));break;case"update":200<=e.status.code&&e.status.code<300?this._fsm.updateSuccess(e.body):401===e.status.code||403===e.status.code?this._fsm.tokenRejected(e.status):(429===e.status.code&&this._modifyBackoff(e.body),this._fsm.updateError(e.status));break;default:m.default.error("unexpected reply")}}},{key:"_storeRequest",value:function(e,t,r){var n=this;m.default.trace("_storeRequest");var i={reqType:t,timeout:setTimeout(function(){m.default.debug("request",t,": ",e,"is timed out"),"init"!==t&&"update"!==t&&m.default.error("unknown request type",t),n._closeSocket()},r)};this._activeRequests.set(e,i)}},{key:"_isConnected",value:function(){return this.state===r.state.CONNECTED&&this._socket&&1===this._socket.readyState}},{key:"_getState",value:function(){if(!this._fsm)return r.state.DISCONNECTED;switch(this._fsm.current){case"connecting":case"initialising":case"retrying":case"error":return r.state.CONNECTING;case"updating":case"connected":return r.state.CONNECTED;case"rejected":return r.state.REJECTED;case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return r.state.DISCONNECTING;case"disconnected":default:return r.state.DISCONNECTED}}},{key:"_initRetry",value:function(){m.default.trace("_initRetry"),this._backoff.backoff()}},{key:"_retry",value:function(){m.default.trace("_retry"),this._socket=null,this._activeToken=null,this._fsm.userRetry()}},{key:"_onConnected",value:function(){this.emit("connected")}},{key:"_finalizeSocket",value:function(){if(m.default.trace("_finalizeSocket"),this._stopWatchdogTimer(),this._onDisconnected(),this._disconnectedPromiseResolve){var e=this._disconnectedPromiseResolve;this._disconnectedPromiseResolve=null,e()}}},{key:"_onDisconnected",value:function(){this._socket=null,this._activeToken=null,this.emit("disconnected")}},{key:"_setupSocket",value:function(){m.default.trace("_setupSocket:",this._config.token);var a=this,e=this._config.twilsockUri;m.default.debug("try to connect to:",e);var t=new g(e);t.binaryType="arraybuffer",t.onopen=function(){m.default.info("socket opened"),a._fsm.socketConnected()},t.onclose=function(e){m.default.info("socket closed",e),a._fsm.socketClosed()},t.onerror=function(e){m.default.error("error: ",e)},t.onmessage=function(t){m.default.trace("data: ",t.data);var e=new Uint8Array(t.data),r=function(e){for(var t="",r=0;r<e.length;++r){var n=String.fromCharCode(e[r]);if(t+=n,"\r"===n){r+=2;break}}var i=t.split(" ");return{size:r,protocol:i[0],version:i[1],headerSize:Number(i[2])}}(e);if("TWILSOCK"!==r.protocol||"V3.0"!==r.version)return m.default.error("unsupported protocol: "+r.protocol+" ver "+r.version),void a._fsm.unsupportedProtocol();var n=null;try{n=x(e.subarray(r.size,r.size+r.headerSize))}catch(e){return m.default.error("failed to parse message header",e,t),void a._fsm.protocolError()}m.default.trace("message received: ",n);var i=null;if(0<n.payload_size){var s=2+r.size+r.headerSize,o=n.payload_size;if(n.hasOwnProperty("payload_type")&&0!==n.payload_type.indexOf("application/json"))0===n.payload_type.indexOf("text/plain")&&(i=w(e.subarray(s,s+o)));else try{i=x(e.subarray(s,s+o))}catch(e){return m.default.error("failed to parse message body",e,t),void a._fsm.protocolError()}}a._updateActivityTimestamp(),"notification"===n.method?(a._confirmReceiving(n),a.emit("message",n.message_type,i)):"reply"===n.method?a.emit("reply",{id:n.id,status:n.status,header:n,body:i}):"ping"===n.method?a._confirmReceiving(n):"close"===n.method&&(m.default.trace("connection close initated by server"),a._confirmReceiving(n),308===n.status.code?(m.default.info("connection has been offloaded"),a._fsm.receiveOffload({status:n.status.status,body:i})):406===n.status.code?(m.default.error("connection has been rejected because server can not parse protocol"),a._fsm.receiveFatalClose()):417===n.status.code?(m.default.info("connection has been rejected because server could not understand client`s reply"),a._fsm.receiveFatalClose(n.status.status)):410===n.status.code?(m.default.info("connection has expired"),a._fsm.receiveClose(n.status.status)):401===n.status.code?(m.default.info("connection is not authenticate"),a._fsm.receiveClose(n.status.status)):(m.default.error("unexpected close: ",n.status),a._fsm.receiveOffload({status:n.status.status,body:null})))},this._activeToken=this._config.token,this._socket=t}},{key:"_sendInit",value:function(){m.default.trace("_sendInit");var e={id:v.default.v4(),method:"init",token:this._activeToken};this._sendPacket(e),this._storeRequest(e.id,"init",5e3)}},{key:"_sendUpdate",value:function(){m.default.trace("_sendUpdate");var e={id:v.default.v4(),method:"update",token:this._activeToken};this._sendPacket(e),this._storeRequest(e.id,"update",5e3)}},{key:"_cancelInit",value:function(){m.default.trace("_cancelInit");var e=!0,t=!1,r=void 0;try{for(var n,i=(0,c.default)(this._activeRequests);!(e=(n=i.next()).done);e=!0){var s=(0,u.default)(n.value,2),o=s[0],a=s[1];a&&"init"===a.reqType&&(clearTimeout(a.timeout),this._activeRequests.delete(o))}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}}},{key:"_cancelUpdate",value:function(){m.default.trace("_cancelUpdate");var e=!0,t=!1,r=void 0;try{for(var n,i=(0,c.default)(this._activeRequests);!(e=(n=i.next()).done);e=!0){var s=(0,u.default)(n.value,2),o=s[0],a=s[1];a&&"update"===a.reqType&&(clearTimeout(a.timeout),this._activeRequests.delete(o))}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}}},{key:"_confirmReceiving",value:function(e){m.default.trace("_confirmReceiving");var t={method:"reply",id:e.id,payload_type:"application/json",status:{code:200,status:"OK"}};try{this._sendPacket(t)}catch(e){m.default.debug("failed to confirm packet receiving",e)}}},{key:"_sendPacket",value:function(t,e){var r=function(e){switch(void 0===e?"undefined":(0,p.default)(e)){case"undefined":return"";case"object":return(0,d.default)(e);default:return e}}(e);t.payload_size=k(r);var n=(0,d.default)(t)+"\r\n",i="TWILSOCK V3.0 "+(k(n)-2)+"\r\n";m.default.debug("send request:",i+n+r);var s,o,a=(s=encodeURIComponent(i+n+r).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}),o=new Uint8Array(s.length),Array.prototype.forEach.call(s,function(e,t){o[t]=e.charCodeAt(0)}),o);try{this._socket.send(a.buffer)}catch(e){throw m.default.info("failed to send ",t,e),m.default.info(e.stack),e}}},{key:"_closeSocket",value:function(){m.default.trace("_closeSocket"),this._socket&&(this._socket.onopen=null,this._socket.onclose=null,this._socket.onerror=null,this._socket.onmessage=null,this._socket.close()),this._fsm.socketClosed()}},{key:"connect",value:function(){m.default.trace("connect"),this._fsm.userConnect()}},{key:"reconnect",value:function(){m.default.trace("reconnect"),this._resetBackoff(),this._fsm.userRetry()}},{key:"isRetrying",value:function(){return"retrying"===this._fsm.current}},{key:"disconnect",value:function(){var t=this;return m.default.trace("disconnect"),this._fsm.is("disconnected")?n.default.resolve():new n.default(function(e){t._disconnectedPromiseResolve=e,t._fsm.userDisconnect()})}},{key:"updateToken",value:function(){if(m.default.trace("updateToken:",this._config.token),"initialising"===this._fsm.current||"updating"===this._fsm.current||"waitSocketClosed"===this._fsm.current||"waitOffloadSocketClosed"===this._fsm.current)return m.default.debug("defer updateToken because of",this._fsm.current,"is in progress"),void(this._isDeferredUpdate=!0);this._isDeferredUpdate=!1,this._activeToken=this._config.token,this._fsm.userUpdateToken()}},{key:"sendUpstreamMessage",value:function(e,t,r){var n=v.default.v4(),i={host:e.host,path:e.path,method:e.method};e.hasOwnProperty("params")&&(i.params=e.params);var s={method:"message",id:n,http_request:i};return t&&(s.http_request.headers=t),t&&t.hasOwnProperty("Content-Type")&&(s.payload_type=t["Content-Type"]),this._sendPacket(s,r),n}},{key:"send",value:function(e,t){return e.id=e.id||v.default.v4(),this._sendPacket(e,t),e.id}},{key:"_onCloseReceived",value:function(e){m.default.trace("_onCloseReceived"),m.default.info("connection closed by server, reason is",e),this._socket&&(this._socket.onopen=null,this._socket.onerror=null,this._socket.onmessage=null)}},{key:"_startWatchdogTimer",value:function(){var e=this;m.default.trace("_startWatchdogTimer"),this._timestamp=Date.now(),this._watchTimer=setInterval(function(){43e3<Date.now()-e._timestamp&&e._socket&&e._socket.close()},5e3)}},{key:"_stopWatchdogTimer",value:function(){m.default.trace("_stopWatchdogTimer"),clearInterval(this._watchTimer)}},{key:"_updateActivityTimestamp",value:function(){m.default.trace("_updateActivityTimestamp"),this._timestamp=Date.now()}}]),r}(r.default);(E.default=C).state={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTING:"disconnecting",ERROR:"error",REJECTED:"rejected"},(0,t.default)(C.state),(0,t.default)(C),S.exports=E.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./logger":277,"babel-runtime/core-js/get-iterator":32,"babel-runtime/core-js/json/stringify":34,"babel-runtime/core-js/map":35,"babel-runtime/core-js/object/define-properties":39,"babel-runtime/core-js/object/freeze":41,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":50,"babel-runtime/helpers/createClass":51,"babel-runtime/helpers/inherits":53,"babel-runtime/helpers/possibleConstructorReturn":54,"babel-runtime/helpers/slicedToArray":55,"babel-runtime/helpers/typeof":56,backoff:58,events:214,"javascript-state-machine":217,uuid:283,ws:70}],280:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],281:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],282:[function(h,e,E){(function(n,i){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
var a=/%[sdj%]/g;E.format=function(e){if(!g(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(u(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,s=String(e).replace(a,function(e){if("%%"===e)return"%";if(i<=r)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),o=n[r];r<i;o=n[++r])y(o)||!l(o)?s+=" "+o:s+=" "+u(o);return s},E.deprecate=function(e,t){if(k(i.process))return function(){return E.deprecate(e,t).apply(this,arguments)};if(!0===n.noDeprecation)return e;var r=!1;return function(){if(!r){if(n.throwDeprecation)throw new Error(t);n.traceDeprecation?console.trace(t):console.error(t),r=!0}return e.apply(this,arguments)}};var e,s={};function u(e,t){var r={seen:[],stylize:c};return 3<=arguments.length&&(r.depth=arguments[2]),4<=arguments.length&&(r.colors=arguments[3]),b(t)?r.showHidden=t:t&&E._extend(r,t),k(r.showHidden)&&(r.showHidden=!1),k(r.depth)&&(r.depth=2),k(r.colors)&&(r.colors=!1),k(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=o),d(r,e,r.depth)}function o(e,t){var r=u.styles[t];return r?"\x1b["+u.colors[r][0]+"m"+e+"\x1b["+u.colors[r][1]+"m":e}function c(e,t){return e}function d(t,r,n){if(t.customInspect&&r&&j(r.inspect)&&r.inspect!==E.inspect&&(!r.constructor||r.constructor.prototype!==r)){var e=r.inspect(n,t);return g(e)||(e=d(t,e,n)),e}var i=function(e,t){if(k(t))return e.stylize("undefined","undefined");if(g(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(_(t))return e.stylize(""+t,"number");if(b(t))return e.stylize(""+t,"boolean");if(y(t))return e.stylize("null","null")}(t,r);if(i)return i;var s,o=Object.keys(r),a=(s={},o.forEach(function(e,t){s[e]=!0}),s);if(t.showHidden&&(o=Object.getOwnPropertyNames(r)),C(r)&&(0<=o.indexOf("message")||0<=o.indexOf("description")))return p(r);if(0===o.length){if(j(r)){var u=r.name?": "+r.name:"";return t.stylize("[Function"+u+"]","special")}if(w(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(x(r))return t.stylize(Date.prototype.toString.call(r),"date");if(C(r))return p(r)}var c,l="",f=!1,h=["{","}"];(v(r)&&(f=!0,h=["[","]"]),j(r))&&(l=" [Function"+(r.name?": "+r.name:"")+"]");return w(r)&&(l=" "+RegExp.prototype.toString.call(r)),x(r)&&(l=" "+Date.prototype.toUTCString.call(r)),C(r)&&(l=" "+p(r)),0!==o.length||f&&0!=r.length?n<0?w(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),c=f?function(t,r,n,i,e){for(var s=[],o=0,a=r.length;o<a;++o)S(r,String(o))?s.push(m(t,r,n,i,String(o),!0)):s.push("");return e.forEach(function(e){e.match(/^\d+$/)||s.push(m(t,r,n,i,e,!0))}),s}(t,r,n,a,o):o.map(function(e){return m(t,r,n,a,e,f)}),t.seen.pop(),function(e,t,r){if(60<e.reduce(function(e,t){return 0,0<=t.indexOf("\n")&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0))return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(c,l,h)):h[0]+l+h[1]}function p(e){return"["+Error.prototype.toString.call(e)+"]"}function m(e,t,r,n,i,s){var o,a,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),S(n,i)||(o="["+i+"]"),a||(e.seen.indexOf(u.value)<0?-1<(a=y(r)?d(e,u.value,null):d(e,u.value,r-1)).indexOf("\n")&&(a=s?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),k(o)){if(s&&i.match(/^\d+$/))return a;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function v(e){return Array.isArray(e)}function b(e){return"boolean"==typeof e}function y(e){return null===e}function _(e){return"number"==typeof e}function g(e){return"string"==typeof e}function k(e){return void 0===e}function w(e){return l(e)&&"[object RegExp]"===t(e)}function l(e){return"object"==typeof e&&null!==e}function x(e){return l(e)&&"[object Date]"===t(e)}function C(e){return l(e)&&("[object Error]"===t(e)||e instanceof Error)}function j(e){return"function"==typeof e}function t(e){return Object.prototype.toString.call(e)}function r(e){return e<10?"0"+e.toString(10):e.toString(10)}E.debuglog=function(t){if(k(e)&&(e=n.env.NODE_DEBUG||""),t=t.toUpperCase(),!s[t])if(new RegExp("\\b"+t+"\\b","i").test(e)){var r=n.pid;s[t]=function(){var e=E.format.apply(E,arguments);console.error("%s %d: %s",t,r,e)}}else s[t]=function(){};return s[t]},(E.inspect=u).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},E.isArray=v,E.isBoolean=b,E.isNull=y,E.isNullOrUndefined=function(e){return null==e},E.isNumber=_,E.isString=g,E.isSymbol=function(e){return"symbol"==typeof e},E.isUndefined=k,E.isRegExp=w,E.isObject=l,E.isDate=x,E.isError=C,E.isFunction=j,E.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},E.isBuffer=h("./support/isBuffer");var f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}E.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[r(e.getHours()),r(e.getMinutes()),r(e.getSeconds())].join(":"),[e.getDate(),f[e.getMonth()],t].join(" ")),E.format.apply(E,arguments))},E.inherits=h("inherits"),E._extend=function(e,t){if(!t||!l(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,h("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":281,_process:225,inherits:280}],283:[function(e,t,r){var n=e("./v1"),i=e("./v4"),s=i;s.v1=n,s.v4=i,t.exports=s},{"./v1":286,"./v4":287}],284:[function(e,t,r){for(var i=[],n=0;n<256;++n)i[n]=(n+256).toString(16).substr(1);t.exports=function(e,t){var r=t||0,n=i;return n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]}},{}],285:[function(e,t,r){var n="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);t.exports=function(){return n(i),i}}else{var s=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),s[t]=e>>>((3&t)<<3)&255;return s}}},{}],286:[function(e,t,r){var p,m,v=e("./lib/rng"),b=e("./lib/bytesToUuid"),y=0,_=0;t.exports=function(e,t,r){var n=t&&r||0,i=t||[],s=(e=e||{}).node||p,o=void 0!==e.clockseq?e.clockseq:m;if(null==s||null==o){var a=v();null==s&&(s=p=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==o&&(o=m=16383&(a[6]<<8|a[7]))}var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:_+1,l=u-y+(c-_)/1e4;if(l<0&&void 0===e.clockseq&&(o=o+1&16383),(l<0||y<u)&&void 0===e.nsecs&&(c=0),1e4<=c)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");y=u,m=o;var f=(1e4*(268435455&(u+=122192928e5))+(_=c))%4294967296;i[n++]=f>>>24&255,i[n++]=f>>>16&255,i[n++]=f>>>8&255,i[n++]=255&f;var h=u/4294967296*1e4&268435455;i[n++]=h>>>8&255,i[n++]=255&h,i[n++]=h>>>24&15|16,i[n++]=h>>>16&255,i[n++]=o>>>8|128,i[n++]=255&o;for(var d=0;d<6;++d)i[n+d]=s[d];return t||b(i)}},{"./lib/bytesToUuid":284,"./lib/rng":285}],287:[function(e,t,r){var o=e("./lib/rng"),a=e("./lib/bytesToUuid");t.exports=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var s=0;s<16;++s)t[n+s]=i[s];return t||a(i)}},{"./lib/bytesToUuid":284,"./lib/rng":285}],288:[function(e,t,r){t.exports={h32:e("./xxhash"),h64:e("./xxhash64")}},{"./xxhash":289,"./xxhash64":290}],289:[function(r,n,e){(function(u){
/**
xxHash implementation in pure Javascript

Copyright (C) 2013, Pierre Curto
MIT license
*/
var a=r("cuint").UINT32;a.prototype.xxh_update=function(e,t){var r,n,i=l._low,s=l._high;r=(n=e*i)>>>16,r+=t*i,r&=65535,r+=e*s;var o=this._low+(65535&n),a=o>>>16,u=(a+=this._high+(65535&r))<<16|65535&o;a=(u=u<<13|u>>>19)>>>16,r=(n=(o=65535&u)*(i=c._low))>>>16,r+=a*i,r&=65535,r+=o*(s=c._high),this._low=65535&n,this._high=65535&r};var c=a("2654435761"),l=a("2246822519"),f=a("3266489917"),h=a("668265263"),d=a("374761393");function e(){return 2==arguments.length?new e(arguments[1]).update(arguments[0]).digest():this instanceof e?void t.call(this,arguments[0]):new e(arguments[0])}function t(e){return this.seed=e instanceof a?e.clone():a(e),this.v1=this.seed.clone().add(c).add(l),this.v2=this.seed.clone().add(l),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(c),this.total_len=0,this.memsize=0,this.memory=null,this}e.prototype.init=t,e.prototype.update=function(e){var t,r="string"==typeof e;r&&(e=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e.charCodeAt(r);i<128?t.push(i):i<2048?t.push(192|i>>6,128|63&i):i<55296||57344<=i?t.push(224|i>>12,128|i>>6&63,128|63&i):(r++,i=65536+((1023&i)<<10|1023&e.charCodeAt(r)),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return new Uint8Array(t)}(e),r=!1,t=!0),"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer&&(t=!0,e=new Uint8Array(e));var n=0,i=e.length,s=n+i;if(0==i)return this;if(this.total_len+=i,0==this.memsize&&(this.memory=r?"":t?new Uint8Array(16):new u(16)),this.memsize+i<16)return r?this.memory+=e:t?this.memory.set(e.subarray(0,i),this.memsize):e.copy(this.memory,this.memsize,0,i),this.memsize+=i,this;if(0<this.memsize){r?this.memory+=e.slice(0,16-this.memsize):t?this.memory.set(e.subarray(0,16-this.memsize),this.memsize):e.copy(this.memory,this.memsize,0,16-this.memsize);var o=0;r?(this.v1.xxh_update(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2)),o+=4,this.v2.xxh_update(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2)),o+=4,this.v3.xxh_update(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2)),o+=4,this.v4.xxh_update(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2))):(this.v1.xxh_update(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2]),o+=4,this.v2.xxh_update(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2]),o+=4,this.v3.xxh_update(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2]),o+=4,this.v4.xxh_update(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2])),n+=16-this.memsize,this.memsize=0,r&&(this.memory="")}if(n<=s-16)for(var a=s-16;r?(this.v1.xxh_update(e.charCodeAt(n+1)<<8|e.charCodeAt(n),e.charCodeAt(n+3)<<8|e.charCodeAt(n+2)),n+=4,this.v2.xxh_update(e.charCodeAt(n+1)<<8|e.charCodeAt(n),e.charCodeAt(n+3)<<8|e.charCodeAt(n+2)),n+=4,this.v3.xxh_update(e.charCodeAt(n+1)<<8|e.charCodeAt(n),e.charCodeAt(n+3)<<8|e.charCodeAt(n+2)),n+=4,this.v4.xxh_update(e.charCodeAt(n+1)<<8|e.charCodeAt(n),e.charCodeAt(n+3)<<8|e.charCodeAt(n+2))):(this.v1.xxh_update(e[n+1]<<8|e[n],e[n+3]<<8|e[n+2]),n+=4,this.v2.xxh_update(e[n+1]<<8|e[n],e[n+3]<<8|e[n+2]),n+=4,this.v3.xxh_update(e[n+1]<<8|e[n],e[n+3]<<8|e[n+2]),n+=4,this.v4.xxh_update(e[n+1]<<8|e[n],e[n+3]<<8|e[n+2])),(n+=4)<=a;);return n<s&&(r?this.memory+=e.slice(n):t?this.memory.set(e.subarray(n,s),this.memsize):e.copy(this.memory,this.memsize,n,s),this.memsize=s-n),this},e.prototype.digest=function(){var e,t,r=this.memory,n="string"==typeof r,i=0,s=this.memsize,o=new a;for((e=16<=this.total_len?this.v1.rotl(1).add(this.v2.rotl(7).add(this.v3.rotl(12).add(this.v4.rotl(18)))):this.seed.clone().add(d)).add(o.fromNumber(this.total_len));i<=s-4;)n?o.fromBits(r.charCodeAt(i+1)<<8|r.charCodeAt(i),r.charCodeAt(i+3)<<8|r.charCodeAt(i+2)):o.fromBits(r[i+1]<<8|r[i],r[i+3]<<8|r[i+2]),e.add(o.multiply(f)).rotl(17).multiply(h),i+=4;for(;i<s;)o.fromBits(n?r.charCodeAt(i++):r[i++],0),e.add(o.multiply(d)).rotl(11).multiply(c);return t=e.clone().shiftRight(15),e.xor(t).multiply(l),t=e.clone().shiftRight(13),e.xor(t).multiply(f),t=e.clone().shiftRight(16),e.xor(t),this.init(this.seed),e},n.exports=e}).call(this,r("buffer").Buffer)},{buffer:71,cuint:209}],290:[function(r,n,e){(function(c){
/**
xxHash64 implementation in pure Javascript

Copyright (C) 2016, Pierre Curto
MIT license
*/
var l=r("cuint").UINT64,f=l("11400714785074694791"),h=l("14029467366897019727"),a=l("1609587929392839161"),u=l("9650029242287828579"),d=l("2870177450012600261");function e(){return 2==arguments.length?new e(arguments[1]).update(arguments[0]).digest():this instanceof e?void t.call(this,arguments[0]):new e(arguments[0])}function t(e){return this.seed=e instanceof l?e.clone():l(e),this.v1=this.seed.clone().add(f).add(h),this.v2=this.seed.clone().add(h),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(f),this.total_len=0,this.memsize=0,this.memory=null,this}e.prototype.init=t,e.prototype.update=function(e){var t,r="string"==typeof e;r&&(e=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e.charCodeAt(r);i<128?t.push(i):i<2048?t.push(192|i>>6,128|63&i):i<55296||57344<=i?t.push(224|i>>12,128|i>>6&63,128|63&i):(r++,i=65536+((1023&i)<<10|1023&e.charCodeAt(r)),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return new Uint8Array(t)}(e),r=!1,t=!0),"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer&&(t=!0,e=new Uint8Array(e));var n=0,i=e.length,s=n+i;if(0==i)return this;if(this.total_len+=i,0==this.memsize&&(this.memory=r?"":t?new Uint8Array(32):new c(32)),this.memsize+i<32)return r?this.memory+=e:t?this.memory.set(e.subarray(0,i),this.memsize):e.copy(this.memory,this.memsize,0,i),this.memsize+=i,this;if(0<this.memsize){r?this.memory+=e.slice(0,32-this.memsize):t?this.memory.set(e.subarray(0,32-this.memsize),this.memsize):e.copy(this.memory,this.memsize,0,32-this.memsize);var o=0;if(r)u=l(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2),this.memory.charCodeAt(o+5)<<8|this.memory.charCodeAt(o+4),this.memory.charCodeAt(o+7)<<8|this.memory.charCodeAt(o+6)),this.v1.add(u.multiply(h)).rotl(31).multiply(f),o+=8,u=l(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2),this.memory.charCodeAt(o+5)<<8|this.memory.charCodeAt(o+4),this.memory.charCodeAt(o+7)<<8|this.memory.charCodeAt(o+6)),this.v2.add(u.multiply(h)).rotl(31).multiply(f),o+=8,u=l(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2),this.memory.charCodeAt(o+5)<<8|this.memory.charCodeAt(o+4),this.memory.charCodeAt(o+7)<<8|this.memory.charCodeAt(o+6)),this.v3.add(u.multiply(h)).rotl(31).multiply(f),o+=8,u=l(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2),this.memory.charCodeAt(o+5)<<8|this.memory.charCodeAt(o+4),this.memory.charCodeAt(o+7)<<8|this.memory.charCodeAt(o+6)),this.v4.add(u.multiply(h)).rotl(31).multiply(f);else u=l(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2],this.memory[o+5]<<8|this.memory[o+4],this.memory[o+7]<<8|this.memory[o+6]),this.v1.add(u.multiply(h)).rotl(31).multiply(f),o+=8,u=l(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2],this.memory[o+5]<<8|this.memory[o+4],this.memory[o+7]<<8|this.memory[o+6]),this.v2.add(u.multiply(h)).rotl(31).multiply(f),o+=8,u=l(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2],this.memory[o+5]<<8|this.memory[o+4],this.memory[o+7]<<8|this.memory[o+6]),this.v3.add(u.multiply(h)).rotl(31).multiply(f),o+=8,u=l(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2],this.memory[o+5]<<8|this.memory[o+4],this.memory[o+7]<<8|this.memory[o+6]),this.v4.add(u.multiply(h)).rotl(31).multiply(f);n+=32-this.memsize,this.memsize=0,r&&(this.memory="")}if(n<=s-32){var a=s-32;do{var u;if(r)u=l(e.charCodeAt(n+1)<<8|e.charCodeAt(n),e.charCodeAt(n+3)<<8|e.charCodeAt(n+2),e.charCodeAt(n+5)<<8|e.charCodeAt(n+4),e.charCodeAt(n+7)<<8|e.charCodeAt(n+6)),this.v1.add(u.multiply(h)).rotl(31).multiply(f),n+=8,u=l(e.charCodeAt(n+1)<<8|e.charCodeAt(n),e.charCodeAt(n+3)<<8|e.charCodeAt(n+2),e.charCodeAt(n+5)<<8|e.charCodeAt(n+4),e.charCodeAt(n+7)<<8|e.charCodeAt(n+6)),this.v2.add(u.multiply(h)).rotl(31).multiply(f),n+=8,u=l(e.charCodeAt(n+1)<<8|e.charCodeAt(n),e.charCodeAt(n+3)<<8|e.charCodeAt(n+2),e.charCodeAt(n+5)<<8|e.charCodeAt(n+4),e.charCodeAt(n+7)<<8|e.charCodeAt(n+6)),this.v3.add(u.multiply(h)).rotl(31).multiply(f),n+=8,u=l(e.charCodeAt(n+1)<<8|e.charCodeAt(n),e.charCodeAt(n+3)<<8|e.charCodeAt(n+2),e.charCodeAt(n+5)<<8|e.charCodeAt(n+4),e.charCodeAt(n+7)<<8|e.charCodeAt(n+6)),this.v4.add(u.multiply(h)).rotl(31).multiply(f);else u=l(e[n+1]<<8|e[n],e[n+3]<<8|e[n+2],e[n+5]<<8|e[n+4],e[n+7]<<8|e[n+6]),this.v1.add(u.multiply(h)).rotl(31).multiply(f),u=l(e[(n+=8)+1]<<8|e[n],e[n+3]<<8|e[n+2],e[n+5]<<8|e[n+4],e[n+7]<<8|e[n+6]),this.v2.add(u.multiply(h)).rotl(31).multiply(f),u=l(e[(n+=8)+1]<<8|e[n],e[n+3]<<8|e[n+2],e[n+5]<<8|e[n+4],e[n+7]<<8|e[n+6]),this.v3.add(u.multiply(h)).rotl(31).multiply(f),u=l(e[(n+=8)+1]<<8|e[n],e[n+3]<<8|e[n+2],e[n+5]<<8|e[n+4],e[n+7]<<8|e[n+6]),this.v4.add(u.multiply(h)).rotl(31).multiply(f);n+=8}while(n<=a)}return n<s&&(r?this.memory+=e.slice(n):t?this.memory.set(e.subarray(n,s),this.memsize):e.copy(this.memory,this.memsize,n,s),this.memsize=s-n),this},e.prototype.digest=function(){var e,t,r=this.memory,n="string"==typeof r,i=0,s=this.memsize,o=new l;for(32<=this.total_len?((e=this.v1.clone().rotl(1)).add(this.v2.clone().rotl(7)),e.add(this.v3.clone().rotl(12)),e.add(this.v4.clone().rotl(18)),e.xor(this.v1.multiply(h).rotl(31).multiply(f)),e.multiply(f).add(u),e.xor(this.v2.multiply(h).rotl(31).multiply(f)),e.multiply(f).add(u),e.xor(this.v3.multiply(h).rotl(31).multiply(f)),e.multiply(f).add(u),e.xor(this.v4.multiply(h).rotl(31).multiply(f)),e.multiply(f).add(u)):e=this.seed.clone().add(d),e.add(o.fromNumber(this.total_len));i<=s-8;)n?o.fromBits(r.charCodeAt(i+1)<<8|r.charCodeAt(i),r.charCodeAt(i+3)<<8|r.charCodeAt(i+2),r.charCodeAt(i+5)<<8|r.charCodeAt(i+4),r.charCodeAt(i+7)<<8|r.charCodeAt(i+6)):o.fromBits(r[i+1]<<8|r[i],r[i+3]<<8|r[i+2],r[i+5]<<8|r[i+4],r[i+7]<<8|r[i+6]),o.multiply(h).rotl(31).multiply(f),e.xor(o).rotl(27).multiply(f).add(u),i+=8;for(i+4<=s&&(n?o.fromBits(r.charCodeAt(i+1)<<8|r.charCodeAt(i),r.charCodeAt(i+3)<<8|r.charCodeAt(i+2),0,0):o.fromBits(r[i+1]<<8|r[i],r[i+3]<<8|r[i+2],0,0),e.xor(o.multiply(f)).rotl(23).multiply(h).add(a),i+=4);i<s;)o.fromBits(n?r.charCodeAt(i++):r[i++],0,0,0),e.xor(o.multiply(d)).rotl(11).multiply(f);return t=e.clone().shiftRight(33),e.xor(t).multiply(h),t=e.clone().shiftRight(29),e.xor(t).multiply(a),t=e.clone().shiftRight(32),e.xor(t),this.init(this.seed),e},n.exports=e}).call(this,r("buffer").Buffer)},{buffer:71,cuint:209}],291:[function(e,t,r){t.exports={name:"twilio-chat",version:"2.2.0",description:"Twilio Chat service client library",main:"lib/index.js",browser:"browser/index.js",types:"./lib/client.d.ts",author:"Twilio",license:"MIT",dependencies:{"twilio-mcs-client":"^0.0.4",durational:"^1.1.0","isomorphic-form-data":"^1.0.0",loglevel:"^1.6.1","operation-retrier":"^1.3.2",platform:"^1.3.4",rfc6902:"^1.3.0","twilio-ems-client":"^0.2.6","twilio-notifications":"^0.4.4","twilio-sync":"^0.7.4","twilio-transport":"^0.1.4",twilsock:"^0.3.6",uuid:"^3.2.1"},devDependencies:{"@types/chai":"^3.4.35","@types/chai-as-promised":"0.0.31","@types/chai-string":"^1.1.30","@types/core-js":"^0.9.45","@types/mocha":"^2.2.46","@types/node":"^7.0.52","@types/sinon":"^2.3.7","@types/sinon-chai":"^2.7.27",async:"^2.6.0","async-test-tools":"^1.0.6","babel-eslint":"^7.2.3","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-istanbul":"^4.1.5","babel-plugin-transform-async-to-generator":"^6.24.1","babel-plugin-transform-object-assign":"^6.22.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-es2015":"^6.24.1","babel-require":"^1.0.1","babel-runtime":"^6.23.0",babelify:"^7.3.0",browserify:"^14.5.0","browserify-replace":"^0.9.0",chai:"^3.5.0","chai-as-promised":"^6.0.0","chai-string":"^1.4.0",cheerio:"^0.22.0",del:"^3.0.0",fs:"0.0.1-security",gulp:"^3.9.1","gulp-babel":"^6.1.2","gulp-derequire":"^2.1.0","gulp-if":"^2.0.2","gulp-insert":"^0.5.0","gulp-mocha":"^4.1.0","gulp-rename":"^1.2.2","gulp-sourcemaps":"^2.6.3","gulp-tap":"^1.0.1","gulp-tslint":"^8.1.0","gulp-typescript":"^3.2.3","gulp-uglify":"^3.0.0","gulp-util":"^3.0.8",gulpclass:"^0.1.2","ink-docstrap":"^1.3.2",jsdoc:"^3.5.5","jsdoc-strip-async-await":"^0.1.0","loglevel-message-prefix":"^2.0.1","mocha.parallel":"^0.15.5",nyc:"^11.4.1",path:"^0.12.7",sinon:"^2.3.2","sinon-chai":"^2.14.0","source-map-explorer":"^1.5.0","ts-node":"^3.0.4",tslint:"^5.9.1",twilio:"^3.11.0",typescript:"^2.6.2","uglify-save-license":"^0.4.1","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0"},engines:{node:">=6"}}},{}]},{},[3])(3)});